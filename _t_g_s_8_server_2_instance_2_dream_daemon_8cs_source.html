<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGS.Server/Instance/DreamDaemon.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d416ca425b5524beda4d68f02698bdb3.html">TGS.Server</a></li><li class="navelem"><a class="el" href="dir_247dc62efdba86a5141239c39fc82c17.html">Instance</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DreamDaemon.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_s_8_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Diagnostics;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.IO;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Linq;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Reflection;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Timers;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_interface.html">Interface</a>;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_s.html">TGS</a>.<a class="code" href="namespace_t_g_s_1_1_interface.html">Interface</a>.<a class="code" href="namespace_t_g_s_1_1_interface_1_1_components.html">Components</a>;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_s.html">TGS</a>.Server</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;{</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="comment">//manages the dd window.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="comment">//It&#39;s not possible to actually click it while starting it in CL mode, so in order to change visibility, security, etc. It restarts the process when the world reboots</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    sealed <span class="keyword">partial class </span>Instance : <a class="code" href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_dream_daemon.html">ITGDreamDaemon</a></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    {</div><div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">   17</a></span>&#160;        <span class="keyword">enum</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            <a class="code" href="namespace_t_g_s_1_1_interface.html#a6aba89d82a2fad3044034cdca1060c4fa6adf97f83acf6453d4a6a4b1070f3754">None</a>,</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            Requested,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;            Pinged,</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#aaf6f1302e487564be3dba0a01c087628">   27</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> DiagnosticsDir = <span class="stringliteral">&quot;Diagnostics&quot;</span>;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a26228c8ac1afc018e956a7e7ab7c9891">   31</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> ResourceDiagnosticsDir = DiagnosticsDir + <span class="stringliteral">&quot;/Resources&quot;</span>;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a2124d6039dfc0e03091319fc937440f5">   35</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> DDHangStartTime = 60;</div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#af176f1f39f4e8ff398687c5cab4eaf4a">   39</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> DDBadStartTime = 10;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#af8f30af9b177beb6c309e05d0d56be33">   44</a></span>&#160;        Process <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#af8f30af9b177beb6c309e05d0d56be33">Proc</a>;</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a16ce149ebe31e4dbf1bf318cc449e790">   48</a></span>&#160;        PerformanceCounter <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a16ce149ebe31e4dbf1bf318cc449e790">pcpu</a>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#af229871e1f4694c13d25a062502c2318">   53</a></span>&#160;        <span class="keywordtype">object</span> watchdogLock = <span class="keyword">new</span> object();</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a85b6d2d0e931f3961b0c1a75577d13dc">   57</a></span>&#160;        Thread <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a85b6d2d0e931f3961b0c1a75577d13dc">DDWatchdog</a>;</div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#af874c36b24f0624f234d04902345eda7">   61</a></span>&#160;        <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#af874c36b24f0624f234d04902345eda7">currentStatus</a>;</div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a068d9bbb0c0d5fe0507e662af2041865">   65</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a068d9bbb0c0d5fe0507e662af2041865">CurrentDDLog</a>;</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a7bf652d7d02976801c7a4781e65da93f">   69</a></span>&#160;        ushort currentPort = 0;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a4e1de416ca840519b72c26d3018afeaa">   74</a></span>&#160;        <span class="keywordtype">object</span> restartLock = <span class="keyword">new</span> object();</div><div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a5863c8e752bf5bf1c25fa4aedad37378">   78</a></span>&#160;        <span class="keywordtype">bool</span> RestartInProgress = <span class="keyword">false</span>;</div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a781f077de8c59157761c92e7984b5f66">   82</a></span>&#160;        <span class="keywordtype">bool</span> ReattachInsteadOfRestart = <span class="keyword">false</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a1f36b3bc5a88149c875173d089b0ea27">   87</a></span>&#160;        <a class="code" href="namespace_t_g_s_1_1_interface.html#a97d3a0f74c35081df4416cd97291bc1d">DreamDaemonSecurity</a> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a1f36b3bc5a88149c875173d089b0ea27">StartingSecurity</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a0c164f4ee52435f463c766bb11ead7ec">   92</a></span>&#160;        <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a0c164f4ee52435f463c766bb11ead7ec">AwaitingShutdown</a>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a2f1cfb897b842dde32d5f2299144f2d1">   97</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a2f1cfb897b842dde32d5f2299144f2d1">InitDreamDaemon</a>()</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            Directory.CreateDirectory(RelativePath(DiagnosticsDir));</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            Directory.CreateDirectory(RelativePath(ResourceDiagnosticsDir));</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            var Reattach = Config.ReattachRequired;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">if</span> (Reattach)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    Proc = Process.GetProcessById(Config.ReattachProcessID);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    <span class="keywordflow">if</span> (Proc == null)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;GetProcessById returned null!&quot;</span>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    WriteInfo(<span class="stringliteral">&quot;Reattached to running DD process!&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.DDReattachSuccess);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    ThreadPool.QueueUserWorkItem(_ =&gt;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                        Thread.Sleep(5000);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        SendMessage(<span class="stringliteral">&quot;DD: Update complete. Watch dog reactivated...&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    });</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="comment">//start wd </span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    lock (restartLock)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                        RestartInProgress = <span class="keyword">true</span>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                        ReattachInsteadOfRestart = <span class="keyword">true</span>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                    currentPort = Config.ReattachPort;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    serviceCommsKey = Config.ReattachCommsKey;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        GameAPIVersion = <span class="keyword">new</span> Version(Config.ReattachAPIVersion);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    currentStatus = <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                    DDWatchdog = <span class="keyword">new</span> Thread(<span class="keyword">new</span> ThreadStart(Watchdog));</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    DDWatchdog.Start();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    WriteError(String.Format(<span class="stringliteral">&quot;Failed to reattach to DreamDaemon! PID: {0}. Exception: {1}&quot;</span>, Config.ReattachProcessID, e.ToString()), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.DDReattachFail);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                <span class="keywordflow">finally</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    Config.ReattachRequired = <span class="keyword">false</span>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                    Config.Save();</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">if</span> (Proc == null)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                Proc = <span class="keyword">new</span> Process();</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            Proc.StartInfo.FileName = RelativePath(ByondDirectory + <span class="stringliteral">&quot;/bin/dreamdaemon.exe&quot;</span>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            Proc.StartInfo.UseShellExecute = <span class="keyword">false</span>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">if</span> (Reattach)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="comment">//autostart the server</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="keywordflow">if</span> (Config.Autostart)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <span class="comment">//break this off so we don&#39;t hold up starting the service</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                ThreadPool.QueueUserWorkItem(_ =&gt; { Start(); });</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a1ae646bbf90e6124e3a73029c193044e">  160</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a1ae646bbf90e6124e3a73029c193044e">DisposeDreamDaemon</a>()</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            var Detach = Config.ReattachRequired;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordtype">bool</span> RenameLog = <span class="keyword">false</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">if</span> (DaemonStatus() == <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="keywordflow">if</span> (!Detach)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    WorldAnnounce(<span class="stringliteral">&quot;Server service stopped&quot;</span>);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                    Thread.Sleep(1000);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    RenameLog = CurrentDDLog != null;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                    SendMessage(<span class="stringliteral">&quot;DD: Detaching watch dog for update!&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                    WriteCurrentDDLog(<span class="stringliteral">&quot;Service updating! Splitting diagnostics...&quot;</span>);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Detach)</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                Config.ReattachRequired = <span class="keyword">false</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            Stop();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordflow">if</span> (pcpu != null)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                pcpu.Dispose();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">if</span> (RenameLog)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    var rrdd = RelativePath(ResourceDiagnosticsDir);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                    File.Move(Path.Combine(rrdd, CurrentDDLog), Path.Combine(rrdd, <span class="stringliteral">&quot;SU-&quot;</span> + CurrentDDLog));</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keywordflow">catch</span> { }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a4d29ee9f52d6da07ac10577bc6db078c">  193</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a4d29ee9f52d6da07ac10577bc6db078c">DaemonStatus</a>()</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                <span class="keywordflow">return</span> currentStatus;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a28f6f35b683539aabb8a0044f6c83406">  202</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a28f6f35b683539aabb8a0044f6c83406">RequestRestart</a>()</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            SendCommand(SCHardReboot);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#af399ffae59f2f1a1595da516e7afca1a">  208</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#af399ffae59f2f1a1595da516e7afca1a">RequestStop</a>()</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keywordflow">if</span> (currentStatus != <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online || AwaitingShutdown != <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a>.None)</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                AwaitingShutdown = <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a>.Pinged;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            SendCommand(SCGracefulShutdown);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#ab09a0bda6eaa71b87c84c685e1e13093">  220</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#ab09a0bda6eaa71b87c84c685e1e13093">Stop</a>()</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            Thread t;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                t = DDWatchdog;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                DDWatchdog = null;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordflow">if</span> (t != null &amp;&amp; t.IsAlive)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                t.Abort();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                t.Join();</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server not running&quot;</span>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a6cac5447eccf0b05ea790475df167a5c">  239</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a6cac5447eccf0b05ea790475df167a5c">SetPort</a>(ushort new_port)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                Config.Port = new_port;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                RequestRestart();</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="comment">//handle a kill request from the server</span></div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a94bfbe235ce28e4f29001f79f16ad7e9">  249</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a94bfbe235ce28e4f29001f79f16ad7e9">KillMe</a>()</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordtype">bool</span> DoRestart;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                DoRestart = AwaitingShutdown == <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a>.None;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="keywordflow">if</span> (!DoRestart)</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    AwaitingShutdown = <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a>.Pinged;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="comment">//Do this is a seperate thread or we&#39;ll kill this thread in the middle of rebooting</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="keywordflow">if</span> (DoRestart)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                ThreadPool.QueueUserWorkItem(_ =&gt; { Restart(); });</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                ThreadPool.QueueUserWorkItem(_ =&gt; { Stop(); });</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a1f6e8f2764269059a4f278955b4e6204">  266</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a1f6e8f2764269059a4f278955b4e6204">Restart</a>()</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">if</span> (DaemonStatus() == <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Offline)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="keywordflow">return</span> Start();</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            lock (restartLock)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="keywordflow">if</span> (RestartInProgress)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Restart already in progress&quot;</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                RestartInProgress = <span class="keyword">true</span>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            SendMessage(<span class="stringliteral">&quot;DD: Hard restart triggered&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            Stop();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            var res = Start();</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                lock (restartLock)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    RestartInProgress = <span class="keyword">false</span>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a0ac4e6797d742a7cb055ce737de36e9c">  291</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a0ac4e6797d742a7cb055ce737de36e9c">WriteCurrentDDLog</a>(<span class="keywordtype">string</span> message)</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                <span class="keywordflow">if</span> (currentStatus != <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online || CurrentDDLog == null)</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                File.AppendAllText(Path.Combine(RelativePath(ResourceDiagnosticsDir), CurrentDDLog), String.Format(<span class="stringliteral">&quot;[{0}]: {1}\n&quot;</span>, DateTime.Now.ToLongTimeString(), message));</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a997fa4bfb2ab7d7034d33c5ae8268894">  304</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a997fa4bfb2ab7d7034d33c5ae8268894">Watchdog</a>()</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                lock (restartLock)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                    <span class="keywordflow">if</span> (!RestartInProgress)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                    {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                        SendMessage(<span class="stringliteral">&quot;DD: Server started, watchdog active...&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                        WriteInfo(<span class="stringliteral">&quot;Watchdog started&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.DDWatchdogStarted);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                    {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                        RestartInProgress = <span class="keyword">false</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                        <span class="keywordflow">if</span> (!ReattachInsteadOfRestart)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                            WriteInfo(<span class="stringliteral">&quot;Watchdog restarted&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.DDWatchdogRestarted);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                            ReattachInsteadOfRestart = <span class="keyword">false</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                    }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                var retries = 0;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                var MemTrackTimer = <span class="keyword">new</span> <a class="code" href="namespace_system.html">System</a>.Timers.Timer</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    AutoReset = <span class="keyword">true</span>,</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    Interval = 5000 <span class="comment">//every 5 seconds</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                };</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                MemTrackTimer.Elapsed += MemTrackTimer_Elapsed;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                    var starttime = DateTime.Now;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    lock (watchdogLock)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                        <span class="keywordflow">if</span> (AwaitingShutdown == <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a>.Requested)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                            SendCommand(SCGracefulShutdown);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                    }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="comment">//all good to go, let&#39;s start monitoring</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    var Now = DateTime.Now;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    lock (watchdogLock)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                        CurrentDDLog = DateTime.UtcNow.ToString(<span class="stringliteral">&quot;yyyy-MM-ddTHH-mm-ssZ&quot;</span>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                        WriteCurrentDDLog(<span class="stringliteral">&quot;Starting monitoring...&quot;</span>);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                    }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    pcpu = <span class="keyword">new</span> PerformanceCounter(<span class="stringliteral">&quot;Process&quot;</span>, <span class="stringliteral">&quot;% Processor Time&quot;</span>, Proc.ProcessName, <span class="keyword">true</span>);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    MemTrackTimer.Start();</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                        Proc.WaitForExit();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                    <span class="keywordflow">finally</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                    {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                        lock (watchdogLock) <span class="comment">//synchronize</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                        {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                            MemTrackTimer.Stop();</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                            pcpu.Dispose();</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                    WriteCurrentDDLog(<span class="stringliteral">&quot;Crash detected!&quot;</span>);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                    lock (watchdogLock)</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                    {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                        currentStatus = <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.HardRebooting;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                        currentPort = 0;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                        Proc.Close();</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                        <span class="keywordflow">if</span> (AwaitingShutdown == <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a>.Pinged)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                        var BadStart = (DateTime.Now - starttime).TotalSeconds &lt; DDBadStartTime;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                        <span class="keywordflow">if</span> (BadStart)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                        {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                            ++retries;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                            var sleep_time = (int)Math.Min(Math.Pow(2, retries), 3600); <span class="comment">//max of one hour</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                            SendMessage(String.Format(<span class="stringliteral">&quot;DD: Watchdog server startup failed! Retrying in {0} seconds...&quot;</span>, sleep_time), <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                            Thread.Sleep(sleep_time * 1000);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                        }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                        {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                            retries = 0;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                            var msg = <span class="stringliteral">&quot;DD: DreamDaemon crashed! Watchdog rebooting DD...&quot;</span>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                            SendMessage(msg, <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                            WriteWarning(msg, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.DDWatchdogRebootingServer);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                        }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                    }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    var res = StartImpl(<span class="keyword">true</span>);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                    <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Hard restart failed: &quot;</span> + res);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="keywordflow">catch</span> (ThreadAbortException)</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="comment">//No Mr bond, I expect you to die</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    <span class="keywordflow">if</span> (!Config.ReattachRequired)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                    {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                        Proc.Kill();</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                        Proc.WaitForExit();</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    }</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                    {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                        Config.ReattachProcessID = Proc.Id;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                        Config.ReattachPort = currentPort;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                        Config.ReattachAPIVersion = GameAPIVersion != null ? GameAPIVersion.ToString() : null;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                        Config.ReattachCommsKey = serviceCommsKey;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                        lock (restartLock)</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                        {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                            RestartInProgress = <span class="keyword">true</span>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                    }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                    Proc.Close();</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                <span class="keywordflow">catch</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                { }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                SendMessage(<span class="stringliteral">&quot;DD: Watchdog thread crashed!&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                WriteError(<span class="stringliteral">&quot;Watch dog thread crashed: &quot;</span> + e.ToString(), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.DDWatchdogCrash);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="keywordflow">finally</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                lock (watchdogLock)</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                {</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    currentStatus = <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Offline;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    currentPort = 0;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    AwaitingShutdown = <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a>.None;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                    lock (restartLock)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                        <span class="keywordflow">if</span> (!RestartInProgress)</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                        {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                            <span class="keywordflow">if</span> (!Config.ReattachRequired)</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                SendMessage(<span class="stringliteral">&quot;DD: Server stopped, watchdog exiting...&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">MessageType</a>.WatchdogInfo);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                            WriteInfo(<span class="stringliteral">&quot;Watch dog exited&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.DDWatchdogExit);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                        }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                            WriteInfo(<span class="stringliteral">&quot;Watch dog restarting...&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.DDWatchdogRestart);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                    }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a02145178d01224be0919b35deedcecba">  454</a></span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a02145178d01224be0919b35deedcecba">MemTrackTimer_Elapsed</a>(<span class="keywordtype">object</span> sender, ElapsedEventArgs e)</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            ulong megamem;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordtype">float</span> cputime;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                cputime = pcpu.NextValue();</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="keyword">using</span> (var pcm = <span class="keyword">new</span> PerformanceCounter(<span class="stringliteral">&quot;Process&quot;</span>, <span class="stringliteral">&quot;Working Set - Private&quot;</span>, Proc.ProcessName, <span class="keyword">true</span>))</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    megamem = Convert.ToUInt64(pcm.NextValue()) / 1024;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            var PercentCpuTime = (int)Math.Round((Decimal)cputime);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            WriteCurrentDDLog(String.Format(<span class="stringliteral">&quot;CPU: {1}% Memory: {0}KB&quot;</span>, megamem, PercentCpuTime.ToString(<span class="stringliteral">&quot;D3&quot;</span>)));</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a604a8e753988470876536ec1b39f94e2">  469</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a604a8e753988470876536ec1b39f94e2">CanStart</a>()</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="keywordflow">if</span> (GetVersion(<a class="code" href="namespace_t_g_s_1_1_interface.html#a1385bc6e3ab604932c185fe8bd6ad008">ByondVersion</a>.Installed) == null)</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Byond is not installed!&quot;</span>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            var DMB = RelativePath(GameDirLive + <span class="stringliteral">&quot;/&quot;</span> + Config.ProjectName + <span class="stringliteral">&quot;.dmb&quot;</span>);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="keywordflow">if</span> (!File.Exists(DMB))</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Unable to find {0}!&quot;</span>, DMB);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a09aac30b5663a766ec55ee415b954f2b">  480</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a09aac30b5663a766ec55ee415b954f2b">Start</a>()</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="keywordflow">if</span> (CurrentStatus() == <a class="code" href="namespace_t_g_s_1_1_interface.html#a4b94c11ccb4064514452be149335bcb0">ByondStatus</a>.Staged)</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                <span class="comment">//IMPORTANT: SLEEP FOR A MOMENT OR WONDOWS WON&#39;T RELEASE THE FUCKING BYOND DLL HANDLES!!!! REEEEEEE</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                Thread.Sleep(3000);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                ApplyStagedUpdate();</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="keywordflow">if</span> (currentStatus != <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Offline)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server already running&quot;</span>;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                var res = CanStart();</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                currentPort = 0;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                currentStatus = <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.HardRebooting;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">return</span> StartImpl(<span class="keyword">false</span>);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#ae6b1cbc3f1bb026d2f57f7af6e0b6024">  506</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#ae6b1cbc3f1bb026d2f57f7af6e0b6024">SecurityWord</a>(<span class="keywordtype">bool</span> starting = <span class="keyword">false</span>)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            var level = starting ? StartingSecurity : Config.Security;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <span class="keywordflow">switch</span> (level)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_s_1_1_interface.html#a97d3a0f74c35081df4416cd97291bc1d">DreamDaemonSecurity</a>.Safe:</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;safe&quot;</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_s_1_1_interface.html#a97d3a0f74c35081df4416cd97291bc1d">DreamDaemonSecurity</a>.Trusted:</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;trusted&quot;</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_s_1_1_interface.html#a97d3a0f74c35081df4416cd97291bc1d">DreamDaemonSecurity</a>.Ultrasafe:</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;ultrasafe&quot;</span>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                <span class="keywordflow">default</span>:</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                    <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(String.Format(<span class="stringliteral">&quot;Bad DreamDaemon security level: {0}&quot;</span>, level));</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a124a5b5441422817b08d3eaf3ec155a9">  526</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a124a5b5441422817b08d3eaf3ec155a9">UpdateBridgeDll</a>(<span class="keywordtype">bool</span> overwrite)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            var rbdlln = RelativePath(BridgeDLLName);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            var FileExists = File.Exists(rbdlln);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">if</span> (FileExists &amp;&amp; !overwrite)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            <span class="comment">//Copy the interface dll to the static dir</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            var InterfacePath = Assembly.GetAssembly(typeof(<a class="code" href="interface_t_g_s_1_1_interface_1_1_i_server_interface.html">IServerInterface</a>)).Location;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="comment">//bridge is installed next to the interface</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            var BridgePath = Path.Combine(Path.GetDirectoryName(InterfacePath), BridgeDLLName);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor">#if DEBUG</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="comment">//We could be debugging from the project directory</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="keywordflow">if</span> (!File.Exists(BridgePath))</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                <span class="comment">//A little hackish debug mode doctoring never hurt anyone</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                BridgePath = Path.Combine(Path.GetDirectoryName(Path.GetDirectoryName(Path.GetDirectoryName(Path.GetDirectoryName(InterfacePath)))), <span class="stringliteral">&quot;TGS.Interface.Bridge/bin/x86/Debug&quot;</span>, BridgeDLLName);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                <span class="comment">//Use reflection to ensure these are the droids we&#39;re looking for</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                Assembly.ReflectionOnlyLoadFrom(BridgePath).GetType(String.Format(<span class="stringliteral">&quot;{0}.{1}.{2}.{3}&quot;</span>, nameof(<a class="code" href="namespace_t_g_s.html">TGS</a>), nameof(Interface), DreamDaemonBridgeNamespace, DreamDaemonBridgeType), <span class="keyword">true</span>);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            {</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                WriteError(String.Format(<span class="stringliteral">&quot;Unable to locate {0}! Error: {1}&quot;</span>, BridgeDLLName, e.ToString()), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.BridgeDLLUpdateFail);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            }</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                <span class="keywordflow">if</span> (FileExists)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                    var Old = File.ReadAllBytes(rbdlln);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                    var New = File.ReadAllBytes(BridgePath);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                    <span class="keywordflow">if</span> (Old.SequenceEqual(New))</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                        <span class="keywordflow">return</span>; <span class="comment">//no need</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                File.Copy(BridgePath, rbdlln, overwrite);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">catch</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                    <span class="comment">//ok the things being stupid and hasn&#39;t released the dll yet, try ONCE more</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    Thread.Sleep(1000);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                    File.Copy(BridgePath, rbdlln, overwrite);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    <span class="comment">//intentionally using the fi</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    WriteError(<span class="stringliteral">&quot;Failed to update bridge DLL! Error: &quot;</span> + e.ToString(), <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.BridgeDLLUpdateFail);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                }</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            WriteInfo(<span class="stringliteral">&quot;Updated interface DLL&quot;</span>, <a class="code" href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">EventID</a>.BridgeDLLUpdated);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a4bfb8765130a4bdb2058979f5f41a8f4">  588</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a4bfb8765130a4bdb2058979f5f41a8f4">StartImpl</a>(<span class="keywordtype">bool</span> watchdog)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                lock (watchdogLock)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                    var res = CanStart();</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                    <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                        <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                    </div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                    var DMB = RelativePath(GameDirLive + <span class="stringliteral">&quot;/&quot;</span> + Config.ProjectName + <span class="stringliteral">&quot;.dmb&quot;</span>);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                    GenCommsKey();</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                    StartingSecurity = Config.Security;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                    Proc.StartInfo.Arguments = String.Format(<span class="stringliteral">&quot;{0} -port {1} {5}-close -verbose -params \&quot;server_service={3}&amp;server_service_version={4}&amp;{6}={7}\&quot; -{2} -public&quot;</span>, DMB, Config.Port, SecurityWord(), serviceCommsKey, Version(), Config.Webclient ? <span class="stringliteral">&quot;-webclient &quot;</span> : <span class="stringliteral">&quot;&quot;</span>, SPInstanceName, Config.Name);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                    UpdateBridgeDll(<span class="keyword">true</span>);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                    lock (topicLock)</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                    {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                        GameAPIVersion = null;  <span class="comment">//needs updating</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                    }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    Proc.Start();</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                    Proc.PriorityClass = ProcessPriorityClass.AboveNormal;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                    <span class="keywordflow">if</span> (!Proc.WaitForInputIdle(DDHangStartTime * 1000))</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                        Proc.Kill();</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                        Proc.WaitForExit();</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                        Proc.Close();</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                        currentStatus = <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Offline;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                        currentPort = 0;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Server start is taking more than {0}s! Aborting!&quot;</span>, DDHangStartTime);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                    }</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    currentPort = Config.Port;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                    currentStatus = <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    <span class="keywordflow">if</span> (!watchdog)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                    {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                        DDWatchdog = <span class="keyword">new</span> Thread(<span class="keyword">new</span> ThreadStart(Watchdog));</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                        DDWatchdog.Start();</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                    }</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            }</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                currentStatus = <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Offline;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            }</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#ac2f290406bac5177798e6af9c5d2487a">  638</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="namespace_t_g_s_1_1_interface.html#a97d3a0f74c35081df4416cd97291bc1d">DreamDaemonSecurity</a> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#ac2f290406bac5177798e6af9c5d2487a">SecurityLevel</a>()</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        {</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <span class="keywordflow">return</span> Config.Security;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a5bf9b431d13fee84dba894eff559bd21">  647</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a5bf9b431d13fee84dba894eff559bd21">SetSecurityLevel</a>(<a class="code" href="namespace_t_g_s_1_1_interface.html#a97d3a0f74c35081df4416cd97291bc1d">DreamDaemonSecurity</a> level)</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="keywordtype">bool</span> needReboot;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                needReboot = Config.Security != level;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                Config.Security = level;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordflow">if</span> (needReboot)</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                RequestRestart();</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">return</span> DaemonStatus() != <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a61459d20db5399496e15aa0c1f1e9d5a">  661</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a61459d20db5399496e15aa0c1f1e9d5a">Autostart</a>()</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <span class="keywordflow">return</span> Config.Autostart;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a103dd502ffe0ff1d52c606d68de6260a">  667</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a103dd502ffe0ff1d52c606d68de6260a">SetAutostart</a>(<span class="keywordtype">bool</span> on)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            Config.Autostart = on;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#ac5e9546bdbc10562ae3f144ab7247acb">  673</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#ac5e9546bdbc10562ae3f144ab7247acb">StatusString</a>(<span class="keywordtype">bool</span> includeMetaInfo)</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">string</span> visSecStr = <span class="stringliteral">&quot; (Sec: {0})&quot;</span>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="keywordtype">string</span> res;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            var ds = DaemonStatus();</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="keywordflow">switch</span> (ds)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Offline:</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                    res = <span class="stringliteral">&quot;OFFLINE&quot;</span>;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.HardRebooting:</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                    res = <span class="stringliteral">&quot;REBOOTING&quot;</span>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online:</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                    res = <span class="stringliteral">&quot;ONLINE&quot;</span>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                    <span class="keywordflow">if</span> (includeMetaInfo)</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                    {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        <span class="keywordtype">string</span> secandvis;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                        lock (watchdogLock)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                        {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                            secandvis = String.Format(visSecStr, SecurityWord(<span class="keyword">true</span>));</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                        }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                        res += secandvis;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                    }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                <span class="keywordflow">default</span>:</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                    res = <span class="stringliteral">&quot;NULL AND ERRORS&quot;</span>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="keywordflow">if</span> (includeMetaInfo &amp;&amp; ds != <a class="code" href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">DreamDaemonStatus</a>.Online)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                res += String.Format(visSecStr, SecurityWord());</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#acce7ab0825aec9c2dfa4d981be2c9977">  708</a></span>&#160;        <span class="keyword">public</span> ushort <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#acce7ab0825aec9c2dfa4d981be2c9977">Port</a>()</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        {</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <span class="keywordflow">return</span> Config.Port;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        }</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#add2fb04b7c86d81968d0b2d9e6f28d18">  714</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#add2fb04b7c86d81968d0b2d9e6f28d18">ShutdownInProgress</a>()</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                <span class="keywordflow">return</span> AwaitingShutdown != <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">ShutdownRequestPhase</a>.None;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#aa60ed802c6a49558a32eaf8c590c84f2">  723</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#aa60ed802c6a49558a32eaf8c590c84f2">WorldAnnounce</a>(<span class="keywordtype">string</span> message)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            var res = SendCommand(SCWorldAnnounce + <span class="stringliteral">&quot;;message=&quot;</span> + <a class="code" href="class_t_g_s_1_1_server_1_1_helpers.html">Helpers</a>.<a class="code" href="class_t_g_s_1_1_server_1_1_helpers.html#ae0106b61248cd5ae831acd405701dc9b">SanitizeTopicString</a>(message));</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            <span class="keywordflow">if</span> (res == <span class="stringliteral">&quot;SUCCESS&quot;</span>)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a46520eda70e7653a8000132617e7451d">  732</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a46520eda70e7653a8000132617e7451d">Webclient</a>()</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="keywordflow">return</span> Config.Webclient;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno"><a class="line" href="class_t_g_s_1_1_server_1_1_instance.html#a1ebe4076139e92478d2de6713c1ff424">  738</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_s_1_1_server_1_1_instance.html#a1ebe4076139e92478d2de6713c1ff424">SetWebclient</a>(<span class="keywordtype">bool</span> on)</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            lock (watchdogLock)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                var diff = on != Config.Webclient;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                <span class="keywordflow">if</span> (diff)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                    Config.Webclient = on;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                    RequestRestart();</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                }</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;}</div><div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a2f1cfb897b842dde32d5f2299144f2d1"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a2f1cfb897b842dde32d5f2299144f2d1">TGS.Server.Instance.InitDreamDaemon</a></div><div class="ttdeci">void InitDreamDaemon()</div><div class="ttdoc">Setup or reattach the watchdog, depending on InstanceConfig.ReattachRequired of Config, and create the DiagnosticsDir </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00097">DreamDaemon.cs:97</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_aa60ed802c6a49558a32eaf8c590c84f2"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#aa60ed802c6a49558a32eaf8c590c84f2">TGS.Server.Instance.WorldAnnounce</a></div><div class="ttdeci">string WorldAnnounce(string message)</div><div class="ttdoc">Sends a message to everyone on the server  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00723">DreamDaemon.cs:723</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a1f36b3bc5a88149c875173d089b0ea27"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a1f36b3bc5a88149c875173d089b0ea27">TGS.Server.Instance.StartingSecurity</a></div><div class="ttdeci">DreamDaemonSecurity StartingSecurity</div><div class="ttdoc">Current DreamDaemonSecurity level of DreamDaemon </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00087">DreamDaemon.cs:87</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a5bf9b431d13fee84dba894eff559bd21"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a5bf9b431d13fee84dba894eff559bd21">TGS.Server.Instance.SetSecurityLevel</a></div><div class="ttdeci">bool SetSecurityLevel(DreamDaemonSecurity level)</div><div class="ttdoc">Sets the security level of the server. Requires server reboot to apply. Calls RequestRestart. Note that anything higher than Trusted will disable interop from DD  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00647">DreamDaemon.cs:647</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_ae6b1cbc3f1bb026d2f57f7af6e0b6024"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#ae6b1cbc3f1bb026d2f57f7af6e0b6024">TGS.Server.Instance.SecurityWord</a></div><div class="ttdeci">string SecurityWord(bool starting=false)</div><div class="ttdoc">Translate the configured DreamDaemonSecurity level into a byond command line param ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00506">DreamDaemon.cs:506</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html_a1385bc6e3ab604932c185fe8bd6ad008"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html#a1385bc6e3ab604932c185fe8bd6ad008">TGS.Interface.ByondVersion</a></div><div class="ttdeci">ByondVersion</div><div class="ttdoc">Type of byond version </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00062">Enumerations.cs:62</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a6cac5447eccf0b05ea790475df167a5c"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a6cac5447eccf0b05ea790475df167a5c">TGS.Server.Instance.SetPort</a></div><div class="ttdeci">void SetPort(ushort new_port)</div><div class="ttdoc">Set the port to host DD on. Requires reboot to apply. Calls RequestRestart.  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00239">DreamDaemon.cs:239</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a02145178d01224be0919b35deedcecba"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a02145178d01224be0919b35deedcecba">TGS.Server.Instance.MemTrackTimer_Elapsed</a></div><div class="ttdeci">void MemTrackTimer_Elapsed(object sender, ElapsedEventArgs e)</div><div class="ttdoc">Called every five seconds while DreamDaemon is running to log it&amp;#39;s current state to the DiagnosticsDi...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00454">DreamDaemon.cs:454</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a85b6d2d0e931f3961b0c1a75577d13dc"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a85b6d2d0e931f3961b0c1a75577d13dc">TGS.Server.Instance.DDWatchdog</a></div><div class="ttdeci">Thread DDWatchdog</div><div class="ttdoc">The thread that monitors the status of DreamDaemon </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00057">DreamDaemon.cs:57</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a604a8e753988470876536ec1b39f94e2"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a604a8e753988470876536ec1b39f94e2">TGS.Server.Instance.CanStart</a></div><div class="ttdeci">string CanStart()</div><div class="ttdoc">Check if a call to Start will fail. Of course, be aware of race conditions with other interfaces  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00469">DreamDaemon.cs:469</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a94bfbe235ce28e4f29001f79f16ad7e9"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a94bfbe235ce28e4f29001f79f16ad7e9">TGS.Server.Instance.KillMe</a></div><div class="ttdeci">void KillMe()</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00249">DreamDaemon.cs:249</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a4bfb8765130a4bdb2058979f5f41a8f4"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a4bfb8765130a4bdb2058979f5f41a8f4">TGS.Server.Instance.StartImpl</a></div><div class="ttdeci">string StartImpl(bool watchdog)</div><div class="ttdoc">Clears the current GameAPIVersion, calls UpdateBridgeDll(bool) with a  parameter, and attempts to sta...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00588">DreamDaemon.cs:588</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a124a5b5441422817b08d3eaf3ec155a9"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a124a5b5441422817b08d3eaf3ec155a9">TGS.Server.Instance.UpdateBridgeDll</a></div><div class="ttdeci">void UpdateBridgeDll(bool overwrite)</div><div class="ttdoc">Copies BridgeDLLName from the program directory to the the Instance directory </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00526">DreamDaemon.cs:526</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a1f6e8f2764269059a4f278955b4e6204"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a1f6e8f2764269059a4f278955b4e6204">TGS.Server.Instance.Restart</a></div><div class="ttdeci">string Restart()</div><div class="ttdoc">Immediately kills and restarts the server  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00266">DreamDaemon.cs:266</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html">TGS.Interface</a></div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00006">ChatSetupInfo.cs:6</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_af8f30af9b177beb6c309e05d0d56be33"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#af8f30af9b177beb6c309e05d0d56be33">TGS.Server.Instance.Proc</a></div><div class="ttdeci">Process Proc</div><div class="ttdoc">The DreamDaemon process </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00044">DreamDaemon.cs:44</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_dream_daemon_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_components_1_1_i_t_g_dream_daemon.html">TGS.Interface.Components.ITGDreamDaemon</a></div><div class="ttdoc">Interface for managing the actual BYOND game server </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_dream_daemon_8cs_source.html#l00010">DreamDaemon.cs:10</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a1ae646bbf90e6124e3a73029c193044e"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a1ae646bbf90e6124e3a73029c193044e">TGS.Server.Instance.DisposeDreamDaemon</a></div><div class="ttdeci">void DisposeDreamDaemon()</div><div class="ttdoc">Either let go of Proc for reattachment or terminate it, depending on InstanceConfig.ReattachRequired of Config </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00160">DreamDaemon.cs:160</a></div></div>
<div class="ttc" id="interface_t_g_s_1_1_interface_1_1_i_server_interface_html"><div class="ttname"><a href="interface_t_g_s_1_1_interface_1_1_i_server_interface.html">TGS.Interface.IServerInterface</a></div><div class="ttdoc">Main  for communicating the ITGSService </div><div class="ttdef"><b>Definition:</b> <a href="_server_interface_8cs_source.html#l00017">ServerInterface.cs:17</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_ac2f290406bac5177798e6af9c5d2487a"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#ac2f290406bac5177798e6af9c5d2487a">TGS.Server.Instance.SecurityLevel</a></div><div class="ttdeci">DreamDaemonSecurity SecurityLevel()</div><div class="ttdoc">Get the configured (not necessarily running) security level  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00638">DreamDaemon.cs:638</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_af399ffae59f2f1a1595da516e7afca1a"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#af399ffae59f2f1a1595da516e7afca1a">TGS.Server.Instance.RequestStop</a></div><div class="ttdeci">void RequestStop()</div><div class="ttdoc">Stop the server after the currently running world reboots. Has no effect if the server isn&amp;#39;t running ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00208">DreamDaemon.cs:208</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a0ac4e6797d742a7cb055ce737de36e9c"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a0ac4e6797d742a7cb055ce737de36e9c">TGS.Server.Instance.WriteCurrentDDLog</a></div><div class="ttdeci">void WriteCurrentDDLog(string message)</div><div class="ttdoc">Write a message  to the CurrentDDLog. A timestamp will be prepended to it </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00291">DreamDaemon.cs:291</a></div></div>
<div class="ttc" id="namespace_t_g_s_html"><div class="ttname"><a href="namespace_t_g_s.html">TGS</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html_a4b94c11ccb4064514452be149335bcb0"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html#a4b94c11ccb4064514452be149335bcb0">TGS.Interface.ByondStatus</a></div><div class="ttdeci">ByondStatus</div><div class="ttdoc">The status of a BYOND update job </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00032">Enumerations.cs:32</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a4d29ee9f52d6da07ac10577bc6db078c"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a4d29ee9f52d6da07ac10577bc6db078c">TGS.Server.Instance.DaemonStatus</a></div><div class="ttdeci">DreamDaemonStatus DaemonStatus()</div><div class="ttdoc">Gets the status of DreamDaemon  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00193">DreamDaemon.cs:193</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html_a769cbe24216f6ab7cb0cdf2b39177175"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html#a769cbe24216f6ab7cb0cdf2b39177175">TGS.Interface.DreamDaemonStatus</a></div><div class="ttdeci">DreamDaemonStatus</div><div class="ttdoc">The status of the DD instance </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00140">Enumerations.cs:140</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_ab09a0bda6eaa71b87c84c685e1e13093"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#ab09a0bda6eaa71b87c84c685e1e13093">TGS.Server.Instance.Stop</a></div><div class="ttdeci">string Stop()</div><div class="ttdoc">Immediately kills the server  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00220">DreamDaemon.cs:220</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a16ce149ebe31e4dbf1bf318cc449e790"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a16ce149ebe31e4dbf1bf318cc449e790">TGS.Server.Instance.pcpu</a></div><div class="ttdeci">PerformanceCounter pcpu</div><div class="ttdoc">CPU performance information for Proc </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00048">DreamDaemon.cs:48</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a068d9bbb0c0d5fe0507e662af2041865"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a068d9bbb0c0d5fe0507e662af2041865">TGS.Server.Instance.CurrentDDLog</a></div><div class="ttdeci">string CurrentDDLog</div><div class="ttdoc">Current logfile in use in ResourceDiagnosticsDir </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00065">DreamDaemon.cs:65</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a24619e3847ca6f303773c3c667a0c644"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a24619e3847ca6f303773c3c667a0c644">TGS.Server.Instance.ShutdownRequestPhase</a></div><div class="ttdeci">ShutdownRequestPhase</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00017">DreamDaemon.cs:17</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a61459d20db5399496e15aa0c1f1e9d5a"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a61459d20db5399496e15aa0c1f1e9d5a">TGS.Server.Instance.Autostart</a></div><div class="ttdeci">bool Autostart()</div><div class="ttdoc">Check if the watchdog will start when the service starts  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00661">DreamDaemon.cs:661</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a09aac30b5663a766ec55ee415b954f2b"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a09aac30b5663a766ec55ee415b954f2b">TGS.Server.Instance.Start</a></div><div class="ttdeci">string Start()</div><div class="ttdoc">Starts the server if it isn&amp;#39;t running  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00480">DreamDaemon.cs:480</a></div></div>
<div class="ttc" id="_t_g_s_8_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_s_8_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html_a6aba89d82a2fad3044034cdca1060c4fa6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html#a6aba89d82a2fad3044034cdca1060c4fa6adf97f83acf6453d4a6a4b1070f3754">TGS.Interface.ConnectivityLevel.None</a></div><div class="ttdoc">The connection could not be made, either a communication error occurred or the specified Components...</div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a997fa4bfb2ab7d7034d33c5ae8268894"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a997fa4bfb2ab7d7034d33c5ae8268894">TGS.Server.Instance.Watchdog</a></div><div class="ttdeci">void Watchdog()</div><div class="ttdoc">Threaded loop that keeps DreamDaemon from unintentionally stopping </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00304">DreamDaemon.cs:304</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a28f6f35b683539aabb8a0044f6c83406"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a28f6f35b683539aabb8a0044f6c83406">TGS.Server.Instance.RequestRestart</a></div><div class="ttdeci">void RequestRestart()</div><div class="ttdoc">Restart the server after the currently running world reboots. Has no effect if the server isn&amp;#39;t runni...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00202">DreamDaemon.cs:202</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_html_a4682739b9567dc9e4e5c327c253ce311"><div class="ttname"><a href="namespace_t_g_s_1_1_server.html#a4682739b9567dc9e4e5c327c253ce311">TGS.Server.EventID</a></div><div class="ttdeci">EventID</div><div class="ttdoc">Various events and their IDs in no particular order. Found in the Windows event log. These key incremented by 100 and are guaranteed to never be reused in the future. In the windows event viewer, these IDs will be offset by the Instance.LoggingID to distinguish events between instances. Each event ID may be information, a warning, or error and will be documented accordingly. Warnings will occur due to user, data, or network errors. Errors will occur due to filesystem errors or hard faults </div><div class="ttdef"><b>Definition:</b> <a href="_event_i_d_8cs_source.html#l00008">EventID.cs:8</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_helpers_html"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_helpers.html">TGS.Server.Helpers</a></div><div class="ttdoc">Generic helpers for the Server </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_helpers_8cs_source.html#l00010">Helpers.cs:10</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_server_html_ac244e362b52b9feac67ac6c2ca27f522"><div class="ttname"><a href="namespace_t_g_s_1_1_server.html#ac244e362b52b9feac67ac6c2ca27f522">TGS.Server.MessageType</a></div><div class="ttdeci">MessageType</div><div class="ttdoc">Type of chat message, these may be OR&amp;#39;d together </div><div class="ttdef"><b>Definition:</b> <a href="_message_type_8cs_source.html#l00008">MessageType.cs:8</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_html_a97d3a0f74c35081df4416cd97291bc1d"><div class="ttname"><a href="namespace_t_g_s_1_1_interface.html#a97d3a0f74c35081df4416cd97291bc1d">TGS.Interface.DreamDaemonSecurity</a></div><div class="ttdeci">DreamDaemonSecurity</div><div class="ttdoc">DreamDaemon&amp;#39;s security level </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00159">Enumerations.cs:159</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_add2fb04b7c86d81968d0b2d9e6f28d18"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#add2fb04b7c86d81968d0b2d9e6f28d18">TGS.Server.Instance.ShutdownInProgress</a></div><div class="ttdeci">bool ShutdownInProgress()</div><div class="ttdoc">Checks if a server stop has been requested  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00714">DreamDaemon.cs:714</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_ac5e9546bdbc10562ae3f144ab7247acb"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#ac5e9546bdbc10562ae3f144ab7247acb">TGS.Server.Instance.StatusString</a></div><div class="ttdeci">string StatusString(bool includeMetaInfo)</div><div class="ttdoc">Returns a human readable string of the current server status  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00673">DreamDaemon.cs:673</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_helpers_html_ae0106b61248cd5ae831acd405701dc9b"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_helpers.html#ae0106b61248cd5ae831acd405701dc9b">TGS.Server.Helpers.SanitizeTopicString</a></div><div class="ttdeci">static string SanitizeTopicString(string input)</div><div class="ttdoc">Properly escapes characters for a BYOND Topic() packet. See http://www.byond.com/docs/ref/info.html#/proc/list2params </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_helpers_8cs_source.html#l00168">Helpers.cs:168</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a1ebe4076139e92478d2de6713c1ff424"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a1ebe4076139e92478d2de6713c1ff424">TGS.Server.Instance.SetWebclient</a></div><div class="ttdeci">void SetWebclient(bool on)</div><div class="ttdoc">Set the webclient config. Calls RequestRestart  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00738">DreamDaemon.cs:738</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a46520eda70e7653a8000132617e7451d"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a46520eda70e7653a8000132617e7451d">TGS.Server.Instance.Webclient</a></div><div class="ttdeci">bool Webclient()</div><div class="ttdoc">Check if the BYOND webclient is currently enabled for the server  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00732">DreamDaemon.cs:732</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a103dd502ffe0ff1d52c606d68de6260a"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a103dd502ffe0ff1d52c606d68de6260a">TGS.Server.Instance.SetAutostart</a></div><div class="ttdeci">void SetAutostart(bool on)</div><div class="ttdoc">Set the autostart config  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00667">DreamDaemon.cs:667</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_af874c36b24f0624f234d04902345eda7"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#af874c36b24f0624f234d04902345eda7">TGS.Server.Instance.currentStatus</a></div><div class="ttdeci">DreamDaemonStatus currentStatus</div><div class="ttdoc">The DreamDaemonStatus of Proc </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00061">DreamDaemon.cs:61</a></div></div>
<div class="ttc" id="namespace_t_g_s_1_1_interface_1_1_components_html"><div class="ttname"><a href="namespace_t_g_s_1_1_interface_1_1_components.html">TGS.Interface.Components</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_interface_2_components_2_administration_8cs_source.html#l00003">Administration.cs:3</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_acce7ab0825aec9c2dfa4d981be2c9977"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#acce7ab0825aec9c2dfa4d981be2c9977">TGS.Server.Instance.Port</a></div><div class="ttdeci">ushort Port()</div><div class="ttdoc">Get the configured port. Not necessarily the running port if it has since changed  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00708">DreamDaemon.cs:708</a></div></div>
<div class="ttc" id="class_t_g_s_1_1_server_1_1_instance_html_a0c164f4ee52435f463c766bb11ead7ec"><div class="ttname"><a href="class_t_g_s_1_1_server_1_1_instance.html#a0c164f4ee52435f463c766bb11ead7ec">TGS.Server.Instance.AwaitingShutdown</a></div><div class="ttdeci">ShutdownRequestPhase AwaitingShutdown</div><div class="ttdoc">Indicator of progress on a RequestRestart or RequestStop operation </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_s_8_server_2_instance_2_dream_daemon_8cs_source.html#l00092">DreamDaemon.cs:92</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
