<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGServerService/Service.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   &#160;<span id="projectnumber">3.1.6.4</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f220d0611c2e3262469750905b70ffc9.html">TGServerService</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Service.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_t_g_server_service_2_service_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Diagnostics;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.IO;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Security.Principal;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.ServiceModel;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.ServiceProcess;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>.<a class="code" href="namespace_t_g_service_interface_1_1_components.html">Components</a>;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_server_service.html">TGServerService</a></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;{</div><div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html">   15</a></span>&#160;    sealed <span class="keyword">partial class </span><a class="code" href="class_t_g_server_service_1_1_service.html">Service</a> : <a class="code" href="class_service_base.html">ServiceBase</a></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    {</div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a525cf1bdbe2b21a7bcb7775be30ce656">   20</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> readonly <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a525cf1bdbe2b21a7bcb7775be30ce656">Version</a> = <span class="stringliteral">&quot;/tg/station 13 Server Service v&quot;</span> + FileVersionInfo.GetVersionInfo(<a class="code" href="namespace_system.html">System</a>.Reflection.Assembly.GetExecutingAssembly().Location).FileVersion;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ac2057d36e9866b9fc8483ba5e56eca12">   25</a></span>&#160;        <span class="keyword">static</span> <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a> <a class="code" href="class_t_g_server_service_1_1_service.html#ac2057d36e9866b9fc8483ba5e56eca12">ActiveService</a>;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ac3397831deffcbd077a20f4ceb86f7c7">   30</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#ac3397831deffcbd077a20f4ceb86f7c7">CancelImpersonation</a>()</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;            WindowsIdentity.Impersonate(IntPtr.Zero);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        }</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">   40</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">WriteInfo</a>(<span class="keywordtype">string</span> message, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a> <span class="keywordtype">id</span>)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            ActiveService.EventLog.WriteEntry(message, EventLogEntryType.Information, (<span class="keywordtype">int</span>)<span class="keywordtype">id</span>);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        }</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">   49</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">WriteError</a>(<span class="keywordtype">string</span> message, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a> <span class="keywordtype">id</span>)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            ActiveService.EventLog.WriteEntry(message, EventLogEntryType.Error, (<span class="keywordtype">int</span>)<span class="keywordtype">id</span>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        }</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ae3c4dfb35fce33f3462633036bc5af14">   58</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#ae3c4dfb35fce33f3462633036bc5af14">WriteWarning</a>(<span class="keywordtype">string</span> message, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a> <span class="keywordtype">id</span>)</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            ActiveService.EventLog.WriteEntry(message, EventLogEntryType.Warning, (<span class="keywordtype">int</span>)<span class="keywordtype">id</span>);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a5f6ad886bff03e90360d6ea8fc0c94ad">   68</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a5f6ad886bff03e90360d6ea8fc0c94ad">WriteAccess</a>(<span class="keywordtype">string</span> username, <span class="keywordtype">bool</span> authSuccess)</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            ActiveService.EventLog.WriteEntry(String.Format(<span class="stringliteral">&quot;Access from: {0}&quot;</span>, username), authSuccess ? EventLogEntryType.SuccessAudit : EventLogEntryType.FailureAudit, (int)<a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.Authentication);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a41aed3f3d48cd6d1c8b2d64acb08e8b8">   76</a></span>&#160;        ServiceHost <a class="code" href="class_t_g_server_service_1_1_service.html#a41aed3f3d48cd6d1c8b2d64acb08e8b8">host</a>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="comment">//you should seriously not add anything here</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="comment">//Use OnStart instead</span></div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a500b9c8dc623291779fbe0d61a073600">   83</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a500b9c8dc623291779fbe0d61a073600">Service</a>()</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                <span class="keywordflow">if</span> (Properties.Settings.Default.UpgradeRequired)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                    var newVersion = Properties.Settings.Default.SettingsVersion;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                    Properties.Settings.Default.Upgrade();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                    var oldVersion = Properties.Settings.Default.SettingsVersion;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                    Properties.Settings.Default.SettingsVersion = newVersion;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html#a1f69ae79605fe8f17f3183ae15583d39">MigrateSettings</a>(oldVersion, newVersion);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                    Properties.Settings.Default.UpgradeRequired = <span class="keyword">false</span>;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    Properties.Settings.Default.Save();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                ServiceName = <span class="stringliteral">&quot;TG Station Server&quot;</span>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                ActiveService = <span class="keyword">this</span>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                Run(<span class="keyword">this</span>);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">finally</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                Properties.Settings.Default.Save();</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a1f69ae79605fe8f17f3183ae15583d39">  115</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a1f69ae79605fe8f17f3183ae15583d39">MigrateSettings</a>(<span class="keywordtype">int</span> oldVersion, <span class="keywordtype">int</span> newVersion)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="keywordflow">if</span> (oldVersion == newVersion &amp;&amp; newVersion == 0)    <span class="comment">//chat refactor</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                Properties.Settings.Default.ChatProviderData = <span class="stringliteral">&quot;NEEDS INITIALIZING&quot;</span>;    <span class="comment">//reset chat settings to be safe</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        }</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a4bb8fb7f15c6f001175ce52d70ef903e">  125</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a4bb8fb7f15c6f001175ce52d70ef903e">OnStart</a>(<span class="keywordtype">string</span>[] args)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="keywordflow">if</span> (!Directory.Exists(Config.ServerDirectory))</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                EventLog.WriteEntry(<span class="stringliteral">&quot;Creating server directory: &quot;</span> + Config.ServerDirectory);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                Directory.CreateDirectory(Config.ServerDirectory);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            Environment.CurrentDirectory = Config.ServerDirectory;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            var instance = <span class="keyword">new</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a>();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordflow">for</span> (var I = 0; I &lt; args.Length - 1; ++I)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                <span class="keywordflow">if</span> (args[I].ToLower() == <span class="stringliteral">&quot;-port&quot;</span>)</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                    {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                        var res = Convert.ToUInt16(args[I + 1]);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                        <span class="keywordflow">if</span> (res == 0)</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Cannot bind to port 0&quot;</span>);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        Config.RemoteAccessPort = res;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                    }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                    <span class="keywordflow">catch</span>(Exception e)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                    {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Invalid argument for \&quot;-port\&quot;&quot;</span>, e);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                    Config.Save();</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            host = <span class="keyword">new</span> ServiceHost(instance, <span class="keyword">new</span> Uri[] { <span class="keyword">new</span> Uri(<span class="stringliteral">&quot;net.pipe://localhost&quot;</span>), <span class="keyword">new</span> Uri(String.Format(<span class="stringliteral">&quot;https://localhost:{0}&quot;</span>, Config.RemoteAccessPort)) })</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                CloseTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 5)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            };</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#a177251e0cec2b05f762f91a560766e95">ValidInterfaces</a>)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html#a2c4c6dd3cb5dadda5608e02fcd1adb35">AddEndpoint</a>(I);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            </div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            host.Authorization.ServiceAuthorizationManager = instance;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                host.Open();</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="keywordflow">catch</span> (AddressAlreadyInUseException e)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Can&#39;t start the service due to the configured remote access port being in use. To fix this change it by starting the service with the \&quot;-port &lt;port&gt;\&quot; argument.&quot;</span>, e);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a2c4c6dd3cb5dadda5608e02fcd1adb35">  179</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a2c4c6dd3cb5dadda5608e02fcd1adb35">AddEndpoint</a>(Type type)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            var bindingName = <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#a9357161b2c8d891dbf69a0e7018ddf77">MasterInterfaceName</a> + <span class="stringliteral">&quot;/&quot;</span> + type.Name;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            host.AddServiceEndpoint(type, <span class="keyword">new</span> NetNamedPipeBinding() { SendTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 30), MaxReceivedMessageSize = <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#aa5ccca53bb7e2bd6fd609ee68099bbd2">TransferLimitLocal</a> }, bindingName);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            var httpsBinding = <span class="keyword">new</span> WSHttpBinding()</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                SendTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 40),</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                MaxReceivedMessageSize = <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#a00d88d167689139612f0e7c4444eb35d">TransferLimitRemote</a></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            };</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            var requireAuth = type.Name != typeof(<a class="code" href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_connectivity.html">ITGConnectivity</a>).Name;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            httpsBinding.Security.Transport.ClientCredentialType = HttpClientCredentialType.None;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            httpsBinding.Security.Mode = requireAuth ? SecurityMode.TransportWithMessageCredential : SecurityMode.Transport;    <span class="comment">//do not require auth for a connectivity check</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            httpsBinding.Security.Message.ClientCredentialType = requireAuth ? MessageCredentialType.UserName : MessageCredentialType.None;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            host.AddServiceEndpoint(type, httpsBinding, bindingName);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a2dbfb4436b03982b6d7e466fde1763d7">  198</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a2dbfb4436b03982b6d7e466fde1763d7">OnStop</a>()</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                var instance = (<a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a>)host.SingletonInstance;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                host.Close();</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                instance.Dispose();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">WriteError</a>(e.ToString(), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.ServiceShutdownFail);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div><div class="ttc" id="namespace_t_g_service_interface_1_1_components_html"><div class="ttname"><a href="namespace_t_g_service_interface_1_1_components.html">TGServiceInterface.Components</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_service_interface_2_components_2_administration_8cs_source.html#l00003">Administration.cs:3</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a2dbfb4436b03982b6d7e466fde1763d7"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a2dbfb4436b03982b6d7e466fde1763d7">TGServerService.Service.OnStop</a></div><div class="ttdeci">override void OnStop()</div><div class="ttdoc">Shutsdown the WCF host and calls IDisposable.Dispose on it&amp;#39;s ServerInstance </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00198">Service.cs:198</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a500b9c8dc623291779fbe0d61a073600"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a500b9c8dc623291779fbe0d61a073600">TGServerService.Service.Service</a></div><div class="ttdeci">Service()</div><div class="ttdoc">Construct and run a Service. Can only execute in the context of the Windows service manager ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00083">Service.cs:83</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a525cf1bdbe2b21a7bcb7775be30ce656"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a525cf1bdbe2b21a7bcb7775be30ce656">TGServerService.Service.Version</a></div><div class="ttdeci">static readonly string Version</div><div class="ttdoc">The service version string based on the FileVersionInfo </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00020">Service.cs:20</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ac90d464e7982312e0a43f1d710bd83a9"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ac90d464e7982312e0a43f1d710bd83a9">TGServerService.Service.WriteInfo</a></div><div class="ttdeci">static void WriteInfo(string message, EventID id)</div><div class="ttdoc">Writes information to Windows the event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00040">Service.cs:40</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_a177251e0cec2b05f762f91a560766e95"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#a177251e0cec2b05f762f91a560766e95">TGServiceInterface.Interface.ValidInterfaces</a></div><div class="ttdeci">static readonly IList&lt; Type &gt; ValidInterfaces</div><div class="ttdoc">List of s that can be used with GetComponent&lt;T&gt; and CreateChannel&lt;T&gt; </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00022">Interface.cs:22</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html_a98d8f6303b894422167c743e15185398"><div class="ttname"><a href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">TGServerService.EventID</a></div><div class="ttdeci">EventID</div><div class="ttdoc">Various events and their IDs in no particular order. Found in the Windows event log. These incremented by 100 and are guaranteed to never be reused in the future. Each event ID may be information, a warning, or error and will be documented accordingly. Warnings will occur due to user, data, or network errors. Errors will occur due to filesystem errors or hard faults </div><div class="ttdef"><b>Definition:</b> <a href="_event_i_d_8cs_source.html#l00008">EventID.cs:8</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html">TGServerService.Service</a></div><div class="ttdoc">The windows service the application runs as </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00015">Service.cs:15</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html">TGServerService.ServerInstance</a></div><div class="ttdoc">The class which holds all interface components. There are no safeguards for call race conditions so t...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_administration_8cs_source.html#l00014">Administration.cs:14</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ae3c4dfb35fce33f3462633036bc5af14"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ae3c4dfb35fce33f3462633036bc5af14">TGServerService.Service.WriteWarning</a></div><div class="ttdeci">static void WriteWarning(string message, EventID id)</div><div class="ttdoc">Writes a warning to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00058">Service.cs:58</a></div></div>
<div class="ttc" id="interface_t_g_service_interface_1_1_components_1_1_i_t_g_connectivity_html"><div class="ttname"><a href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_connectivity.html">TGServiceInterface.Components.ITGConnectivity</a></div><div class="ttdoc">Used for testing connections to the service without authentication </div><div class="ttdef"><b>Definition:</b> <a href="_connectivity_8cs_source.html#l00009">Connectivity.cs:9</a></div></div>
<div class="ttc" id="class_service_base_html"><div class="ttname"><a href="class_service_base.html">ServiceBase</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a4bb8fb7f15c6f001175ce52d70ef903e"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a4bb8fb7f15c6f001175ce52d70ef903e">TGServerService.Service.OnStart</a></div><div class="ttdeci">override void OnStart(string[] args)</div><div class="ttdoc">Called by the Windows service manager. Initializes and starts the ServerInstance </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00125">Service.cs:125</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_aa5ccca53bb7e2bd6fd609ee68099bbd2"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#aa5ccca53bb7e2bd6fd609ee68099bbd2">TGServiceInterface.Interface.TransferLimitLocal</a></div><div class="ttdeci">const long TransferLimitLocal</div><div class="ttdoc">The maximum message size to and from a local server </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00027">Interface.cs:27</a></div></div>
<div class="ttc" id="_t_g_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">ï»¿using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_a00d88d167689139612f0e7c4444eb35d"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#a00d88d167689139612f0e7c4444eb35d">TGServiceInterface.Interface.TransferLimitRemote</a></div><div class="ttdeci">const long TransferLimitRemote</div><div class="ttdoc">The maximum message size to and from a remote server </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00032">Interface.cs:32</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html"><div class="ttname"><a href="namespace_t_g_service_interface.html">TGServiceInterface</a></div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00006">ChatSetupInfo.cs:6</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_a9357161b2c8d891dbf69a0e7018ddf77"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#a9357161b2c8d891dbf69a0e7018ddf77">TGServiceInterface.Interface.MasterInterfaceName</a></div><div class="ttdeci">const string MasterInterfaceName</div><div class="ttdoc">Base name of the communication pipe they are formatted as MasterPipeName/ComponentName ...</div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00038">Interface.cs:38</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ac2057d36e9866b9fc8483ba5e56eca12"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ac2057d36e9866b9fc8483ba5e56eca12">TGServerService.Service.ActiveService</a></div><div class="ttdeci">static Service ActiveService</div><div class="ttdoc">Singleton instance </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00025">Service.cs:25</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ac3397831deffcbd077a20f4ceb86f7c7"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ac3397831deffcbd077a20f4ceb86f7c7">TGServerService.Service.CancelImpersonation</a></div><div class="ttdeci">static void CancelImpersonation()</div><div class="ttdoc">Cancels WCF&amp;#39;s user impersonation to allow clean access to writing log files </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00030">Service.cs:30</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a41aed3f3d48cd6d1c8b2d64acb08e8b8"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a41aed3f3d48cd6d1c8b2d64acb08e8b8">TGServerService.Service.host</a></div><div class="ttdeci">ServiceHost host</div><div class="ttdoc">The WCF host that the Interface connects to </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00076">Service.cs:76</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a103b806b056a42886318a9f0422a865c"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a103b806b056a42886318a9f0422a865c">TGServerService.Service.WriteError</a></div><div class="ttdeci">static void WriteError(string message, EventID id)</div><div class="ttdoc">Writes an error to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00049">Service.cs:49</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html">TGServiceInterface.Interface</a></div><div class="ttdoc">Main inteface class for the service </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00017">Interface.cs:17</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a2c4c6dd3cb5dadda5608e02fcd1adb35"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a2c4c6dd3cb5dadda5608e02fcd1adb35">TGServerService.Service.AddEndpoint</a></div><div class="ttdeci">void AddEndpoint(Type type)</div><div class="ttdoc">Adds a WCF endpoint for a component type  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00179">Service.cs:179</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a1f69ae79605fe8f17f3183ae15583d39"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a1f69ae79605fe8f17f3183ae15583d39">TGServerService.Service.MigrateSettings</a></div><div class="ttdeci">void MigrateSettings(int oldVersion, int newVersion)</div><div class="ttdoc">Migrates the Properties.Settings file from an older version </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00115">Service.cs:115</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html"><div class="ttname"><a href="namespace_t_g_server_service.html">TGServerService</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a5f6ad886bff03e90360d6ea8fc0c94ad"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a5f6ad886bff03e90360d6ea8fc0c94ad">TGServerService.Service.WriteAccess</a></div><div class="ttdeci">static void WriteAccess(string username, bool authSuccess)</div><div class="ttdoc">Writes an access event to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00068">Service.cs:68</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
