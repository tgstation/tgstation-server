<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGServerService/Service.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   &#160;<span id="projectnumber">3.1.6.6</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f220d0611c2e3262469750905b70ffc9.html">TGServerService</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Service.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_t_g_server_service_2_service_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Specialized;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Diagnostics;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.IO;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Security.Principal;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.ServiceModel;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.ServiceProcess;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>.<a class="code" href="namespace_t_g_service_interface_1_1_components.html">Components</a>;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_server_service.html">TGServerService</a></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;{</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    [ServiceBehavior(ConcurrencyMode = ConcurrencyMode.Multiple, InstanceContextMode = InstanceContextMode.Single)]</div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html">   18</a></span>&#160;    <span class="keyword">class </span><a class="code" href="class_t_g_server_service_1_1_service.html">Service</a> : <a class="code" href="class_service_base.html">ServiceBase</a>, <a class="code" href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_s_service.html">ITGSService</a>, <a class="code" href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_connectivity.html">ITGConnectivity</a></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    {</div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a6e95310be3be5a0cebd4f0c00fc83123">   23</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">const</span> byte <a class="code" href="class_t_g_server_service_1_1_service.html#a6e95310be3be5a0cebd4f0c00fc83123">LoggingID</a> = 0;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a088c62d8706172788f1889e68074e574">   28</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> readonly <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a088c62d8706172788f1889e68074e574">VersionString</a> = <span class="stringliteral">&quot;/tg/station 13 Server Service v&quot;</span> + FileVersionInfo.GetVersionInfo(<a class="code" href="namespace_system.html">System</a>.Reflection.Assembly.GetExecutingAssembly().Location).FileVersion;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ac2057d36e9866b9fc8483ba5e56eca12">   33</a></span>&#160;        <span class="keyword">static</span> <a class="code" href="class_t_g_server_service_1_1_service.html">Service</a> <a class="code" href="class_t_g_server_service_1_1_service.html#ac2057d36e9866b9fc8483ba5e56eca12">ActiveService</a>;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ac3397831deffcbd077a20f4ceb86f7c7">   38</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#ac3397831deffcbd077a20f4ceb86f7c7">CancelImpersonation</a>()</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            WindowsIdentity.Impersonate(IntPtr.Zero);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        }</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">   50</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">WriteEntry</a>(<span class="keywordtype">string</span> message, <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a> <span class="keywordtype">id</span>, EventLogEntryType eventType, byte loggingID)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            ActiveService.EventLog.<a class="code" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">WriteEntry</a>(message, eventType, (<span class="keywordtype">int</span>)<span class="keywordtype">id</span> + loggingID);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#aab8893f216482bd3ac65029838ada7fd">   60</a></span>&#160;        <span class="keyword">static</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#aab8893f216482bd3ac65029838ada7fd">CheckInstanceName</a>(<span class="keywordtype">string</span> instanceName)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="keywordtype">char</span>[] bannedCharacters = { <span class="charliteral">&#39;;&#39;</span>, <span class="charliteral">&#39;&amp;&#39;</span>, <span class="charliteral">&#39;=&#39;</span>, <span class="charliteral">&#39;%&#39;</span> };</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> bannedCharacters)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                <span class="keywordflow">if</span> (instanceName.Contains(I.ToString()))</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Instance names may not contain the following characters: &#39;;&#39;, &#39;&amp;&#39;, &#39;=&#39;, or &#39;%&#39;&quot;</span>;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a500b9c8dc623291779fbe0d61a073600">   72</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a500b9c8dc623291779fbe0d61a073600">Service</a>()</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            ServiceName = <span class="stringliteral">&quot;TG Station Server&quot;</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <span class="keywordflow">if</span> (ActiveService != null)</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;There is already a Service instance running!&quot;</span>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            ActiveService = <span class="keyword">this</span>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        </div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a78d03d1ce1ea982ffc9b4eb2c4254fa3">   84</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a78d03d1ce1ea982ffc9b4eb2c4254fa3">Dispose</a>(<span class="keywordtype">bool</span> disposing)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            ActiveService = null;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            base.<a class="code" href="class_t_g_server_service_1_1_service.html#a78d03d1ce1ea982ffc9b4eb2c4254fa3">Dispose</a>(disposing);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a9fb024e6ebb361ab16de6eda9d741043">   93</a></span>&#160;        ServiceHost <a class="code" href="class_t_g_server_service_1_1_service.html#a9fb024e6ebb361ab16de6eda9d741043">serviceHost</a>;</div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ad84d7c573dcaddfa8411b826c1d4fc53">   97</a></span>&#160;        IDictionary&lt;string, ServiceHost&gt; <a class="code" href="class_t_g_server_service_1_1_service.html#ad84d7c573dcaddfa8411b826c1d4fc53">hosts</a>;</div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#aed1f5d700a3a39457ce637e1d8e62290">  101</a></span>&#160;        IList&lt;int&gt; <a class="code" href="class_t_g_server_service_1_1_service.html#aed1f5d700a3a39457ce637e1d8e62290">UsedLoggingIDs</a> = <span class="keyword">new</span> List&lt;int&gt;();</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#aa6dedd0eb3bb12503c8bbbc6cb76f3f7">  107</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#aa6dedd0eb3bb12503c8bbbc6cb76f3f7">MigrateSettings</a>(<span class="keywordtype">int</span> oldVersion)</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="keywordflow">switch</span> (oldVersion)</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">case</span> 6: <span class="comment">//switch to per-instance configs</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    var IC = <a class="code" href="class_t_g_server_service_1_1_deprecated_instance_config.html">DeprecatedInstanceConfig</a>.<a class="code" href="class_t_g_server_service_1_1_deprecated_instance_config.html#a283d7b133be485f8aa82efa41cb91e2f">CreateFromNETSettings</a>();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    IC.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a9d77e1404ff1815cd19ca1c6f5401987">Save</a>();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    Config.InstancePaths.Add(IC.Directory);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">  124</a></span>&#160;        IEnumerable&lt;InstanceConfig&gt; <a class="code" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">GetInstanceConfigs</a>()</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            var pathsToRemove = <span class="keyword">new</span> List&lt;string&gt;();</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                var IPS = Properties.Settings.Default.InstancePaths;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> IPS)</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a> ic;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                        ic = <a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a>.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#ac18cfbc0482a23d2092febe2c0a0bcfb">Load</a>(I);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                    <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">WriteEntry</a>(String.Format(<span class="stringliteral">&quot;Unable load instance config at path {0}. Error: {1} Detaching...&quot;</span>, I, e.ToString()), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.InstanceInitializationFailure, EventLogEntryType.Error, LoggingID);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        pathsToRemove.Add(I);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                    }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                    yield <span class="keywordflow">return</span> ic;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> pathsToRemove)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                    IPS.Remove(I);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a68b7d6185818aa22a4edcf4865ec2bb0">  154</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a68b7d6185818aa22a4edcf4865ec2bb0">ChangePortFromCommandLine</a>(<span class="keywordtype">string</span>[] args)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <span class="keywordflow">for</span> (var I = 0; I &lt; args.Length - 1; ++I)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                <span class="keywordflow">if</span> (args[I].ToLower() == <span class="stringliteral">&quot;-port&quot;</span>)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                        var res = Convert.ToUInt16(args[I + 1]);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                        <span class="keywordflow">if</span> (res == 0)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Cannot bind to port 0&quot;</span>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                        Config.RemoteAccessPort = res;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                    {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Invalid argument for \&quot;-port\&quot;&quot;</span>, e);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    Config.Save();</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a4bb8fb7f15c6f001175ce52d70ef903e">  181</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a4bb8fb7f15c6f001175ce52d70ef903e">OnStart</a>(<span class="keywordtype">string</span>[] args)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            Environment.CurrentDirectory = Directory.CreateDirectory(Path.GetTempPath() + <span class="stringliteral">&quot;/TGStationServerService&quot;</span>).FullName;  <span class="comment">//MOVE THIS POINTER BECAUSE ONE TIME I ALMOST ACCIDENTALLY NUKED MYSELF BY REFACTORING! http://imgur.com/zvGEpJD.png</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_service.html#a3ed52895c6c15b9f1270f73369958347">SetupConfig</a>();</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_service.html#a68b7d6185818aa22a4edcf4865ec2bb0">ChangePortFromCommandLine</a>(args);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_service.html#a1e851175c71de84bae17d2f43c8b3301">SetupService</a>();</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_service.html#ab74c8e27919681ca6333d98088e482b9">SetupInstances</a>();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_service.html#a6a61f954b4c3ea04d88d73bfb095ead6">OnlineAllHosts</a>();</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#afeed60cf886ff66bfcaa160f028f0022">  199</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#afeed60cf886ff66bfcaa160f028f0022">PrePrepConfig</a>()</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordflow">if</span> (Config.InstancePaths == null)</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                Config.InstancePaths = <span class="keyword">new</span> StringCollection();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a3ed52895c6c15b9f1270f73369958347">  210</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a3ed52895c6c15b9f1270f73369958347">SetupConfig</a>()</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">if</span> (Config.UpgradeRequired)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                var newVersion = Config.SettingsVersion;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                Config.Upgrade();</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html#afeed60cf886ff66bfcaa160f028f0022">PrePrepConfig</a>();</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                </div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="keywordflow">for</span> (var oldVersion = Config.SettingsVersion; oldVersion &lt; newVersion; ++oldVersion)</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html#aa6dedd0eb3bb12503c8bbbc6cb76f3f7">MigrateSettings</a>(oldVersion);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                Config.SettingsVersion = newVersion;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                Config.UpgradeRequired = <span class="keyword">false</span>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                Config.Save();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a1e851175c71de84bae17d2f43c8b3301">  233</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a1e851175c71de84bae17d2f43c8b3301">SetupService</a>()</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            serviceHost = <a class="code" href="class_t_g_server_service_1_1_service.html#abd51696063d87ec7fc00054a19b345d9">CreateHost</a>(<span class="keyword">this</span>, <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#a9357161b2c8d891dbf69a0e7018ddf77">MasterInterfaceName</a>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_service.html#a70efdca1b28c2d1a30df7e46bd48bc40">AddEndpoint</a>(serviceHost, typeof(<a class="code" href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_s_service.html">ITGSService</a>));</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_service.html#a70efdca1b28c2d1a30df7e46bd48bc40">AddEndpoint</a>(serviceHost, typeof(<a class="code" href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_connectivity.html">ITGConnectivity</a>));</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            serviceHost.Authorization.ServiceAuthorizationManager = <span class="keyword">new</span> <a class="code" href="class_t_g_server_service_1_1_administrative_authorization_manager.html">AdministrativeAuthorizationManager</a>();   <span class="comment">//only admins can diddle us</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a6a61f954b4c3ea04d88d73bfb095ead6">  244</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a6a61f954b4c3ea04d88d73bfb095ead6">OnlineAllHosts</a>()</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            serviceHost.Open();</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> hosts)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                I.Value.Open();</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#abd51696063d87ec7fc00054a19b345d9">  257</a></span>&#160;        <span class="keyword">static</span> ServiceHost <a class="code" href="class_t_g_server_service_1_1_service.html#abd51696063d87ec7fc00054a19b345d9">CreateHost</a>(<span class="keywordtype">object</span> singleton, <span class="keywordtype">string</span> endpointPostfix)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> ServiceHost(singleton, <span class="keyword">new</span> Uri[] { <span class="keyword">new</span> Uri(String.Format(<span class="stringliteral">&quot;net.pipe://localhost/{0}&quot;</span>, endpointPostfix)), <span class="keyword">new</span> Uri(String.Format(<span class="stringliteral">&quot;https://localhost:{0}/{1}&quot;</span>, Properties.Settings.Default.RemoteAccessPort, endpointPostfix)) })</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                CloseTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 5)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            };</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ab74c8e27919681ca6333d98088e482b9">  268</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#ab74c8e27919681ca6333d98088e482b9">SetupInstances</a>()</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            hosts = <span class="keyword">new</span> Dictionary&lt;string, ServiceHost&gt;();</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            var pathsToRemove = <span class="keyword">new</span> List&lt;string&gt;();</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            var seenNames = <span class="keyword">new</span> List&lt;string&gt;();</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">GetInstanceConfigs</a>())</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="keywordflow">if</span> (seenNames.Contains(I.Name))</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">WriteEntry</a>(String.Format(<span class="stringliteral">&quot;Instance at {0} has a duplicate name! Detaching...&quot;</span>, I.Directory), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.InstanceInitializationFailure, EventLogEntryType.Error, <a class="code" href="class_t_g_server_service_1_1_service.html#a6e95310be3be5a0cebd4f0c00fc83123">LoggingID</a>);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    pathsToRemove.Add(I.Directory);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                }</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_t_g_server_service_1_1_service.html#af9fbc7211bc275fbfbb1bd6fcf4f94d0">SetupInstance</a>(I) == null)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    pathsToRemove.Add(I.Directory);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    seenNames.Add(I.Name);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> pathsToRemove)</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                Properties.Settings.Default.InstancePaths.Remove(I);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a43203a881d0bd7376cfeb73182a847cc">  293</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a43203a881d0bd7376cfeb73182a847cc">UnlockLoggingID</a>(byte ID)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            lock (UsedLoggingIDs)</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                UsedLoggingIDs.Remove(ID);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#af8321586d223cb2326e14360b8af7d8e">  305</a></span>&#160;        byte <a class="code" href="class_t_g_server_service_1_1_service.html#af8321586d223cb2326e14360b8af7d8e">LockLoggingID</a>()</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            lock (UsedLoggingIDs)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                <span class="keywordflow">for</span> (byte I = 1; I &lt; 100; ++I)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                    <span class="keywordflow">if</span> (!UsedLoggingIDs.Contains(I))</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                    {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                        UsedLoggingIDs.Add(I);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                        <span class="keywordflow">return</span> I;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            }</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;All logging IDs in use!&quot;</span>);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#af9fbc7211bc275fbfbb1bd6fcf4f94d0">  324</a></span>&#160;        ServiceHost <a class="code" href="class_t_g_server_service_1_1_service.html#af9fbc7211bc275fbfbb1bd6fcf4f94d0">SetupInstance</a>(<a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a> config)</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a> instance;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordtype">string</span> instanceName;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="keywordflow">if</span> (hosts.ContainsKey(config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a93c4edaf28eccc9a37913d6224a568d9">Directory</a>))</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                    var datInstance = ((<a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a>)hosts[config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a93c4edaf28eccc9a37913d6224a568d9">Directory</a>].SingletonInstance);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">WriteEntry</a>(String.Format(<span class="stringliteral">&quot;Unable to start instance at path {0}. Has the same name as instance at path {1}. Detaching...&quot;</span>, config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a93c4edaf28eccc9a37913d6224a568d9">Directory</a>, datInstance.ServerDirectory()), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.InstanceInitializationFailure, EventLogEntryType.Error, LoggingID);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                    Properties.Settings.Default.InstancePaths.Remove(config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a93c4edaf28eccc9a37913d6224a568d9">Directory</a>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="keywordflow">if</span> (!config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a5c5299a15a41f783643dfee92e19ceed">Enabled</a>)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                var ID = <a class="code" href="class_t_g_server_service_1_1_service.html#af8321586d223cb2326e14360b8af7d8e">LockLoggingID</a>();</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">WriteEntry</a>(String.Format(<span class="stringliteral">&quot;Instance {0} ({1}) assigned logging ID {2}&quot;</span>, config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a7da592ea91a0b4ddf0806e25aa5d3b77">Name</a>, config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a93c4edaf28eccc9a37913d6224a568d9">Directory</a>, ID), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.InstanceIDAssigned, EventLogEntryType.Information, ID);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                instanceName = config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a7da592ea91a0b4ddf0806e25aa5d3b77">Name</a>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                instance = <span class="keyword">new</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a>(config, ID);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">WriteEntry</a>(String.Format(<span class="stringliteral">&quot;Unable to start instance at path {0}. Detaching... Error: {1}&quot;</span>, config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a93c4edaf28eccc9a37913d6224a568d9">Directory</a>, e.ToString()), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.InstanceInitializationFailure, EventLogEntryType.Error, LoggingID);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            var host = <a class="code" href="class_t_g_server_service_1_1_service.html#abd51696063d87ec7fc00054a19b345d9">CreateHost</a>(instance, String.Format(<span class="stringliteral">&quot;{0}/{1}&quot;</span>, <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#a4f396e87dea799dd730d59c6fc2e36ef">InstanceInterfaceName</a>, instanceName));</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            hosts.Add(instanceName, host);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            </div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="keywordflow">foreach</span> (var J <span class="keywordflow">in</span> <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#a177251e0cec2b05f762f91a560766e95">ValidInterfaces</a>)</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_service.html#a70efdca1b28c2d1a30df7e46bd48bc40">AddEndpoint</a>(host, J);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            host.Authorization.ServiceAuthorizationManager = instance;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keywordflow">return</span> host;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a70efdca1b28c2d1a30df7e46bd48bc40">  365</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a70efdca1b28c2d1a30df7e46bd48bc40">AddEndpoint</a>(ServiceHost host, Type typetype)</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            var bindingName = typetype.Name;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            host.AddServiceEndpoint(typetype, <span class="keyword">new</span> NetNamedPipeBinding() { SendTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 30), MaxReceivedMessageSize = <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#aa5ccca53bb7e2bd6fd609ee68099bbd2">TransferLimitLocal</a> }, bindingName);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            var httpsBinding = <span class="keyword">new</span> WSHttpBinding()</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                SendTimeout = <span class="keyword">new</span> TimeSpan(0, 0, 40),</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                MaxReceivedMessageSize = <a class="code" href="class_t_g_service_interface_1_1_interface.html">Interface</a>.<a class="code" href="class_t_g_service_interface_1_1_interface.html#a00d88d167689139612f0e7c4444eb35d">TransferLimitRemote</a></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            };</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            var requireAuth = typetype.Name != typeof(<a class="code" href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_connectivity.html">ITGConnectivity</a>).Name;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            httpsBinding.Security.Transport.ClientCredentialType = HttpClientCredentialType.None;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            httpsBinding.Security.Mode = requireAuth ? SecurityMode.TransportWithMessageCredential : SecurityMode.Transport;    <span class="comment">//do not require auth for a connectivity check</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            httpsBinding.Security.Message.ClientCredentialType = requireAuth ? MessageCredentialType.UserName : MessageCredentialType.None;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            host.AddServiceEndpoint(typetype, httpsBinding, bindingName);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a2dbfb4436b03982b6d7e466fde1763d7">  384</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a2dbfb4436b03982b6d7e466fde1763d7">OnStop</a>()</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> hosts)</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                        var host = I.Value;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                        var instance = (<a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a>)host.SingletonInstance;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                        host.Close();</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                        instance.Dispose();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_service.html#a43203a881d0bd7376cfeb73182a847cc">UnlockLoggingID</a>(instance.LoggingID);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                    }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">WriteEntry</a>(e.ToString(), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.ServiceShutdownFail, EventLogEntryType.Error, <a class="code" href="class_t_g_server_service_1_1_service.html#a6e95310be3be5a0cebd4f0c00fc83123">LoggingID</a>);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                serviceHost.Close();</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            Properties.Settings.Default.Save();</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            ActiveService = null;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#aabd5b55add385cb0a45b294074b5ed3d">  410</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#aabd5b55add385cb0a45b294074b5ed3d">VerifyConnection</a>() { }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a7af610c63c1113cd743cc2c240d5b1fc">  413</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a7af610c63c1113cd743cc2c240d5b1fc">PrepareForUpdate</a>()</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">foreach</span> (var I <span class="keywordflow">in</span> hosts)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                ((<a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a>)I.Value.SingletonInstance).Reattach(<span class="keyword">false</span>);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a3832427713c1d9a1e89c95c603f71e03">  420</a></span>&#160;        <span class="keyword">public</span> ushort <a class="code" href="class_t_g_server_service_1_1_service.html#a3832427713c1d9a1e89c95c603f71e03">RemoteAccessPort</a>()</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keywordflow">return</span> Properties.Settings.Default.RemoteAccessPort;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ae8d3d03864d6d3dddd839ffa06bd7f09">  426</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#ae8d3d03864d6d3dddd839ffa06bd7f09">SetRemoteAccessPort</a>(ushort port)</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="keywordflow">if</span> (port == 0)</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Cannot bind to port 0&quot;</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            Properties.Settings.Default.RemoteAccessPort = port;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a1a2bf19a85493e100eae48ccf8843f6f">  435</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a1a2bf19a85493e100eae48ccf8843f6f">Version</a>()</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a088c62d8706172788f1889e68074e574">VersionString</a>;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#acfdb38171925330315461b0ee025ae24">  441</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_service.html#acfdb38171925330315461b0ee025ae24">SetPythonPath</a>(<span class="keywordtype">string</span> path)</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="keywordflow">if</span> (!Directory.Exists(path))</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            Properties.Settings.Default.PythonPath = Path.GetFullPath(path);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#af90e43b785ee8ff8bb1dad5b7f137e66">  450</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#af90e43b785ee8ff8bb1dad5b7f137e66">PythonPath</a>()</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">return</span> Properties.Settings.Default.PythonPath;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        }</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a1238e3562599d24e76fe7551e25d577a">  456</a></span>&#160;        <span class="keyword">public</span> IList&lt;InstanceMetadata&gt; <a class="code" href="class_t_g_server_service_1_1_service.html#a1238e3562599d24e76fe7551e25d577a">ListInstances</a>()</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            var result = <span class="keyword">new</span> List&lt;InstanceMetadata&gt;();</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <span class="keywordflow">foreach</span> (var ic <span class="keywordflow">in</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">GetInstanceConfigs</a>()) </div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                    result.Add(<span class="keyword">new</span> <a class="code" href="class_t_g_service_interface_1_1_instance_metadata.html">InstanceMetadata</a></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                        Name = ic.<a class="code" href="class_t_g_service_interface_1_1_instance_metadata.html#aa4e0f82b2fef9af8fe214531d1951c9b">Name</a>,</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                        Path = ic.Directory,</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                        Enabled = ic.Enabled,</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                        LoggingID = (byte)(ic.Enabled ? ((<a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a>)hosts[ic.Name].SingletonInstance).LoggingID : 0)</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                    });</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a44796f0b39871f5104d4a08b0f6c890b">  472</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a44796f0b39871f5104d4a08b0f6c890b">CreateInstance</a>(<span class="keywordtype">string</span> Name, <span class="keywordtype">string</span> path)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        {</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            var res = <a class="code" href="class_t_g_server_service_1_1_service.html#aab8893f216482bd3ac65029838ada7fd">CheckInstanceName</a>(Name);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="keywordflow">if</span> (File.Exists(path) || Directory.Exists(path))</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Cannot create instance at pre-existing path!&quot;</span>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                <span class="keywordflow">if</span> (Config.InstancePaths.Contains(path))</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance at {0} already exists!&quot;</span>, path);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                <span class="keywordflow">foreach</span> (var oic <span class="keywordflow">in</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">GetInstanceConfigs</a>())</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                    <span class="keywordflow">if</span> (Name == oic.Name)</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance named {0} already exists!&quot;</span>, oic.Name);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a> ic;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                    ic = <span class="keyword">new</span> <a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a>(path)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                    {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                        Name = Name</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                    };</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                    Directory.CreateDirectory(path);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                    ic.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a9d77e1404ff1815cd19ca1c6f5401987">Save</a>();</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                    Properties.Settings.Default.InstancePaths.Add(path);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                    <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a7bd9fa33a5f51db6f4f44cdd8eaae281">SetupOneInstance</a>(ic);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a7bd9fa33a5f51db6f4f44cdd8eaae281">  511</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a7bd9fa33a5f51db6f4f44cdd8eaae281">SetupOneInstance</a>(<a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a> config)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                var host = <a class="code" href="class_t_g_server_service_1_1_service.html#af9fbc7211bc275fbfbb1bd6fcf4f94d0">SetupInstance</a>(config);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                <span class="keywordflow">if</span> (host != null)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                    host.Open();</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                        Properties.Settings.Default.InstancePaths.Remove(config.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a93c4edaf28eccc9a37913d6224a568d9">Directory</a>);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            }</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            {</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Instance set up but an error occurred while starting it: &quot;</span> + e.ToString();</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        }</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a602684a72a2b6c933779ed5682d432c6">  530</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a602684a72a2b6c933779ed5682d432c6">ImportInstance</a>(<span class="keywordtype">string</span> path)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        {</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            var Config = Properties.Settings.Default;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                <span class="keywordflow">if</span> (Config.InstancePaths.Contains(path))</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance at {0} already exists!&quot;</span>, path);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="keywordflow">if</span>(!Directory.Exists(path))</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;There is no instance located at {0}!&quot;</span>, path);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a> ic;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    ic = <a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a>.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#ac18cfbc0482a23d2092febe2c0a0bcfb">Load</a>(path);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    <span class="keywordflow">foreach</span>(var oic <span class="keywordflow">in</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">GetInstanceConfigs</a>())</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                        <span class="keywordflow">if</span>(ic.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a7da592ea91a0b4ddf0806e25aa5d3b77">Name</a> == oic.Name)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                            <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance named {0} already exists!&quot;</span>, oic.Name);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                    ic.<a class="code" href="class_t_g_server_service_1_1_instance_config.html#a9d77e1404ff1815cd19ca1c6f5401987">Save</a>();</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                    Properties.Settings.Default.InstancePaths.Add(path);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                {</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                    <span class="keywordflow">return</span> e.ToString();</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                }</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a7bd9fa33a5f51db6f4f44cdd8eaae281">SetupOneInstance</a>(ic);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#ae76f237bd1c470a81363ae5c4e7db2f4">  558</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_service.html#ae76f237bd1c470a81363ae5c4e7db2f4">InstanceEnabled</a>(<span class="keywordtype">string</span> Name)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            lock(<span class="keyword">this</span>)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <span class="keywordflow">return</span> hosts.ContainsKey(Name);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a3198184dea17357f249757cba2647c77">  567</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a3198184dea17357f249757cba2647c77">SetInstanceEnabled</a>(<span class="keywordtype">string</span> Name, <span class="keywordtype">bool</span> enabled)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a4a985af3b9cd637f80b406c0395599f2">SetInstanceEnabledImpl</a>(Name, enabled, out <span class="keywordtype">string</span> path);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a4a985af3b9cd637f80b406c0395599f2">  580</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a4a985af3b9cd637f80b406c0395599f2">SetInstanceEnabledImpl</a>(<span class="keywordtype">string</span> Name, <span class="keywordtype">bool</span> enabled, out <span class="keywordtype">string</span> path)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            path = null;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                var hostIsOnline = hosts.ContainsKey(Name);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <span class="keywordflow">if</span> (enabled)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                    <span class="keywordflow">if</span> (hostIsOnline)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                        <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                    <span class="comment">//now this is a bit awkward because we need to check each instance config for the one named Name</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                    <span class="keywordtype">string</span> LastCheckedConfig = null;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                    {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                        <span class="keywordflow">foreach</span> (var ic <span class="keywordflow">in</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">GetInstanceConfigs</a>())</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                        {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                            <span class="keywordflow">if</span> (ic.Name == Name)</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                            {</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                path = ic.Directory;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                ic.Enabled = <span class="keyword">true</span>;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a7bd9fa33a5f51db6f4f44cdd8eaae281">SetupOneInstance</a>(ic);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                            }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                        }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                    }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                    <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                    {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                        <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;An error occurred while checking instance config at {0}! Error: &quot;</span>, LastCheckedConfig, e.ToString());</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                    }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;Instance {0} does not exist!&quot;</span>, Name);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    <span class="keywordflow">if</span> (!hostIsOnline)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                        <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                    var host = hosts[Name];</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                    hosts.Remove(Name);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                    var inst = (<a class="code" href="class_t_g_server_service_1_1_server_instance.html">ServerInstance</a>)host.SingletonInstance;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                    host.Close();</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                    path = inst.ServerDirectory();</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                    inst.Offline();</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    inst.Dispose();</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html#a43203a881d0bd7376cfeb73182a847cc">UnlockLoggingID</a>(inst.LoggingID);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a5faffc551d8f0ef082208b53394a9aea">  628</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a5faffc551d8f0ef082208b53394a9aea">RenameInstance</a>(<span class="keywordtype">string</span> name, <span class="keywordtype">string</span> new_name)</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <span class="keywordflow">if</span> (name == new_name)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            var res = <a class="code" href="class_t_g_server_service_1_1_service.html#aab8893f216482bd3ac65029838ada7fd">CheckInstanceName</a>(new_name);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <span class="comment">//we have to check em all anyway</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_instance_config.html">InstanceConfig</a> the_droid_were_looking_for = null;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                <span class="keywordflow">foreach</span> (var ic <span class="keywordflow">in</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">GetInstanceConfigs</a>())</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                    <span class="keywordflow">if</span> (ic.Name == name)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                    {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                        the_droid_were_looking_for = ic;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                    }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ic.Name == new_name)</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                        <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;There is already another instance named {0}!&quot;</span>, new_name);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                <span class="keywordflow">if</span> (the_droid_were_looking_for == null)</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;There is no instance named {0}!&quot;</span>, name);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                var ie = <a class="code" href="class_t_g_server_service_1_1_service.html#ae76f237bd1c470a81363ae5c4e7db2f4">InstanceEnabled</a>(name);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                <span class="keywordflow">if</span>(ie)</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_service.html#a3198184dea17357f249757cba2647c77">SetInstanceEnabled</a>(name, <span class="keyword">false</span>);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                the_droid_were_looking_for.Name = new_name;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                <span class="keywordtype">string</span> result = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                    the_droid_were_looking_for.Save();</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                    result = null;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                <span class="keywordflow">catch</span>(Exception e)</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    result = <span class="stringliteral">&quot;Could not save instance config! Error: &quot;</span> + e.ToString();</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                }</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <span class="keywordflow">finally</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                    <span class="keywordflow">if</span> (ie)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                    {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                        var resRestore = <a class="code" href="class_t_g_server_service_1_1_service.html#a3198184dea17357f249757cba2647c77">SetInstanceEnabled</a>(new_name, <span class="keyword">true</span>);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                        <span class="keywordflow">if</span> (resRestore != null)</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                            result = (result + <span class="stringliteral">&quot; &quot;</span> + resRestore).Trim();</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                    }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            }</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        }</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_service.html#a4a3002f3d9ef01874bb73b676f5eb110">  677</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a4a3002f3d9ef01874bb73b676f5eb110">DetachInstance</a>(<span class="keywordtype">string</span> name)</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            lock (<span class="keyword">this</span>)</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            {</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                var res = <a class="code" href="class_t_g_server_service_1_1_service.html#a4a985af3b9cd637f80b406c0395599f2">SetInstanceEnabledImpl</a>(name, <span class="keyword">false</span>, out <span class="keywordtype">string</span> path);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                <span class="keywordflow">if</span> (res != null)</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                <span class="keywordflow">if</span> (path == null)    <span class="comment">//gotta find it ourselves</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                    <span class="keywordflow">foreach</span> (var ic <span class="keywordflow">in</span> <a class="code" href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">GetInstanceConfigs</a>())</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                        <span class="keywordflow">if</span> (ic.Name == name)</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                        {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                            path = ic.Directory;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        }</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                <span class="keywordflow">if</span> (path == null)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                    <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;No instance named {0} exists!&quot;</span>, name);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                Properties.Settings.Default.InstancePaths.Remove(path);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            }</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    }</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;}</div><div class="ttc" id="class_t_g_server_service_1_1_service_html_a78d03d1ce1ea982ffc9b4eb2c4254fa3"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a78d03d1ce1ea982ffc9b4eb2c4254fa3">TGServerService.Service.Dispose</a></div><div class="ttdeci">override void Dispose(bool disposing)</div><div class="ttdoc">Clears ActiveService </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00084">Service.cs:84</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_1_1_components_html"><div class="ttname"><a href="namespace_t_g_service_interface_1_1_components.html">TGServiceInterface.Components</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_service_interface_2_components_2_administration_8cs_source.html#l00003">Administration.cs:3</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_aab8893f216482bd3ac65029838ada7fd"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#aab8893f216482bd3ac65029838ada7fd">TGServerService.Service.CheckInstanceName</a></div><div class="ttdeci">static string CheckInstanceName(string instanceName)</div><div class="ttdoc">Checks an instanceName  for illegal characters </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00060">Service.cs:60</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a2dbfb4436b03982b6d7e466fde1763d7"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a2dbfb4436b03982b6d7e466fde1763d7">TGServerService.Service.OnStop</a></div><div class="ttdeci">override void OnStop()</div><div class="ttdoc">Shuts down all active ServiceHosts and calls IDisposable.Dispose on it&amp;#39;s ServerInstance ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00384">Service.cs:384</a></div></div>
<div class="ttc" id="interface_t_g_service_interface_1_1_components_1_1_i_t_g_s_service_html"><div class="ttname"><a href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_s_service.html">TGServiceInterface.Components.ITGSService</a></div><div class="ttdoc">Interface for managing the service </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_service_interface_2_components_2_service_8cs_source.html#l00010">Service.cs:10</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a7af610c63c1113cd743cc2c240d5b1fc"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a7af610c63c1113cd743cc2c240d5b1fc">TGServerService.Service.PrepareForUpdate</a></div><div class="ttdeci">void PrepareForUpdate()</div><div class="ttdoc">Next stop of the service will not close DD and sets a flag for it to reattach once it restarts  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00413">Service.cs:413</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_deprecated_instance_config_html"><div class="ttname"><a href="class_t_g_server_service_1_1_deprecated_instance_config.html">TGServerService.DeprecatedInstanceConfig</a></div><div class="ttdoc">Used to migrate old config settings </div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_instance_config_8cs_source.html#l00009">DeprecatedInstanceConfig.cs:9</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a500b9c8dc623291779fbe0d61a073600"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a500b9c8dc623291779fbe0d61a073600">TGServerService.Service.Service</a></div><div class="ttdeci">Service()</div><div class="ttdoc">Sets up ServiceName and ActiveService </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00072">Service.cs:72</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a088c62d8706172788f1889e68074e574"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a088c62d8706172788f1889e68074e574">TGServerService.Service.VersionString</a></div><div class="ttdeci">static readonly string VersionString</div><div class="ttdoc">The service version string based on the FileVersionInfo </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00028">Service.cs:28</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a3832427713c1d9a1e89c95c603f71e03"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a3832427713c1d9a1e89c95c603f71e03">TGServerService.Service.RemoteAccessPort</a></div><div class="ttdeci">ushort RemoteAccessPort()</div><div class="ttdoc">Get the port used for remote operation  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00420">Service.cs:420</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a43203a881d0bd7376cfeb73182a847cc"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a43203a881d0bd7376cfeb73182a847cc">TGServerService.Service.UnlockLoggingID</a></div><div class="ttdeci">void UnlockLoggingID(byte ID)</div><div class="ttdoc">Unlocks a ServerInstance.LoggingID acquired with LockLoggingID </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00293">Service.cs:293</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a6a61f954b4c3ea04d88d73bfb095ead6"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a6a61f954b4c3ea04d88d73bfb095ead6">TGServerService.Service.OnlineAllHosts</a></div><div class="ttdeci">void OnlineAllHosts()</div><div class="ttdoc">Opens all created ServiceHosts </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00244">Service.cs:244</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a1238e3562599d24e76fe7551e25d577a"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a1238e3562599d24e76fe7551e25d577a">TGServerService.Service.ListInstances</a></div><div class="ttdeci">IList&lt; InstanceMetadata &gt; ListInstances()</div><div class="ttdoc">List instances  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00456">Service.cs:456</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_afeed60cf886ff66bfcaa160f028f0022"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#afeed60cf886ff66bfcaa160f028f0022">TGServerService.Service.PrePrepConfig</a></div><div class="ttdeci">void PrePrepConfig()</div><div class="ttdoc">Writes some changes to the Properties.Settings that always need to be done. </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00199">Service.cs:199</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_a177251e0cec2b05f762f91a560766e95"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#a177251e0cec2b05f762f91a560766e95">TGServiceInterface.Interface.ValidInterfaces</a></div><div class="ttdeci">static readonly IList&lt; Type &gt; ValidInterfaces</div><div class="ttdoc">List of s that can be used with GetComponent&lt;T&gt; and CreateChannel&lt;T&gt; </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00022">Interface.cs:22</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html_a98d8f6303b894422167c743e15185398"><div class="ttname"><a href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">TGServerService.EventID</a></div><div class="ttdeci">EventID</div><div class="ttdoc">Various events and their IDs in no particular order. Found in the Windows event log. These key incremented by 100 and are guaranteed to never be reused in the future. In the windows event viewer, these IDs will be offset by the ServerInstance.LoggingID to distinguish events between instances. Each event ID may be information, a warning, or error and will be documented accordingly. Warnings will occur due to user, data, or network errors. Errors will occur due to filesystem errors or hard faults </div><div class="ttdef"><b>Definition:</b> <a href="_event_i_d_8cs_source.html#l00008">EventID.cs:8</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html">TGServerService.Service</a></div><div class="ttdoc">The windows service the application runs as </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00018">Service.cs:18</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a7bd9fa33a5f51db6f4f44cdd8eaae281"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a7bd9fa33a5f51db6f4f44cdd8eaae281">TGServerService.Service.SetupOneInstance</a></div><div class="ttdeci">string SetupOneInstance(InstanceConfig config)</div><div class="ttdoc">Starts and onlines an instance located at config  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00511">Service.cs:511</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html">TGServerService.ServerInstance</a></div><div class="ttdoc">The class which holds all interface components. There are no safeguards for call race conditions so t...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_administration_8cs_source.html#l00013">Administration.cs:13</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_abd51696063d87ec7fc00054a19b345d9"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#abd51696063d87ec7fc00054a19b345d9">TGServerService.Service.CreateHost</a></div><div class="ttdeci">static ServiceHost CreateHost(object singleton, string endpointPostfix)</div><div class="ttdoc">Creates a ServiceHost for singleton  using the default pipe, CloseTimeout for the ServiceHost...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00257">Service.cs:257</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_instance_config_html_a9d77e1404ff1815cd19ca1c6f5401987"><div class="ttname"><a href="class_t_g_server_service_1_1_instance_config.html#a9d77e1404ff1815cd19ca1c6f5401987">TGServerService.InstanceConfig.Save</a></div><div class="ttdeci">void Save()</div><div class="ttdoc">Saves the InstanceConfig to it&amp;#39;s ServerInstance Directory </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00132">InstanceConfig.cs:132</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a6e95310be3be5a0cebd4f0c00fc83123"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a6e95310be3be5a0cebd4f0c00fc83123">TGServerService.Service.LoggingID</a></div><div class="ttdeci">const byte LoggingID</div><div class="ttdoc">The logging ID used for Service events </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00023">Service.cs:23</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a9b5c6694977d1c65dcc661dbfd7edb97"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a9b5c6694977d1c65dcc661dbfd7edb97">TGServerService.Service.GetInstanceConfigs</a></div><div class="ttdeci">IEnumerable&lt; InstanceConfig &gt; GetInstanceConfigs()</div><div class="ttdoc">Enumerates configured InstanceConfigs. Detaches those that fail to load </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00124">Service.cs:124</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_instance_config_html_a7da592ea91a0b4ddf0806e25aa5d3b77"><div class="ttname"><a href="class_t_g_server_service_1_1_instance_config.html#a7da592ea91a0b4ddf0806e25aa5d3b77">TGServerService.InstanceConfig.Name</a></div><div class="ttdeci">string Name</div><div class="ttdoc">The name of the ServerInstance </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00034">InstanceConfig.cs:34</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_instance_config_html_a93c4edaf28eccc9a37913d6224a568d9"><div class="ttname"><a href="class_t_g_server_service_1_1_instance_config.html#a93c4edaf28eccc9a37913d6224a568d9">TGServerService.InstanceConfig.Directory</a></div><div class="ttdeci">string Directory</div><div class="ttdoc">The ServerInstance directory this InstanceConfig is for </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00024">InstanceConfig.cs:24</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_aabd5b55add385cb0a45b294074b5ed3d"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#aabd5b55add385cb0a45b294074b5ed3d">TGServerService.Service.VerifyConnection</a></div><div class="ttdeci">void VerifyConnection()</div><div class="ttdoc">Does nothing on the server end, but if the call completes, you can be sure you are connected...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00410">Service.cs:410</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ad84d7c573dcaddfa8411b826c1d4fc53"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ad84d7c573dcaddfa8411b826c1d4fc53">TGServerService.Service.hosts</a></div><div class="ttdeci">IDictionary&lt; string, ServiceHost &gt; hosts</div><div class="ttdoc">Map of InstanceConfig.Name to the respective ServiceHost hosting the ServerInstance ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00097">Service.cs:97</a></div></div>
<div class="ttc" id="interface_t_g_service_interface_1_1_components_1_1_i_t_g_connectivity_html"><div class="ttname"><a href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_connectivity.html">TGServiceInterface.Components.ITGConnectivity</a></div><div class="ttdoc">Used for testing connections to the service without authentication </div><div class="ttdef"><b>Definition:</b> <a href="_connectivity_8cs_source.html#l00009">Connectivity.cs:9</a></div></div>
<div class="ttc" id="class_service_base_html"><div class="ttname"><a href="class_service_base.html">ServiceBase</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_aa6dedd0eb3bb12503c8bbbc6cb76f3f7"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#aa6dedd0eb3bb12503c8bbbc6cb76f3f7">TGServerService.Service.MigrateSettings</a></div><div class="ttdeci">void MigrateSettings(int oldVersion)</div><div class="ttdoc">Migrates the .NET config from oldVersion  to oldVersion  + 1 </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00107">Service.cs:107</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_acfdb38171925330315461b0ee025ae24"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#acfdb38171925330315461b0ee025ae24">TGServerService.Service.SetPythonPath</a></div><div class="ttdeci">bool SetPythonPath(string path)</div><div class="ttdoc">Sets the path to the python 2.7 installation  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00441">Service.cs:441</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a5faffc551d8f0ef082208b53394a9aea"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a5faffc551d8f0ef082208b53394a9aea">TGServerService.Service.RenameInstance</a></div><div class="ttdeci">string RenameInstance(string name, string new_name)</div><div class="ttdoc">Renames an instance, this will restart the instance if it is enabled  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00628">Service.cs:628</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a4bb8fb7f15c6f001175ce52d70ef903e"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a4bb8fb7f15c6f001175ce52d70ef903e">TGServerService.Service.OnStart</a></div><div class="ttdeci">override void OnStart(string[] args)</div><div class="ttdoc">Called by the Windows service manager. Initializes and starts configured ServerInstances ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00181">Service.cs:181</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a4a3002f3d9ef01874bb73b676f5eb110"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a4a3002f3d9ef01874bb73b676f5eb110">TGServerService.Service.DetachInstance</a></div><div class="ttdeci">string DetachInstance(string name)</div><div class="ttdoc">Disables and unregisters an instance, allowing the folder and data to be manipulated manually  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00677">Service.cs:677</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_administrative_authorization_manager_html"><div class="ttname"><a href="class_t_g_server_service_1_1_administrative_authorization_manager.html">TGServerService.AdministrativeAuthorizationManager</a></div><div class="ttdoc">A ServiceAuthorizationManager used to determine only if the caller is an admin </div><div class="ttdef"><b>Definition:</b> <a href="_administrative_authorization_manager_8cs_source.html#l00012">AdministrativeAuthorizationManager.cs:12</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_instance_metadata_html_aa4e0f82b2fef9af8fe214531d1951c9b"><div class="ttname"><a href="class_t_g_service_interface_1_1_instance_metadata.html#aa4e0f82b2fef9af8fe214531d1951c9b">TGServiceInterface.InstanceMetadata.Name</a></div><div class="ttdeci">string Name</div><div class="ttdoc">The name of the Components.ITGInstance </div><div class="ttdef"><b>Definition:</b> <a href="_instance_metadata_8cs_source.html#l00015">InstanceMetadata.cs:15</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_instance_metadata_html"><div class="ttname"><a href="class_t_g_service_interface_1_1_instance_metadata.html">TGServiceInterface.InstanceMetadata</a></div><div class="ttdoc">Metadata about an Components.ITGInstance </div><div class="ttdef"><b>Definition:</b> <a href="_instance_metadata_8cs_source.html#l00009">InstanceMetadata.cs:9</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a44796f0b39871f5104d4a08b0f6c890b"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a44796f0b39871f5104d4a08b0f6c890b">TGServerService.Service.CreateInstance</a></div><div class="ttdeci">string CreateInstance(string Name, string path)</div><div class="ttdoc">Creates a new server instance  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00472">Service.cs:472</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ae8d3d03864d6d3dddd839ffa06bd7f09"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ae8d3d03864d6d3dddd839ffa06bd7f09">TGServerService.Service.SetRemoteAccessPort</a></div><div class="ttdeci">string SetRemoteAccessPort(ushort port)</div><div class="ttdoc">Set the port used for remote operation Requires a service restart to take effect  ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00426">Service.cs:426</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_aa5ccca53bb7e2bd6fd609ee68099bbd2"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#aa5ccca53bb7e2bd6fd609ee68099bbd2">TGServiceInterface.Interface.TransferLimitLocal</a></div><div class="ttdeci">const long TransferLimitLocal</div><div class="ttdoc">The maximum message size to and from a local server </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00027">Interface.cs:27</a></div></div>
<div class="ttc" id="_t_g_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_a00d88d167689139612f0e7c4444eb35d"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#a00d88d167689139612f0e7c4444eb35d">TGServiceInterface.Interface.TransferLimitRemote</a></div><div class="ttdeci">const long TransferLimitRemote</div><div class="ttdoc">The maximum message size to and from a remote server </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00032">Interface.cs:32</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html"><div class="ttname"><a href="namespace_t_g_service_interface.html">TGServiceInterface</a></div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00006">ChatSetupInfo.cs:6</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a4a985af3b9cd637f80b406c0395599f2"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a4a985af3b9cd637f80b406c0395599f2">TGServerService.Service.SetInstanceEnabledImpl</a></div><div class="ttdeci">string SetInstanceEnabledImpl(string Name, bool enabled, out string path)</div><div class="ttdoc">Sets a ServerInstance&amp;#39;s enabled status </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00580">Service.cs:580</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_a9357161b2c8d891dbf69a0e7018ddf77"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#a9357161b2c8d891dbf69a0e7018ddf77">TGServiceInterface.Interface.MasterInterfaceName</a></div><div class="ttdeci">const string MasterInterfaceName</div><div class="ttdoc">Base name of communication URLs </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00037">Interface.cs:37</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_af9fbc7211bc275fbfbb1bd6fcf4f94d0"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#af9fbc7211bc275fbfbb1bd6fcf4f94d0">TGServerService.Service.SetupInstance</a></div><div class="ttdeci">ServiceHost SetupInstance(InstanceConfig config)</div><div class="ttdoc">Creates and starts a ServiceHost for a ServerInstance at config  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00324">Service.cs:324</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a7c4beb99d9b8b74015aef3ea5e7c0a57"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a7c4beb99d9b8b74015aef3ea5e7c0a57">TGServerService.Service.WriteEntry</a></div><div class="ttdeci">static void WriteEntry(string message, EventID id, EventLogEntryType eventType, byte loggingID)</div><div class="ttdoc">Writes an event to Windows the event log </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00050">Service.cs:50</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ac2057d36e9866b9fc8483ba5e56eca12"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ac2057d36e9866b9fc8483ba5e56eca12">TGServerService.Service.ActiveService</a></div><div class="ttdeci">static Service ActiveService</div><div class="ttdoc">Singleton instance </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00033">Service.cs:33</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_instance_config_html"><div class="ttname"><a href="class_t_g_server_service_1_1_instance_config.html">TGServerService.InstanceConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00007">InstanceConfig.cs:7</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_deprecated_instance_config_html_a283d7b133be485f8aa82efa41cb91e2f"><div class="ttname"><a href="class_t_g_server_service_1_1_deprecated_instance_config.html#a283d7b133be485f8aa82efa41cb91e2f">TGServerService.DeprecatedInstanceConfig.CreateFromNETSettings</a></div><div class="ttdeci">static InstanceConfig CreateFromNETSettings()</div><div class="ttdoc">Convert the settings version 6 .NET settings file to a config json </div><div class="ttdef"><b>Definition:</b> <a href="_deprecated_instance_config_8cs_source.html#l00020">DeprecatedInstanceConfig.cs:20</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ac3397831deffcbd077a20f4ceb86f7c7"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ac3397831deffcbd077a20f4ceb86f7c7">TGServerService.Service.CancelImpersonation</a></div><div class="ttdeci">static void CancelImpersonation()</div><div class="ttdoc">Cancels WCF&amp;#39;s user impersonation to allow clean access to writing log files </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00038">Service.cs:38</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a9fb024e6ebb361ab16de6eda9d741043"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a9fb024e6ebb361ab16de6eda9d741043">TGServerService.Service.serviceHost</a></div><div class="ttdeci">ServiceHost serviceHost</div><div class="ttdoc">The WCF host that contains ITGSService connects to </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00093">Service.cs:93</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a1e851175c71de84bae17d2f43c8b3301"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a1e851175c71de84bae17d2f43c8b3301">TGServerService.Service.SetupService</a></div><div class="ttdeci">void SetupService()</div><div class="ttdoc">Creates the ServiceHost for ITGSService </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00233">Service.cs:233</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html_a4f396e87dea799dd730d59c6fc2e36ef"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html#a4f396e87dea799dd730d59c6fc2e36ef">TGServiceInterface.Interface.InstanceInterfaceName</a></div><div class="ttdeci">const string InstanceInterfaceName</div><div class="ttdoc">Base name of instance URLs </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00041">Interface.cs:41</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a1a2bf19a85493e100eae48ccf8843f6f"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a1a2bf19a85493e100eae48ccf8843f6f">TGServerService.Service.Version</a></div><div class="ttdeci">string Version()</div><div class="ttdoc">Retrieve&amp;#39;s the service&amp;#39;s version  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00435">Service.cs:435</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a602684a72a2b6c933779ed5682d432c6"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a602684a72a2b6c933779ed5682d432c6">TGServerService.Service.ImportInstance</a></div><div class="ttdeci">string ImportInstance(string path)</div><div class="ttdoc">Registers an existing server instance  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00530">Service.cs:530</a></div></div>
<div class="ttc" id="class_t_g_service_interface_1_1_interface_html"><div class="ttname"><a href="class_t_g_service_interface_1_1_interface.html">TGServiceInterface.Interface</a></div><div class="ttdoc">Main inteface class for the service </div><div class="ttdef"><b>Definition:</b> <a href="_interface_8cs_source.html#l00017">Interface.cs:17</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a70efdca1b28c2d1a30df7e46bd48bc40"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a70efdca1b28c2d1a30df7e46bd48bc40">TGServerService.Service.AddEndpoint</a></div><div class="ttdeci">void AddEndpoint(ServiceHost host, Type typetype)</div><div class="ttdoc">Adds a WCF endpoint for a component typetype  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00365">Service.cs:365</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a3ed52895c6c15b9f1270f73369958347"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a3ed52895c6c15b9f1270f73369958347">TGServerService.Service.SetupConfig</a></div><div class="ttdeci">void SetupConfig()</div><div class="ttdoc">Upgrades up the service configuration </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00210">Service.cs:210</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ab74c8e27919681ca6333d98088e482b9"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ab74c8e27919681ca6333d98088e482b9">TGServerService.Service.SetupInstances</a></div><div class="ttdeci">void SetupInstances()</div><div class="ttdoc">Creates ServiceHosts for all ServerInstances as listed in Properties.Settings.InstancePaths, detaches bad ones </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00268">Service.cs:268</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a68b7d6185818aa22a4edcf4865ec2bb0"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a68b7d6185818aa22a4edcf4865ec2bb0">TGServerService.Service.ChangePortFromCommandLine</a></div><div class="ttdeci">void ChangePortFromCommandLine(string[] args)</div><div class="ttdoc">Overrides and saves the configured Properties.Settings.RemoteAccessPort if requested by command line ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00154">Service.cs:154</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_instance_config_html_a5c5299a15a41f783643dfee92e19ceed"><div class="ttname"><a href="class_t_g_server_service_1_1_instance_config.html#a5c5299a15a41f783643dfee92e19ceed">TGServerService.InstanceConfig.Enabled</a></div><div class="ttdeci">bool Enabled</div><div class="ttdoc">If the ServerInstance is active </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00039">InstanceConfig.cs:39</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_aed1f5d700a3a39457ce637e1d8e62290"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#aed1f5d700a3a39457ce637e1d8e62290">TGServerService.Service.UsedLoggingIDs</a></div><div class="ttdeci">IList&lt; int &gt; UsedLoggingIDs</div><div class="ttdoc">List of ServerInstance.LoggingIDs in use </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00101">Service.cs:101</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_af8321586d223cb2326e14360b8af7d8e"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#af8321586d223cb2326e14360b8af7d8e">TGServerService.Service.LockLoggingID</a></div><div class="ttdeci">byte LockLoggingID()</div><div class="ttdoc">Gets and locks a ServerInstance.LoggingID </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00305">Service.cs:305</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html"><div class="ttname"><a href="namespace_t_g_server_service.html">TGServerService</a></div><div class="ttdef"><b>Definition:</b> <a href="_administrative_authorization_manager_8cs_source.html#l00007">AdministrativeAuthorizationManager.cs:7</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_a3198184dea17357f249757cba2647c77"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#a3198184dea17357f249757cba2647c77">TGServerService.Service.SetInstanceEnabled</a></div><div class="ttdeci">string SetInstanceEnabled(string Name, bool enabled)</div><div class="ttdoc">Sets an instance&amp;#39;s enabled status  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00567">Service.cs:567</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_af90e43b785ee8ff8bb1dad5b7f137e66"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#af90e43b785ee8ff8bb1dad5b7f137e66">TGServerService.Service.PythonPath</a></div><div class="ttdeci">string PythonPath()</div><div class="ttdoc">Gets the path to the python 2.7 installation  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00450">Service.cs:450</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_service_html_ae76f237bd1c470a81363ae5c4e7db2f4"><div class="ttname"><a href="class_t_g_server_service_1_1_service.html#ae76f237bd1c470a81363ae5c4e7db2f4">TGServerService.Service.InstanceEnabled</a></div><div class="ttdeci">bool InstanceEnabled(string Name)</div><div class="ttdoc">Checks if an instance is online  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_service_8cs_source.html#l00558">Service.cs:558</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_instance_config_html_ac18cfbc0482a23d2092febe2c0a0bcfb"><div class="ttname"><a href="class_t_g_server_service_1_1_instance_config.html#ac18cfbc0482a23d2092febe2c0a0bcfb">TGServerService.InstanceConfig.Load</a></div><div class="ttdeci">static InstanceConfig Load(string path)</div><div class="ttdoc">Loads and migrates an InstanceConfig from a ServerInstance at path  </div><div class="ttdef"><b>Definition:</b> <a href="_instance_config_8cs_source.html#l00144">InstanceConfig.cs:144</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
