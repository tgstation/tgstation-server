<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tgstation-server: API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">tgstation-server<span id="projectnumber">&#160;6.16.1</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">API</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#api_swag">OpenAPI Spec</a></li>
<li class="level1"><a href="#api_intro">Introduction</a></li>
<li class="level1"><a href="#api_lib">Official Libraries</a><ul><li class="level2"><a href="#api_interp">Interpreting C# Models</a></li>
</ul>
</li>
<li class="level1"><a href="#api_header">Headers</a></li>
<li class="level1"><a href="#api_response">Response Codes</a></li>
<li class="level1"><a href="#api_ver">Server Information</a></li>
<li class="level1"><a href="#api_auth">Authentication</a><ul><li class="level2"><a href="#api_auth_o">OAuth 2.0</a><ul><li class="level3"><a href="#api_auth_o_providers">Supported Providers</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#api_perms">Permissions</a></li>
<li class="level1"><a href="#api_transfer">File Transfers</a></li>
<li class="level1"><a href="#api_user">User Management</a><ul><li class="level2"><a href="#api_iuser">Instance User Management</a></li>
</ul>
</li>
<li class="level1"><a href="#api_admin">Server-wide Administrative Actions</a></li>
<li class="level1"><a href="#api_inst">Instances</a><ul><li class="level2"><a href="#api_job">Jobs</a></li>
<li class="level2"><a href="#api_chat">Chat Bots</a></li>
<li class="level2"><a href="#api_byond">Byond Version Management</a></li>
<li class="level2"><a href="#Git">Repository Management</a><ul><li class="level3"><a href="#api_repopost">Repository Commands for Git Aliases</a></li>
<li class="level3"><a href="#api_repotm">Test Merging</a></li>
<li class="level3"><a href="#api_repounsetauth">Unsetting Authentication</a></li>
</ul>
</li>
<li class="level2"><a href="#api_dm">Compiler Handling</a></li>
<li class="level2"><a href="#api_config">Static Files</a></li>
<li class="level2"><a href="#api_dog">Watchdog</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="api_swag"></a>
OpenAPI Spec</h1>
<p>TGS has a, from code, generated OpenAPI 3.0 specification. It is much more authorative than these documents.</p>
<p>The most up to date version should be found in the most recent appveyor build artifacts. It is also included in release artifacts.</p>
<p>You can use the API explorer SwaggerUI to interact with it: <a href="https://tgstation.github.io/tgs-api-doc-host/">https://tgstation.github.io/tgs-api-doc-host/</a></p>
<h1><a class="anchor" id="api_intro"></a>
Introduction</h1>
<p>The TGS API is designed to be a fully realized RESTful service. Once hosted, follow the specified protocol for developing new clients or one off requests that provide full control over the server</p>
<p>Routes and their usages are defined as follows</p>
<p>[I (If Instance is required)] &lt;<code>Http Method</code>&gt; "&lt;`Route`&gt;" [Request Model] =&gt; &lt;<code>Response Model</code>&gt;</p>
<h1><a class="anchor" id="api_lib"></a>
Official Libraries</h1>
<p>The TGS API's canonical definitions are provided as a .NET Standard library in the form of a nuget package located here: <a href="https://www.nuget.org/packages/Tgstation.Server.Api">https://www.nuget.org/packages/Tgstation.Server.Api</a></p>
<p>An all inclusive TAP interface for using the API is also provided in this package: <a href="https://www.nuget.org/packages/Tgstation.Server.Client">https://www.nuget.org/packages/Tgstation.Server.Client</a></p>
<p>Last off, if anything in this API doesn't seem to hold true when tested against the server, please open an issue on the repository.</p>
<h2><a class="anchor" id="api_interp"></a>
Interpreting C# Models</h2>
<p>This document will reference the canonical C# models in the <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models.html">Tgstation.Server.Api.Models</a> namespace. Note that these models are built to mirror the JSON requests and responses with a couple caveats.</p>
<ul>
<li>The first letter of every field name will/must be lowercase in JSON models</li>
<li>Fields marked 'Required' should be ignored, this is a semantic for the backing SQL database</li>
<li>Id fields must be specified when making POST requests</li>
<li>All other fields are optional and may be absent from responses or requests unless otherwise specified</li>
<li>Request models can be found in <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models_1_1_request.html">Tgstation.Server.Api.Models.Request</a>. Response models can be found in <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models_1_1_response.html">Tgstation.Server.Api.Models.Response</a>.</li>
</ul>
<h1><a class="anchor" id="api_header"></a>
Headers</h1>
<p>TGS expects this set of headers. Failure to provide them will result in 400 error responses</p>
<ul>
<li>User-Agent: The user agent product header value of the calling program</li>
<li>Api: Another product header value representing the version of the API to use. Currently this must be: <a class="el" href="namespace_tgstation_1_1_server_1_1_api.html">Tgstation.Server.Api</a>/4.0.0.0</li>
</ul>
<p>For POST, PATCH, and PUT requests you must also include the content type. Currently only json is supported</p>
<ul>
<li>Content-Type: application/json</li>
</ul>
<p>For requests made to any Instance based API's a header with the Instance's ID must be provided</p>
<ul>
<li>Instance: The ID of the instance being accessed</li>
</ul>
<p>An Authentication header is also required. See <a class="el" href="api.html#api_auth">Authentication</a></p>
<h1><a class="anchor" id="api_response"></a>
Response Codes</h1>
<p>TGS will only every return the response codes listed here</p>
<ul>
<li>200: OK. The response body will contain a json model or array depending on the API called.</li>
<li>201: Created. Returned when the request created an entity, 202 trumps this</li>
<li>202: Accepted. Used when a response triggers a long running operation such as a Tgstation.Server.Api.Models.Job or server restart</li>
<li>204: No Content. Identical to 200 with no response body.</li>
<li>400: Bad Request. The response body will contain an Tgstation.Server.Api.Models.ErrorMessage model detailing the error</li>
<li>401: Unauthorized. Invalid or expired credentials were provided. Check rights APIs for updates. See <a class="el" href="api.html#api_auth">Authentication</a> for details</li>
<li>403: Forbidden. User tried to make a request they were not allowed to perform.</li>
<li>404: Not found. A resource was requested that had never existed. In the case of retrieving a resource by ID, it could potentially exist in the future</li>
<li>406: Not Acceptable. Consequence of failing to provide an Accept header</li>
<li>408: Request Timeout. The client took to long to continue a request</li>
<li>409: Conflict. Documented in the requests that use them</li>
<li>410: Gone. Attempted to access/modify a resource that ideally should have been ready, but isn't or no longer is</li>
<li>422: Unprocessable Entity: Used specifically when an operation that requires a server restart is unable to be performed due to the <a class="el" href="namespace_tgstation_1_1_server_1_1_host_1_1_watchdog.html">Tgstation.Server.Host.Watchdog</a> not being present in the deployment. Should not happen with a proper server configuration. Response body contains an Tgstation.Server.Api.Models.ErrorMessage</li>
<li>424: Failed Dependency: When a request that depends on an external API fails for a reason other than rate limiting. The response body will contain an Tgstation.Server.Api.Models.ErrorMessage model detailing the error.</li>
<li>429: Rate limited. Used with operations that rely on GitHub.com. If a rate limit is hit for an operation this will be returned. Response will contain a Retry-After header with the amount of seconds to wait.</li>
<li>500: Server error. Please report the request and response body to the code repository</li>
<li>501: Not implemented. Functionality not available in the current server version</li>
<li>503: Service unavailable. The server is either starting up or shutting down and isn't ready to respond to requests. You can try again soon and a response/lack thereof will indicate which of the two events it was</li>
</ul>
<h1><a class="anchor" id="api_ver"></a>
Server Information</h1>
<p>The versions of the TGS host can be retireved with this request.</p>
<p>Note: This endpoint does not require authentication</p>
<p>GET "/" =&gt; Tgstation.Server.Api.Models.ServerInformation</p>
<p>The Version model fields are based on the C# one and looks like this:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;version&quot;: &quot;&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;.&lt;revision&gt;&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Other fields may be present in the Version model but should be ignored. See a description of these version numbers <a href="https://github.com/tgstation/tgstation-server/blob/master/.github/CONTRIBUTING.md#versioning">here</a>.</p>
<h1><a class="anchor" id="api_auth"></a>
Authentication</h1>
<p>Every request made to TGS requires authentication. It is provided in the form of the Authorization header.</p>
<p>The first request made to TGS must be to login the user</p>
<p>POST "/" =&gt; Tgstation.Server.Api.Models.Token</p>
<p>Headers:</p>
<ul>
<li>Authorization:Basic <code>&lt;Base64 encoded credentials in the form username:password&gt;</code></li>
</ul>
<p>If the provided credentials are valid and your user account is enabled you will recieve a Tgstation.Server.Api.Models.Token object </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;bearer&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoiMTUzMzIzNjk0MSIsIm5iZiI6IjE1MzMyMzYwNDEiLCJpc3MiOiJUZ3N0YXRpb24uU2VydmVyLkhvc3QiLCJhdWQiOiJUZ3N0YXRpb24uU2VydmVyLkFwaSJ9.QWFSWNi9mgol582zaK4MQ5XDK2gZF-Nx3z9_ToHjKW4&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>If your account is disabled, you will receive a 403 response.</p>
<p>You may recognize the bearer value as a <a href="https://jwt.io">Json Web Token</a>. This is a secure representation of your identity to the server. It expires after a set period of time or until your password changes. It must be present for requests made to all other APIs. To do so add the following header to your other requests</p>
<ul>
<li>Authorization:Bearer <code>&lt;your bearer token&gt;</code></li>
</ul>
<p>Continue to use this token until you begin to receive 401 responses from the API. Then repeat the process to get a new one if your credentials are still valid</p>
<h2><a class="anchor" id="api_auth_o"></a>
OAuth 2.0</h2>
<p>TGS supports OAuth 2.0 with select providers for authentication.</p>
<p>The flow for this is as follows:</p>
<ul>
<li>Retrieve the <a class="el" href="api.html#api_ver">Server Information</a> to find out which <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models.html#a49b1c1275c0d47d43360f8c7619ec901">Tgstation.Server.Api.Models.OAuthProvider</a> are enabled and their respective information.</li>
<li>Send the user to the Authorization Request endpoint for the provider using the client ID from above. See <a href="https://tools.ietf.org/html/rfc6749#section-4.1.1">https://tools.ietf.org/html/rfc6749#section-4.1.1</a>. DO NOT specify a redirect URI, this should be configured in the provider.</li>
<li>Retrieve the authorization response code after successfully completing the authorize step above.</li>
<li>Perform the following request:</li>
</ul>
<p>POST "/" =&gt; Tgstation.Server.Api.Models.Token</p>
<p>Headers:</p>
<ul>
<li>Authorization:OAuth <code>OAuth Authorization Response Code</code></li>
<li>OAuthProvider:&lt;Provider Name&gt;</li>
</ul>
<p>You will be granted a bearer token as in basic auth. This will have an extended expiration to avoid repeating the entire process.</p>
<h3><a class="anchor" id="api_auth_o_providers"></a>
Supported Providers</h3>
<ul>
<li>GitHub: <a href="https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps">https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps</a></li>
<li>Discord: <a href="https://discord.com/developers/docs/topics/oauth2">https://discord.com/developers/docs/topics/oauth2</a></li>
<li>TGForums: <a href="https://tgstation13.org/phpBB/viewtopic.php?f=45&t=30155">https://tgstation13.org/phpBB/viewtopic.php?f=45&amp;t=30155</a></li>
<li>Keycloak: <a href="https://plugins.miniorange.com/keycloak-single-sign-on-wordpress-sso-oauth-openid-connect">https://plugins.miniorange.com/keycloak-single-sign-on-wordpress-sso-oauth-openid-connect</a></li>
</ul>
<h1><a class="anchor" id="api_perms"></a>
Permissions</h1>
<p>Almost all actions available require some level of user permissions. Which are divided into two categories:</p>
<ul>
<li>General permissions apply to a user across the entire service</li>
<li>Instance permissions apply only when interacting with a specific instance</li>
</ul>
<p>Permissions are represented a a 32 bit integer in the form of bitflags. The two endpoints for retrieving these permission are:</p>
<p>GET "/Users" =&gt; Tgstation.Server.Api.Models.User I GET "/InstanceUser" =&gt; Tgstation.Server.Api.Models.InstanceUser</p>
<p>See individual documentation of each permission enum for their usage</p>
<h1><a class="anchor" id="api_transfer"></a>
File Transfers</h1>
<p>Certain responses inherit from Tgstation.Server.Api.Models.FileTicketResult. These are special in that, having that model's Tgstation.Server.Api.Models.FileTicketResult.FileTicket field populated indicates there is a pending file download or upload to take place. These are handled in the "/Transfer" endpoint.</p>
<p>To perform a file download make the following request:</p>
<p>GET "/Transfer?ticket=&lt;@ref Tgstation.Server.Api.Models.FileTicketResult.FileTicket&gt;" =&gt; application/octet-stream</p>
<p>To perform a file upload make the following request:</p>
<p>PUT "/Transfer?ticket=&lt;@ref Tgstation.Server.Api.Models.FileTicketResult.FileTicket&gt;" application/octet-stream =&gt; OK</p>
<p>File tickets are only valid for a short time after the initial request is made and should be dealt with immediately. Ensure that the file tickets are properly URL encoded.</p>
<h1><a class="anchor" id="api_user"></a>
User Management</h1>
<p>TGS start with one user: "Admin". The password is "ISolemlySwearToDeleteTheDataDirectory"</p>
<p>There are two types of users that can be created: Database users and system users. Database users are your plain login/password style users. System users are based on either Windows or POSIX accounts depending on the host system. They cannot be created by TGS and have to be activated by adding them to the Database similarly to a normal user using the "SystemIdentifier" field which should generally be set to their username or DOMAIN\Username in an active directory environment. These act the same as regular users with the only exception being <a class="el" href="api.html#api_config">Static Files</a>. See that section for details.</p>
<p>New users can be created with the following method.</p>
<p>PUT "/User" Tgstation.Server.Api.Models.UserUpdate =&gt; Tgstation.Server.Api.Models.User</p>
<p>To create a regular user, populate the name and password fields. To create a system user populate the SystemIdentifier field. Users rights and enabled status can also be specified in this call. To change them later use this API.</p>
<p>POST "/User" Tgstation.Server.Api.Models.UserUpdate =&gt; Tgstation.Server.Api.Models.User</p>
<p>Passowords for database users may be changed as well using this call. The capitalization of the display name of a user may also be changed</p>
<h2><a class="anchor" id="api_iuser"></a>
Instance User Management</h2>
<p>Instance users must be created for a given instance before being manipulated. The creator of an instance starts with full permissions on it</p>
<p>I PUT "/InstanceUser" Tgstation.Server.Api.Models.InstanceUser =&gt; Tgstation.Server.Api.Models.InstanceUser</p>
<p>They can be updated with a similar POST</p>
<p>I POST "/InstanceUser" Tgstation.Server.Api.Models.InstanceUser =&gt; Tgstation.Server.Api.Models.InstanceUser</p>
<p>Unlike regular users, they can also be deleted, which prevents the user from discovering the instance</p>
<p>I DELETE "/InstanceUser/{UserId}" =&gt; OK</p>
<p>Users with the permission to modify <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_instance.html">Tgstation.Server.Api.Models.Instance</a> objects can also gain user editing rights for any Instance. See api_instance</p>
<h1><a class="anchor" id="api_admin"></a>
Server-wide Administrative Actions</h1>
<p>You can retrieve server update information with this</p>
<p>GET "/Administration" =&gt; Tgstation.Server.Api.Models.Administration</p>
<p>If you want to perform a live update of the server use</p>
<p>POST "/Administration" Tgstation.Server.Api.Models.Administration =&gt; OK</p>
<p>With the Tgstation.Server.Api.Models.Administration.NewVersion field set</p>
<p>Any DreamDaemon servers running will persist while the server installs the new version from the official tgstation-server GitHub (If it exists)</p>
<p>If the server is otherwise acting funky and you wish to restart it, use this request:</p>
<p>DELETE "/Administration" =&gt; OK</p>
<h1><a class="anchor" id="api_inst"></a>
Instances</h1>
<p>Instances are DreamDaemon server configurations, they live in their own directory on the disk somewhere you specify. TGS starts with no default instance, to create one use this request:</p>
<p>PUT "/Instance" <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_instance.html">Tgstation.Server.Api.Models.Instance</a> =&gt; <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_instance.html">Tgstation.Server.Api.Models.Instance</a></p>
<p>This normally returns 201 BUT, in the case of attaching an existing instance, 200 will instead be returned</p>
<p>The user that creates an instance will be given full Tgstation.Server.Api.Models.InstanceUser permission. The path must not exist at the time of creation. Support for attaching instances from backups is yet to come.</p>
<p>A specific Instance may be retrieved with:</p>
<p>GET "/Instances/{InstanceID}" =&gt; <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_instance.html">Tgstation.Server.Api.Models.Instance</a></p>
<p>Instances start offline, regardless of what was specified during the create request. An offline instance will return 403 for all requests made to it.</p>
<p>To online or change other instance variables use the following request. Note that using this request (even with an empty object) will automatically give you the Tgstation.Server.Api.Rights.InstanceUserRights.WriteUsers right for that instance if you don't have it</p>
<p>POST "/Instance" <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_instance.html">Tgstation.Server.Api.Models.Instance</a> =&gt; <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_instance.html">Tgstation.Server.Api.Models.Instance</a></p>
<p>Note that onlining an offline instance will never automatically start DreamDaemon. That must be done as a seperate step.</p>
<p>Instances can be detached which will delete all meta knowledge of the instance (Compile metadata, job metadata, repository commit metadata, Test merge metadata, etc...) but leave the files intact. That can be done with this request:</p>
<p>DELETE "/Instance/{InstanceId}" =&gt; OK</p>
<h2><a class="anchor" id="api_job"></a>
Jobs</h2>
<p>Some requests return Tgstation.Server.Api.Models.Job objects. These are long running tasks the server will perform asyncronously and can be polled for status.</p>
<p>Note that the job representing instance move operations must be queried and cancelled differently than others. See the documentation of Tgstation.Server.Api.Models.Instance.MoveJob for details</p>
<p>To list all jobs in an Instance use the following request</p>
<p>I GET "/Job/List" =&gt; Array of Tgstation.Server.Api.Models.Job</p>
<p>Note that the response for this request will only have the Tgstation.Server.Api.Models.Job.Id field populated</p>
<p>To get full details of <em>active</em> jobs use the following request:</p>
<p>I GET "/Job" =&gt; Array of Tgstation.Server.Api.Models.Job</p>
<p>To get full details of a specific job use the following request:</p>
<p>I GET "/Job/{JobId}" =&gt; Tgstation.Server.Api.Models.Job</p>
<p>To cancel a running job (If the job can be cancelled and you have sufficient rights) use the following request:</p>
<p>I DELETE "/Job/{JobId}" =&gt; OK</p>
<h2><a class="anchor" id="api_chat"></a>
Chat Bots</h2>
<p>Each chat bot is represented by a Tgstation.Server.Api.Models.ChatBot object</p>
<p>Chat bots can be created/updated/deleted with the following requests respectively</p>
<p>I PUT "/Chat" Tgstation.Server.Api.Models.ChatBot =&gt; Tgstation.Server.Api.Models.ChatBot I POST "/Chat" Tgstation.Server.Api.Models.ChatBot =&gt; Tgstation.Server.Api.Models.ChatBot I DELETE "/Chat/{ChatBotId}" =&gt; OK</p>
<p>The Tgstation.Server.Api.Models.Internal.ChatBot.ConnectionString must differ based on what kind of chat bot you wish to create. Each <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models.html#a2d962413bc23404156feea75066e39cc">Tgstation.Server.Api.Models.ChatProvider</a> has a <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_chat_connection_string_builder.html">Tgstation.Server.Api.Models.Internal.ChatConnectionStringBuilder</a> that dictates how to form it</p>
<p>For IRC chat bots see <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_irc_connection_string_builder.html">Tgstation.Server.Api.Models.IrcConnectionStringBuilder</a> For Discord chat bots see <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_discord_connection_string_builder.html">Tgstation.Server.Api.Models.DiscordConnectionStringBuilder</a></p>
<p>A specific bot's settings may be retrieved with:</p>
<p>I GET "/Chat/{ChatBotId}" =&gt; Tgstation.Server.Api.Models.ChatBot</p>
<p>Also note that if the Tgstation.Server.Api.Models.ChatBot.Channels is present in a POST request, the list will fully replace any active channels</p>
<h2><a class="anchor" id="api_byond"></a>
Byond Version Management</h2>
<p>To get the Byond version used for new compilations use the following request:</p>
<p>I GET "/Byond" =&gt; <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models.html#ad8fb60934662752c4bbed899440208eaa2f4b44b678b37bcd3239cd83e64d0eb0">Tgstation.Server.Api.Models.Byond</a></p>
<p>To set the active Byond version:</p>
<p>I POST "/Byond" <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models.html#ad8fb60934662752c4bbed899440208eaa2f4b44b678b37bcd3239cd83e64d0eb0">Tgstation.Server.Api.Models.Byond</a> =&gt; <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models.html#ad8fb60934662752c4bbed899440208eaa2f4b44b678b37bcd3239cd83e64d0eb0">Tgstation.Server.Api.Models.Byond</a></p>
<p>This will queue up a job to install the byond version if it doesn't exist which will be returned in the response. The Tgstation.Server.Api.Models.Internal.RawData.Content field can be used to upload custom zip files.</p>
<p>To list all installed Byond versions use the following request:</p>
<p>I GET "/Byond/List" =&gt; Array of <a class="el" href="namespace_tgstation_1_1_server_1_1_api_1_1_models.html#ad8fb60934662752c4bbed899440208eaa2f4b44b678b37bcd3239cd83e64d0eb0">Tgstation.Server.Api.Models.Byond</a></p>
<h2><a class="anchor" id="Git"></a>
Repository Management</h2>
<p>To read the current repository state use the following request:</p>
<p>I GET "/Repository" =&gt; Tgstation.Server.Api.Models.Repository</p>
<p>To clone the repository if it doesn't yet exist use the following request:</p>
<p>I PUT "/Repository" =&gt; Tgstation.Server.Api.Models.Repository</p>
<p>The clone job will be represented by the Tgstation.Server.Api.Models.Repository.ActiveJob field. Specify the Tgstation.Server.Api.Models.Repository.Origin URL. Optionally specify the initial Tgstation.Server.Api.Models.Repository.Reference as a git tag or branch. Be sure to specify the authentication fields if necessary to access your repository. Will return 409 if the repository already exists or is already being cloned</p>
<p>To delete an existing repository make the following request:</p>
<p>I DELETE "/Repository" =&gt; OK</p>
<p>Modifications to the repository are done with the following request:</p>
<p>I POST "/Repository" =&gt; Tgstation.Server.Api.Models.Repository =&gt; Tgstation.Server.Api.Models.Repository</p>
<p>Each update that requires git changes creates a job specified in the Tgstation.Server.Api.Models.Repository.ActiveJob field jobs will be queued in succession. See below for POST examples.</p>
<h3><a class="anchor" id="api_repopost"></a>
Repository Commands for Git Aliases</h3>
<p>All these actions are done with the POST method</p>
<p>git pull (Only if Tgstation.Server.Api.Models.Repository.Reference is set): </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;updateFromOrigin&quot;: true</div>
<div class="line">}</div>
</div><!-- fragment --><p>git checkout &lt;<code>commit sha</code>&gt; (Unsets Tgstation.Server.Api.Models.Repository.Reference): </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;checkoutSha&quot;: &quot;&lt;commit sha&gt;&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>git checkout -f &lt;<code>branch or tag</code>&gt; &amp;&amp; git clean -fxd (Sets Tgstation.Server.Api.Models.Repository.Reference): </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;reference&quot;: &quot;&lt;branch or tag&gt;&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>git fetch &amp;&amp; git checkout -f branch &amp;&amp; git clean -fxd &amp;&amp; git reset &ndash;hard origin/branch (Sets Tgstation.Server.Api.Models.Repository.Reference); </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;updateFromOrigin&quot;: true,</div>
<div class="line">    &quot;reference&quot;: &quot;branch&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="api_repotm"></a>
Test Merging</h3>
<p>Any of the above POST methods can be combined with the Tgstation.Server.Api.Models.Repository.NewTestMerges field to add test merges on top of the checked out commit.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;newTestMerges&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;number&quot;: 12345,</div>
<div class="line">            &quot;comment&quot;: &quot;I&#39;m merging this for x reason&quot;</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            &quot;number&quot;: 12346,</div>
<div class="line">            &quot;pullRequestRevision&quot;: &quot;abcdef1&quot;</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the server detects a set of <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_test_merge_parameters.html">Tgstation.Server.Api.Models.TestMergeParameters</a> being applied that it has seen before, it'll instead attempt to checkout the commit that was created then.</p>
<h3><a class="anchor" id="api_repounsetauth"></a>
Unsetting Authentication</h3>
<p>The repository uses the Tgstation.Server.Api.Models.Repository.AccessUser and Tgstation.Server.Api.Models.Repository.AccessToken credentials to access the remote repository if these fields are set. To unset them you must set both of them to an empty string like so</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;accessUser&quot;: &quot;&quot;,</div>
<div class="line">    &quot;accessToken&quot;: &quot;&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This will remove both fields from the database</p>
<h2><a class="anchor" id="api_dm"></a>
Compiler Handling</h2>
<p>The DM compiler can run one job at a time for an Instance. Instead of using standard Tgstation.Server.Api.Models.Job.Progress it uses the Tgstation.Server.Api.Models.DreamMaker.Status field to denote it's current stage. It can be retrieved like this:</p>
<p>I GET "/DreamMaker" =&gt; Tgstation.Server.Api.Models.DreamMaker</p>
<p>This will also return the last successful Tgstation.Server.Api.Models.CompileJob as well as the <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_dream_maker_settings.html#a2382b143a3da29cd0f748d793771cd03">Tgstation.Server.Api.Models.Internal.DreamMakerSettings.ProjectName</a></p>
<p>The ProjectName field can be changed with this method:</p>
<p>I POST "/DreamMaker" Tgstation.Server.Api.Models.DreamMaker =&gt; Tgstation.Server.Api.Models.DreamMaker</p>
<p>To start a compile job use the following request:</p>
<p>I PUT "/DreamMaker" Empty =&gt; Tgstation.Server.Api.Models.Job</p>
<p>The job object returned represents the compile job</p>
<p>"Empty" refers to an empty json object like so:</p>
<div class="fragment"><div class="line">{}</div>
</div><!-- fragment --><p>The compiler endpoint is also used to read compile jobs</p>
<p>To list successful compile jobs ids use:</p>
<p>I GET "/DreamMaker/List" =&gt; Array of Tgstation.Server.Api.Models.CompileJob</p>
<p>To get a specific compile job use:</p>
<p>I GET "/DreamMaker/{CompileJobId}" =&gt; Tgstation.Server.Api.Models.CompileJob</p>
<h2><a class="anchor" id="api_config"></a>
Static Files</h2>
<p>Static files can be both read and written.</p>
<p>To get the contents of a static file directory use the following method</p>
<p>I GET "/Config/List/&lt;path to directory&gt;" =&gt; Array of Tgstation.Server.Api.Models.ConfigurationFile</p>
<p>Where the path is formatted as: directory/inner_directory/more_directories</p>
<p>If the path is empty, the root directory will be retrieved. The Tgstation.Server.Api.Models.ConfigurationFile.Content and Tgstation.Server.Api.Models.ConfigurationFile.LastReadHash fields will not be populated for this response</p>
<p>If you do not have access to list the requested directory, a 403 response will be returned. If the path actually represents a file or the directory no longer exists a 410 response will be returned.</p>
<p>To create an empty config directory use the following request</p>
<p>I PUT "/Config" Tgstation.Server.Api.Models.ConfigurationFile =&gt; Tgstation.Server.Api.Models.ConfigurationFile</p>
<p>To get the content of a static file use the following method</p>
<p>I GET "/Config/File/&lt;path to file&gt;" =&gt; Tgstation.Server.Api.Models.ConfigurationFile</p>
<p>410 will be returned if the path doesn't exist. Tgstation.Server.Api.Models.ConfigurationFile.Content will only be populated if the path is a file the user has access to, otherwise the other fields will be populated appropriately.</p>
<p>To create, write, and delete files use the following request</p>
<p>I POST "/Config" Tgstation.Server.Api.Models.ConfigurationFile =&gt; Tgstation.Server.Api.Models.ConfigurationFile</p>
<p>When creating a file, only Tgstation.Server.Api.Models.ConfigurationFile.Path and Tgstation.Server.Api.Models.ConfigurationFile.Content should be specified</p>
<p>If the file already exists, the Tgstation.Server.Api.Models.ConfigurationFile.LastReadHash field must also be present with the last version received from the server for that file. If this does not match at the time of the request, 409 will be returned, indicating the file has changed since it was last viewed by the client.</p>
<p>To delete a file set Tgstation.Server.Api.Models.ConfigurationFile.Content to null in the request.</p>
<p>To delete an empty directory use the following request</p>
<p>I DELETE "/Config" Tgstation.Server.Api.Models.ConfigurationFile =&gt; OK</p>
<p>Where the request Tgstation.Server.Api.Models.ConfigurationFile.Path is set to the directory to delete</p>
<h2><a class="anchor" id="api_dog"></a>
Watchdog</h2>
<p>To read watchdog status use the following request:</p>
<p>I GET "/DreamDaemon" =&gt; Tgstation.Server.Api.Models.DreamDaemon</p>
<p>To update watchdog settings use the following request:</p>
<p>I POST "/DreamDaemon" =&gt; Tgstation.Server.Api.Models.DreamDaemon</p>
<p>Note that soft restart/shutdown operations cannot be cancelled via this method, they can be changed from one to another however.</p>
<p>To start the watchdog use the following request:</p>
<p>I PUT "/DreamDaemon" Empty =&gt; Tgstation.Server.Api.Models.Job</p>
<p>To restart the watchdog use the following request:</p>
<p>I PATCH "/DreamDaemon" Empty =&gt; Tgstation.Server.Api.Models.Job</p>
<p>The returned jobs represents the startup process for the watchdog</p>
<p>To stop the watchdog use the following request:</p>
<p>I DELETE "/DreamDaemon" =&gt; OK </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
