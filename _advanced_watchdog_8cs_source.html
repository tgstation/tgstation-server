<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tgstation-server: src/Tgstation.Server.Host/Components/Watchdog/AdvancedWatchdog.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">tgstation-server<span id="projectnumber">&#160;5.17.3</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_34761767c1c3cd212f9d2f80ea0828a8.html">Tgstation.Server.Host</a></li><li class="navelem"><a class="el" href="dir_7a3fd032a1362a6005a1fc9227a8dd86.html">Components</a></li><li class="navelem"><a class="el" href="dir_02f69155ced6ccca99a24744a5273903.html">Watchdog</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">AdvancedWatchdog.cs</div></div>
</div><!--header-->
<div class="contents">
<a href="_advanced_watchdog_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="keyword">using </span>System;</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">using </span>System.Collections.Generic;</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">using </span>System.Diagnostics;</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">using </span>System.Threading;</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">using </span>System.Threading.Tasks;</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="keyword">using </span>Microsoft.Extensions.Logging;</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal.html">Tgstation.Server.Api.Models.Internal</a>;</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat.html">Tgstation.Server.Host.Components.Chat</a>;</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment.html">Tgstation.Server.Host.Components.Deployment</a>;</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_remote.html">Tgstation.Server.Host.Components.Deployment.Remote</a>;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_events.html">Tgstation.Server.Host.Components.Events</a>;</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_session.html">Tgstation.Server.Host.Components.Session</a>;</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_core.html">Tgstation.Server.Host.Core</a>;</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_i_o.html">Tgstation.Server.Host.IO</a>;</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_jobs.html">Tgstation.Server.Host.Jobs</a>;</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_utils.html">Tgstation.Server.Host.Utils</a>;</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno"><a class="line" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html">   20</a></span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html">Tgstation.Server.Host.Components.Watchdog</a></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>{</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html">   25</a></span>    <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html">AdvancedWatchdog</a> : <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_basic_watchdog.html">BasicWatchdog</a></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    {</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">   30</a></span>        <span class="keyword">protected</span> <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html">SwappableDmbProvider</a> <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a> { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#aadaea6d8f22e45c5c9dd9299657a2d5f">   35</a></span>        <span class="keyword">protected</span> <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_i_o_1_1_i_filesystem_link_factory.html">IFilesystemLinkFactory</a> <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#aadaea6d8f22e45c5c9dd9299657a2d5f">LinkFactory</a> { <span class="keyword">get</span>; }</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">   40</a></span>        readonly List&lt;Task&gt; <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">deploymentCleanupTasks</a>;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">   45</a></span>        <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html">SwappableDmbProvider</a> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>;</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0df40065bfa38cf64ef01a8147f1a684">   50</a></span>        <span class="keyword">volatile</span> TaskCompletionSource <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0df40065bfa38cf64ef01a8147f1a684">deploymentCleanupGate</a>;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#acb48f966670f07a01c89a708fc82411a">   71</a></span>        <span class="keyword">public</span> <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#acb48f966670f07a01c89a708fc82411a">AdvancedWatchdog</a>(</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html">IChatManager</a> chat,</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_i_session_controller_factory.html">ISessionControllerFactory</a> sessionControllerFactory,</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_factory.html">IDmbFactory</a> dmbFactory,</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_i_session_persistor.html">ISessionPersistor</a> sessionPersistor,</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_jobs_1_1_i_job_manager.html">IJobManager</a> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a1688863ddcd7d0bbfa3ec13b7b015319">jobManager</a>,</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control.html">IServerControl</a> serverControl,</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_utils_1_1_i_async_delayer.html">IAsyncDelayer</a> asyncDelayer,</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_i_o_1_1_i_i_o_manager.html">IIOManager</a> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a8becb1115fe1c09c84534c798466e03f">diagnosticsIOManager</a>,</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_events_1_1_i_event_consumer.html">IEventConsumer</a> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5768c37124d54e80c66dc63d28d0dea4">eventConsumer</a>,</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_remote_1_1_i_remote_deployment_manager_factory.html">IRemoteDeploymentManagerFactory</a> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a72637a3ebe8925b7c3753416370ad83c">remoteDeploymentManagerFactory</a>,</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_i_o_1_1_i_i_o_manager.html">IIOManager</a> gameIOManager,</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_i_o_1_1_i_filesystem_link_factory.html">IFilesystemLinkFactory</a> linkFactory,</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>            ILogger&lt;AdvancedWatchdog&gt; logger,</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <a class="code hl_class" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_dream_daemon_launch_parameters.html">DreamDaemonLaunchParameters</a> initialLaunchParameters,</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            Api.Models.Instance instance,</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            <span class="keywordtype">bool</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a410f168d84f80c138450fb42f222ba01">autoStart</a>)</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            : base(</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>                chat,</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                sessionControllerFactory,</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                dmbFactory,</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                sessionPersistor,</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a1688863ddcd7d0bbfa3ec13b7b015319">jobManager</a>,</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>                serverControl,</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                asyncDelayer,</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a8becb1115fe1c09c84534c798466e03f">diagnosticsIOManager</a>,</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5768c37124d54e80c66dc63d28d0dea4">eventConsumer</a>,</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a72637a3ebe8925b7c3753416370ad83c">remoteDeploymentManagerFactory</a>,</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>                gameIOManager,</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                logger,</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                initialLaunchParameters,</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>                instance,</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a410f168d84f80c138450fb42f222ba01">autoStart</a>)</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        {</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            <span class="keywordflow">try</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            {</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#aadaea6d8f22e45c5c9dd9299657a2d5f">LinkFactory</a> = linkFactory ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(linkFactory));</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">deploymentCleanupTasks</a> = <span class="keyword">new</span> List&lt;Task&gt;();</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>            }</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            <span class="keywordflow">catch</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>            {</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                <span class="comment">// Async dispose is for if we have controllers running, not the case here</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                var disposeTask = <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a6f69db8c3ceae298404f5d8d5a7312b3">DisposeAsync</a>();</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>                Debug.Assert(disposeTask.IsCompleted, <span class="stringliteral">&quot;This should always be true during construction!&quot;</span>);</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                disposeTask.GetAwaiter().GetResult();</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>                <span class="keywordflow">throw</span>;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>            }</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>        }</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad685dab25c922c43bff30f2822811c2b">  123</a></span>        <span class="keyword">protected</span> sealed <span class="keyword">override</span> async ValueTask <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad685dab25c922c43bff30f2822811c2b">DisposeAndNullControllersImpl</a>()</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        {</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>            await base.DisposeAndNullControllersImpl();</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>            <span class="comment">// If we reach this point, we can guarantee PrepServerForLaunch will be called before starting again.</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>            <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a> = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>            await (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>?.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a6f69db8c3ceae298404f5d8d5a7312b3">DisposeAsync</a>() ?? ValueTask.CompletedTask);</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a> = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>            await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a59895d5671d2f658a9ac0f9dbda73dca">DrainDeploymentCleanupTasks</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        }</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a9a94dccebeb6abb16f75b2ad03a5eb28">  136</a></span>        <span class="keyword">protected</span> sealed <span class="keyword">override</span> async ValueTask&lt;MonitorAction&gt; <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a9a94dccebeb6abb16f75b2ad03a5eb28">HandleNormalReboot</a>(CancellationToken cancellationToken)</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>        {</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a> != <span class="keyword">null</span>)</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            {</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>                ValueTask RunPrequel() =&gt; <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a9efa04dfe5428a8ce1271600e2388a4e">BeforeApplyDmb</a>(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#a53eeda8cf6068e5865575b8df220e44a">CompileJob</a>, cancellationToken);</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>                var needToSwap = !<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#aa556acd2f54e38ce22f5e623a12222c7">Swapped</a>;</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>                <span class="keywordflow">if</span> (needToSwap)</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>                {</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>                    <span class="comment">// IMPORTANT: THE SESSIONCONTROLLER SHOULD STILL BE PROCESSING THE BRIDGE REQUEST SO WE KNOW DD IS SLEEPING</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                    <span class="comment">// OTHERWISE, IT COULD RETURN TO /world/Reboot() TOO EARLY AND LOAD THE WRONG .DMB</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>                    <span class="keywordflow">if</span> (!<a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_server.html">Server</a>.ProcessingRebootBridgeRequest)</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                    {</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                        <span class="comment">// integration test logging will catch this</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                        <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogError(</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                            <span class="stringliteral">&quot;The reboot bridge request completed before the watchdog could suspend the server! This can lead to buggy DreamDaemon behaviour and should be reported! To ensure stability, we will need to hard reboot the server&quot;</span>);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>                        await RunPrequel();</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                        <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html#a97c1a4a168451bd7e3be23c467aa2812">MonitorAction</a>.Restart;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>                    }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                    <span class="comment">// DCT: Not necessary</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>                    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#a62c2020413dd770a7b3b0482e91ffbf3">FinishActivationPreparation</a>(CancellationToken.None).IsCompleted)</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>                    {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>                        <span class="comment">// rare pokemon</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>                        <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogInformation(<span class="stringliteral">&quot;Deployed .dme is not ready to swap, delaying until next reboot!&quot;</span>);</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>                        <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#aec24ff5e3b22b40e62f4a2443eb8cec9">Chat</a>.<a class="code hl_function" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#a103e061814fc6760410734c7a83f9a83">QueueWatchdogMessage</a>(<span class="stringliteral">&quot;The pending deployment was not ready to be activated this reboot. It will be applied at the next one.&quot;</span>);</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>                        <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html#a97c1a4a168451bd7e3be23c467aa2812">MonitorAction</a>.Continue;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>                    }</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>                }</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                var updateTask = RunPrequel();</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                <span class="keywordflow">if</span> (needToSwap)</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                    await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad7b9818a9a73bbf86d9353c30e23197f">PerformDmbSwap</a>(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>, cancellationToken);</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                var currentCompileJobId = <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_server.html">Server</a>.ReattachInformation.Dmb.CompileJob.Id;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>                await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a59895d5671d2f658a9ac0f9dbda73dca">DrainDeploymentCleanupTasks</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                <a class="code hl_class" href="class_i_async_disposable.html">IAsyncDisposable</a> lingeringDeployment;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>                var localDeploymentCleanupGate = <span class="keyword">new</span> TaskCompletionSource();</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>                async Task CleanupLingeringDeployment()</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>                    var lingeringDeploymentExpirySeconds = <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a9affc2eeae2903d1bdb0fa81a6550fc4">ActiveLaunchParameters</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_dream_daemon_launch_parameters.html#aa3ac63088b89bf67dd5fdbe67970b03d">StartupTimeout</a>.Value;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                    <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogDebug(</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>                        <span class="stringliteral">&quot;Holding old deployment {compileJobId} for up to {expiry} seconds...&quot;</span>,</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>                        currentCompileJobId,</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>                        lingeringDeploymentExpirySeconds);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>                    var timeout = <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_async_delayer.html">AsyncDelayer</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_async_delayer.html#a866d0f61c2a2311e5fbe5d8de329df33">Delay</a>(TimeSpan.FromSeconds(lingeringDeploymentExpirySeconds), cancellationToken);</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>                    var completedTask = await Task.WhenAny(</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>                        localDeploymentCleanupGate.Task,</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                        timeout);</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                    var timedOut = completedTask == timeout;</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                    <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.Log(</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                        timedOut</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>                            ? LogLevel.Warning</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>                            : LogLevel.Trace,</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>                        <span class="stringliteral">&quot;Releasing old deployment {compileJobId}{afterTimeout}&quot;</span>,</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>                        currentCompileJobId,</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>                        timedOut</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>                            ? <span class="stringliteral">&quot; due to timeout!&quot;</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>                            : <span class="stringliteral">&quot;...&quot;</span>);</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>                    await lingeringDeployment.DisposeAsync();</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>                }</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                var oldDeploymentCleanupGate = Interlocked.Exchange(ref <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0df40065bfa38cf64ef01a8147f1a684">deploymentCleanupGate</a>, localDeploymentCleanupGate);</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>                oldDeploymentCleanupGate?.TrySetResult();</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogTrace(<span class="stringliteral">&quot;Replacing activeSwappable with pendingSwappable...&quot;</span>);</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>                lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">deploymentCleanupTasks</a>)</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>                {</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>                    lingeringDeployment = <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_server.html">Server</a>.ReplaceDmbProvider(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>);</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">deploymentCleanupTasks</a>.Add(</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>                        CleanupLingeringDeployment());</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>                }</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a> = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a> = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>                await <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_session_persistor.html">SessionPersistor</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_session_persistor.html#acf4ff5319507dc5a79726921ab341187">Save</a>(<a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_server.html">Server</a>.ReattachInformation, cancellationToken);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                await updateTask;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            }</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogTrace(<span class="stringliteral">&quot;Nothing to do as pendingSwappable is null.&quot;</span>);</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>            <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html#a97c1a4a168451bd7e3be23c467aa2812">MonitorAction</a>.Continue;</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        }</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#abc18654a9da3b33e0c5201fe3c376374">  229</a></span>        <span class="keyword">protected</span> sealed <span class="keyword">override</span> async ValueTask <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#abc18654a9da3b33e0c5201fe3c376374">HandleNewDmbAvailable</a>(CancellationToken cancellationToken)</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        {</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html">IDmbProvider</a> compileJobProvider = <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_dmb_factory.html">DmbFactory</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_dmb_factory.html#aa5ae13811ef0862a54741653dc058783">LockNextDmb</a>(1);</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>            <span class="keywordtype">bool</span> canSeamlesslySwap = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="keywordflow">if</span> (compileJobProvider.<a class="code hl_property" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html#aa70dea09833e84fe4b5fead42a9067a6">CompileJob</a>.ByondVersion != <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5a4b8311c8cbd7cb851d1ade3bc27e05">ActiveCompileJob</a>.ByondVersion)</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            {</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                <span class="comment">// have to do a graceful restart</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogDebug(</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>                    <span class="stringliteral">&quot;Not swapping to new compile job {0} as it uses a different BYOND version ({1}) than what is currently active {2}. Queueing graceful restart instead...&quot;</span>,</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>                    compileJobProvider.<a class="code hl_property" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html#aa70dea09833e84fe4b5fead42a9067a6">CompileJob</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570">Id</a>,</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>                    compileJobProvider.<a class="code hl_property" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html#aa70dea09833e84fe4b5fead42a9067a6">CompileJob</a>.ByondVersion,</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>                    <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5a4b8311c8cbd7cb851d1ade3bc27e05">ActiveCompileJob</a>.ByondVersion);</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                canSeamlesslySwap = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>            }</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>            <span class="keywordflow">if</span> (compileJobProvider.<a class="code hl_property" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html#aa70dea09833e84fe4b5fead42a9067a6">CompileJob</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job.html#a62c90f6d2a9a109318bb3fba05afead0">DmeName</a> != <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5a4b8311c8cbd7cb851d1ade3bc27e05">ActiveCompileJob</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job.html#a62c90f6d2a9a109318bb3fba05afead0">DmeName</a>)</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>            {</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogDebug(</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>                    <span class="stringliteral">&quot;Not swapping to new compile job {0} as it uses a different .dmb name ({1}) than what is currently active {2}. Queueing graceful restart instead...&quot;</span>,</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>                    compileJobProvider.<a class="code hl_property" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html#aa70dea09833e84fe4b5fead42a9067a6">CompileJob</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570">Id</a>,</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>                    compileJobProvider.<a class="code hl_property" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html#aa70dea09833e84fe4b5fead42a9067a6">CompileJob</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job.html#a62c90f6d2a9a109318bb3fba05afead0">DmeName</a>,</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>                    <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5a4b8311c8cbd7cb851d1ade3bc27e05">ActiveCompileJob</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job.html#a62c90f6d2a9a109318bb3fba05afead0">DmeName</a>);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>                canSeamlesslySwap = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>            }</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span> </div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>            <span class="keywordflow">if</span> (!canSeamlesslySwap)</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            {</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>                await compileJobProvider.DisposeAsync();</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>                await base.HandleNewDmbAvailable(cancellationToken);</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            }</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html">SwappableDmbProvider</a> swappableProvider = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>            <span class="keywordflow">try</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>            {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>                swappableProvider = <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#afdc40d34050aab6b62e2f3b16482f27a">CreateSwappableDmbProvider</a>(compileJobProvider);</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                <span class="keywordflow">if</span> (<a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5a4b8311c8cbd7cb851d1ade3bc27e05">ActiveCompileJob</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job.html#ab960ca771b3f1b5b1caabddb6286934b">DMApiVersion</a> == <span class="keyword">null</span>)</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>                {</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                    <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogWarning(<span class="stringliteral">&quot;Active compile job has no DMAPI! Commencing immediate .dmb swap. Note this behavior is known to be buggy in some DM code contexts. See https://github.com/tgstation/tgstation-server/issues/1550&quot;</span>);</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                    await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad7b9818a9a73bbf86d9353c30e23197f">PerformDmbSwap</a>(swappableProvider, cancellationToken);</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                }</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>            }</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>            <span class="keywordflow">catch</span> (Exception ex)</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>            {</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogError(ex, <span class="stringliteral">&quot;Exception while swapping&quot;</span>);</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html">IDmbProvider</a> providerToDispose = swappableProvider ?? compileJobProvider;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>                await providerToDispose.DisposeAsync();</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>                <span class="keywordflow">throw</span>;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            }</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            await (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a>?.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a6f69db8c3ceae298404f5d8d5a7312b3">DisposeAsync</a>() ?? ValueTask.CompletedTask);</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a> = swappableProvider;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        }</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a1bc14906a6fb391ce835039400575073">  285</a></span>        <span class="keyword">protected</span> sealed <span class="keyword">override</span> async ValueTask&lt;IDmbProvider&gt; <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a1bc14906a6fb391ce835039400575073">PrepServerForLaunch</a>(<a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html">IDmbProvider</a> dmbToUse, CancellationToken cancellationToken)</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>        {</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a> != <span class="keyword">null</span>)</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="stringliteral">&quot;Expected activeSwappable to be null!&quot;</span>);</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">pendingSwappable</a> != <span class="keyword">null</span>)</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="stringliteral">&quot;Expected pendingSwappable to be null!&quot;</span>);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>            <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogTrace(<span class="stringliteral">&quot;Prep for server launch&quot;</span>);</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>            <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a> = <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#afdc40d34050aab6b62e2f3b16482f27a">CreateSwappableDmbProvider</a>(dmbToUse);</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>            <span class="keywordflow">try</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>            {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>                await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a1845f3dca4597a726053daa649565c5f">InitialLink</a>(cancellationToken);</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>            }</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            <span class="keywordflow">catch</span> (Exception ex)</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>            {</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>                <span class="comment">// We won&#39;t worry about disposing activeSwappable here as we can&#39;t dispose dmbToUse here.</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogTrace(ex, <span class="stringliteral">&quot;Initial link error, nulling ActiveSwappable&quot;</span>);</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a> = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>                <span class="keywordflow">throw</span>;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            }</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            <span class="keywordflow">return</span> <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a>;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>        }</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad1845db5b55426291619a02d2d56b4fd">  315</a></span>        <span class="keyword">protected</span> <span class="keyword">abstract</span> ValueTask <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad1845db5b55426291619a02d2d56b4fd">ApplyInitialDmb</a>(CancellationToken cancellationToken);</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#afdc40d34050aab6b62e2f3b16482f27a">  322</a></span>        <span class="keyword">protected</span> <span class="keyword">abstract</span> <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html">SwappableDmbProvider</a> <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#afdc40d34050aab6b62e2f3b16482f27a">CreateSwappableDmbProvider</a>(<a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html">IDmbProvider</a> dmbProvider);</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a60d804c11d6598add968037617a3e06f">  325</a></span>        <span class="keyword">protected</span> <span class="keyword">override</span> async ValueTask <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a60d804c11d6598add968037617a3e06f">SessionStartupPersist</a>(CancellationToken cancellationToken)</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        {</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>            await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad1845db5b55426291619a02d2d56b4fd">ApplyInitialDmb</a>(cancellationToken);</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>            await base.SessionStartupPersist(cancellationToken);</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        }</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#af92913ca3e4ef60daa783fc3bc1a0807">  332</a></span>        <span class="keyword">protected</span> <span class="keyword">override</span> async ValueTask&lt;MonitorAction&gt; <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#af92913ca3e4ef60daa783fc3bc1a0807">HandleMonitorWakeup</a>(<a class="code hl_enumeration" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html#acb2ccc2dc05d01ec3a6448d3d57155c9">MonitorActivationReason</a> reason, CancellationToken cancellationToken)</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>        {</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            var result = await base.HandleMonitorWakeup(reason, cancellationToken);</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>            <span class="keywordflow">if</span> (reason == <a class="code hl_enumeration" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html#acb2ccc2dc05d01ec3a6448d3d57155c9">MonitorActivationReason</a>.ActiveServerStartup)</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a59895d5671d2f658a9ac0f9dbda73dca">DrainDeploymentCleanupTasks</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>            <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a1845f3dca4597a726053daa649565c5f">  346</a></span>        async ValueTask <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a1845f3dca4597a726053daa649565c5f">InitialLink</a>(CancellationToken cancellationToken)</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        {</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>            await <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#a62c2020413dd770a7b3b0482e91ffbf3">FinishActivationPreparation</a>(cancellationToken);</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogTrace(<span class="stringliteral">&quot;Linking compile job...&quot;</span>);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            await <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">ActiveSwappable</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#ad6e832b7e37fcfb95f47294a9a084c2e">MakeActive</a>(cancellationToken);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        }</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad7b9818a9a73bbf86d9353c30e23197f">  359</a></span>        async ValueTask <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad7b9818a9a73bbf86d9353c30e23197f">PerformDmbSwap</a>(<a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html">SwappableDmbProvider</a> newProvider, CancellationToken cancellationToken)</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        {</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>            <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogDebug(<span class="stringliteral">&quot;Swapping to compile job {id}...&quot;</span>, newProvider.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#a53eeda8cf6068e5865575b8df220e44a">CompileJob</a>.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570">Id</a>);</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>            await newProvider.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#a62c2020413dd770a7b3b0482e91ffbf3">FinishActivationPreparation</a>(cancellationToken);</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>            var suspended = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>            var server = <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_basic_watchdog.html#a8055d121e620784216311342fa30f715">Server</a>;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>            <span class="keywordflow">try</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>            {</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>                server.<a class="code hl_function" href="interface_tgstation_1_1_server_1_1_host_1_1_system_1_1_i_process_base.html#a50cf121e04a59decc0262d2eaef0845f">Suspend</a>();</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                suspended = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>            }</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>            <span class="keywordflow">catch</span> (Exception ex)</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>            {</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>                <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogWarning(ex, <span class="stringliteral">&quot;Exception while suspending server!&quot;</span>);</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>            }</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>            <span class="keywordflow">try</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>            {</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>                await newProvider.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#ad6e832b7e37fcfb95f47294a9a084c2e">MakeActive</a>(cancellationToken);</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>            }</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>            <span class="keywordflow">finally</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>            {</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>                <span class="comment">// Let this throw hard if it fails</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                <span class="keywordflow">if</span> (suspended)</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>                    server.Resume();</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>            }</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        }</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span> </div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno"><a class="line" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a59895d5671d2f658a9ac0f9dbda73dca">  394</a></span>        Task <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a59895d5671d2f658a9ac0f9dbda73dca">DrainDeploymentCleanupTasks</a>(<span class="keywordtype">bool</span> blocking)</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>        {</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>            <a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Logger</a>.LogTrace(<span class="stringliteral">&quot;DrainDeploymentCleanupTasks...&quot;</span>);</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>            var localDeploymentCleanupGate = Interlocked.Exchange(ref <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0df40065bfa38cf64ef01a8147f1a684">deploymentCleanupGate</a>, <span class="keyword">null</span>);</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>            localDeploymentCleanupGate?.TrySetResult();</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>            List&lt;Task&gt; localDeploymentCleanupTasks;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">deploymentCleanupTasks</a>)</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>            {</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>                var totalActiveTasks = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">deploymentCleanupTasks</a>.Count;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>                localDeploymentCleanupTasks = <span class="keyword">new</span> List&lt;Task&gt;(totalActiveTasks);</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>                <span class="keywordflow">for</span> (var i = totalActiveTasks - 1; i &gt;= 0; --i)</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>                {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>                    var currentTask = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">deploymentCleanupTasks</a>[i];</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                    <span class="keywordflow">if</span> (!blocking &amp;&amp; !currentTask.IsCompleted)</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span> </div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>                    localDeploymentCleanupTasks.Add(currentTask);</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">deploymentCleanupTasks</a>.RemoveAt(i);</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>                }</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>            }</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>            <span class="keywordflow">return</span> Task.WhenAll(localDeploymentCleanupTasks);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        }</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    }</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>}</div>
<div class="ttc" id="aclass_i_async_disposable_html"><div class="ttname"><a href="class_i_async_disposable.html">IAsyncDisposable</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id_html_ae31e478e1d338b37a14565df6fd58570"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570">Tgstation.Server.Api.Models.EntityId.Id</a></div><div class="ttdeci">virtual ? long Id</div><div class="ttdoc">The ID of the entity.</div><div class="ttdef"><b>Definition:</b> <a href="_entity_id_8cs_source.html#l00013">EntityId.cs:13</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job_html_a62c90f6d2a9a109318bb3fba05afead0"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job.html#a62c90f6d2a9a109318bb3fba05afead0">Tgstation.Server.Api.Models.Internal.CompileJob.DmeName</a></div><div class="ttdeci">string? DmeName</div><div class="ttdoc">The .dme file used for compilation.</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_api_2_models_2_internal_2_compile_job_8cs_source.html#l00016">CompileJob.cs:16</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job_html_ab960ca771b3f1b5b1caabddb6286934b"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_compile_job.html#ab960ca771b3f1b5b1caabddb6286934b">Tgstation.Server.Api.Models.Internal.CompileJob.DMApiVersion</a></div><div class="ttdeci">virtual ? Version DMApiVersion</div><div class="ttdoc">The DMAPI Version.</div><div class="ttdef"><b>Definition:</b> <a href="_tgstation_8_server_8_api_2_models_2_internal_2_compile_job_8cs_source.html#l00041">CompileJob.cs:41</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_dream_daemon_launch_parameters_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_dream_daemon_launch_parameters.html">Tgstation.Server.Api.Models.Internal.DreamDaemonLaunchParameters</a></div><div class="ttdoc">Launch settings for DreamDaemon.</div><div class="ttdef"><b>Definition:</b> <a href="_dream_daemon_launch_parameters_8cs_source.html#l00009">DreamDaemonLaunchParameters.cs:10</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_dream_daemon_launch_parameters_html_aa3ac63088b89bf67dd5fdbe67970b03d"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_dream_daemon_launch_parameters.html#aa3ac63088b89bf67dd5fdbe67970b03d">Tgstation.Server.Api.Models.Internal.DreamDaemonLaunchParameters.StartupTimeout</a></div><div class="ttdeci">uint? StartupTimeout</div><div class="ttdoc">The DreamDaemon startup timeout in seconds.</div><div class="ttdef"><b>Definition:</b> <a href="_dream_daemon_launch_parameters_8cs_source.html#l00055">DreamDaemonLaunchParameters.cs:55</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_dmb_factory_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_dmb_factory.html">Tgstation.Server.Host.Components.Deployment.DmbFactory</a></div><div class="ttdoc">Standard IDmbFactory.</div><div class="ttdef"><b>Definition:</b> <a href="_dmb_factory_8cs_source.html#l00023">DmbFactory.cs:24</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_dmb_factory_html_aa5ae13811ef0862a54741653dc058783"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_dmb_factory.html#aa5ae13811ef0862a54741653dc058783">Tgstation.Server.Host.Components.Deployment.DmbFactory.LockNextDmb</a></div><div class="ttdeci">IDmbProvider LockNextDmb(int lockCount)</div><div class="ttdoc">Gets the next IDmbProvider. A new IDmbProvider.</div><div class="ttdef"><b>Definition:</b> <a href="_dmb_factory_8cs_source.html#l00167">DmbFactory.cs:167</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html">Tgstation.Server.Host.Components.Deployment.SwappableDmbProvider</a></div><div class="ttdoc">A IDmbProvider that uses filesystem links to change directory structure underneath the server process...</div><div class="ttdef"><b>Definition:</b> <a href="_swappable_dmb_provider_8cs_source.html#l00013">SwappableDmbProvider.cs:14</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider_html_a53eeda8cf6068e5865575b8df220e44a"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#a53eeda8cf6068e5865575b8df220e44a">Tgstation.Server.Host.Components.Deployment.SwappableDmbProvider.CompileJob</a></div><div class="ttdeci">CompileJob CompileJob</div><div class="ttdoc">The CompileJob of the .dmb.</div><div class="ttdef"><b>Definition:</b> <a href="_swappable_dmb_provider_8cs_source.html#l00027">SwappableDmbProvider.cs:27</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider_html_a62c2020413dd770a7b3b0482e91ffbf3"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#a62c2020413dd770a7b3b0482e91ffbf3">Tgstation.Server.Host.Components.Deployment.SwappableDmbProvider.FinishActivationPreparation</a></div><div class="ttdeci">abstract Task FinishActivationPreparation(CancellationToken cancellationToken)</div><div class="ttdoc">Should be await. before calling MakeActive(CancellationToken) to ensure the SwappableDmbProvider is r...</div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider_html_aa556acd2f54e38ce22f5e623a12222c7"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#aa556acd2f54e38ce22f5e623a12222c7">Tgstation.Server.Host.Components.Deployment.SwappableDmbProvider.Swapped</a></div><div class="ttdeci">bool Swapped</div><div class="ttdoc">If MakeActive(CancellationToken) has been run.</div><div class="ttdef"><b>Definition:</b> <a href="_swappable_dmb_provider_8cs_source.html#l00032">SwappableDmbProvider.cs:32</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider_html_ad6e832b7e37fcfb95f47294a9a084c2e"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_swappable_dmb_provider.html#ad6e832b7e37fcfb95f47294a9a084c2e">Tgstation.Server.Host.Components.Deployment.SwappableDmbProvider.MakeActive</a></div><div class="ttdeci">ValueTask MakeActive(CancellationToken cancellationToken)</div><div class="ttdoc">Make the SwappableDmbProvider active by replacing the live link with our CompileJob.</div><div class="ttdef"><b>Definition:</b> <a href="_swappable_dmb_provider_8cs_source.html#l00078">SwappableDmbProvider.cs:78</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_session_persistor_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_session_persistor.html">Tgstation.Server.Host.Components.Session.SessionPersistor</a></div><div class="ttdef"><b>Definition:</b> <a href="_session_persistor_8cs_source.html#l00018">SessionPersistor.cs:19</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_session_persistor_html_acf4ff5319507dc5a79726921ab341187"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_session_persistor.html#acf4ff5319507dc5a79726921ab341187">Tgstation.Server.Host.Components.Session.SessionPersistor.Save</a></div><div class="ttdeci">ValueTask Save(ReattachInformation reattachInformation, CancellationToken cancellationToken)</div><div class="ttdoc">Save some reattachInformation . A ValueTask representing the running operation.</div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog</a></div><div class="ttdoc">A IWatchdog that, instead of killing servers for updates, uses the wonders of filesystem links to swa...</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00025">AdvancedWatchdog.cs:26</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_a0484c9175cd700015e03340d48b20982"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0484c9175cd700015e03340d48b20982">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.deploymentCleanupTasks</a></div><div class="ttdeci">readonly List&lt; Task &gt; deploymentCleanupTasks</div><div class="ttdoc">List&lt;T&gt; of Tasks that are waiting to clean up old deployments.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00040">AdvancedWatchdog.cs:40</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_a0df40065bfa38cf64ef01a8147f1a684"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a0df40065bfa38cf64ef01a8147f1a684">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.deploymentCleanupGate</a></div><div class="ttdeci">volatile TaskCompletionSource deploymentCleanupGate</div><div class="ttdoc">The TaskCompletionSource representing the cleanup of an unused IDmbProvider.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00050">AdvancedWatchdog.cs:50</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_a1845f3dca4597a726053daa649565c5f"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a1845f3dca4597a726053daa649565c5f">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.InitialLink</a></div><div class="ttdeci">async ValueTask InitialLink(CancellationToken cancellationToken)</div><div class="ttdoc">Create the initial link to the live game directory using ActiveSwappable.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00346">AdvancedWatchdog.cs:346</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_a1bc14906a6fb391ce835039400575073"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a1bc14906a6fb391ce835039400575073">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.PrepServerForLaunch</a></div><div class="ttdeci">sealed override async ValueTask&lt; IDmbProvider &gt; PrepServerForLaunch(IDmbProvider dmbToUse, CancellationToken cancellationToken)</div><div class="ttdoc">Prepare the server to launch a new instance with the WatchdogBase.ActiveLaunchParameters and a given ...</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00285">AdvancedWatchdog.cs:285</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_a59895d5671d2f658a9ac0f9dbda73dca"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a59895d5671d2f658a9ac0f9dbda73dca">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.DrainDeploymentCleanupTasks</a></div><div class="ttdeci">Task DrainDeploymentCleanupTasks(bool blocking)</div><div class="ttdoc">Asynchronously drain deploymentCleanupTasks.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00394">AdvancedWatchdog.cs:394</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_a60d804c11d6598add968037617a3e06f"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a60d804c11d6598add968037617a3e06f">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.SessionStartupPersist</a></div><div class="ttdeci">override async ValueTask SessionStartupPersist(CancellationToken cancellationToken)</div><div class="ttdoc">Called to save the current Server into the WatchdogBase.SessionPersistor when initially launched....</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00325">AdvancedWatchdog.cs:325</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_a94750133564deaa9c13552acf89b9029"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a94750133564deaa9c13552acf89b9029">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.pendingSwappable</a></div><div class="ttdeci">SwappableDmbProvider pendingSwappable</div><div class="ttdoc">The active SwappableDmbProvider for WatchdogBase.ActiveLaunchParameters.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00045">AdvancedWatchdog.cs:45</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_a9a94dccebeb6abb16f75b2ad03a5eb28"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#a9a94dccebeb6abb16f75b2ad03a5eb28">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.HandleNormalReboot</a></div><div class="ttdeci">sealed override async ValueTask&lt; MonitorAction &gt; HandleNormalReboot(CancellationToken cancellationToken)</div><div class="ttdoc">Handler for MonitorActivationReason.ActiveServerRebooted when the RebootState is RebootState....</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00136">AdvancedWatchdog.cs:136</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_aadaea6d8f22e45c5c9dd9299657a2d5f"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#aadaea6d8f22e45c5c9dd9299657a2d5f">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.LinkFactory</a></div><div class="ttdeci">IFilesystemLinkFactory LinkFactory</div><div class="ttdoc">The IFilesystemLinkFactory for the AdvancedWatchdog.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00035">AdvancedWatchdog.cs:35</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_abc18654a9da3b33e0c5201fe3c376374"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#abc18654a9da3b33e0c5201fe3c376374">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.HandleNewDmbAvailable</a></div><div class="ttdeci">sealed override async ValueTask HandleNewDmbAvailable(CancellationToken cancellationToken)</div><div class="ttdoc">Handler for MonitorActivationReason.NewDmbAvailable. A ValueTask representing the running operation.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00229">AdvancedWatchdog.cs:229</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_acb48f966670f07a01c89a708fc82411a"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#acb48f966670f07a01c89a708fc82411a">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.AdvancedWatchdog</a></div><div class="ttdeci">AdvancedWatchdog(IChatManager chat, ISessionControllerFactory sessionControllerFactory, IDmbFactory dmbFactory, ISessionPersistor sessionPersistor, IJobManager jobManager, IServerControl serverControl, IAsyncDelayer asyncDelayer, IIOManager diagnosticsIOManager, IEventConsumer eventConsumer, IRemoteDeploymentManagerFactory remoteDeploymentManagerFactory, IIOManager gameIOManager, IFilesystemLinkFactory linkFactory, ILogger&lt; AdvancedWatchdog &gt; logger, DreamDaemonLaunchParameters initialLaunchParameters, Api.Models.Instance instance, bool autoStart)</div><div class="ttdoc">Initializes a new instance of the AdvancedWatchdog class.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00071">AdvancedWatchdog.cs:71</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_ad1845db5b55426291619a02d2d56b4fd"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad1845db5b55426291619a02d2d56b4fd">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.ApplyInitialDmb</a></div><div class="ttdeci">abstract ValueTask ApplyInitialDmb(CancellationToken cancellationToken)</div><div class="ttdoc">Set the ReattachInformation.InitialDmb for the BasicWatchdog.Server.</div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_ad685dab25c922c43bff30f2822811c2b"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad685dab25c922c43bff30f2822811c2b">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.DisposeAndNullControllersImpl</a></div><div class="ttdeci">sealed override async ValueTask DisposeAndNullControllersImpl()</div><div class="ttdoc">Call IDisposable.Dispose and null the fields for all ISessionControllers. A ValueTask representing th...</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00123">AdvancedWatchdog.cs:123</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_ad7b9818a9a73bbf86d9353c30e23197f"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#ad7b9818a9a73bbf86d9353c30e23197f">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.PerformDmbSwap</a></div><div class="ttdeci">async ValueTask PerformDmbSwap(SwappableDmbProvider newProvider, CancellationToken cancellationToken)</div><div class="ttdoc">Suspends the BasicWatchdog.Server and calls SwappableDmbProvider.MakeActive(CancellationToken) on a n...</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00359">AdvancedWatchdog.cs:359</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_adeb92f8d6df8d19f06b238b206de16c0"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#adeb92f8d6df8d19f06b238b206de16c0">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.ActiveSwappable</a></div><div class="ttdeci">SwappableDmbProvider ActiveSwappable</div><div class="ttdoc">The SwappableDmbProvider for WatchdogBase.LastLaunchParameters.</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00030">AdvancedWatchdog.cs:30</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_af92913ca3e4ef60daa783fc3bc1a0807"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#af92913ca3e4ef60daa783fc3bc1a0807">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.HandleMonitorWakeup</a></div><div class="ttdeci">override async ValueTask&lt; MonitorAction &gt; HandleMonitorWakeup(MonitorActivationReason reason, CancellationToken cancellationToken)</div><div class="ttdoc">Handles the actions to take when the monitor has to &quot;wake up&quot;. A ValueTask&lt;TResult&gt; resulting in the ...</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00332">AdvancedWatchdog.cs:332</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog_html_afdc40d34050aab6b62e2f3b16482f27a"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_advanced_watchdog.html#afdc40d34050aab6b62e2f3b16482f27a">Tgstation.Server.Host.Components.Watchdog.AdvancedWatchdog.CreateSwappableDmbProvider</a></div><div class="ttdeci">abstract SwappableDmbProvider CreateSwappableDmbProvider(IDmbProvider dmbProvider)</div><div class="ttdoc">Create a SwappableDmbProvider for a given dmbProvider .</div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_basic_watchdog_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_basic_watchdog.html">Tgstation.Server.Host.Components.Watchdog.BasicWatchdog</a></div><div class="ttdoc">A IWatchdog that manages one server.</div><div class="ttdef"><b>Definition:</b> <a href="_basic_watchdog_8cs_source.html#l00025">BasicWatchdog.cs:26</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_basic_watchdog_html_a8055d121e620784216311342fa30f715"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_basic_watchdog.html#a8055d121e620784216311342fa30f715">Tgstation.Server.Host.Components.Watchdog.BasicWatchdog.Server</a></div><div class="ttdeci">ISessionController Server</div><div class="ttdoc">The single ISessionController.</div><div class="ttdef"><b>Definition:</b> <a href="_basic_watchdog_8cs_source.html#l00036">BasicWatchdog.cs:36</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a1688863ddcd7d0bbfa3ec13b7b015319"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a1688863ddcd7d0bbfa3ec13b7b015319">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.jobManager</a></div><div class="ttdeci">readonly IJobManager jobManager</div><div class="ttdoc">The IJobManager for the WatchdogBase.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00127">WatchdogBase.cs:127</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a2143ec7079d0ffd42c76f61cf7b71cf6"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a2143ec7079d0ffd42c76f61cf7b71cf6">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.Logger</a></div><div class="ttdeci">ILogger&lt; WatchdogBase &gt; Logger</div><div class="ttdoc">The ILogger for the WatchdogBase.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00077">WatchdogBase.cs:77</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a410f168d84f80c138450fb42f222ba01"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a410f168d84f80c138450fb42f222ba01">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.autoStart</a></div><div class="ttdeci">readonly bool autoStart</div><div class="ttdoc">If the WatchdogBase should LaunchNoLock(bool, bool, bool, ReattachInformation, CancellationToken) in ...</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00147">WatchdogBase.cs:147</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a5768c37124d54e80c66dc63d28d0dea4"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5768c37124d54e80c66dc63d28d0dea4">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.eventConsumer</a></div><div class="ttdeci">readonly IEventConsumer eventConsumer</div><div class="ttdoc">The IEventConsumer that is not the WatchdogBase.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00122">WatchdogBase.cs:122</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a5a4b8311c8cbd7cb851d1ade3bc27e05"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a5a4b8311c8cbd7cb851d1ade3bc27e05">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.ActiveCompileJob</a></div><div class="ttdeci">Models.CompileJob ActiveCompileJob</div><div class="ttdoc">Retrieves the Models.CompileJob currently running on the server.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00059">WatchdogBase.cs:59</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a6f69db8c3ceae298404f5d8d5a7312b3"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a6f69db8c3ceae298404f5d8d5a7312b3">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.DisposeAsync</a></div><div class="ttdeci">async ValueTask DisposeAsync()</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00254">WatchdogBase.cs:254</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a72637a3ebe8925b7c3753416370ad83c"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a72637a3ebe8925b7c3753416370ad83c">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.remoteDeploymentManagerFactory</a></div><div class="ttdeci">readonly IRemoteDeploymentManagerFactory remoteDeploymentManagerFactory</div><div class="ttdoc">The IRemoteDeploymentManagerFactory for the WatchdogBase.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00142">WatchdogBase.cs:142</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a8becb1115fe1c09c84534c798466e03f"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a8becb1115fe1c09c84534c798466e03f">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.diagnosticsIOManager</a></div><div class="ttdeci">readonly IIOManager diagnosticsIOManager</div><div class="ttdoc">The IIOManager pointing to the Diagnostics directory.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00137">WatchdogBase.cs:137</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a9affc2eeae2903d1bdb0fa81a6550fc4"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a9affc2eeae2903d1bdb0fa81a6550fc4">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.ActiveLaunchParameters</a></div><div class="ttdeci">DreamDaemonLaunchParameters ActiveLaunchParameters</div><div class="ttdoc">The DreamDaemonLaunchParameters to be applied.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00053">WatchdogBase.cs:53</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_a9efa04dfe5428a8ce1271600e2388a4e"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#a9efa04dfe5428a8ce1271600e2388a4e">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.BeforeApplyDmb</a></div><div class="ttdeci">async ValueTask BeforeApplyDmb(Models.CompileJob newCompileJob, CancellationToken cancellationToken)</div><div class="ttdoc">To be called before a given newCompileJob  goes live.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00675">WatchdogBase.cs:675</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base_html_aec24ff5e3b22b40e62f4a2443eb8cec9"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_1_1_watchdog_base.html#aec24ff5e3b22b40e62f4a2443eb8cec9">Tgstation.Server.Host.Components.Watchdog.WatchdogBase.Chat</a></div><div class="ttdeci">IChatManager Chat</div><div class="ttdoc">The IChatManager for the WatchdogBase.</div><div class="ttdef"><b>Definition:</b> <a href="_watchdog_base_8cs_source.html#l00082">WatchdogBase.cs:82</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_server_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_server.html">Tgstation.Server.Host.Server</a></div><div class="ttdef"><b>Definition:</b> <a href="_server_8cs_source.html#l00020">Server.cs:21</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_utils_1_1_async_delayer_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_async_delayer.html">Tgstation.Server.Host.Utils.AsyncDelayer</a></div><div class="ttdef"><b>Definition:</b> <a href="_async_delayer_8cs_source.html#l00008">AsyncDelayer.cs:9</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_utils_1_1_async_delayer_html_a866d0f61c2a2311e5fbe5d8de329df33"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_async_delayer.html#a866d0f61c2a2311e5fbe5d8de329df33">Tgstation.Server.Host.Utils.AsyncDelayer.Delay</a></div><div class="ttdeci">Task Delay(TimeSpan timeSpan, CancellationToken cancellationToken)</div><div class="ttdoc">Create a Task that completes after a given timeSpan . A Task representing the running operation.</div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html">Tgstation.Server.Host.Components.Chat.IChatManager</a></div><div class="ttdoc">For managing connected chat services.</div><div class="ttdef"><b>Definition:</b> <a href="_i_chat_manager_8cs_source.html#l00014">IChatManager.cs:15</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager_html_a103e061814fc6760410734c7a83f9a83"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#a103e061814fc6760410734c7a83f9a83">Tgstation.Server.Host.Components.Chat.IChatManager.QueueWatchdogMessage</a></div><div class="ttdeci">void QueueWatchdogMessage(string message)</div><div class="ttdoc">Queue a chat message  to configured watchdog channels.</div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_factory_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_factory.html">Tgstation.Server.Host.Components.Deployment.IDmbFactory</a></div><div class="ttdoc">Factory for IDmbProviders.</div><div class="ttdef"><b>Definition:</b> <a href="_i_dmb_factory_8cs_source.html#l00012">IDmbFactory.cs:13</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html">Tgstation.Server.Host.Components.Deployment.IDmbProvider</a></div><div class="ttdoc">Provides absolute paths to the latest compiled .dmbs.</div><div class="ttdef"><b>Definition:</b> <a href="_i_dmb_provider_8cs_source.html#l00010">IDmbProvider.cs:11</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider_html_aa70dea09833e84fe4b5fead42a9067a6"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_i_dmb_provider.html#aa70dea09833e84fe4b5fead42a9067a6">Tgstation.Server.Host.Components.Deployment.IDmbProvider.CompileJob</a></div><div class="ttdeci">CompileJob CompileJob</div><div class="ttdoc">The CompileJob of the .dmb.</div><div class="ttdef"><b>Definition:</b> <a href="_i_dmb_provider_8cs_source.html#l00025">IDmbProvider.cs:25</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_remote_1_1_i_remote_deployment_manager_factory_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_remote_1_1_i_remote_deployment_manager_factory.html">Tgstation.Server.Host.Components.Deployment.Remote.IRemoteDeploymentManagerFactory</a></div><div class="ttdoc">Factory for creating IRemoteDeploymentManagers.</div><div class="ttdef"><b>Definition:</b> <a href="_i_remote_deployment_manager_factory_8cs_source.html#l00010">IRemoteDeploymentManagerFactory.cs:11</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_events_1_1_i_event_consumer_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_events_1_1_i_event_consumer.html">Tgstation.Server.Host.Components.Events.IEventConsumer</a></div><div class="ttdoc">Consumes EventTypes and takes the appropriate actions.</div><div class="ttdef"><b>Definition:</b> <a href="_i_event_consumer_8cs_source.html#l00010">IEventConsumer.cs:11</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_i_session_controller_factory_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_i_session_controller_factory.html">Tgstation.Server.Host.Components.Session.ISessionControllerFactory</a></div><div class="ttdoc">Factory for ISessionControllers.</div><div class="ttdef"><b>Definition:</b> <a href="_i_session_controller_factory_8cs_source.html#l00013">ISessionControllerFactory.cs:14</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_i_session_persistor_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_1_1_i_session_persistor.html">Tgstation.Server.Host.Components.Session.ISessionPersistor</a></div><div class="ttdoc">Handles saving and loading ReattachInformation.</div><div class="ttdef"><b>Definition:</b> <a href="_i_session_persistor_8cs_source.html#l00009">ISessionPersistor.cs:10</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control.html">Tgstation.Server.Host.Core.IServerControl</a></div><div class="ttdoc">Represents a service that may take an updated Host assembly and run it, stopping the current assembly...</div><div class="ttdef"><b>Definition:</b> <a href="_i_server_control_8cs_source.html#l00009">IServerControl.cs:10</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_i_o_1_1_i_filesystem_link_factory_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_i_o_1_1_i_filesystem_link_factory.html">Tgstation.Server.Host.IO.IFilesystemLinkFactory</a></div><div class="ttdoc">For creating filesystem symbolic links.</div><div class="ttdef"><b>Definition:</b> <a href="_i_filesystem_link_factory_8cs_source.html#l00009">IFilesystemLinkFactory.cs:10</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_i_o_1_1_i_i_o_manager_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_i_o_1_1_i_i_o_manager.html">Tgstation.Server.Host.IO.IIOManager</a></div><div class="ttdoc">Interface for using filesystems.</div><div class="ttdef"><b>Definition:</b> <a href="_i_i_o_manager_8cs_source.html#l00012">IIOManager.cs:13</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_jobs_1_1_i_job_manager_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_jobs_1_1_i_job_manager.html">Tgstation.Server.Host.Jobs.IJobManager</a></div><div class="ttdoc">Manages the runtime of Jobs.</div><div class="ttdef"><b>Definition:</b> <a href="_i_job_manager_8cs_source.html#l00012">IJobManager.cs:13</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_system_1_1_i_process_base_html_a50cf121e04a59decc0262d2eaef0845f"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_system_1_1_i_process_base.html#a50cf121e04a59decc0262d2eaef0845f">Tgstation.Server.Host.System.IProcessBase.Suspend</a></div><div class="ttdeci">void Suspend()</div><div class="ttdoc">Suspends the process.</div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_utils_1_1_i_async_delayer_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_utils_1_1_i_async_delayer.html">Tgstation.Server.Host.Utils.IAsyncDelayer</a></div><div class="ttdoc">For waiting asynchronously.</div><div class="ttdef"><b>Definition:</b> <a href="_i_async_delayer_8cs_source.html#l00010">IAsyncDelayer.cs:11</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal.html">Tgstation.Server.Api.Models.Internal</a></div><div class="ttdef"><b>Definition:</b> <a href="_chat_bot_api_base_8cs_source.html#l00005">ChatBotApiBase.cs:6</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat.html">Tgstation.Server.Host.Components.Chat</a></div><div class="ttdef"><b>Definition:</b> <a href="_channel_mapping_8cs_source.html#l00001">ChannelMapping.cs:2</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_remote_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_1_1_remote.html">Tgstation.Server.Host.Components.Deployment.Remote</a></div><div class="ttdef"><b>Definition:</b> <a href="_base_remote_deployment_manager_8cs_source.html#l00014">BaseRemoteDeploymentManager.cs:15</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_deployment.html">Tgstation.Server.Host.Components.Deployment</a></div><div class="ttdef"><b>Definition:</b> <a href="_dmb_factory_8cs_source.html#l00018">DmbFactory.cs:19</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_events_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_events.html">Tgstation.Server.Host.Components.Events</a></div><div class="ttdef"><b>Definition:</b> <a href="_event_consumer_8cs_source.html#l00009">EventConsumer.cs:10</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_session_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_session.html">Tgstation.Server.Host.Components.Session</a></div><div class="ttdef"><b>Definition:</b> <a href="_api_validation_status_8cs_source.html#l00001">ApiValidationStatus.cs:2</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html">Tgstation.Server.Host.Components.Watchdog</a></div><div class="ttdef"><b>Definition:</b> <a href="_advanced_watchdog_8cs_source.html#l00020">AdvancedWatchdog.cs:21</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_html_a97c1a4a168451bd7e3be23c467aa2812"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html#a97c1a4a168451bd7e3be23c467aa2812">Tgstation.Server.Host.Components.Watchdog.MonitorAction</a></div><div class="ttdeci">MonitorAction</div><div class="ttdoc">The action for the monitor loop to take when control is returned to it.</div><div class="ttdef"><b>Definition:</b> <a href="_monitor_action_8cs_source.html#l00006">MonitorAction.cs:7</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog_html_acb2ccc2dc05d01ec3a6448d3d57155c9"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_watchdog.html#acb2ccc2dc05d01ec3a6448d3d57155c9">Tgstation.Server.Host.Components.Watchdog.MonitorActivationReason</a></div><div class="ttdeci">MonitorActivationReason</div><div class="ttdoc">Reasons for the monitor to wake up.</div><div class="ttdef"><b>Definition:</b> <a href="_monitor_activation_reason_8cs_source.html#l00006">MonitorActivationReason.cs:7</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_core_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_core.html">Tgstation.Server.Host.Core</a></div><div class="ttdef"><b>Definition:</b> <a href="_application_8cs_source.html#l00065">Application.cs:66</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_i_o_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_i_o.html">Tgstation.Server.Host.IO</a></div><div class="ttdef"><b>Definition:</b> <a href="_buffered_file_stream_provider_8cs_source.html#l00008">BufferedFileStreamProvider.cs:9</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_jobs_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_jobs.html">Tgstation.Server.Host.Jobs</a></div><div class="ttdef"><b>Definition:</b> <a href="_i_job_manager_8cs_source.html#l00007">IJobManager.cs:8</a></div></div>
<div class="ttc" id="anamespace_tgstation_1_1_server_1_1_host_1_1_utils_html"><div class="ttname"><a href="namespace_tgstation_1_1_server_1_1_host_1_1_utils.html">Tgstation.Server.Host.Utils</a></div><div class="ttdef"><b>Definition:</b> <a href="_abstract_http_client_factory_8cs_source.html#l00009">AbstractHttpClientFactory.cs:10</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
