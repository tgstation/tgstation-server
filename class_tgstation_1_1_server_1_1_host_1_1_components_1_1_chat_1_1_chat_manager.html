<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tgstation-server: Tgstation.Server.Host.Components.Chat.ChatManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">tgstation-server<span id="projectnumber">&#160;6.15.0</span>
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_tgstation.html">Tgstation</a></li><li class="navelem"><a class="el" href="namespace_tgstation_1_1_server.html">Server</a></li><li class="navelem"><a class="el" href="namespace_tgstation_1_1_server_1_1_host.html">Host</a></li><li class="navelem"><a class="el" href="namespace_tgstation_1_1_server_1_1_host_1_1_components.html">Components</a></li><li class="navelem"><a class="el" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat.html">Chat</a></li><li class="navelem"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html">ChatManager</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">Tgstation.Server.Host.Components.Chat.ChatManager Class Reference<span class="mlabels"><span class="mlabel">sealed</span></span></div></div>
</div><!--header-->
<div class="contents">

<p> 
 <a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for Tgstation.Server.Host.Components.Chat.ChatManager:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager__inherit__graph.png" border="0" usemap="#a_tgstation_8_server_8_host_8_components_8_chat_8_chat_manager_inherit__map" alt="Inheritance graph"/></div>
<map name="a_tgstation_8_server_8_host_8_components_8_chat_8_chat_manager_inherit__map" id="a_tgstation_8_server_8_host_8_components_8_chat_8_chat_manager_inherit__map">
<area shape="rect" title=" " alt="" coords="103,226,329,267"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html" title="For managing connected chat services." alt="" coords="99,153,202,178"/>
<area shape="poly" title=" " alt="" coords="172,189,202,224,197,228,168,192"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_i_component_service.html" title="Represents a component meant to be started and stopped by its parent component." alt="" coords="5,79,141,105"/>
<area shape="poly" title=" " alt="" coords="99,114,139,150,136,154,96,117"/>
<area shape="rect" href="class_i_hosted_service.html" title=" " alt="" coords="17,5,129,31"/>
<area shape="poly" title=" " alt="" coords="76,46,76,79,70,79,70,46"/>
<area shape="rect" href="class_i_async_disposable.html" title=" " alt="" coords="165,79,290,105"/>
<area shape="poly" title=" " alt="" coords="205,117,165,154,161,150,202,114"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_restart_handler.html" title="Handler for server restarts." alt="" coords="226,153,339,178"/>
<area shape="poly" title=" " alt="" coords="264,192,234,228,230,224,260,189"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Tgstation.Server.Host.Components.Chat.ChatManager:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager__coll__graph.png" border="0" usemap="#a_tgstation_8_server_8_host_8_components_8_chat_8_chat_manager_coll__map" alt="Collaboration graph"/></div>
<map name="a_tgstation_8_server_8_host_8_components_8_chat_8_chat_manager_coll__map" id="a_tgstation_8_server_8_host_8_components_8_chat_8_chat_manager_coll__map">
<area shape="rect" title=" " alt="" coords="843,674,1069,715"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html" title="For managing connected chat services." alt="" coords="432,33,535,59"/>
<area shape="poly" title=" " alt="" coords="549,30,613,24,685,26,722,32,757,43,791,58,821,80,838,100,853,126,880,195,902,279,920,372,945,551,956,673,951,674,940,552,915,373,897,280,875,196,848,128,833,103,817,84,788,63,756,48,721,37,685,31,613,29,550,36"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_i_component_service.html" title="Represents a component meant to be started and stopped by its parent component." alt="" coords="166,5,301,31"/>
<area shape="poly" title=" " alt="" coords="317,25,432,38,431,43,316,30"/>
<area shape="rect" href="class_i_hosted_service.html" title=" " alt="" coords="5,5,117,31"/>
<area shape="poly" title=" " alt="" coords="132,16,166,16,166,21,132,21"/>
<area shape="rect" href="class_i_async_disposable.html" title=" " alt="" coords="171,55,296,80"/>
<area shape="poly" title=" " alt="" coords="312,58,432,48,432,53,312,64"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_restart_handler.html" title="Handler for server restarts." alt="" coords="427,83,540,108"/>
<area shape="poly" title=" " alt="" coords="555,78,617,71,688,73,724,78,759,88,791,103,821,124,837,142,851,166,877,229,899,307,918,392,943,558,956,673,950,674,938,559,912,393,894,308,872,231,847,168,832,145,817,128,789,108,757,93,723,84,688,78,618,76,555,83"/>
<area shape="rect" title=" " alt="" coords="439,132,528,158"/>
<area shape="poly" title=" " alt="" coords="543,141,616,141,698,146,771,158,800,167,821,179,835,195,849,216,874,273,895,342,914,419,941,569,955,673,950,674,935,569,908,420,890,344,869,275,844,219,831,198,817,183,798,172,770,163,697,152,616,147,543,146"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html" title="Factory for IProviders." alt="" coords="370,182,597,223"/>
<area shape="poly" title=" " alt="" coords="612,196,674,198,734,203,786,213,821,229,847,262,871,313,892,375,910,443,939,577,954,673,949,674,933,578,905,444,887,376,866,315,842,265,817,234,784,218,734,208,674,203,612,202"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_factory.html" title="Factory for built in ICommands." alt="" coords="370,247,597,288"/>
<area shape="poly" title=" " alt="" coords="612,246,665,246,720,253,773,270,821,297,862,339,894,388,918,441,935,497,946,551,953,600,958,673,952,674,948,601,941,552,930,498,913,443,889,390,858,342,817,302,771,275,719,259,665,252,612,251"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_restart_registration.html" title="Represents the lifetime of a IRestartHandler registration." alt="" coords="393,313,574,353"/>
<area shape="poly" title=" " alt="" coords="589,317,646,316,707,323,766,340,795,353,821,369,856,402,884,441,907,484,924,528,946,612,956,673,950,674,941,613,919,530,902,486,880,444,852,406,817,374,792,357,765,345,706,328,646,322,589,322"/>
<area shape="rect" href="class_i_disposable.html" title=" " alt="" coords="189,320,278,346"/>
<area shape="poly" title=" " alt="" coords="294,330,393,330,393,336,294,336"/>
<area shape="rect" title=" " alt="" coords="404,377,563,403"/>
<area shape="poly" title=" " alt="" coords="579,383,637,386,700,396,763,416,821,447,849,471,874,500,912,563,938,625,952,673,947,674,933,627,907,566,869,503,845,475,817,451,761,421,699,402,636,392,578,388"/>
<area shape="rect" title=" " alt="" coords="370,428,597,483"/>
<area shape="poly" title=" " alt="" coords="612,460,664,469,718,482,771,500,820,525,863,559,899,599,927,639,946,672,942,675,923,642,895,603,859,563,818,530,769,505,716,487,663,474,612,465"/>
<area shape="rect" title=" " alt="" coords="411,507,556,548"/>
<area shape="poly" title=" " alt="" coords="572,533,692,555,757,572,820,596,883,632,933,671,930,675,880,637,818,601,756,578,691,560,571,539"/>
<area shape="rect" title=" " alt="" coords="419,573,548,613"/>
<area shape="poly" title=" " alt="" coords="564,601,685,621,820,649,895,671,893,676,818,654,684,626,563,606"/>
<area shape="rect" title=" " alt="" coords="387,638,580,679"/>
<area shape="poly" title=" " alt="" coords="595,664,843,683,842,688,595,669"/>
<area shape="rect" title=" " alt="" coords="351,702,616,758"/>
<area shape="poly" title=" " alt="" coords="631,717,819,703,842,701,843,706,819,708,632,722"/>
<area shape="rect" title=" " alt="" coords="368,782,599,838"/>
<area shape="poly" title=" " alt="" coords="613,784,714,763,818,737,897,712,899,718,820,742,715,768,614,789"/>
<area shape="rect" title=" " alt="" coords="395,862,572,903"/>
<area shape="poly" title=" " alt="" coords="587,866,701,841,761,823,818,799,851,780,883,757,932,713,936,717,886,761,854,784,820,804,763,828,702,847,588,872"/>
<area shape="rect" title=" " alt="" coords="394,927,573,968"/>
<area shape="poly" title=" " alt="" coords="588,943,644,937,704,925,763,905,818,878,862,840,898,795,925,750,944,714,948,716,930,753,902,798,866,844,820,882,765,910,705,930,645,942,589,948"/>
<area shape="rect" title=" " alt="" coords="430,992,537,1018"/>
<area shape="poly" title=" " alt="" coords="553,1010,614,1012,683,1007,754,990,787,976,817,958,847,932,872,901,894,868,911,833,935,766,948,714,954,716,941,767,916,835,898,870,877,905,851,936,821,962,789,981,755,995,684,1012,614,1017,553,1016"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_custom_command_handler.html" title="Handles Commands.ICommands that map to those defined in a IChatTrackingContext." alt="" coords="370,1042,597,1083"/>
<area shape="poly" title=" " alt="" coords="612,1079,665,1079,718,1073,770,1058,817,1032,854,999,883,958,905,913,922,867,943,779,951,715,956,715,948,780,928,869,910,916,887,961,858,1002,821,1037,773,1063,719,1078,665,1085,612,1085"/>
<area shape="rect" title=" " alt="" coords="455,1107,512,1132"/>
<area shape="poly" title=" " alt="" coords="528,1123,601,1131,686,1136,765,1133,796,1126,818,1117,841,1097,862,1074,895,1023,920,965,936,906,946,847,952,794,953,715,958,715,957,794,952,848,941,907,925,967,900,1025,866,1078,845,1101,820,1121,798,1132,766,1138,686,1141,600,1136,527,1128"/>
<area shape="rect" title=" " alt="" coords="458,1156,509,1182"/>
<area shape="poly" title=" " alt="" coords="524,1171,597,1177,684,1180,765,1175,796,1168,817,1158,843,1126,867,1077,888,1015,906,946,934,811,949,714,955,715,939,812,911,948,893,1017,872,1079,848,1129,821,1162,798,1173,765,1180,684,1185,597,1182,524,1176"/>
<area shape="rect" title=" " alt="" coords="405,1205,562,1231"/>
<area shape="poly" title=" " alt="" coords="577,1223,646,1226,717,1225,778,1218,801,1211,817,1202,831,1187,845,1167,869,1112,891,1043,909,968,936,819,950,714,955,715,941,819,914,969,896,1045,874,1114,849,1169,836,1190,821,1206,803,1216,779,1223,717,1230,646,1232,577,1229"/>
<area shape="rect" title=" " alt="" coords="457,1255,510,1280"/>
<area shape="poly" title=" " alt="" coords="525,1269,598,1273,685,1274,765,1267,796,1260,817,1248,832,1232,847,1210,872,1149,894,1073,912,990,938,827,950,714,956,715,943,828,918,991,899,1075,877,1151,851,1212,837,1235,821,1253,798,1265,766,1273,685,1279,598,1278,525,1274"/>
<area shape="rect" title=" " alt="" coords="461,1304,506,1330"/>
<area shape="poly" title=" " alt="" coords="522,1325,585,1337,664,1343,705,1340,745,1332,783,1318,817,1295,833,1277,849,1253,875,1186,897,1104,915,1013,940,836,951,715,956,715,945,836,921,1014,903,1105,880,1188,853,1255,838,1280,821,1299,786,1322,747,1337,706,1346,664,1348,584,1343,521,1330"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1c0349edb057491d7bb8c03612bc8753" id="r_a1c0349edb057491d7bb8c03612bc8753"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a1c0349edb057491d7bb8c03612bc8753">ChatManager</a> (<a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html">IProviderFactory</a> <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a13f4e387e7b5419193b74e1ae3cd0fb5">providerFactory</a>, <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_factory.html">ICommandFactory</a> <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#aa6a9c74750f2d7681b3e2f2a2913d0b3">commandFactory</a>, <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control.html">IServerControl</a> serverControl, ILoggerFactory <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a76009f2ea5bcdd632cd599fc3857ac96">loggerFactory</a>, ILogger&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html">ChatManager</a> &gt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>, IEnumerable&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_bot.html">Models.ChatBot</a> &gt; initialChatBots)</td></tr>
<tr class="memdesc:a1c0349edb057491d7bb8c03612bc8753"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a new instance of the ChatManager class.  <br /></td></tr>
<tr class="separator:a1c0349edb057491d7bb8c03612bc8753"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0bd122a06d9a590adc983b3aedc7417" id="r_ac0bd122a06d9a590adc983b3aedc7417"><td class="memItemLeft" align="right" valign="top">async ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ac0bd122a06d9a590adc983b3aedc7417">DisposeAsync</a> ()</td></tr>
<tr class="separator:ac0bd122a06d9a590adc983b3aedc7417"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a627c57e5a0a6cc6f52a9f7f09cfa5694" id="r_a627c57e5a0a6cc6f52a9f7f09cfa5694"><td class="memItemLeft" align="right" valign="top">async ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a627c57e5a0a6cc6f52a9f7f09cfa5694">ChangeChannels</a> (long connectionId, IEnumerable&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_channel.html">Models.ChatChannel</a> &gt; newChannels, CancellationToken cancellationToken)</td></tr>
<tr class="separator:a627c57e5a0a6cc6f52a9f7f09cfa5694"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d3eb0ce3398090f2f26241f515845fb" id="r_a8d3eb0ce3398090f2f26241f515845fb"><td class="memItemLeft" align="right" valign="top">async ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8d3eb0ce3398090f2f26241f515845fb">ChangeSettings</a> (<a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_bot.html">Models.ChatBot</a> newSettings, CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:a8d3eb0ce3398090f2f26241f515845fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change chat settings. If the <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">Api.Models.EntityId.Id</a> is not currently in use, a new connection will be made instead.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newSettings</td><td>The new <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_bot.html">Models.ChatBot</a>.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask representing the running operation. Will complete immediately if the <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_chat_bot_settings.html#a6579e1e95a99c1d53c90eb3142a12421" title="If the connection is enabled.">ChatBotSettings.Enabled</a> property of <em>newSettings</em>  is <code><a class="el" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers.html#af4b5f6ad734602f75d059267687ca3dd">false</a></code>.</dd></dl>
  <br /></td></tr>
<tr class="separator:a8d3eb0ce3398090f2f26241f515845fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6df490e4067fe694af10379fb56a7a25" id="r_a6df490e4067fe694af10379fb56a7a25"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a6df490e4067fe694af10379fb56a7a25">QueueMessage</a> (<a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a> message, IEnumerable&lt; ulong &gt; channelIds)</td></tr>
<tr class="memdesc:a6df490e4067fe694af10379fb56a7a25"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue a chat <em>message</em>  to a given set of <em>channelIds</em> .<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>The MessageContent being sent.</td></tr>
    <tr><td class="paramname">channelIds</td><td>The <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_channel.html#a0dd252ba836263c5a825862bcda215f7" title="The row Id.">Models.ChatChannel.Id</a>s of the <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_channel.html">Models.ChatChannel</a>s to send to.</td></tr>
  </table>
  </dd>
</dl>
  <br /></td></tr>
<tr class="separator:a6df490e4067fe694af10379fb56a7a25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd8b6d211bb278105cc10f3a483362f6" id="r_acd8b6d211bb278105cc10f3a483362f6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#acd8b6d211bb278105cc10f3a483362f6">QueueWatchdogMessage</a> (string message)</td></tr>
<tr class="memdesc:acd8b6d211bb278105cc10f3a483362f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue a chat <em>message</em>  to configured watchdog channels.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>The message being sent.</td></tr>
  </table>
  </dd>
</dl>
  <br /></td></tr>
<tr class="separator:acd8b6d211bb278105cc10f3a483362f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af41ce2b0c652e320dfeedb42d3d93d3d" id="r_af41ce2b0c652e320dfeedb42d3d93d3d"><td class="memItemLeft" align="right" valign="top">Func&lt; string?, string, Action&lt; bool &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af41ce2b0c652e320dfeedb42d3d93d3d">QueueDeploymentMessage</a> (<a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_revision_information.html">Models.RevisionInformation</a> revisionInformation, <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_revision_information.html">Models.RevisionInformation</a>? previousRevisionInformation, <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_engine_version.html">EngineVersion</a> engineVersion, DateTimeOffset? estimatedCompletionTime, string? gitHubOwner, string? gitHubRepo, bool localCommitPushed)</td></tr>
<tr class="memdesc:af41ce2b0c652e320dfeedb42d3d93d3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send the message for a deployment to configured deployment channels.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">revisionInformation</td><td>The RevisionInformation of the deployment.</td></tr>
    <tr><td class="paramname">previousRevisionInformation</td><td>The optional RevisionInformation of the previous deployment.</td></tr>
    <tr><td class="paramname">engineVersion</td><td>The <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_engine_version.html" title="Information about an engine installation.">Api.Models.EngineVersion</a> of the deployment.</td></tr>
    <tr><td class="paramname">estimatedCompletionTime</td><td>The optional DateTimeOffset the deployment is expected to be completed at.</td></tr>
    <tr><td class="paramname">gitHubOwner</td><td>The repository GitHub owner, if any.</td></tr>
    <tr><td class="paramname">gitHubRepo</td><td>The repository GitHub name, if any.</td></tr>
    <tr><td class="paramname">localCommitPushed</td><td><code>true</code> if the local deployment commit was pushed to the remote repository.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Func&lt;T1, T2, TResult&gt; to call to update the message at the deployment's conclusion. Parameters: Error message if any, DreamMaker output if any. Returns an Action to call to mark the deployment as active/inactive. Parameter: If the deployment is being activated or inactivated.</dd></dl>
  <br /></td></tr>
<tr class="separator:af41ce2b0c652e320dfeedb42d3d93d3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae189d33da50a0791f4caf35fa3eb2567" id="r_ae189d33da50a0791f4caf35fa3eb2567"><td class="memItemLeft" align="right" valign="top">async Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae189d33da50a0791f4caf35fa3eb2567">StartAsync</a> (CancellationToken cancellationToken)</td></tr>
<tr class="separator:ae189d33da50a0791f4caf35fa3eb2567"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af798c33e00b6fbbf046c8459cfd06eab" id="r_af798c33e00b6fbbf046c8459cfd06eab"><td class="memItemLeft" align="right" valign="top">async Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af798c33e00b6fbbf046c8459cfd06eab">StopAsync</a> (CancellationToken cancellationToken)</td></tr>
<tr class="separator:af798c33e00b6fbbf046c8459cfd06eab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadf2ea0ffdbf567ac24cc5c45f6f66b6" id="r_aadf2ea0ffdbf567ac24cc5c45f6f66b6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_tracking_context.html">IChatTrackingContext</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#aadf2ea0ffdbf567ac24cc5c45f6f66b6">CreateTrackingContext</a> ()</td></tr>
<tr class="memdesc:aadf2ea0ffdbf567ac24cc5c45f6f66b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start tracking <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_custom_command.html" title="Represents a command made from DM code.">Commands.CustomCommand</a>s and <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_channel_representation.html" title="Represents a Providers.IProvider channel.">ChannelRepresentation</a>s.<dl class="section return"><dt>Returns</dt><dd>A new <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_tracking_context.html" title="Represents a tracking of dynamic chat json files.">IChatTrackingContext</a>.</dd></dl>
  <br /></td></tr>
<tr class="separator:aadf2ea0ffdbf567ac24cc5c45f6f66b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2f686caab499a7d4ff36174d99a81e7" id="r_ae2f686caab499a7d4ff36174d99a81e7"><td class="memItemLeft" align="right" valign="top">async ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae2f686caab499a7d4ff36174d99a81e7">UpdateTrackingContexts</a> (CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:ae2f686caab499a7d4ff36174d99a81e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Force an update with the active channels on all active <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_tracking_context.html" title="Represents a tracking of dynamic chat json files.">IChatTrackingContext</a>s.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask representing the running operation.</dd></dl>
  <br /></td></tr>
<tr class="separator:ae2f686caab499a7d4ff36174d99a81e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1b556bac2bf1a08d0eef0fd76297dc4" id="r_ae1b556bac2bf1a08d0eef0fd76297dc4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae1b556bac2bf1a08d0eef0fd76297dc4">RegisterCommandHandler</a> (<a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_custom_command_handler.html">ICustomCommandHandler</a> <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a537b7a1db9aa8fab1de0dfb4587b2b3b">customCommandHandler</a>)</td></tr>
<tr class="memdesc:ae1b556bac2bf1a08d0eef0fd76297dc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers a <em>customCommandHandler</em>  to use.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">customCommandHandler</td><td>A <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_custom_command_handler.html" title="Handles Commands.ICommands that map to those defined in a IChatTrackingContext.">ICustomCommandHandler</a>.</td></tr>
  </table>
  </dd>
</dl>
  <br /></td></tr>
<tr class="separator:ae1b556bac2bf1a08d0eef0fd76297dc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8f42e9fc59f0aa9d70de26a4b6600b7" id="r_ae8f42e9fc59f0aa9d70de26a4b6600b7"><td class="memItemLeft" align="right" valign="top">async Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae8f42e9fc59f0aa9d70de26a4b6600b7">DeleteConnection</a> (long connectionId, CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:ae8f42e9fc59f0aa9d70de26a4b6600b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disconnects and deletes a given connection.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connectionId</td><td>The <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">Api.Models.EntityId.Id</a> of the connection.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task representing the running operation.</dd></dl>
  <br /></td></tr>
<tr class="separator:ae8f42e9fc59f0aa9d70de26a4b6600b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3042b37389548f8b8a969bdd7128a783" id="r_a3042b37389548f8b8a969bdd7128a783"><td class="memItemLeft" align="right" valign="top">ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3042b37389548f8b8a969bdd7128a783">HandleRestart</a> (Version? updateVersion, bool handlerMayDelayShutdownWithExtremelyLongRunningTasks, CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:a3042b37389548f8b8a969bdd7128a783"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle a restart of the server.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">updateVersion</td><td>The Version being updated to, <code>null</code> if not being changed.</td></tr>
    <tr><td class="paramname">handlerMayDelayShutdownWithExtremelyLongRunningTasks</td><td>If <code><a class="el" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers.html#af4b5f6ad734602f75d059267687ca3dd">false</a></code> the <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_restart_handler.html" title="Handler for server restarts.">IRestartHandler</a> should aim to complete the Task returned from this function ASAP.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask representing the running operation.</dd></dl>
  <br /></td></tr>
<tr class="separator:a3042b37389548f8b8a969bdd7128a783"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html">Tgstation.Server.Host.Components.Chat.IChatManager</a></td></tr>
<tr class="memitem:a26ee474703de8b7cc4cf94f550b5322f inherit pub_methods_interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager" id="r_a26ee474703de8b7cc4cf94f550b5322f"><td class="memItemLeft" align="right" valign="top">ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#a26ee474703de8b7cc4cf94f550b5322f">ChangeChannels</a> (long connectionId, IEnumerable&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_channel.html">Models.ChatChannel</a> &gt; newChannels, CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:a26ee474703de8b7cc4cf94f550b5322f inherit pub_methods_interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change chat channels.  <br /></td></tr>
<tr class="separator:a26ee474703de8b7cc4cf94f550b5322f inherit pub_methods_interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-attribs" name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a0b5b0d03d129b21de29dc2c2bbf17edf" id="r_a0b5b0d03d129b21de29dc2c2bbf17edf"><td class="memItemLeft" align="right" valign="top">const string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a0b5b0d03d129b21de29dc2c2bbf17edf">CommonMention</a> = &quot;!tgs&quot;</td></tr>
<tr class="memdesc:a0b5b0d03d129b21de29dc2c2bbf17edf"><td class="mdescLeft">&#160;</td><td class="mdescRight">The common bot mention.  <br /></td></tr>
<tr class="separator:a0b5b0d03d129b21de29dc2c2bbf17edf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:af46a3f4845f2190ea2c22af33e233c31" id="r_af46a3f4845f2190ea2c22af33e233c31"><td class="memItemLeft" align="right" valign="top">async ValueTask&lt; <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a>?&gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af46a3f4845f2190ea2c22af33e233c31">RemoveProviderChannels</a> (long connectionId, bool removeProvider, CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:af46a3f4845f2190ea2c22af33e233c31"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove a IProvider from mappedChannels optionally removing the provider itself from providers and updating the trackingContexts as well.  <br /></td></tr>
<tr class="separator:af46a3f4845f2190ea2c22af33e233c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4487a7f0841824a78272233a9f30262c" id="r_a4487a7f0841824a78272233a9f30262c"><td class="memItemLeft" align="right" valign="top">async ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4487a7f0841824a78272233a9f30262c">RemapProvider</a> (<a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a> provider, CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:a4487a7f0841824a78272233a9f30262c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remap the channels for a given <em>provider</em> .  <br /></td></tr>
<tr class="separator:a4487a7f0841824a78272233a9f30262c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a469bab0c686f2aa640069bae4a1a0055" id="r_a469bab0c686f2aa640069bae4a1a0055"><td class="memItemLeft" align="right" valign="top">async ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a469bab0c686f2aa640069bae4a1a0055">ProcessMessage</a> (<a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a> provider, <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_message.html">Message</a>? message, bool recursed, CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:a469bab0c686f2aa640069bae4a1a0055"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes a <em>message</em> .  <br /></td></tr>
<tr class="separator:a469bab0c686f2aa640069bae4a1a0055"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a530e8ef5a58711a9c6744021df74afb2" id="r_a530e8ef5a58711a9c6744021df74afb2"><td class="memItemLeft" align="right" valign="top">async Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a530e8ef5a58711a9c6744021df74afb2">MonitorMessages</a> (CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:a530e8ef5a58711a9c6744021df74afb2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Monitors active providers for new Messages.  <br /></td></tr>
<tr class="separator:a530e8ef5a58711a9c6744021df74afb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14df10dd6677ff9fbf9d9d3bdc05c99f" id="r_a14df10dd6677ff9fbf9d9d3bdc05c99f"><td class="memItemLeft" align="right" valign="top">ValueTask&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a14df10dd6677ff9fbf9d9d3bdc05c99f">SendMessage</a> (IEnumerable&lt; ulong &gt; channelIds, <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_message.html">Message</a>? replyTo, <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a> message, CancellationToken cancellationToken)</td></tr>
<tr class="memdesc:a14df10dd6677ff9fbf9d9d3bdc05c99f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronously send a given <em>message</em>  to a set of <em>channelIds</em> .  <br /></td></tr>
<tr class="separator:a14df10dd6677ff9fbf9d9d3bdc05c99f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a422e8e55e6988c994b23eaaf16cf0498" id="r_a422e8e55e6988c994b23eaaf16cf0498"><td class="memItemLeft" align="right" valign="top">async Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a422e8e55e6988c994b23eaaf16cf0498">InitialConnection</a> ()</td></tr>
<tr class="memdesc:a422e8e55e6988c994b23eaaf16cf0498"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aggregate all <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html#a98843a608252fa92e550215f3097e51e" title="A Task that completes once the IProvider finishes it&#39;s first connection attempt regardless of success...">IProvider.InitialConnectionJob</a>s into one &lt;sse cref="Task"&gt;.  <br /></td></tr>
<tr class="separator:a422e8e55e6988c994b23eaaf16cf0498"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab21f39aa8eb74bc4269aa37b378cf85c" id="r_ab21f39aa8eb74bc4269aa37b378cf85c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ab21f39aa8eb74bc4269aa37b378cf85c">AddMessageTask</a> (Task task)</td></tr>
<tr class="memdesc:ab21f39aa8eb74bc4269aa37b378cf85c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a given <em>task</em>  to messageSendTask.  <br /></td></tr>
<tr class="separator:ab21f39aa8eb74bc4269aa37b378cf85c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a340b673aa6460c8570dc501b18fe0f5e" id="r_a340b673aa6460c8570dc501b18fe0f5e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a340b673aa6460c8570dc501b18fe0f5e">QueueMessageInternal</a> (<a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a> message, Func&lt; IEnumerable&lt; ulong &gt; &gt; channelIdsFactory, bool waitForConnections)</td></tr>
<tr class="memdesc:a340b673aa6460c8570dc501b18fe0f5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a given <em>message</em>  to the send queue.  <br /></td></tr>
<tr class="separator:a340b673aa6460c8570dc501b18fe0f5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a13f4e387e7b5419193b74e1ae3cd0fb5" id="r_a13f4e387e7b5419193b74e1ae3cd0fb5"><td class="memItemLeft" align="right" valign="top">readonly <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html">IProviderFactory</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a13f4e387e7b5419193b74e1ae3cd0fb5">providerFactory</a></td></tr>
<tr class="memdesc:a13f4e387e7b5419193b74e1ae3cd0fb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">The IProviderFactory for the ChatManager.  <br /></td></tr>
<tr class="separator:a13f4e387e7b5419193b74e1ae3cd0fb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6a9c74750f2d7681b3e2f2a2913d0b3" id="r_aa6a9c74750f2d7681b3e2f2a2913d0b3"><td class="memItemLeft" align="right" valign="top">readonly <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_factory.html">ICommandFactory</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#aa6a9c74750f2d7681b3e2f2a2913d0b3">commandFactory</a></td></tr>
<tr class="memdesc:aa6a9c74750f2d7681b3e2f2a2913d0b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">The ICommandFactory for the ChatManager.  <br /></td></tr>
<tr class="separator:aa6a9c74750f2d7681b3e2f2a2913d0b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3dec357800cfc9a526c82d61fe99803" id="r_ac3dec357800cfc9a526c82d61fe99803"><td class="memItemLeft" align="right" valign="top">readonly <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_restart_registration.html">IRestartRegistration</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ac3dec357800cfc9a526c82d61fe99803">restartRegistration</a></td></tr>
<tr class="memdesc:ac3dec357800cfc9a526c82d61fe99803"><td class="mdescLeft">&#160;</td><td class="mdescRight">The IRestartRegistration for the ChatManager.  <br /></td></tr>
<tr class="separator:ac3dec357800cfc9a526c82d61fe99803"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76009f2ea5bcdd632cd599fc3857ac96" id="r_a76009f2ea5bcdd632cd599fc3857ac96"><td class="memItemLeft" align="right" valign="top">readonly ILoggerFactory&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a76009f2ea5bcdd632cd599fc3857ac96">loggerFactory</a></td></tr>
<tr class="memdesc:a76009f2ea5bcdd632cd599fc3857ac96"><td class="mdescLeft">&#160;</td><td class="mdescRight">The ILoggerFactory for the ChatManager.  <br /></td></tr>
<tr class="separator:a76009f2ea5bcdd632cd599fc3857ac96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc0dda9d12fd94b299931aaa8d4aa8bd" id="r_abc0dda9d12fd94b299931aaa8d4aa8bd"><td class="memItemLeft" align="right" valign="top">readonly ILogger&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html">ChatManager</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a></td></tr>
<tr class="memdesc:abc0dda9d12fd94b299931aaa8d4aa8bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">The ILogger for the ChatManager.  <br /></td></tr>
<tr class="separator:abc0dda9d12fd94b299931aaa8d4aa8bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69d25612b62368e0fb9ac204987ed7b6" id="r_a69d25612b62368e0fb9ac204987ed7b6"><td class="memItemLeft" align="right" valign="top">readonly Dictionary&lt; string, <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command.html">ICommand</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a69d25612b62368e0fb9ac204987ed7b6">builtinCommands</a></td></tr>
<tr class="memdesc:a69d25612b62368e0fb9ac204987ed7b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unchanging ICommands in the ChatManager mapped by <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command.html#aa9cbbf23975efc1dde048ee43a6e1d4b" title="The text to invoke the command. May not be &quot;?&quot; or &quot;help&quot; (case-insensitive).">ICommand.Name</a>.  <br /></td></tr>
<tr class="separator:a69d25612b62368e0fb9ac204987ed7b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cad1103e8e6752fa1772016effff937" id="r_a4cad1103e8e6752fa1772016effff937"><td class="memItemLeft" align="right" valign="top">readonly Dictionary&lt; long, <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a></td></tr>
<tr class="memdesc:a4cad1103e8e6752fa1772016effff937"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map of IProviders in use, keyed by ChatBotSettings <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">EntityId.Id</a>.  <br /></td></tr>
<tr class="separator:a4cad1103e8e6752fa1772016effff937"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abef5c8cc20c6ed55f7393272cc5e5cbe" id="r_abef5c8cc20c6ed55f7393272cc5e5cbe"><td class="memItemLeft" align="right" valign="top">readonly ConcurrentDictionary&lt; long, SemaphoreSlim &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abef5c8cc20c6ed55f7393272cc5e5cbe">changeChannelSemaphores</a></td></tr>
<tr class="memdesc:abef5c8cc20c6ed55f7393272cc5e5cbe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map of SemaphoreSlims used to guard concurrent access to ChangeChannels(long, IEnumerable&lt;Models.ChatChannel&gt;, CancellationToken), keyed by ChatBotSettings <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">EntityId.Id</a>.  <br /></td></tr>
<tr class="separator:abef5c8cc20c6ed55f7393272cc5e5cbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affabd2c8c6dccbfc92ab509c9405b88b" id="r_affabd2c8c6dccbfc92ab509c9405b88b"><td class="memItemLeft" align="right" valign="top">readonly Dictionary&lt; ulong, <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_channel_mapping.html">ChannelMapping</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a></td></tr>
<tr class="memdesc:affabd2c8c6dccbfc92ab509c9405b88b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map of ChannelRepresentation.RealIds to ChannelMappings.  <br /></td></tr>
<tr class="separator:affabd2c8c6dccbfc92ab509c9405b88b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af98ea12e0c98e5cc3815d59cace7567a" id="r_af98ea12e0c98e5cc3815d59cace7567a"><td class="memItemLeft" align="right" valign="top">readonly List&lt; <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_tracking_context.html">IChatTrackingContext</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a></td></tr>
<tr class="memdesc:af98ea12e0c98e5cc3815d59cace7567a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The active IChatTrackingContexts for the ChatManager.  <br /></td></tr>
<tr class="separator:af98ea12e0c98e5cc3815d59cace7567a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ca52a2da0df3c6f05614dc8e87a4ec0" id="r_a3ca52a2da0df3c6f05614dc8e87a4ec0"><td class="memItemLeft" align="right" valign="top">readonly List&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_bot.html">Models.ChatBot</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a></td></tr>
<tr class="memdesc:a3ca52a2da0df3c6f05614dc8e87a4ec0"><td class="mdescLeft">&#160;</td><td class="mdescRight">The active Models.ChatBot for the ChatManager.  <br /></td></tr>
<tr class="separator:a3ca52a2da0df3c6f05614dc8e87a4ec0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc4749cb2a207e472c9fac07cf56e981" id="r_adc4749cb2a207e472c9fac07cf56e981"><td class="memItemLeft" align="right" valign="top">readonly CancellationTokenSource&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#adc4749cb2a207e472c9fac07cf56e981">handlerCts</a></td></tr>
<tr class="memdesc:adc4749cb2a207e472c9fac07cf56e981"><td class="mdescLeft">&#160;</td><td class="mdescRight">The CancellationTokenSource for chatHandler.  <br /></td></tr>
<tr class="separator:adc4749cb2a207e472c9fac07cf56e981"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ac2daf67a09f128290588a5181c88ba" id="r_a1ac2daf67a09f128290588a5181c88ba"><td class="memItemLeft" align="right" valign="top">readonly object&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a1ac2daf67a09f128290588a5181c88ba">synchronizationLock</a></td></tr>
<tr class="memdesc:a1ac2daf67a09f128290588a5181c88ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used for various lock statements throughout this <code>class</code>.  <br /></td></tr>
<tr class="separator:a1ac2daf67a09f128290588a5181c88ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a537b7a1db9aa8fab1de0dfb4587b2b3b" id="r_a537b7a1db9aa8fab1de0dfb4587b2b3b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_custom_command_handler.html">ICustomCommandHandler</a>?&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a537b7a1db9aa8fab1de0dfb4587b2b3b">customCommandHandler</a></td></tr>
<tr class="memdesc:a537b7a1db9aa8fab1de0dfb4587b2b3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The ICustomCommandHandler for the ChangeChannels(long, IEnumerable&lt;Models.ChatChannel&gt;, CancellationToken).  <br /></td></tr>
<tr class="separator:a537b7a1db9aa8fab1de0dfb4587b2b3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87f1fd43fb31e2681bd1852ae7bf7ae8" id="r_a87f1fd43fb31e2681bd1852ae7bf7ae8"><td class="memItemLeft" align="right" valign="top">Task?&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a87f1fd43fb31e2681bd1852ae7bf7ae8">chatHandler</a></td></tr>
<tr class="memdesc:a87f1fd43fb31e2681bd1852ae7bf7ae8"><td class="mdescLeft">&#160;</td><td class="mdescRight">The Task that monitors incoming chat messages.  <br /></td></tr>
<tr class="separator:a87f1fd43fb31e2681bd1852ae7bf7ae8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cd00fcaf7dd3fe543c97bb315bd1837" id="r_a2cd00fcaf7dd3fe543c97bb315bd1837"><td class="memItemLeft" align="right" valign="top">Task?&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a2cd00fcaf7dd3fe543c97bb315bd1837">initialProviderConnectionsTask</a></td></tr>
<tr class="memdesc:a2cd00fcaf7dd3fe543c97bb315bd1837"><td class="mdescLeft">&#160;</td><td class="mdescRight">A Task that represents the IProviders initial connection.  <br /></td></tr>
<tr class="separator:a2cd00fcaf7dd3fe543c97bb315bd1837"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8537715fb809f78e49b1497bcd82849e" id="r_a8537715fb809f78e49b1497bcd82849e"><td class="memItemLeft" align="right" valign="top">Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8537715fb809f78e49b1497bcd82849e">messageSendTask</a></td></tr>
<tr class="memdesc:a8537715fb809f78e49b1497bcd82849e"><td class="mdescLeft">&#160;</td><td class="mdescRight">A Task that represents all sent messages.  <br /></td></tr>
<tr class="separator:a8537715fb809f78e49b1497bcd82849e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae24bfda149bf5a3080399529e7ef299c" id="r_ae24bfda149bf5a3080399529e7ef299c"><td class="memItemLeft" align="right" valign="top">TaskCompletionSource&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae24bfda149bf5a3080399529e7ef299c">connectionsUpdated</a></td></tr>
<tr class="memdesc:ae24bfda149bf5a3080399529e7ef299c"><td class="mdescLeft">&#160;</td><td class="mdescRight">The TaskCompletionSource that completes when ChatBotSettingss change.  <br /></td></tr>
<tr class="separator:ae24bfda149bf5a3080399529e7ef299c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f8c4d78e74aa61eb4aaa13cc1a88bbf" id="r_a9f8c4d78e74aa61eb4aaa13cc1a88bbf"><td class="memItemLeft" align="right" valign="top">ulong&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a9f8c4d78e74aa61eb4aaa13cc1a88bbf">channelIdCounter</a></td></tr>
<tr class="memdesc:a9f8c4d78e74aa61eb4aaa13cc1a88bbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used for remapping ChannelRepresentation.RealIds.  <br /></td></tr>
<tr class="separator:a9f8c4d78e74aa61eb4aaa13cc1a88bbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f90df8e6ed21489cc4b57f690f41c7e" id="r_a0f90df8e6ed21489cc4b57f690f41c7e"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a0f90df8e6ed21489cc4b57f690f41c7e">messagesProcessed</a></td></tr>
<tr class="memdesc:a0f90df8e6ed21489cc4b57f690f41c7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of Messages processed.  <br /></td></tr>
<tr class="separator:a0f90df8e6ed21489cc4b57f690f41c7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00028">28</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a1c0349edb057491d7bb8c03612bc8753" name="a1c0349edb057491d7bb8c03612bc8753"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c0349edb057491d7bb8c03612bc8753">&#9670;&#160;</a></span>ChatManager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html">IProviderFactory</a>&#160;</td>
          <td class="paramname"><em>providerFactory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_factory.html">ICommandFactory</a>&#160;</td>
          <td class="paramname"><em>commandFactory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control.html">IServerControl</a>&#160;</td>
          <td class="paramname"><em>serverControl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ILoggerFactory&#160;</td>
          <td class="paramname"><em>loggerFactory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ILogger&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html">ChatManager</a> &gt;&#160;</td>
          <td class="paramname"><em>logger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IEnumerable&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_bot.html">Models::ChatBot</a> &gt;&#160;</td>
          <td class="paramname"><em>initialChatBots</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a new instance of the ChatManager class. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">providerFactory</td><td>The value of providerFactory.</td></tr>
    <tr><td class="paramname">commandFactory</td><td>The value of commandFactory.</td></tr>
    <tr><td class="paramname">serverControl</td><td>The IServerControl to populate restartRegistration with.</td></tr>
    <tr><td class="paramname">loggerFactory</td><td>The value of loggerFactory.</td></tr>
    <tr><td class="paramname">logger</td><td>The value of logger.</td></tr>
    <tr><td class="paramname">initialChatBots</td><td>The IEnumerable&lt;T&gt; used to populate activeChatBots.</td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00144">144</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  151</span>        {</div>
<div class="line"><span class="lineno">  152</span>            this.providerFactory = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a13f4e387e7b5419193b74e1ae3cd0fb5">providerFactory</a> ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a13f4e387e7b5419193b74e1ae3cd0fb5">providerFactory</a>));</div>
<div class="line"><span class="lineno">  153</span>            this.commandFactory = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#aa6a9c74750f2d7681b3e2f2a2913d0b3">commandFactory</a> ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#aa6a9c74750f2d7681b3e2f2a2913d0b3">commandFactory</a>));</div>
<div class="line"><span class="lineno">  154</span>            ArgumentNullException.ThrowIfNull(serverControl);</div>
<div class="line"><span class="lineno">  155</span>            this.loggerFactory = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a76009f2ea5bcdd632cd599fc3857ac96">loggerFactory</a> ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a76009f2ea5bcdd632cd599fc3857ac96">loggerFactory</a>));</div>
<div class="line"><span class="lineno">  156</span>            this.logger = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a> ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>));</div>
<div class="line"><span class="lineno">  157</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a> = initialChatBots?.ToList() ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(initialChatBots));</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ac3dec357800cfc9a526c82d61fe99803">restartRegistration</a> = serverControl.<a class="code hl_function" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control.html#a35728d66030addfd5551351b8c6db942">RegisterForRestart</a>(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">  160</span> </div>
<div class="line"><span class="lineno">  161</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a1ac2daf67a09f128290588a5181c88ba">synchronizationLock</a> = <span class="keyword">new</span> object();</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a69d25612b62368e0fb9ac204987ed7b6">builtinCommands</a> = <span class="keyword">new</span> Dictionary&lt;string, ICommand&gt;(StringComparer.OrdinalIgnoreCase);</div>
<div class="line"><span class="lineno">  164</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a> = <span class="keyword">new</span> Dictionary&lt;long, IProvider&gt;();</div>
<div class="line"><span class="lineno">  165</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abef5c8cc20c6ed55f7393272cc5e5cbe">changeChannelSemaphores</a> = <span class="keyword">new</span> ConcurrentDictionary&lt;long, SemaphoreSlim&gt;();</div>
<div class="line"><span class="lineno">  166</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a> = <span class="keyword">new</span> Dictionary&lt;ulong, ChannelMapping&gt;();</div>
<div class="line"><span class="lineno">  167</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a> = <span class="keyword">new</span> List&lt;IChatTrackingContext&gt;();</div>
<div class="line"><span class="lineno">  168</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#adc4749cb2a207e472c9fac07cf56e981">handlerCts</a> = <span class="keyword">new</span> CancellationTokenSource();</div>
<div class="line"><span class="lineno">  169</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae24bfda149bf5a3080399529e7ef299c">connectionsUpdated</a> = <span class="keyword">new</span> TaskCompletionSource();</div>
<div class="line"><span class="lineno">  170</span> </div>
<div class="line"><span class="lineno">  171</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8537715fb809f78e49b1497bcd82849e">messageSendTask</a> = Task.CompletedTask;</div>
<div class="line"><span class="lineno">  172</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a9f8c4d78e74aa61eb4aaa13cc1a88bbf">channelIdCounter</a> = 1;</div>
<div class="line"><span class="lineno">  173</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a13f4e387e7b5419193b74e1ae3cd0fb5"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a13f4e387e7b5419193b74e1ae3cd0fb5">Tgstation.Server.Host.Components.Chat.ChatManager.providerFactory</a></div><div class="ttdeci">readonly IProviderFactory providerFactory</div><div class="ttdoc">The IProviderFactory for the ChatManager.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00038">ChatManager.cs:38</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a1ac2daf67a09f128290588a5181c88ba"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a1ac2daf67a09f128290588a5181c88ba">Tgstation.Server.Host.Components.Chat.ChatManager.synchronizationLock</a></div><div class="ttdeci">readonly object synchronizationLock</div><div class="ttdoc">Used for various lock statements throughout this class.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00098">ChatManager.cs:98</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a3ca52a2da0df3c6f05614dc8e87a4ec0"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">Tgstation.Server.Host.Components.Chat.ChatManager.activeChatBots</a></div><div class="ttdeci">readonly List&lt; Models.ChatBot &gt; activeChatBots</div><div class="ttdoc">The active Models.ChatBot for the ChatManager.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00088">ChatManager.cs:88</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a4cad1103e8e6752fa1772016effff937"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">Tgstation.Server.Host.Components.Chat.ChatManager.providers</a></div><div class="ttdeci">readonly Dictionary&lt; long, IProvider &gt; providers</div><div class="ttdoc">Map of IProviders in use, keyed by ChatBotSettings EntityId.Id.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00068">ChatManager.cs:68</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a69d25612b62368e0fb9ac204987ed7b6"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a69d25612b62368e0fb9ac204987ed7b6">Tgstation.Server.Host.Components.Chat.ChatManager.builtinCommands</a></div><div class="ttdeci">readonly Dictionary&lt; string, ICommand &gt; builtinCommands</div><div class="ttdoc">Unchanging ICommands in the ChatManager mapped by ICommand.Name.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00063">ChatManager.cs:63</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a76009f2ea5bcdd632cd599fc3857ac96"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a76009f2ea5bcdd632cd599fc3857ac96">Tgstation.Server.Host.Components.Chat.ChatManager.loggerFactory</a></div><div class="ttdeci">readonly ILoggerFactory loggerFactory</div><div class="ttdoc">The ILoggerFactory for the ChatManager.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00053">ChatManager.cs:53</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a8537715fb809f78e49b1497bcd82849e"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8537715fb809f78e49b1497bcd82849e">Tgstation.Server.Host.Components.Chat.ChatManager.messageSendTask</a></div><div class="ttdeci">Task messageSendTask</div><div class="ttdoc">A Task that represents all sent messages.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00118">ChatManager.cs:118</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a9f8c4d78e74aa61eb4aaa13cc1a88bbf"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a9f8c4d78e74aa61eb4aaa13cc1a88bbf">Tgstation.Server.Host.Components.Chat.ChatManager.channelIdCounter</a></div><div class="ttdeci">ulong channelIdCounter</div><div class="ttdoc">Used for remapping ChannelRepresentation.RealIds.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00128">ChatManager.cs:128</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_aa6a9c74750f2d7681b3e2f2a2913d0b3"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#aa6a9c74750f2d7681b3e2f2a2913d0b3">Tgstation.Server.Host.Components.Chat.ChatManager.commandFactory</a></div><div class="ttdeci">readonly ICommandFactory commandFactory</div><div class="ttdoc">The ICommandFactory for the ChatManager.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00043">ChatManager.cs:43</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_abc0dda9d12fd94b299931aaa8d4aa8bd"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">Tgstation.Server.Host.Components.Chat.ChatManager.logger</a></div><div class="ttdeci">readonly ILogger&lt; ChatManager &gt; logger</div><div class="ttdoc">The ILogger for the ChatManager.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00058">ChatManager.cs:58</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_abef5c8cc20c6ed55f7393272cc5e5cbe"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abef5c8cc20c6ed55f7393272cc5e5cbe">Tgstation.Server.Host.Components.Chat.ChatManager.changeChannelSemaphores</a></div><div class="ttdeci">readonly ConcurrentDictionary&lt; long, SemaphoreSlim &gt; changeChannelSemaphores</div><div class="ttdoc">Map of SemaphoreSlims used to guard concurrent access to ChangeChannels(long, IEnumerable&lt;Models....</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00073">ChatManager.cs:73</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_ac3dec357800cfc9a526c82d61fe99803"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ac3dec357800cfc9a526c82d61fe99803">Tgstation.Server.Host.Components.Chat.ChatManager.restartRegistration</a></div><div class="ttdeci">readonly IRestartRegistration restartRegistration</div><div class="ttdoc">The IRestartRegistration for the ChatManager.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00048">ChatManager.cs:48</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_adc4749cb2a207e472c9fac07cf56e981"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#adc4749cb2a207e472c9fac07cf56e981">Tgstation.Server.Host.Components.Chat.ChatManager.handlerCts</a></div><div class="ttdeci">readonly CancellationTokenSource handlerCts</div><div class="ttdoc">The CancellationTokenSource for chatHandler.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00093">ChatManager.cs:93</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_ae24bfda149bf5a3080399529e7ef299c"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae24bfda149bf5a3080399529e7ef299c">Tgstation.Server.Host.Components.Chat.ChatManager.connectionsUpdated</a></div><div class="ttdeci">TaskCompletionSource connectionsUpdated</div><div class="ttdoc">The TaskCompletionSource that completes when ChatBotSettingss change.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00123">ChatManager.cs:123</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_af98ea12e0c98e5cc3815d59cace7567a"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">Tgstation.Server.Host.Components.Chat.ChatManager.trackingContexts</a></div><div class="ttdeci">readonly List&lt; IChatTrackingContext &gt; trackingContexts</div><div class="ttdoc">The active IChatTrackingContexts for the ChatManager.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00083">ChatManager.cs:83</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_affabd2c8c6dccbfc92ab509c9405b88b"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">Tgstation.Server.Host.Components.Chat.ChatManager.mappedChannels</a></div><div class="ttdeci">readonly Dictionary&lt; ulong, ChannelMapping &gt; mappedChannels</div><div class="ttdoc">Map of ChannelRepresentation.RealIds to ChannelMappings.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00078">ChatManager.cs:78</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control_html_a35728d66030addfd5551351b8c6db942"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control.html#a35728d66030addfd5551351b8c6db942">Tgstation.Server.Host.Core.IServerControl.RegisterForRestart</a></div><div class="ttdeci">IRestartRegistration RegisterForRestart(IRestartHandler handler)</div><div class="ttdoc">Register a given handler  to run before stopping the server for a restart.</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_chat_manager_8cs_source.html#l00088">Tgstation.Server.Host.Components.Chat.ChatManager.activeChatBots</a>, <a class="el" href="_chat_manager_8cs_source.html#l00063">Tgstation.Server.Host.Components.Chat.ChatManager.builtinCommands</a>, <a class="el" href="_chat_manager_8cs_source.html#l00073">Tgstation.Server.Host.Components.Chat.ChatManager.changeChannelSemaphores</a>, <a class="el" href="_chat_manager_8cs_source.html#l00128">Tgstation.Server.Host.Components.Chat.ChatManager.channelIdCounter</a>, <a class="el" href="_chat_manager_8cs_source.html#l00043">Tgstation.Server.Host.Components.Chat.ChatManager.commandFactory</a>, <a class="el" href="_chat_manager_8cs_source.html#l00123">Tgstation.Server.Host.Components.Chat.ChatManager.connectionsUpdated</a>, <a class="el" href="_chat_manager_8cs_source.html#l00093">Tgstation.Server.Host.Components.Chat.ChatManager.handlerCts</a>, <a class="el" href="_chat_manager_8cs_source.html#l00058">Tgstation.Server.Host.Components.Chat.ChatManager.logger</a>, <a class="el" href="_chat_manager_8cs_source.html#l00053">Tgstation.Server.Host.Components.Chat.ChatManager.loggerFactory</a>, <a class="el" href="_chat_manager_8cs_source.html#l00078">Tgstation.Server.Host.Components.Chat.ChatManager.mappedChannels</a>, <a class="el" href="_chat_manager_8cs_source.html#l00118">Tgstation.Server.Host.Components.Chat.ChatManager.messageSendTask</a>, <a class="el" href="_chat_manager_8cs_source.html#l00038">Tgstation.Server.Host.Components.Chat.ChatManager.providerFactory</a>, <a class="el" href="_chat_manager_8cs_source.html#l00068">Tgstation.Server.Host.Components.Chat.ChatManager.providers</a>, <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control.html#a35728d66030addfd5551351b8c6db942">Tgstation.Server.Host.Core.IServerControl.RegisterForRestart()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00048">Tgstation.Server.Host.Components.Chat.ChatManager.restartRegistration</a>, <a class="el" href="_chat_manager_8cs_source.html#l00098">Tgstation.Server.Host.Components.Chat.ChatManager.synchronizationLock</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00083">Tgstation.Server.Host.Components.Chat.ChatManager.trackingContexts</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a1c0349edb057491d7bb8c03612bc8753_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a1c0349edb057491d7bb8c03612bc8753_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a1c0349edb057491d7bb8c03612bc8753_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a1c0349edb057491d7bb8c03612bc8753_cgraph">
<area shape="rect" title="Initializes a new instance of the ChatManager class." alt="" coords="5,5,232,46"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_server_control.html#a35728d66030addfd5551351b8c6db942" title="Register a given handler &#160;to run before stopping the server for a restart." alt="" coords="280,5,496,46"/>
<area shape="poly" title=" " alt="" coords="232,23,264,23,264,28,232,28"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab21f39aa8eb74bc4269aa37b378cf85c" name="ab21f39aa8eb74bc4269aa37b378cf85c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab21f39aa8eb74bc4269aa37b378cf85c">&#9670;&#160;</a></span>AddMessageTask()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Tgstation.Server.Host.Components.Chat.ChatManager.AddMessageTask </td>
          <td>(</td>
          <td class="paramtype">Task&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds a given <em>task</em>  to messageSendTask. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">task</td><td>The Task to add.</td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l01068">1068</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1069</span>        {</div>
<div class="line"><span class="lineno"> 1070</span>            async Task Wrap(Task originalTask)</div>
<div class="line"><span class="lineno"> 1071</span>            {</div>
<div class="line"><span class="lineno"> 1072</span>                await originalTask;</div>
<div class="line"><span class="lineno"> 1073</span>                <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno"> 1074</span>                {</div>
<div class="line"><span class="lineno"> 1075</span>                    await task;</div>
<div class="line"><span class="lineno"> 1076</span>                }</div>
<div class="line"><span class="lineno"> 1077</span>                <span class="keywordflow">catch</span> (OperationCanceledException ex)</div>
<div class="line"><span class="lineno"> 1078</span>                {</div>
<div class="line"><span class="lineno"> 1079</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogDebug(ex, <span class="stringliteral">&quot;Async chat message cancelled!&quot;</span>);</div>
<div class="line"><span class="lineno"> 1080</span>                }</div>
<div class="line"><span class="lineno"> 1081</span>                <span class="keywordflow">catch</span> (<a class="code hl_class" href="class_exception.html">Exception</a> ex)</div>
<div class="line"><span class="lineno"> 1082</span>                {</div>
<div class="line"><span class="lineno"> 1083</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogError(ex, <span class="stringliteral">&quot;Error in asynchronous chat message!&quot;</span>);</div>
<div class="line"><span class="lineno"> 1084</span>                }</div>
<div class="line"><span class="lineno"> 1085</span>            }</div>
<div class="line"><span class="lineno"> 1086</span> </div>
<div class="line"><span class="lineno"> 1087</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#adc4749cb2a207e472c9fac07cf56e981">handlerCts</a>)</div>
<div class="line"><span class="lineno"> 1088</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8537715fb809f78e49b1497bcd82849e">messageSendTask</a> = Wrap(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8537715fb809f78e49b1497bcd82849e">messageSendTask</a>);</div>
<div class="line"><span class="lineno"> 1089</span>        }</div>
<div class="ttc" id="aclass_exception_html"><div class="ttname"><a href="class_exception.html">Exception</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a627c57e5a0a6cc6f52a9f7f09cfa5694" name="a627c57e5a0a6cc6f52a9f7f09cfa5694"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a627c57e5a0a6cc6f52a9f7f09cfa5694">&#9670;&#160;</a></span>ChangeChannels()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async ValueTask Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>connectionId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IEnumerable&lt; <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_channel.html">Models::ChatChannel</a> &gt;&#160;</td>
          <td class="paramname"><em>newChannels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p></p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00191">191</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  192</span>        {</div>
<div class="line"><span class="lineno">  193</span>            ArgumentNullException.ThrowIfNull(newChannels);</div>
<div class="line"><span class="lineno">  194</span> </div>
<div class="line"><span class="lineno">  195</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;ChangeChannels {connectionId}...&quot;</span>, connectionId);</div>
<div class="line"><span class="lineno">  196</span>            var semaphore = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abef5c8cc20c6ed55f7393272cc5e5cbe">changeChannelSemaphores</a>.GetOrAdd(connectionId, _ =&gt;</div>
<div class="line"><span class="lineno">  197</span>            {</div>
<div class="line"><span class="lineno">  198</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Creating ChangeChannels semaphore for connection ID {connectionId}...&quot;</span>, connectionId);</div>
<div class="line"><span class="lineno">  199</span>                <span class="keywordflow">return</span> <span class="keyword">new</span> SemaphoreSlim(1);</div>
<div class="line"><span class="lineno">  200</span>            });</div>
<div class="line"><span class="lineno">  201</span>            <span class="keyword">using</span> (await <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html">SemaphoreSlimContext</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html#abeb1f086e2752f6f9a4d3d175a4392af">Lock</a>(semaphore, cancellationToken))</div>
<div class="line"><span class="lineno">  202</span>            {</div>
<div class="line"><span class="lineno">  203</span>                var provider = await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af46a3f4845f2190ea2c22af33e233c31">RemoveProviderChannels</a>(connectionId, <span class="keyword">false</span>, cancellationToken);</div>
<div class="line"><span class="lineno">  204</span>                <span class="keywordflow">if</span> (provider == <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  205</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span>                <span class="keywordflow">if</span> (!provider.Connected)</div>
<div class="line"><span class="lineno">  208</span>                {</div>
<div class="line"><span class="lineno">  209</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogDebug(<span class="stringliteral">&quot;Cannot map channels, provider {providerId} disconnected!&quot;</span>, connectionId);</div>
<div class="line"><span class="lineno">  210</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  211</span>                }</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>                var results = await provider.MapChannels(newChannels, cancellationToken);</div>
<div class="line"><span class="lineno">  214</span>                <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  215</span>                {</div>
<div class="line"><span class="lineno">  216</span>                    lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>)</div>
<div class="line"><span class="lineno">  217</span>                    {</div>
<div class="line"><span class="lineno">  218</span>                        var botToUpdate = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>.FirstOrDefault(bot =&gt; bot.Id == connectionId);</div>
<div class="line"><span class="lineno">  219</span>                        <span class="keywordflow">if</span> (botToUpdate != <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  220</span>                            botToUpdate.Channels = newChannels</div>
<div class="line"><span class="lineno">  221</span>                                .Select(apiModel =&gt; <span class="keyword">new</span> Models.ChatChannel</div>
<div class="line"><span class="lineno">  222</span>                                {</div>
<div class="line"><span class="lineno">  223</span>                                    DiscordChannelId = apiModel.DiscordChannelId,</div>
<div class="line"><span class="lineno">  224</span>                                    IrcChannel = apiModel.IrcChannel,</div>
<div class="line"><span class="lineno">  225</span>                                    IsAdminChannel = apiModel.IsAdminChannel,</div>
<div class="line"><span class="lineno">  226</span>                                    IsUpdatesChannel = apiModel.IsUpdatesChannel,</div>
<div class="line"><span class="lineno">  227</span>                                    IsSystemChannel = apiModel.IsSystemChannel,</div>
<div class="line"><span class="lineno">  228</span>                                    IsWatchdogChannel = apiModel.IsWatchdogChannel,</div>
<div class="line"><span class="lineno">  229</span>                                    Tag = apiModel.Tag,</div>
<div class="line"><span class="lineno">  230</span>                                })</div>
<div class="line"><span class="lineno">  231</span>                                .ToList();</div>
<div class="line"><span class="lineno">  232</span>                    }</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>                    var newMappings = results.SelectMany(</div>
<div class="line"><span class="lineno">  235</span>                        kvp =&gt; kvp.Value.Select(</div>
<div class="line"><span class="lineno">  236</span>                            channelRepresentation =&gt; <span class="keyword">new</span> ChannelMapping(channelRepresentation)</div>
<div class="line"><span class="lineno">  237</span>                            {</div>
<div class="line"><span class="lineno">  238</span>                                IsWatchdogChannel = kvp.Key.IsWatchdogChannel == <span class="keyword">true</span>,</div>
<div class="line"><span class="lineno">  239</span>                                IsUpdatesChannel = kvp.Key.IsUpdatesChannel == <span class="keyword">true</span>,</div>
<div class="line"><span class="lineno">  240</span>                                IsAdminChannel = kvp.Key.IsAdminChannel == <span class="keyword">true</span>,</div>
<div class="line"><span class="lineno">  241</span>                                IsSystemChannel = kvp.Key.IsSystemChannel == <span class="keyword">true</span>,</div>
<div class="line"><span class="lineno">  242</span>                                ProviderChannelId = channelRepresentation.RealId,</div>
<div class="line"><span class="lineno">  243</span>                                ProviderId = connectionId,</div>
<div class="line"><span class="lineno">  244</span>                            }));</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>                    ulong baseId;</div>
<div class="line"><span class="lineno">  247</span>                    lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a1ac2daf67a09f128290588a5181c88ba">synchronizationLock</a>)</div>
<div class="line"><span class="lineno">  248</span>                    {</div>
<div class="line"><span class="lineno">  249</span>                        baseId = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a9f8c4d78e74aa61eb4aaa13cc1a88bbf">channelIdCounter</a>;</div>
<div class="line"><span class="lineno">  250</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a9f8c4d78e74aa61eb4aaa13cc1a88bbf">channelIdCounter</a> += (ulong)results.Count;</div>
<div class="line"><span class="lineno">  251</span>                    }</div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>                    lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>)</div>
<div class="line"><span class="lineno">  254</span>                    {</div>
<div class="line"><span class="lineno">  255</span>                        lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>)</div>
<div class="line"><span class="lineno">  256</span>                            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>.TryGetValue(connectionId, out var verify) || verify != provider) <span class="comment">// aborted again</span></div>
<div class="line"><span class="lineno">  257</span>                                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  258</span>                        <span class="keywordflow">foreach</span> (var newMapping <span class="keywordflow">in</span> newMappings)</div>
<div class="line"><span class="lineno">  259</span>                        {</div>
<div class="line"><span class="lineno">  260</span>                            var newId = baseId++;</div>
<div class="line"><span class="lineno">  261</span>                            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Mapping channel {connectionName}:{channelFriendlyName} as {newId}&quot;</span>, newMapping.Channel.ConnectionName, newMapping.Channel.FriendlyName, newId);</div>
<div class="line"><span class="lineno">  262</span>                            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Add(newId, newMapping);</div>
<div class="line"><span class="lineno">  263</span>                            newMapping.Channel.RealId = newId;</div>
<div class="line"><span class="lineno">  264</span>                        }</div>
<div class="line"><span class="lineno">  265</span>                    }</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span>                    <span class="comment">// we only want to update contexts if everything at startup has connected once already</span></div>
<div class="line"><span class="lineno">  268</span>                    <span class="comment">// otherwise we could send an incomplete channel set to the DMAPI, which will then spout all its queued messages into it instead of all relevant chatbots</span></div>
<div class="line"><span class="lineno">  269</span>                    <span class="comment">// The watchdog can call this if it needs to after starting up</span></div>
<div class="line"><span class="lineno">  270</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a2cd00fcaf7dd3fe543c97bb315bd1837">initialProviderConnectionsTask</a>!.IsCompleted)</div>
<div class="line"><span class="lineno">  271</span>                        await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae2f686caab499a7d4ff36174d99a81e7">UpdateTrackingContexts</a>(cancellationToken);</div>
<div class="line"><span class="lineno">  272</span>                }</div>
<div class="line"><span class="lineno">  273</span>                <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno">  274</span>                {</div>
<div class="line"><span class="lineno">  275</span>                    provider.InitialMappingComplete();</div>
<div class="line"><span class="lineno">  276</span>                }</div>
<div class="line"><span class="lineno">  277</span>            }</div>
<div class="line"><span class="lineno">  278</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a2cd00fcaf7dd3fe543c97bb315bd1837"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a2cd00fcaf7dd3fe543c97bb315bd1837">Tgstation.Server.Host.Components.Chat.ChatManager.initialProviderConnectionsTask</a></div><div class="ttdeci">Task? initialProviderConnectionsTask</div><div class="ttdoc">A Task that represents the IProviders initial connection.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00113">ChatManager.cs:113</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_ae2f686caab499a7d4ff36174d99a81e7"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae2f686caab499a7d4ff36174d99a81e7">Tgstation.Server.Host.Components.Chat.ChatManager.UpdateTrackingContexts</a></div><div class="ttdeci">async ValueTask UpdateTrackingContexts(CancellationToken cancellationToken)</div><div class="ttdoc">Force an update with the active channels on all active IChatTrackingContexts.A ValueTask representing...</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00518">ChatManager.cs:518</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_af46a3f4845f2190ea2c22af33e233c31"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af46a3f4845f2190ea2c22af33e233c31">Tgstation.Server.Host.Components.Chat.ChatManager.RemoveProviderChannels</a></div><div class="ttdeci">async ValueTask&lt; IProvider?&gt; RemoveProviderChannels(long connectionId, bool removeProvider, CancellationToken cancellationToken)</div><div class="ttdoc">Remove a IProvider from mappedChannels optionally removing the provider itself from providers and upd...</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00622">ChatManager.cs:622</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html">Tgstation.Server.Host.Utils.SemaphoreSlimContext</a></div><div class="ttdoc">Async lock context helper.</div><div class="ttdef"><b>Definition</b> <a href="_semaphore_slim_context_8cs_source.html#l00012">SemaphoreSlimContext.cs:13</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context_html_abeb1f086e2752f6f9a4d3d175a4392af"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html#abeb1f086e2752f6f9a4d3d175a4392af">Tgstation.Server.Host.Utils.SemaphoreSlimContext.Lock</a></div><div class="ttdeci">static async ValueTask&lt; SemaphoreSlimContext &gt; Lock(SemaphoreSlim semaphore, CancellationToken cancellationToken, ILogger? logger=null)</div><div class="ttdoc">Asyncronously locks a semaphore .</div><div class="ttdef"><b>Definition</b> <a href="_semaphore_slim_context_8cs_source.html#l00021">SemaphoreSlimContext.cs:21</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_chat_manager_8cs_source.html#l00088">Tgstation.Server.Host.Components.Chat.ChatManager.activeChatBots</a>, <a class="el" href="_chat_manager_8cs_source.html#l00073">Tgstation.Server.Host.Components.Chat.ChatManager.changeChannelSemaphores</a>, <a class="el" href="_chat_manager_8cs_source.html#l00128">Tgstation.Server.Host.Components.Chat.ChatManager.channelIdCounter</a>, <a class="el" href="_chat_manager_8cs_source.html#l00113">Tgstation.Server.Host.Components.Chat.ChatManager.initialProviderConnectionsTask</a>, <a class="el" href="_semaphore_slim_context_8cs_source.html#l00021">Tgstation.Server.Host.Utils.SemaphoreSlimContext.Lock()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00058">Tgstation.Server.Host.Components.Chat.ChatManager.logger</a>, <a class="el" href="_chat_manager_8cs_source.html#l00078">Tgstation.Server.Host.Components.Chat.ChatManager.mappedChannels</a>, <a class="el" href="_chat_manager_8cs_source.html#l00068">Tgstation.Server.Host.Components.Chat.ChatManager.providers</a>, <a class="el" href="_chat_manager_8cs_source.html#l00622">Tgstation.Server.Host.Components.Chat.ChatManager.RemoveProviderChannels()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00098">Tgstation.Server.Host.Components.Chat.ChatManager.synchronizationLock</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00518">Tgstation.Server.Host.Components.Chat.ChatManager.UpdateTrackingContexts()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a627c57e5a0a6cc6f52a9f7f09cfa5694_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a627c57e5a0a6cc6f52a9f7f09cfa5694_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a627c57e5a0a6cc6f52a9f7f09cfa5694_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a627c57e5a0a6cc6f52a9f7f09cfa5694_cgraph">
<area shape="rect" title=" " alt="" coords="5,71,235,111"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html#abeb1f086e2752f6f9a4d3d175a4392af" title="Asyncronously locks a semaphore ." alt="" coords="329,5,518,46"/>
<area shape="poly" title=" " alt="" coords="217,67,313,47,314,52,218,73"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af46a3f4845f2190ea2c22af33e233c31" title="Remove a IProvider from mappedChannels optionally removing the provider itself from providers and upd..." alt="" coords="283,71,564,111"/>
<area shape="poly" title=" " alt="" coords="235,88,267,88,267,94,235,94"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae2f686caab499a7d4ff36174d99a81e7" title="Force an update with the active channels on all active IChatTrackingContexts.A ValueTask representing..." alt="" coords="286,137,561,178"/>
<area shape="poly" title=" " alt="" coords="216,109,313,131,312,136,215,115"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3" title="Fully await a given list of tasks ." alt="" coords="618,61,833,116"/>
<area shape="poly" title=" " alt="" coords="564,87,602,87,602,92,564,92"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_channel_sink.html#a0a3e498cc9efaf16adabea814bdae5b7" title="Called when newChannels &#160;are set." alt="" coords="612,140,839,181"/>
<area shape="poly" title=" " alt="" coords="561,156,596,157,596,162,561,162"/>
</map>
</div>

</div>
</div>
<a id="a8d3eb0ce3398090f2f26241f515845fb" name="a8d3eb0ce3398090f2f26241f515845fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d3eb0ce3398090f2f26241f515845fb">&#9670;&#160;</a></span>ChangeSettings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async ValueTask Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_bot.html">Models::ChatBot</a>&#160;</td>
          <td class="paramname"><em>newSettings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Change chat settings. If the <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">Api.Models.EntityId.Id</a> is not currently in use, a new connection will be made instead.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newSettings</td><td>The new <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_bot.html">Models.ChatBot</a>.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask representing the running operation. Will complete immediately if the <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_internal_1_1_chat_bot_settings.html#a6579e1e95a99c1d53c90eb3142a12421" title="If the connection is enabled.">ChatBotSettings.Enabled</a> property of <em>newSettings</em>  is <code><a class="el" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers.html#af4b5f6ad734602f75d059267687ca3dd">false</a></code>.</dd></dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#ad6def737362e62bcf63b35d772b01d50">Tgstation.Server.Host.Components.Chat.IChatManager</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00281">281</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  282</span>        {</div>
<div class="line"><span class="lineno">  283</span>            ArgumentNullException.ThrowIfNull(newSettings);</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;ChangeSettings...&quot;</span>);</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>            Task disconnectTask;</div>
<div class="line"><span class="lineno">  288</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a>? provider = <span class="keyword">null</span>;</div>
<div class="line"><span class="lineno">  289</span>            var newSettingsId = Models.ModelExtensions.Require(newSettings, x =&gt; x.Id);</div>
<div class="line"><span class="lineno">  290</span>            var newSettingsEnabled = Models.ModelExtensions.Require(newSettings, x =&gt; x.Enabled);</div>
<div class="line"><span class="lineno">  291</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>)</div>
<div class="line"><span class="lineno">  292</span>            {</div>
<div class="line"><span class="lineno">  293</span>                <span class="comment">// raw settings changes forces a rebuild of the provider</span></div>
<div class="line"><span class="lineno">  294</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>.ContainsKey(newSettingsId))</div>
<div class="line"><span class="lineno">  295</span>                    disconnectTask = <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae8f42e9fc59f0aa9d70de26a4b6600b7">DeleteConnection</a>(newSettingsId, cancellationToken);</div>
<div class="line"><span class="lineno">  296</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  297</span>                    disconnectTask = Task.CompletedTask;</div>
<div class="line"><span class="lineno">  298</span>                <span class="keywordflow">if</span> (newSettingsEnabled)</div>
<div class="line"><span class="lineno">  299</span>                {</div>
<div class="line"><span class="lineno">  300</span>                    provider = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a13f4e387e7b5419193b74e1ae3cd0fb5">providerFactory</a>.<a class="code hl_function" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html#a4250fc0dc09258c391507fbf29977758">CreateProvider</a>(newSettings);</div>
<div class="line"><span class="lineno">  301</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>.Add(newSettingsId, provider);</div>
<div class="line"><span class="lineno">  302</span>                }</div>
<div class="line"><span class="lineno">  303</span>            }</div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>)</div>
<div class="line"><span class="lineno">  306</span>                <span class="keywordflow">foreach</span> (var oldMappedChannelId <span class="keywordflow">in</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Where(x =&gt; x.Value.ProviderId == newSettingsId).Select(x =&gt; x.Key).ToList())</div>
<div class="line"><span class="lineno">  307</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Remove(oldMappedChannelId);</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>            await disconnectTask;</div>
<div class="line"><span class="lineno">  310</span> </div>
<div class="line"><span class="lineno">  311</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a1ac2daf67a09f128290588a5181c88ba">synchronizationLock</a>)</div>
<div class="line"><span class="lineno">  312</span>            {</div>
<div class="line"><span class="lineno">  313</span>                <span class="comment">// same thread shennanigans</span></div>
<div class="line"><span class="lineno">  314</span>                var oldOne = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae24bfda149bf5a3080399529e7ef299c">connectionsUpdated</a>;</div>
<div class="line"><span class="lineno">  315</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae24bfda149bf5a3080399529e7ef299c">connectionsUpdated</a> = <span class="keyword">new</span> TaskCompletionSource();</div>
<div class="line"><span class="lineno">  316</span>                oldOne.SetResult();</div>
<div class="line"><span class="lineno">  317</span>            }</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>            var reconnectionUpdateTask = provider?.<a class="code hl_function" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html#a8f13abd1df7147c47d6d1a8e4577b9e6">SetReconnectInterval</a>(</div>
<div class="line"><span class="lineno">  320</span>                Models.ModelExtensions.Require(newSettings, x =&gt; x.ReconnectionInterval),</div>
<div class="line"><span class="lineno">  321</span>                newSettingsEnabled)</div>
<div class="line"><span class="lineno">  322</span>                ?? Task.CompletedTask;</div>
<div class="line"><span class="lineno">  323</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>)</div>
<div class="line"><span class="lineno">  324</span>            {</div>
<div class="line"><span class="lineno">  325</span>                var originalChatBot = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>.FirstOrDefault(bot =&gt; bot.Id == newSettings.Id);</div>
<div class="line"><span class="lineno">  326</span>                <span class="keywordflow">if</span> (originalChatBot != <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  327</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>.Remove(originalChatBot);</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>.Add(<span class="keyword">new</span> Models.ChatBot(newSettings.Channels)</div>
<div class="line"><span class="lineno">  330</span>                {</div>
<div class="line"><span class="lineno">  331</span>                    Id = newSettings.Id,</div>
<div class="line"><span class="lineno">  332</span>                    ConnectionString = newSettings.ConnectionString,</div>
<div class="line"><span class="lineno">  333</span>                    Enabled = newSettings.Enabled,</div>
<div class="line"><span class="lineno">  334</span>                    Name = newSettings.Name,</div>
<div class="line"><span class="lineno">  335</span>                    ReconnectionInterval = newSettings.ReconnectionInterval,</div>
<div class="line"><span class="lineno">  336</span>                    Provider = newSettings.Provider,</div>
<div class="line"><span class="lineno">  337</span>                });</div>
<div class="line"><span class="lineno">  338</span>            }</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>            await reconnectionUpdateTask;</div>
<div class="line"><span class="lineno">  341</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_ae8f42e9fc59f0aa9d70de26a4b6600b7"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae8f42e9fc59f0aa9d70de26a4b6600b7">Tgstation.Server.Host.Components.Chat.ChatManager.DeleteConnection</a></div><div class="ttdeci">async Task DeleteConnection(long connectionId, CancellationToken cancellationToken)</div><div class="ttdoc">Disconnects and deletes a given connection.A Task representing the running operation.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00558">ChatManager.cs:558</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory_html_a4250fc0dc09258c391507fbf29977758"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html#a4250fc0dc09258c391507fbf29977758">Tgstation.Server.Host.Components.Chat.Providers.IProviderFactory.CreateProvider</a></div><div class="ttdeci">IProvider CreateProvider(ChatBot settings)</div><div class="ttdoc">Create a IProvider.</div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">Tgstation.Server.Host.Components.Chat.Providers.IProvider</a></div><div class="ttdoc">For interacting with a chat service.</div><div class="ttdef"><b>Definition</b> <a href="_i_provider_8cs_source.html#l00015">IProvider.cs:16</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_html_a8f13abd1df7147c47d6d1a8e4577b9e6"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html#a8f13abd1df7147c47d6d1a8e4577b9e6">Tgstation.Server.Host.Components.Chat.Providers.IProvider.SetReconnectInterval</a></div><div class="ttdeci">Task SetReconnectInterval(uint reconnectInterval, bool connectNow)</div><div class="ttdoc">Set the interval at which the provider starts jobs to try to reconnect.</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_chat_manager_8cs_source.html#l00088">Tgstation.Server.Host.Components.Chat.ChatManager.activeChatBots</a>, <a class="el" href="_chat_manager_8cs_source.html#l00123">Tgstation.Server.Host.Components.Chat.ChatManager.connectionsUpdated</a>, <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html#a4250fc0dc09258c391507fbf29977758">Tgstation.Server.Host.Components.Chat.Providers.IProviderFactory.CreateProvider()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00558">Tgstation.Server.Host.Components.Chat.ChatManager.DeleteConnection()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00058">Tgstation.Server.Host.Components.Chat.ChatManager.logger</a>, <a class="el" href="_chat_manager_8cs_source.html#l00078">Tgstation.Server.Host.Components.Chat.ChatManager.mappedChannels</a>, <a class="el" href="_chat_manager_8cs_source.html#l00038">Tgstation.Server.Host.Components.Chat.ChatManager.providerFactory</a>, <a class="el" href="_chat_manager_8cs_source.html#l00068">Tgstation.Server.Host.Components.Chat.ChatManager.providers</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00098">Tgstation.Server.Host.Components.Chat.ChatManager.synchronizationLock</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a8d3eb0ce3398090f2f26241f515845fb_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a8d3eb0ce3398090f2f26241f515845fb_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a8d3eb0ce3398090f2f26241f515845fb_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a8d3eb0ce3398090f2f26241f515845fb_cgraph">
<area shape="rect" title="Change chat settings. If the Api.Models.EntityId.Id is not currently in use, a new connection will be..." alt="" coords="5,49,232,90"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html#a4250fc0dc09258c391507fbf29977758" title="Create a IProvider." alt="" coords="280,5,525,61"/>
<area shape="poly" title=" " alt="" coords="232,52,264,48,264,53,233,57"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae8f42e9fc59f0aa9d70de26a4b6600b7" title="Disconnects and deletes a given connection.A Task representing the running operation." alt="" coords="286,85,519,126"/>
<area shape="poly" title=" " alt="" coords="233,81,271,86,270,91,232,86"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html#abeb1f086e2752f6f9a4d3d175a4392af" title="Asyncronously locks a semaphore ." alt="" coords="573,85,762,126"/>
<area shape="poly" title=" " alt="" coords="520,103,558,103,558,108,520,108"/>
</map>
</div>

</div>
</div>
<a id="aadf2ea0ffdbf567ac24cc5c45f6f66b6" name="aadf2ea0ffdbf567ac24cc5c45f6f66b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadf2ea0ffdbf567ac24cc5c45f6f66b6">&#9670;&#160;</a></span>CreateTrackingContext()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_tracking_context.html">IChatTrackingContext</a> Tgstation.Server.Host.Components.Chat.ChatManager.CreateTrackingContext </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start tracking <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_custom_command.html" title="Represents a command made from DM code.">Commands.CustomCommand</a>s and <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_channel_representation.html" title="Represents a Providers.IProvider channel.">ChannelRepresentation</a>s.<dl class="section return"><dt>Returns</dt><dd>A new <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_tracking_context.html" title="Represents a tracking of dynamic chat json files.">IChatTrackingContext</a>.</dd></dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#a5b3b4e9ab7d03bd8020ee9dfa9bebbbe">Tgstation.Server.Host.Components.Chat.IChatManager</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00494">494</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  495</span>        {</div>
<div class="line"><span class="lineno">  496</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a537b7a1db9aa8fab1de0dfb4587b2b3b">customCommandHandler</a> == <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  497</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="stringliteral">&quot;RegisterCommandHandler() hasn&#39;t been called!&quot;</span>);</div>
<div class="line"><span class="lineno">  498</span> </div>
<div class="line"><span class="lineno">  499</span>            IChatTrackingContext context = <span class="keyword">null</span>!;</div>
<div class="line"><span class="lineno">  500</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>)</div>
<div class="line"><span class="lineno">  501</span>                context = <span class="keyword">new</span> ChatTrackingContext(</div>
<div class="line"><span class="lineno">  502</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a537b7a1db9aa8fab1de0dfb4587b2b3b">customCommandHandler</a>,</div>
<div class="line"><span class="lineno">  503</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Select(y =&gt; y.Value.Channel),</div>
<div class="line"><span class="lineno">  504</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a76009f2ea5bcdd632cd599fc3857ac96">loggerFactory</a>.CreateLogger&lt;ChatTrackingContext&gt;(),</div>
<div class="line"><span class="lineno">  505</span>                    () =&gt;</div>
<div class="line"><span class="lineno">  506</span>                    {</div>
<div class="line"><span class="lineno">  507</span>                        lock (trackingContexts)</div>
<div class="line"><span class="lineno">  508</span>                            trackingContexts.Remove(context);</div>
<div class="line"><span class="lineno">  509</span>                    });</div>
<div class="line"><span class="lineno">  510</span> </div>
<div class="line"><span class="lineno">  511</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a>)</div>
<div class="line"><span class="lineno">  512</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a>.Add(context);</div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span>            <span class="keywordflow">return</span> context;</div>
<div class="line"><span class="lineno">  515</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a537b7a1db9aa8fab1de0dfb4587b2b3b"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a537b7a1db9aa8fab1de0dfb4587b2b3b">Tgstation.Server.Host.Components.Chat.ChatManager.customCommandHandler</a></div><div class="ttdeci">ICustomCommandHandler? customCommandHandler</div><div class="ttdoc">The ICustomCommandHandler for the ChangeChannels(long, IEnumerable&lt;Models.ChatChannel&gt;,...</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00103">ChatManager.cs:103</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8f42e9fc59f0aa9d70de26a4b6600b7" name="ae8f42e9fc59f0aa9d70de26a4b6600b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8f42e9fc59f0aa9d70de26a4b6600b7">&#9670;&#160;</a></span>DeleteConnection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async Task Tgstation.Server.Host.Components.Chat.ChatManager.DeleteConnection </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>connectionId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disconnects and deletes a given connection.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connectionId</td><td>The <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">Api.Models.EntityId.Id</a> of the connection.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task representing the running operation.</dd></dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#a1593d7d3f8d4b3efe3412d6c96f6e411">Tgstation.Server.Host.Components.Chat.IChatManager</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00558">558</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  559</span>        {</div>
<div class="line"><span class="lineno">  560</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;DeleteConnection {connectionId}&quot;</span>, connectionId);</div>
<div class="line"><span class="lineno">  561</span>            var hasSemaphore = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abef5c8cc20c6ed55f7393272cc5e5cbe">changeChannelSemaphores</a>.TryRemove(connectionId, out var semaphore);</div>
<div class="line"><span class="lineno">  562</span>            <span class="keyword">using</span> (hasSemaphore</div>
<div class="line"><span class="lineno">  563</span>                ? semaphore</div>
<div class="line"><span class="lineno">  564</span>                : <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  565</span>            <span class="keyword">using</span> (hasSemaphore</div>
<div class="line"><span class="lineno">  566</span>                ? await <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html">SemaphoreSlimContext</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html#abeb1f086e2752f6f9a4d3d175a4392af">Lock</a>(semaphore!, cancellationToken)</div>
<div class="line"><span class="lineno">  567</span>                : <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  568</span>            {</div>
<div class="line"><span class="lineno">  569</span>                var provider = await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af46a3f4845f2190ea2c22af33e233c31">RemoveProviderChannels</a>(connectionId, <span class="keyword">true</span>, cancellationToken);</div>
<div class="line"><span class="lineno">  570</span>                <span class="keywordflow">if</span> (provider != <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  571</span>                {</div>
<div class="line"><span class="lineno">  572</span>                    var startTime = DateTimeOffset.UtcNow;</div>
<div class="line"><span class="lineno">  573</span>                    <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  574</span>                    {</div>
<div class="line"><span class="lineno">  575</span>                        await provider.Disconnect(cancellationToken);</div>
<div class="line"><span class="lineno">  576</span>                    }</div>
<div class="line"><span class="lineno">  577</span>                    <span class="keywordflow">catch</span> (<a class="code hl_class" href="class_exception.html">Exception</a> ex)</div>
<div class="line"><span class="lineno">  578</span>                    {</div>
<div class="line"><span class="lineno">  579</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogError(ex, <span class="stringliteral">&quot;Error disconnecting connection {connectionId}!&quot;</span>, connectionId);</div>
<div class="line"><span class="lineno">  580</span>                    }</div>
<div class="line"><span class="lineno">  581</span> </div>
<div class="line"><span class="lineno">  582</span>                    await provider.DisposeAsync();</div>
<div class="line"><span class="lineno">  583</span>                    var duration = DateTimeOffset.UtcNow - startTime;</div>
<div class="line"><span class="lineno">  584</span>                    <span class="keywordflow">if</span> (duration.TotalSeconds &gt; 3)</div>
<div class="line"><span class="lineno">  585</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogWarning(<span class="stringliteral">&quot;Disconnecting a {providerType} took {totalSeconds}s!&quot;</span>, provider.GetType().Name, duration.TotalSeconds);</div>
<div class="line"><span class="lineno">  586</span>                }</div>
<div class="line"><span class="lineno">  587</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  588</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;DeleteConnection: ID {connectionId} doesn&#39;t exist!&quot;</span>, connectionId);</div>
<div class="line"><span class="lineno">  589</span>            }</div>
<div class="line"><span class="lineno">  590</span>        }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_semaphore_slim_context_8cs_source.html#l00021">Tgstation.Server.Host.Utils.SemaphoreSlimContext.Lock()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00281">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae8f42e9fc59f0aa9d70de26a4b6600b7_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae8f42e9fc59f0aa9d70de26a4b6600b7_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae8f42e9fc59f0aa9d70de26a4b6600b7_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae8f42e9fc59f0aa9d70de26a4b6600b7_cgraph">
<area shape="rect" title="Disconnects and deletes a given connection.A Task representing the running operation." alt="" coords="5,5,239,46"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_semaphore_slim_context.html#abeb1f086e2752f6f9a4d3d175a4392af" title="Asyncronously locks a semaphore ." alt="" coords="287,5,476,46"/>
<area shape="poly" title=" " alt="" coords="239,23,271,23,271,28,239,28"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae8f42e9fc59f0aa9d70de26a4b6600b7_icgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae8f42e9fc59f0aa9d70de26a4b6600b7_icgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae8f42e9fc59f0aa9d70de26a4b6600b7_icgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae8f42e9fc59f0aa9d70de26a4b6600b7_icgraph">
<area shape="rect" title="Disconnects and deletes a given connection.A Task representing the running operation." alt="" coords="280,5,513,46"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8d3eb0ce3398090f2f26241f515845fb" title="Change chat settings. If the Api.Models.EntityId.Id is not currently in use, a new connection will be..." alt="" coords="5,5,232,46"/>
<area shape="poly" title=" " alt="" coords="264,28,232,28,232,23,264,23"/>
</map>
</div>

</div>
</div>
<a id="ac0bd122a06d9a590adc983b3aedc7417" name="ac0bd122a06d9a590adc983b3aedc7417"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0bd122a06d9a590adc983b3aedc7417">&#9670;&#160;</a></span>DisposeAsync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async ValueTask Tgstation.Server.Host.Components.Chat.ChatManager.DisposeAsync </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p></p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00176">176</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  177</span>        {</div>
<div class="line"><span class="lineno">  178</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Disposing...&quot;</span>);</div>
<div class="line"><span class="lineno">  179</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ac3dec357800cfc9a526c82d61fe99803">restartRegistration</a>.Dispose();</div>
<div class="line"><span class="lineno">  180</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#adc4749cb2a207e472c9fac07cf56e981">handlerCts</a>.Dispose();</div>
<div class="line"><span class="lineno">  181</span>            <span class="keywordflow">foreach</span> (var providerKvp <span class="keywordflow">in</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>)</div>
<div class="line"><span class="lineno">  182</span>                await providerKvp.Value.DisposeAsync();</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>            <span class="keywordflow">foreach</span> (var providerKvp <span class="keywordflow">in</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abef5c8cc20c6ed55f7393272cc5e5cbe">changeChannelSemaphores</a>)</div>
<div class="line"><span class="lineno">  185</span>                providerKvp.Value.Dispose();</div>
<div class="line"><span class="lineno">  186</span> </div>
<div class="line"><span class="lineno">  187</span>            await <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8537715fb809f78e49b1497bcd82849e">messageSendTask</a>;</div>
<div class="line"><span class="lineno">  188</span>        }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_chat_manager_8cs_source.html#l00073">Tgstation.Server.Host.Components.Chat.ChatManager.changeChannelSemaphores</a>, <a class="el" href="_chat_manager_8cs_source.html#l00093">Tgstation.Server.Host.Components.Chat.ChatManager.handlerCts</a>, <a class="el" href="_chat_manager_8cs_source.html#l00058">Tgstation.Server.Host.Components.Chat.ChatManager.logger</a>, <a class="el" href="_chat_manager_8cs_source.html#l00118">Tgstation.Server.Host.Components.Chat.ChatManager.messageSendTask</a>, <a class="el" href="_chat_manager_8cs_source.html#l00068">Tgstation.Server.Host.Components.Chat.ChatManager.providers</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00048">Tgstation.Server.Host.Components.Chat.ChatManager.restartRegistration</a>.</p>

</div>
</div>
<a id="a3042b37389548f8b8a969bdd7128a783" name="a3042b37389548f8b8a969bdd7128a783"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3042b37389548f8b8a969bdd7128a783">&#9670;&#160;</a></span>HandleRestart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ValueTask Tgstation.Server.Host.Components.Chat.ChatManager.HandleRestart </td>
          <td>(</td>
          <td class="paramtype">Version?&#160;</td>
          <td class="paramname"><em>updateVersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>handlerMayDelayShutdownWithExtremelyLongRunningTasks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle a restart of the server.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">updateVersion</td><td>The Version being updated to, <code>null</code> if not being changed.</td></tr>
    <tr><td class="paramname">handlerMayDelayShutdownWithExtremelyLongRunningTasks</td><td>If <code><a class="el" href="namespace_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers.html#af4b5f6ad734602f75d059267687ca3dd">false</a></code> the <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_restart_handler.html" title="Handler for server restarts.">IRestartHandler</a> should aim to complete the Task returned from this function ASAP.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask representing the running operation.</dd></dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_restart_handler.html#a876fb70e47b6d6c39d7016b0b77d5f75">Tgstation.Server.Host.Core.IRestartHandler</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00593">593</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  594</span>        {</div>
<div class="line"><span class="lineno">  595</span>            var message = updateVersion == <span class="keyword">null</span></div>
<div class="line"><span class="lineno">  596</span>                ? $<span class="stringliteral">&quot;TGS: {(handlerMayDelayShutdownWithExtremelyLongRunningTasks ? &quot;</span>Graceful shutdown<span class="stringliteral">&quot; : &quot;</span>Going down<span class="stringliteral">&quot;)}...&quot;</span></div>
<div class="line"><span class="lineno">  597</span>                : $<span class="stringliteral">&quot;TGS: Updating to version {updateVersion}...&quot;</span>;</div>
<div class="line"><span class="lineno">  598</span>            List&lt;ulong&gt; systemChannels;</div>
<div class="line"><span class="lineno">  599</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>) <span class="comment">// so it doesn&#39;t change while we&#39;re using it</span></div>
<div class="line"><span class="lineno">  600</span>                systemChannels = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a></div>
<div class="line"><span class="lineno">  601</span>                    .Where(x =&gt; x.Value.IsSystemChannel)</div>
<div class="line"><span class="lineno">  602</span>                    .Select(x =&gt; x.Key)</div>
<div class="line"><span class="lineno">  603</span>                    .ToList();</div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a14df10dd6677ff9fbf9d9d3bdc05c99f">SendMessage</a>(</div>
<div class="line"><span class="lineno">  606</span>                systemChannels,</div>
<div class="line"><span class="lineno">  607</span>                <span class="keyword">null</span>,</div>
<div class="line"><span class="lineno">  608</span>                <span class="keyword">new</span> <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a></div>
<div class="line"><span class="lineno">  609</span>                {</div>
<div class="line"><span class="lineno">  610</span>                    Text = message,</div>
<div class="line"><span class="lineno">  611</span>                },</div>
<div class="line"><span class="lineno">  612</span>                cancellationToken);</div>
<div class="line"><span class="lineno">  613</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a14df10dd6677ff9fbf9d9d3bdc05c99f"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a14df10dd6677ff9fbf9d9d3bdc05c99f">Tgstation.Server.Host.Components.Chat.ChatManager.SendMessage</a></div><div class="ttdeci">ValueTask SendMessage(IEnumerable&lt; ulong &gt; channelIds, Message? replyTo, MessageContent message, CancellationToken cancellationToken)</div><div class="ttdoc">Asynchronously send a given message  to a set of channelIds .</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l01026">ChatManager.cs:1026</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">Tgstation.Server.Host.Components.Interop.MessageContent</a></div><div class="ttdoc">Represents a message to send to a chat provider.</div><div class="ttdef"><b>Definition</b> <a href="_message_content_8cs_source.html#l00006">MessageContent.cs:7</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a422e8e55e6988c994b23eaaf16cf0498" name="a422e8e55e6988c994b23eaaf16cf0498"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a422e8e55e6988c994b23eaaf16cf0498">&#9670;&#160;</a></span>InitialConnection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task Tgstation.Server.Host.Components.Chat.ChatManager.InitialConnection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Aggregate all <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html#a98843a608252fa92e550215f3097e51e" title="A Task that completes once the IProvider finishes it&#39;s first connection attempt regardless of success...">IProvider.InitialConnectionJob</a>s into one &lt;sse cref="Task"&gt;. </p>
<dl class="section return"><dt>Returns</dt><dd>A Task representing the running operation.</dd></dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l01058">1058</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1059</span>        {</div>
<div class="line"><span class="lineno"> 1060</span>            await Task.WhenAll(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>.Select(x =&gt; x.Value.InitialConnectionJob));</div>
<div class="line"><span class="lineno"> 1061</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Initial provider connection task completed&quot;</span>);</div>
<div class="line"><span class="lineno"> 1062</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a530e8ef5a58711a9c6744021df74afb2" name="a530e8ef5a58711a9c6744021df74afb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a530e8ef5a58711a9c6744021df74afb2">&#9670;&#160;</a></span>MonitorMessages()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task Tgstation.Server.Host.Components.Chat.ChatManager.MonitorMessages </td>
          <td>(</td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Monitors active providers for new Messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task representing the running operation.</dd></dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00933">933</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  934</span>        {</div>
<div class="line"><span class="lineno">  935</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Starting processing loop...&quot;</span>);</div>
<div class="line"><span class="lineno">  936</span>            var messageTasks = <span class="keyword">new</span> Dictionary&lt;IProvider, Task&lt;Message?&gt;&gt;();</div>
<div class="line"><span class="lineno">  937</span>            ValueTask activeProcessingTask = ValueTask.CompletedTask;</div>
<div class="line"><span class="lineno">  938</span>            <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  939</span>            {</div>
<div class="line"><span class="lineno">  940</span>                Task? updatedTask = <span class="keyword">null</span>;</div>
<div class="line"><span class="lineno">  941</span>                <span class="keywordflow">while</span> (!cancellationToken.IsCancellationRequested)</div>
<div class="line"><span class="lineno">  942</span>                {</div>
<div class="line"><span class="lineno">  943</span>                    <span class="keywordflow">if</span> (updatedTask?.IsCompleted != <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">  944</span>                        lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a1ac2daf67a09f128290588a5181c88ba">synchronizationLock</a>)</div>
<div class="line"><span class="lineno">  945</span>                            updatedTask = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae24bfda149bf5a3080399529e7ef299c">connectionsUpdated</a>.Task;</div>
<div class="line"><span class="lineno">  946</span> </div>
<div class="line"><span class="lineno">  947</span>                    <span class="comment">// prune disconnected providers</span></div>
<div class="line"><span class="lineno">  948</span>                    <span class="keywordflow">foreach</span> (var disposedProviderMessageTaskKvp <span class="keywordflow">in</span> messageTasks.Where(x =&gt; x.Key.Disposed).ToList())</div>
<div class="line"><span class="lineno">  949</span>                        messageTasks.Remove(disposedProviderMessageTaskKvp.Key);</div>
<div class="line"><span class="lineno">  950</span> </div>
<div class="line"><span class="lineno">  951</span>                    <span class="comment">// add new ones</span></div>
<div class="line"><span class="lineno">  952</span>                    lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>)</div>
<div class="line"><span class="lineno">  953</span>                        <span class="keywordflow">foreach</span> (var providerKvp <span class="keywordflow">in</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>)</div>
<div class="line"><span class="lineno">  954</span>                            <span class="keywordflow">if</span> (!messageTasks.ContainsKey(providerKvp.Value))</div>
<div class="line"><span class="lineno">  955</span>                                messageTasks.Add(</div>
<div class="line"><span class="lineno">  956</span>                                    providerKvp.Value,</div>
<div class="line"><span class="lineno">  957</span>                                    providerKvp.Value.NextMessage(cancellationToken));</div>
<div class="line"><span class="lineno">  958</span> </div>
<div class="line"><span class="lineno">  959</span>                    <span class="keywordflow">if</span> (messageTasks.Count == 0)</div>
<div class="line"><span class="lineno">  960</span>                    {</div>
<div class="line"><span class="lineno">  961</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;No providers active, pausing messsage monitoring...&quot;</span>);</div>
<div class="line"><span class="lineno">  962</span>                        await updatedTask.WaitAsync(cancellationToken);</div>
<div class="line"><span class="lineno">  963</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Resuming message monitoring...&quot;</span>);</div>
<div class="line"><span class="lineno">  964</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  965</span>                    }</div>
<div class="line"><span class="lineno">  966</span> </div>
<div class="line"><span class="lineno">  967</span>                    <span class="comment">// wait for a message</span></div>
<div class="line"><span class="lineno">  968</span>                    await Task.WhenAny(updatedTask, Task.WhenAny(messageTasks.Select(x =&gt; x.Value)));</div>
<div class="line"><span class="lineno">  969</span> </div>
<div class="line"><span class="lineno">  970</span>                    <span class="comment">// process completed ones</span></div>
<div class="line"><span class="lineno">  971</span>                    <span class="keywordflow">foreach</span> (var completedMessageTaskKvp <span class="keywordflow">in</span> messageTasks.Where(x =&gt; x.Value.IsCompleted).ToList())</div>
<div class="line"><span class="lineno">  972</span>                    {</div>
<div class="line"><span class="lineno">  973</span>                        var provider = completedMessageTaskKvp.Key;</div>
<div class="line"><span class="lineno">  974</span>                        messageTasks.Remove(provider);</div>
<div class="line"><span class="lineno">  975</span> </div>
<div class="line"><span class="lineno">  976</span>                        <span class="keywordflow">if</span> (provider.Disposed) <span class="comment">// valid to receive one, but don&#39;t process it</span></div>
<div class="line"><span class="lineno">  977</span>                            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  978</span> </div>
<div class="line"><span class="lineno">  979</span>                        var message = await completedMessageTaskKvp.Value;</div>
<div class="line"><span class="lineno">  980</span>                        var messageNumber = Interlocked.Increment(ref <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a0f90df8e6ed21489cc4b57f690f41c7e">messagesProcessed</a>);</div>
<div class="line"><span class="lineno">  981</span> </div>
<div class="line"><span class="lineno">  982</span>                        async ValueTask WrapProcessMessage()</div>
<div class="line"><span class="lineno">  983</span>                        {</div>
<div class="line"><span class="lineno">  984</span>                            var localActiveProcessingTask = activeProcessingTask;</div>
<div class="line"><span class="lineno">  985</span>                            <span class="keyword">using</span> (LogContext.PushProperty(<a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_serilog_context_helper.html">SerilogContextHelper</a>.<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_serilog_context_helper.html#a0193caaad82bc334ee4d5e1976a556c1">ChatMessageIterationContextProperty</a>, messageNumber))</div>
<div class="line"><span class="lineno">  986</span>                                <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  987</span>                                {</div>
<div class="line"><span class="lineno">  988</span>                                    await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a469bab0c686f2aa640069bae4a1a0055">ProcessMessage</a>(provider, message, <span class="keyword">false</span>, cancellationToken);</div>
<div class="line"><span class="lineno">  989</span>                                }</div>
<div class="line"><span class="lineno">  990</span>                                <span class="keywordflow">catch</span> (<a class="code hl_class" href="class_exception.html">Exception</a> ex)</div>
<div class="line"><span class="lineno">  991</span>                                {</div>
<div class="line"><span class="lineno">  992</span>                                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogError(ex, <span class="stringliteral">&quot;Error processing message {messageNumber}!&quot;</span>, messageNumber);</div>
<div class="line"><span class="lineno">  993</span>                                }</div>
<div class="line"><span class="lineno">  994</span> </div>
<div class="line"><span class="lineno">  995</span>                            await localActiveProcessingTask;</div>
<div class="line"><span class="lineno">  996</span>                        }</div>
<div class="line"><span class="lineno">  997</span> </div>
<div class="line"><span class="lineno">  998</span>                        activeProcessingTask = WrapProcessMessage();</div>
<div class="line"><span class="lineno">  999</span>                    }</div>
<div class="line"><span class="lineno"> 1000</span>                }</div>
<div class="line"><span class="lineno"> 1001</span>            }</div>
<div class="line"><span class="lineno"> 1002</span>            <span class="keywordflow">catch</span> (OperationCanceledException ex)</div>
<div class="line"><span class="lineno"> 1003</span>            {</div>
<div class="line"><span class="lineno"> 1004</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(ex, <span class="stringliteral">&quot;Message processing loop cancelled!&quot;</span>);</div>
<div class="line"><span class="lineno"> 1005</span>            }</div>
<div class="line"><span class="lineno"> 1006</span>            <span class="keywordflow">catch</span> (<a class="code hl_class" href="class_exception.html">Exception</a> e)</div>
<div class="line"><span class="lineno"> 1007</span>            {</div>
<div class="line"><span class="lineno"> 1008</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogError(e, <span class="stringliteral">&quot;Message loop crashed!&quot;</span>);</div>
<div class="line"><span class="lineno"> 1009</span>            }</div>
<div class="line"><span class="lineno"> 1010</span>            <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno"> 1011</span>            {</div>
<div class="line"><span class="lineno"> 1012</span>                await activeProcessingTask;</div>
<div class="line"><span class="lineno"> 1013</span>            }</div>
<div class="line"><span class="lineno"> 1014</span> </div>
<div class="line"><span class="lineno"> 1015</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Leaving message processing loop&quot;</span>);</div>
<div class="line"><span class="lineno"> 1016</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a0f90df8e6ed21489cc4b57f690f41c7e"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a0f90df8e6ed21489cc4b57f690f41c7e">Tgstation.Server.Host.Components.Chat.ChatManager.messagesProcessed</a></div><div class="ttdeci">long messagesProcessed</div><div class="ttdoc">The number of Messages processed.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00133">ChatManager.cs:133</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a469bab0c686f2aa640069bae4a1a0055"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a469bab0c686f2aa640069bae4a1a0055">Tgstation.Server.Host.Components.Chat.ChatManager.ProcessMessage</a></div><div class="ttdeci">async ValueTask ProcessMessage(IProvider provider, Message? message, bool recursed, CancellationToken cancellationToken)</div><div class="ttdoc">Processes a message .</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00688">ChatManager.cs:688</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_utils_1_1_serilog_context_helper_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_serilog_context_helper.html">Tgstation.Server.Host.Utils.SerilogContextHelper</a></div><div class="ttdoc">Helpers for manipulating the Serilog.Context.LogContext.</div><div class="ttdef"><b>Definition</b> <a href="_serilog_context_helper_8cs_source.html#l00006">SerilogContextHelper.cs:7</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_utils_1_1_serilog_context_helper_html_a0193caaad82bc334ee4d5e1976a556c1"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_utils_1_1_serilog_context_helper.html#a0193caaad82bc334ee4d5e1976a556c1">Tgstation.Server.Host.Utils.SerilogContextHelper.ChatMessageIterationContextProperty</a></div><div class="ttdeci">const string ChatMessageIterationContextProperty</div><div class="ttdoc">The Serilog.Context.LogContext property name for the ID of the chat message currently being processed...</div><div class="ttdef"><b>Definition</b> <a href="_serilog_context_helper_8cs_source.html#l00041">SerilogContextHelper.cs:41</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_serilog_context_helper_8cs_source.html#l00041">Tgstation.Server.Host.Utils.SerilogContextHelper.ChatMessageIterationContextProperty</a>.</p>

</div>
</div>
<a id="a469bab0c686f2aa640069bae4a1a0055" name="a469bab0c686f2aa640069bae4a1a0055"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a469bab0c686f2aa640069bae4a1a0055">&#9670;&#160;</a></span>ProcessMessage()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async ValueTask Tgstation.Server.Host.Components.Chat.ChatManager.ProcessMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a>&#160;</td>
          <td class="paramname"><em>provider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_message.html">Message</a>?&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>recursed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Processes a <em>message</em> . </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">provider</td><td>The IProvider who recevied <em>message</em> .</td></tr>
    <tr><td class="paramname">message</td><td>The Message to process. If <code>null</code>, this indicates the provider reconnected.</td></tr>
    <tr><td class="paramname">recursed</td><td>If we are called recursively after remapping the provider.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask representing the running operation.</dd></dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00688">688</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  690</span>        {</div>
<div class="line"><span class="lineno">  691</span>            <span class="keywordflow">if</span> (!provider.<a class="code hl_property" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html#acc07a6bfb2fbb35243aa1e147d92dd87">Connected</a>)</div>
<div class="line"><span class="lineno">  692</span>            {</div>
<div class="line"><span class="lineno">  693</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Abort message processing because provider is disconnected!&quot;</span>);</div>
<div class="line"><span class="lineno">  694</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  695</span>            }</div>
<div class="line"><span class="lineno">  696</span> </div>
<div class="line"><span class="lineno">  697</span>            <span class="comment">// provider reconnected, remap channels.</span></div>
<div class="line"><span class="lineno">  698</span>            <span class="keywordflow">if</span> (message == <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  699</span>            {</div>
<div class="line"><span class="lineno">  700</span>                await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4487a7f0841824a78272233a9f30262c">RemapProvider</a>(provider, cancellationToken);</div>
<div class="line"><span class="lineno">  701</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  702</span>            }</div>
<div class="line"><span class="lineno">  703</span> </div>
<div class="line"><span class="lineno">  704</span>            <span class="comment">// map the channel if it&#39;s private and we haven&#39;t seen it</span></div>
<div class="line"><span class="lineno">  705</span>            var providerChannelId = message.User.Channel.RealId;</div>
<div class="line"><span class="lineno">  706</span>            KeyValuePair&lt;ulong, ChannelMapping&gt;? mappedChannel;</div>
<div class="line"><span class="lineno">  707</span>            <span class="keywordtype">long</span> providerId;</div>
<div class="line"><span class="lineno">  708</span>            <span class="keywordtype">bool</span> hasChannelZero;</div>
<div class="line"><span class="lineno">  709</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>)</div>
<div class="line"><span class="lineno">  710</span>            {</div>
<div class="line"><span class="lineno">  711</span>                <span class="comment">// important, otherwise we could end up processing during shutdown</span></div>
<div class="line"><span class="lineno">  712</span>                cancellationToken.ThrowIfCancellationRequested();</div>
<div class="line"><span class="lineno">  713</span> </div>
<div class="line"><span class="lineno">  714</span>                var providerIdNullable = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a></div>
<div class="line"><span class="lineno">  715</span>                    .Where(x =&gt; x.Value == provider)</div>
<div class="line"><span class="lineno">  716</span>                    .Select(x =&gt; (<span class="keywordtype">long</span>?)x.Key)</div>
<div class="line"><span class="lineno">  717</span>                    .FirstOrDefault();</div>
<div class="line"><span class="lineno">  718</span> </div>
<div class="line"><span class="lineno">  719</span>                <span class="keywordflow">if</span> (!providerIdNullable.HasValue)</div>
<div class="line"><span class="lineno">  720</span>                {</div>
<div class="line"><span class="lineno">  721</span>                    <span class="comment">// possible to have a message queued and then the provider immediately disconnects</span></div>
<div class="line"><span class="lineno">  722</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogDebug(<span class="stringliteral">&quot;Unable to process command \&quot;{command}\&quot; due to provider disconnecting&quot;</span>, message.Content);</div>
<div class="line"><span class="lineno">  723</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  724</span>                }</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>                providerId = providerIdNullable.Value;</div>
<div class="line"><span class="lineno">  727</span>                mappedChannel = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a></div>
<div class="line"><span class="lineno">  728</span>                    .Where(x =&gt; x.Value.ProviderId == providerId &amp;&amp; x.Value.ProviderChannelId == providerChannelId)</div>
<div class="line"><span class="lineno">  729</span>                    .Select(x =&gt; (KeyValuePair&lt;ulong, ChannelMapping&gt;?)x)</div>
<div class="line"><span class="lineno">  730</span>                    .FirstOrDefault();</div>
<div class="line"><span class="lineno">  731</span>                hasChannelZero = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a></div>
<div class="line"><span class="lineno">  732</span>                    .Where(x =&gt; x.Value.ProviderId == providerId &amp;&amp; x.Value.ProviderChannelId == 0)</div>
<div class="line"><span class="lineno">  733</span>                    .Any();</div>
<div class="line"><span class="lineno">  734</span>            }</div>
<div class="line"><span class="lineno">  735</span> </div>
<div class="line"><span class="lineno">  736</span>            <span class="keywordflow">if</span> (!recursed &amp;&amp; !mappedChannel.HasValue &amp;&amp; !message.User.Channel.IsPrivateChannel &amp;&amp; hasChannelZero)</div>
<div class="line"><span class="lineno">  737</span>            {</div>
<div class="line"><span class="lineno">  738</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogInformation(<span class="stringliteral">&quot;Receieved message from unmapped channel whose provider contains ID 0. Remapping...&quot;</span>);</div>
<div class="line"><span class="lineno">  739</span>                await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4487a7f0841824a78272233a9f30262c">RemapProvider</a>(provider, cancellationToken);</div>
<div class="line"><span class="lineno">  740</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Resume processing original message...&quot;</span>);</div>
<div class="line"><span class="lineno">  741</span>                await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a469bab0c686f2aa640069bae4a1a0055">ProcessMessage</a>(provider, message, <span class="keyword">true</span>, cancellationToken);</div>
<div class="line"><span class="lineno">  742</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  743</span>            }</div>
<div class="line"><span class="lineno">  744</span> </div>
<div class="line"><span class="lineno">  745</span>            ValueTask TextReply(<span class="keywordtype">string</span> reply) =&gt; <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a14df10dd6677ff9fbf9d9d3bdc05c99f">SendMessage</a>(</div>
<div class="line"><span class="lineno">  746</span>                <span class="keyword">new</span> List&lt;ulong&gt;</div>
<div class="line"><span class="lineno">  747</span>                {</div>
<div class="line"><span class="lineno">  748</span>                    message.User.Channel.RealId,</div>
<div class="line"><span class="lineno">  749</span>                },</div>
<div class="line"><span class="lineno">  750</span>                message,</div>
<div class="line"><span class="lineno">  751</span>                <span class="keyword">new</span> <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a></div>
<div class="line"><span class="lineno">  752</span>                {</div>
<div class="line"><span class="lineno">  753</span>                    Text = reply,</div>
<div class="line"><span class="lineno">  754</span>                },</div>
<div class="line"><span class="lineno">  755</span>                cancellationToken);</div>
<div class="line"><span class="lineno">  756</span> </div>
<div class="line"><span class="lineno">  757</span>            <span class="keywordflow">if</span> (message.User.Channel.IsPrivateChannel)</div>
<div class="line"><span class="lineno">  758</span>                lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>)</div>
<div class="line"><span class="lineno">  759</span>                    <span class="keywordflow">if</span> (!mappedChannel.HasValue)</div>
<div class="line"><span class="lineno">  760</span>                    {</div>
<div class="line"><span class="lineno">  761</span>                        ulong newId;</div>
<div class="line"><span class="lineno">  762</span>                        lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a1ac2daf67a09f128290588a5181c88ba">synchronizationLock</a>)</div>
<div class="line"><span class="lineno">  763</span>                            newId = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a9f8c4d78e74aa61eb4aaa13cc1a88bbf">channelIdCounter</a>++;</div>
<div class="line"><span class="lineno">  764</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(</div>
<div class="line"><span class="lineno">  765</span>                            <span class="stringliteral">&quot;Mapping private channel {connectionName}:{channelFriendlyName} as {newId}&quot;</span>,</div>
<div class="line"><span class="lineno">  766</span>                            message.User.Channel.ConnectionName,</div>
<div class="line"><span class="lineno">  767</span>                            message.User.FriendlyName,</div>
<div class="line"><span class="lineno">  768</span>                            newId);</div>
<div class="line"><span class="lineno">  769</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Add(newId, <span class="keyword">new</span> ChannelMapping(message.User.Channel)</div>
<div class="line"><span class="lineno">  770</span>                        {</div>
<div class="line"><span class="lineno">  771</span>                            ProviderChannelId = message.User.Channel.RealId,</div>
<div class="line"><span class="lineno">  772</span>                            ProviderId = providerId,</div>
<div class="line"><span class="lineno">  773</span>                        });</div>
<div class="line"><span class="lineno">  774</span> </div>
<div class="line"><span class="lineno">  775</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(</div>
<div class="line"><span class="lineno">  776</span>                            <span class="stringliteral">&quot;Mapping DM {connectionName}:{userId} ({userFriendlyName}) as {newId}&quot;</span>,</div>
<div class="line"><span class="lineno">  777</span>                            message.User.Channel.ConnectionName,</div>
<div class="line"><span class="lineno">  778</span>                            message.User.RealId,</div>
<div class="line"><span class="lineno">  779</span>                            message.User.FriendlyName,</div>
<div class="line"><span class="lineno">  780</span>                            newId);</div>
<div class="line"><span class="lineno">  781</span>                        message.User.Channel.RealId = newId;</div>
<div class="line"><span class="lineno">  782</span>                    }</div>
<div class="line"><span class="lineno">  783</span>                    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  784</span>                        message.User.Channel.RealId = mappedChannel.Value.Key;</div>
<div class="line"><span class="lineno">  785</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  786</span>            {</div>
<div class="line"><span class="lineno">  787</span>                <span class="keywordflow">if</span> (!mappedChannel.HasValue)</div>
<div class="line"><span class="lineno">  788</span>                {</div>
<div class="line"><span class="lineno">  789</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogError(</div>
<div class="line"><span class="lineno">  790</span>                        <span class="stringliteral">&quot;Error mapping message: Provider ID: {providerId}, Channel Real ID: {realId}&quot;</span>,</div>
<div class="line"><span class="lineno">  791</span>                        providerId,</div>
<div class="line"><span class="lineno">  792</span>                        message.User.Channel.RealId);</div>
<div class="line"><span class="lineno">  793</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;message: {messageJson}&quot;</span>, JsonConvert.SerializeObject(message));</div>
<div class="line"><span class="lineno">  794</span>                    lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>)</div>
<div class="line"><span class="lineno">  795</span>                        <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;mappedChannels: {mappedChannelsJson}&quot;</span>, JsonConvert.SerializeObject(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>));</div>
<div class="line"><span class="lineno">  796</span>                    await TextReply(<span class="stringliteral">&quot;TGS: Processing error, check logs!&quot;</span>);</div>
<div class="line"><span class="lineno">  797</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  798</span>                }</div>
<div class="line"><span class="lineno">  799</span> </div>
<div class="line"><span class="lineno">  800</span>                var mappingChannelRepresentation = mappedChannel.Value.Value.Channel;</div>
<div class="line"><span class="lineno">  801</span> </div>
<div class="line"><span class="lineno">  802</span>                message.User.Channel.RealId = mappingChannelRepresentation.RealId;</div>
<div class="line"><span class="lineno">  803</span>                message.User.Channel.Tag = mappingChannelRepresentation.Tag;</div>
<div class="line"><span class="lineno">  804</span>                message.User.Channel.IsAdminChannel = mappingChannelRepresentation.IsAdminChannel;</div>
<div class="line"><span class="lineno">  805</span>            }</div>
<div class="line"><span class="lineno">  806</span> </div>
<div class="line"><span class="lineno">  807</span>            var trimmedMessage = message.Content.Trim();</div>
<div class="line"><span class="lineno">  808</span>            <span class="keywordflow">if</span> (trimmedMessage.Length == 0)</div>
<div class="line"><span class="lineno">  809</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  810</span> </div>
<div class="line"><span class="lineno">  811</span>            var splits = <span class="keyword">new</span> List&lt;string&gt;(trimmedMessage.Split(<span class="charliteral">&#39; &#39;</span>, StringSplitOptions.RemoveEmptyEntries));</div>
<div class="line"><span class="lineno">  812</span>            var address = splits[0];</div>
<div class="line"><span class="lineno">  813</span>            <span class="keywordflow">if</span> (address.Length &gt; 1 &amp;&amp; (address.Last() == <span class="charliteral">&#39;:&#39;</span> || address.Last() == <span class="charliteral">&#39;,&#39;</span>))</div>
<div class="line"><span class="lineno">  814</span>                address = address[0..^1];</div>
<div class="line"><span class="lineno">  815</span> </div>
<div class="line"><span class="lineno">  816</span>            var addressed =</div>
<div class="line"><span class="lineno">  817</span>                address.Equals(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a0b5b0d03d129b21de29dc2c2bbf17edf">CommonMention</a>, StringComparison.OrdinalIgnoreCase)</div>
<div class="line"><span class="lineno">  818</span>                || address.Equals(provider.<a class="code hl_property" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html#a781f872cb8143fe3ff92f3cc8d0d5abb">BotMention</a>, StringComparison.OrdinalIgnoreCase);</div>
<div class="line"><span class="lineno">  819</span> </div>
<div class="line"><span class="lineno">  820</span>            <span class="comment">// no mention</span></div>
<div class="line"><span class="lineno">  821</span>            <span class="keywordflow">if</span> (!addressed &amp;&amp; !message.User.Channel.IsPrivateChannel)</div>
<div class="line"><span class="lineno">  822</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(</div>
<div class="line"><span class="lineno">  825</span>                <span class="stringliteral">&quot;Start processing command: {message}. User (True provider Id): {profiderId}&quot;</span>,</div>
<div class="line"><span class="lineno">  826</span>                message.Content,</div>
<div class="line"><span class="lineno">  827</span>                JsonConvert.SerializeObject(message.User));</div>
<div class="line"><span class="lineno">  828</span>            <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  829</span>            {</div>
<div class="line"><span class="lineno">  830</span>                <span class="keywordflow">if</span> (addressed)</div>
<div class="line"><span class="lineno">  831</span>                    splits.RemoveAt(0);</div>
<div class="line"><span class="lineno">  832</span> </div>
<div class="line"><span class="lineno">  833</span>                <span class="keywordflow">if</span> (splits.Count == 0)</div>
<div class="line"><span class="lineno">  834</span>                {</div>
<div class="line"><span class="lineno">  835</span>                    <span class="comment">// just a mention</span></div>
<div class="line"><span class="lineno">  836</span>                    await TextReply(<span class="stringliteral">&quot;Hi!&quot;</span>);</div>
<div class="line"><span class="lineno">  837</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  838</span>                }</div>
<div class="line"><span class="lineno">  839</span> </div>
<div class="line"><span class="lineno">  840</span>                var command = splits[0];</div>
<div class="line"><span class="lineno">  841</span>                splits.RemoveAt(0);</div>
<div class="line"><span class="lineno">  842</span>                var arguments = String.Join(<span class="stringliteral">&quot; &quot;</span>, splits);</div>
<div class="line"><span class="lineno">  843</span> </div>
<div class="line"><span class="lineno">  844</span>                Tuple&lt;ICommand, IChatTrackingContext?&gt;? GetCommand(<span class="keywordtype">string</span> command)</div>
<div class="line"><span class="lineno">  845</span>                {</div>
<div class="line"><span class="lineno">  846</span>                    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a69d25612b62368e0fb9ac204987ed7b6">builtinCommands</a>.TryGetValue(command, out var handler))</div>
<div class="line"><span class="lineno">  847</span>                        <span class="keywordflow">return</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a></div>
<div class="line"><span class="lineno">  848</span>                            .Where(trackingContext =&gt; trackingContext.Active)</div>
<div class="line"><span class="lineno">  849</span>                            .SelectMany(trackingContext =&gt; trackingContext.CustomCommands.Select(customCommand =&gt; Tuple.Create&lt;<a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command.html">ICommand</a>, IChatTrackingContext?&gt;(customCommand, trackingContext)))</div>
<div class="line"><span class="lineno">  850</span>                            .Where(tuple =&gt; tuple.Item1.Name.Equals(command, StringComparison.OrdinalIgnoreCase))</div>
<div class="line"><span class="lineno">  851</span>                            .FirstOrDefault();</div>
<div class="line"><span class="lineno">  852</span> </div>
<div class="line"><span class="lineno">  853</span>                    <span class="keywordflow">return</span> Tuple.Create&lt;<a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command.html">ICommand</a>, IChatTrackingContext?&gt;(handler, <span class="keyword">null</span>);</div>
<div class="line"><span class="lineno">  854</span>                }</div>
<div class="line"><span class="lineno">  855</span> </div>
<div class="line"><span class="lineno">  856</span>                <span class="keyword">const</span> <span class="keywordtype">string</span> UnknownCommandMessage = <span class="stringliteral">&quot;TGS: Unknown command! Type &#39;?&#39; or &#39;help&#39; for available commands.&quot;</span>;</div>
<div class="line"><span class="lineno">  857</span> </div>
<div class="line"><span class="lineno">  858</span>                <span class="keywordflow">if</span> (command.Equals(<span class="stringliteral">&quot;help&quot;</span>, StringComparison.OrdinalIgnoreCase) || command == <span class="stringliteral">&quot;?&quot;</span>)</div>
<div class="line"><span class="lineno">  859</span>                {</div>
<div class="line"><span class="lineno">  860</span>                    <span class="keywordtype">string</span> helpText;</div>
<div class="line"><span class="lineno">  861</span>                    <span class="keywordflow">if</span> (splits.Count == 0)</div>
<div class="line"><span class="lineno">  862</span>                    {</div>
<div class="line"><span class="lineno">  863</span>                        var allCommands = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a69d25612b62368e0fb9ac204987ed7b6">builtinCommands</a>.Select(x =&gt; x.Value).ToList();</div>
<div class="line"><span class="lineno">  864</span>                        allCommands.AddRange(</div>
<div class="line"><span class="lineno">  865</span>                            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a></div>
<div class="line"><span class="lineno">  866</span>                                .SelectMany(</div>
<div class="line"><span class="lineno">  867</span>                                    x =&gt; x.CustomCommands));</div>
<div class="line"><span class="lineno">  868</span>                        helpText = String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;Available commands (Type &#39;?&#39; or &#39;help&#39; and then a command name for more details): {0}&quot;</span>, String.Join(<span class="stringliteral">&quot;, &quot;</span>, allCommands.Select(x =&gt; x.Name)));</div>
<div class="line"><span class="lineno">  869</span>                    }</div>
<div class="line"><span class="lineno">  870</span>                    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  871</span>                    {</div>
<div class="line"><span class="lineno">  872</span>                        var helpTuple = GetCommand(splits[0]);</div>
<div class="line"><span class="lineno">  873</span>                        <span class="keywordflow">if</span> (helpTuple != <span class="keywordflow">default</span>)</div>
<div class="line"><span class="lineno">  874</span>                        {</div>
<div class="line"><span class="lineno">  875</span>                            var (helpHandler, _) = helpTuple;</div>
<div class="line"><span class="lineno">  876</span>                            helpText = String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;{0}: {1}{2}&quot;</span>, helpHandler.Name, helpHandler.HelpText, helpHandler.AdminOnly ? <span class="stringliteral">&quot; - May only be used in admin channels&quot;</span> : String.Empty);</div>
<div class="line"><span class="lineno">  877</span>                        }</div>
<div class="line"><span class="lineno">  878</span>                        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  879</span>                            helpText = UnknownCommandMessage;</div>
<div class="line"><span class="lineno">  880</span>                    }</div>
<div class="line"><span class="lineno">  881</span> </div>
<div class="line"><span class="lineno">  882</span>                    await TextReply(helpText);</div>
<div class="line"><span class="lineno">  883</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  884</span>                }</div>
<div class="line"><span class="lineno">  885</span> </div>
<div class="line"><span class="lineno">  886</span>                var tuple = GetCommand(command);</div>
<div class="line"><span class="lineno">  887</span> </div>
<div class="line"><span class="lineno">  888</span>                <span class="keywordflow">if</span> (tuple == <span class="keywordflow">default</span>)</div>
<div class="line"><span class="lineno">  889</span>                {</div>
<div class="line"><span class="lineno">  890</span>                    await TextReply(UnknownCommandMessage);</div>
<div class="line"><span class="lineno">  891</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  892</span>                }</div>
<div class="line"><span class="lineno">  893</span> </div>
<div class="line"><span class="lineno">  894</span>                var (commandHandler, trackingContext) = tuple;</div>
<div class="line"><span class="lineno">  895</span> </div>
<div class="line"><span class="lineno">  896</span>                <span class="keywordflow">if</span> (trackingContext?.Active == <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">  897</span>                {</div>
<div class="line"><span class="lineno">  898</span>                    await TextReply(<span class="stringliteral">&quot;TGS: The server is rebooting, please try again later&quot;</span>);</div>
<div class="line"><span class="lineno">  899</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  900</span>                }</div>
<div class="line"><span class="lineno">  901</span> </div>
<div class="line"><span class="lineno">  902</span>                <span class="keywordflow">if</span> (commandHandler.AdminOnly &amp;&amp; !message.User.Channel.IsAdminChannel)</div>
<div class="line"><span class="lineno">  903</span>                {</div>
<div class="line"><span class="lineno">  904</span>                    await TextReply(<span class="stringliteral">&quot;TGS: Use this command in an admin channel!&quot;</span>);</div>
<div class="line"><span class="lineno">  905</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  906</span>                }</div>
<div class="line"><span class="lineno">  907</span> </div>
<div class="line"><span class="lineno">  908</span>                var result = await commandHandler.Invoke(arguments, message.User, cancellationToken);</div>
<div class="line"><span class="lineno">  909</span>                <span class="keywordflow">if</span> (result != <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  910</span>                    await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a14df10dd6677ff9fbf9d9d3bdc05c99f">SendMessage</a>(<span class="keyword">new</span> List&lt;ulong&gt; { message.User.Channel.RealId }, message, result, cancellationToken);</div>
<div class="line"><span class="lineno">  911</span>            }</div>
<div class="line"><span class="lineno">  912</span>            <span class="keywordflow">catch</span> (OperationCanceledException ex)</div>
<div class="line"><span class="lineno">  913</span>            {</div>
<div class="line"><span class="lineno">  914</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(ex, <span class="stringliteral">&quot;Command processing canceled!&quot;</span>);</div>
<div class="line"><span class="lineno">  915</span>            }</div>
<div class="line"><span class="lineno">  916</span>            <span class="keywordflow">catch</span> (<a class="code hl_class" href="class_exception.html">Exception</a> e)</div>
<div class="line"><span class="lineno">  917</span>            {</div>
<div class="line"><span class="lineno">  918</span>                <span class="comment">// error bc custom commands should reply about why it failed</span></div>
<div class="line"><span class="lineno">  919</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogError(e, <span class="stringliteral">&quot;Error processing chat command&quot;</span>);</div>
<div class="line"><span class="lineno">  920</span>                await TextReply(<span class="stringliteral">&quot;TGS: Internal error processing command! Check server logs!&quot;</span>);</div>
<div class="line"><span class="lineno">  921</span>            }</div>
<div class="line"><span class="lineno">  922</span>            <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno">  923</span>            {</div>
<div class="line"><span class="lineno">  924</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Done processing command.&quot;</span>);</div>
<div class="line"><span class="lineno">  925</span>            }</div>
<div class="line"><span class="lineno">  926</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a0b5b0d03d129b21de29dc2c2bbf17edf"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a0b5b0d03d129b21de29dc2c2bbf17edf">Tgstation.Server.Host.Components.Chat.ChatManager.CommonMention</a></div><div class="ttdeci">const string CommonMention</div><div class="ttdoc">The common bot mention.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00033">ChatManager.cs:33</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a4487a7f0841824a78272233a9f30262c"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4487a7f0841824a78272233a9f30262c">Tgstation.Server.Host.Components.Chat.ChatManager.RemapProvider</a></div><div class="ttdeci">async ValueTask RemapProvider(IProvider provider, CancellationToken cancellationToken)</div><div class="ttdoc">Remap the channels for a given provider .</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00664">ChatManager.cs:664</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_html"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command.html">Tgstation.Server.Host.Components.Chat.Commands.ICommand</a></div><div class="ttdoc">Represents a command that can be invoked by talking to chat bots.</div><div class="ttdef"><b>Definition</b> <a href="_i_command_8cs_source.html#l00011">ICommand.cs:12</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_html_a781f872cb8143fe3ff92f3cc8d0d5abb"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html#a781f872cb8143fe3ff92f3cc8d0d5abb">Tgstation.Server.Host.Components.Chat.Providers.IProvider.BotMention</a></div><div class="ttdeci">string BotMention</div><div class="ttdoc">The string that indicates the IProvider was mentioned.</div><div class="ttdef"><b>Definition</b> <a href="_i_provider_8cs_source.html#l00030">IProvider.cs:30</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_html_acc07a6bfb2fbb35243aa1e147d92dd87"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html#acc07a6bfb2fbb35243aa1e147d92dd87">Tgstation.Server.Host.Components.Chat.Providers.IProvider.Connected</a></div><div class="ttdeci">bool Connected</div><div class="ttdoc">If the IProvider is currently connected.</div><div class="ttdef"><b>Definition</b> <a href="_i_provider_8cs_source.html#l00020">IProvider.cs:20</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_i_provider_8cs_source.html#l00030">Tgstation.Server.Host.Components.Chat.Providers.IProvider.BotMention</a>, <a class="el" href="_chat_user_8cs_source.html#l00041">Tgstation.Server.Host.Components.Chat.ChatUser.Channel</a>, <a class="el" href="_i_provider_8cs_source.html#l00020">Tgstation.Server.Host.Components.Chat.Providers.IProvider.Connected</a>, <a class="el" href="_channel_representation_8cs_source.html#l00038">Tgstation.Server.Host.Components.Chat.ChannelRepresentation.ConnectionName</a>, <a class="el" href="_message_8cs_source.html#l00013">Tgstation.Server.Host.Components.Chat.Providers.Message.Content</a>, <a class="el" href="_chat_user_8cs_source.html#l00031">Tgstation.Server.Host.Components.Chat.ChatUser.FriendlyName</a>, <a class="el" href="_channel_representation_8cs_source.html#l00043">Tgstation.Server.Host.Components.Chat.ChannelRepresentation.IsAdminChannel</a>, <a class="el" href="_channel_representation_8cs_source.html#l00048">Tgstation.Server.Host.Components.Chat.ChannelRepresentation.IsPrivateChannel</a>, <a class="el" href="_channel_representation_8cs_source.html#l00025">Tgstation.Server.Host.Components.Chat.ChannelRepresentation.RealId</a>, <a class="el" href="_chat_user_8cs_source.html#l00023">Tgstation.Server.Host.Components.Chat.ChatUser.RealId</a>, and <a class="el" href="_message_8cs_source.html#l00018">Tgstation.Server.Host.Components.Chat.Providers.Message.User</a>.</p>

</div>
</div>
<a id="af41ce2b0c652e320dfeedb42d3d93d3d" name="af41ce2b0c652e320dfeedb42d3d93d3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af41ce2b0c652e320dfeedb42d3d93d3d">&#9670;&#160;</a></span>QueueDeploymentMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Func&lt; string?, string, Action&lt; bool &gt; &gt; Tgstation.Server.Host.Components.Chat.ChatManager.QueueDeploymentMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_revision_information.html">Models::RevisionInformation</a>&#160;</td>
          <td class="paramname"><em>revisionInformation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_revision_information.html">Models::RevisionInformation</a>?&#160;</td>
          <td class="paramname"><em>previousRevisionInformation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_engine_version.html">EngineVersion</a>&#160;</td>
          <td class="paramname"><em>engineVersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DateTimeOffset?&#160;</td>
          <td class="paramname"><em>estimatedCompletionTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string?&#160;</td>
          <td class="paramname"><em>gitHubOwner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string?&#160;</td>
          <td class="paramname"><em>gitHubRepo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>localCommitPushed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send the message for a deployment to configured deployment channels.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">revisionInformation</td><td>The RevisionInformation of the deployment.</td></tr>
    <tr><td class="paramname">previousRevisionInformation</td><td>The optional RevisionInformation of the previous deployment.</td></tr>
    <tr><td class="paramname">engineVersion</td><td>The <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_engine_version.html" title="Information about an engine installation.">Api.Models.EngineVersion</a> of the deployment.</td></tr>
    <tr><td class="paramname">estimatedCompletionTime</td><td>The optional DateTimeOffset the deployment is expected to be completed at.</td></tr>
    <tr><td class="paramname">gitHubOwner</td><td>The repository GitHub owner, if any.</td></tr>
    <tr><td class="paramname">gitHubRepo</td><td>The repository GitHub name, if any.</td></tr>
    <tr><td class="paramname">localCommitPushed</td><td><code>true</code> if the local deployment commit was pushed to the remote repository.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Func&lt;T1, T2, TResult&gt; to call to update the message at the deployment's conclusion. Parameters: Error message if any, DreamMaker output if any. Returns an Action to call to mark the deployment as active/inactive. Parameter: If the deployment is being activated or inactivated.</dd></dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#af57dca6c1e1af2dc810e731ce106c719">Tgstation.Server.Host.Components.Chat.IChatManager</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00378">378</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  386</span>        {</div>
<div class="line"><span class="lineno">  387</span>            List&lt;ulong&gt; wdChannels;</div>
<div class="line"><span class="lineno">  388</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>) <span class="comment">// so it doesn&#39;t change while we&#39;re using it</span></div>
<div class="line"><span class="lineno">  389</span>                wdChannels = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Where(x =&gt; x.Value.IsUpdatesChannel).Select(x =&gt; x.Key).ToList();</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Sending deployment message for RevisionInformation: {revisionInfoId}&quot;</span>, revisionInformation.Id);</div>
<div class="line"><span class="lineno">  392</span> </div>
<div class="line"><span class="lineno">  393</span>            var callbacks = <span class="keyword">new</span> List&lt;Func&lt;string?, string, ValueTask&lt;Func&lt;bool, ValueTask&gt;&gt;&gt;&gt;();</div>
<div class="line"><span class="lineno">  394</span> </div>
<div class="line"><span class="lineno">  395</span>            var task = Task.WhenAll(</div>
<div class="line"><span class="lineno">  396</span>                wdChannels.Select(</div>
<div class="line"><span class="lineno">  397</span>                    async x =&gt;</div>
<div class="line"><span class="lineno">  398</span>                    {</div>
<div class="line"><span class="lineno">  399</span>                        ChannelMapping? channelMapping;</div>
<div class="line"><span class="lineno">  400</span>                        lock (mappedChannels)</div>
<div class="line"><span class="lineno">  401</span>                            if (!mappedChannels.TryGetValue(x, out channelMapping))</div>
<div class="line"><span class="lineno">  402</span>                                return;</div>
<div class="line"><span class="lineno">  403</span>                        IProvider? provider;</div>
<div class="line"><span class="lineno">  404</span>                        lock (providers)</div>
<div class="line"><span class="lineno">  405</span>                            if (!providers.TryGetValue(channelMapping.ProviderId, out provider))</div>
<div class="line"><span class="lineno">  406</span>                                return;</div>
<div class="line"><span class="lineno">  407</span>                        try</div>
<div class="line"><span class="lineno">  408</span>                        {</div>
<div class="line"><span class="lineno">  409</span>                            var callback = await provider.SendUpdateMessage(</div>
<div class="line"><span class="lineno">  410</span>                                revisionInformation,</div>
<div class="line"><span class="lineno">  411</span>                                previousRevisionInformation,</div>
<div class="line"><span class="lineno">  412</span>                                engineVersion,</div>
<div class="line"><span class="lineno">  413</span>                                estimatedCompletionTime,</div>
<div class="line"><span class="lineno">  414</span>                                gitHubOwner,</div>
<div class="line"><span class="lineno">  415</span>                                gitHubRepo,</div>
<div class="line"><span class="lineno">  416</span>                                channelMapping.ProviderChannelId,</div>
<div class="line"><span class="lineno">  417</span>                                localCommitPushed,</div>
<div class="line"><span class="lineno">  418</span>                                handlerCts.Token);</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>                            lock (callbacks)</div>
<div class="line"><span class="lineno">  421</span>                                callbacks.Add(callback);</div>
<div class="line"><span class="lineno">  422</span>                        }</div>
<div class="line"><span class="lineno">  423</span>                        catch (<a class="code hl_class" href="class_exception.html">Exception</a> ex)</div>
<div class="line"><span class="lineno">  424</span>                        {</div>
<div class="line"><span class="lineno">  425</span>                            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogWarning(</div>
<div class="line"><span class="lineno">  426</span>                                ex,</div>
<div class="line"><span class="lineno">  427</span>                                <span class="stringliteral">&quot;Error sending deploy message to provider {providerId}!&quot;</span>,</div>
<div class="line"><span class="lineno">  428</span>                                channelMapping.ProviderId);</div>
<div class="line"><span class="lineno">  429</span>                        }</div>
<div class="line"><span class="lineno">  430</span>                    }));</div>
<div class="line"><span class="lineno">  431</span> </div>
<div class="line"><span class="lineno">  432</span>            <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ab21f39aa8eb74bc4269aa37b378cf85c">AddMessageTask</a>(task);</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>            Task callbackTask;</div>
<div class="line"><span class="lineno">  435</span>            Func&lt;bool, Task&gt;? finalUpdateAction = <span class="keyword">null</span>;</div>
<div class="line"><span class="lineno">  436</span>            async Task CallbackTask(<span class="keywordtype">string</span>? errorMessage, <span class="keywordtype">string</span> dreamMakerOutput)</div>
<div class="line"><span class="lineno">  437</span>            {</div>
<div class="line"><span class="lineno">  438</span>                await task;</div>
<div class="line"><span class="lineno">  439</span>                var callbackResults = await <a class="code hl_class" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html">ValueTaskExtensions</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3">WhenAll</a>(</div>
<div class="line"><span class="lineno">  440</span>                    callbacks.Select(</div>
<div class="line"><span class="lineno">  441</span>                        x =&gt; x(</div>
<div class="line"><span class="lineno">  442</span>                            errorMessage,</div>
<div class="line"><span class="lineno">  443</span>                            dreamMakerOutput)),</div>
<div class="line"><span class="lineno">  444</span>                    callbacks.Count);</div>
<div class="line"><span class="lineno">  445</span> </div>
<div class="line"><span class="lineno">  446</span>                finalUpdateAction = active =&gt; <a class="code hl_class" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html">ValueTaskExtensions</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3">WhenAll</a>(callbackResults.Select(finalizerCallback =&gt; finalizerCallback(active))).AsTask();</div>
<div class="line"><span class="lineno">  447</span>            }</div>
<div class="line"><span class="lineno">  448</span> </div>
<div class="line"><span class="lineno">  449</span>            async Task CompletionTask(<span class="keywordtype">bool</span> active)</div>
<div class="line"><span class="lineno">  450</span>            {</div>
<div class="line"><span class="lineno">  451</span>                <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  452</span>                {</div>
<div class="line"><span class="lineno">  453</span>                    await callbackTask;</div>
<div class="line"><span class="lineno">  454</span>                }</div>
<div class="line"><span class="lineno">  455</span>                <span class="keywordflow">catch</span></div>
<div class="line"><span class="lineno">  456</span>                {</div>
<div class="line"><span class="lineno">  457</span>                    <span class="comment">// Handled in AddMessageTask</span></div>
<div class="line"><span class="lineno">  458</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  459</span>                }</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>                <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ab21f39aa8eb74bc4269aa37b378cf85c">AddMessageTask</a>(finalUpdateAction!(active));</div>
<div class="line"><span class="lineno">  462</span>            }</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>            <span class="keywordflow">return</span> (errorMessage, dreamMakerOutput) =&gt;</div>
<div class="line"><span class="lineno">  465</span>            {</div>
<div class="line"><span class="lineno">  466</span>                callbackTask = CallbackTask(errorMessage, dreamMakerOutput);</div>
<div class="line"><span class="lineno">  467</span>                <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ab21f39aa8eb74bc4269aa37b378cf85c">AddMessageTask</a>(callbackTask);</div>
<div class="line"><span class="lineno">  468</span>                <span class="keywordflow">return</span> active =&gt; <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ab21f39aa8eb74bc4269aa37b378cf85c">AddMessageTask</a>(CompletionTask(active));</div>
<div class="line"><span class="lineno">  469</span>            };</div>
<div class="line"><span class="lineno">  470</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions_html"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html">Tgstation.Server.Common.Extensions.ValueTaskExtensions</a></div><div class="ttdoc">Extension methods for the ValueTask and ValueTask&lt;TResult&gt; classes.</div><div class="ttdef"><b>Definition</b> <a href="_value_task_extensions_8cs_source.html#l00011">ValueTaskExtensions.cs:12</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions_html_a58adbd94d764754bd3e6c566a5fe7fe3"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3">Tgstation.Server.Common.Extensions.ValueTaskExtensions.WhenAll</a></div><div class="ttdeci">static async ValueTask WhenAll(IEnumerable&lt; ValueTask &gt; tasks)</div><div class="ttdoc">Fully await a given list of tasks .</div><div class="ttdef"><b>Definition</b> <a href="_value_task_extensions_8cs_source.html#l00099">ValueTaskExtensions.cs:99</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_ab21f39aa8eb74bc4269aa37b378cf85c"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ab21f39aa8eb74bc4269aa37b378cf85c">Tgstation.Server.Host.Components.Chat.ChatManager.AddMessageTask</a></div><div class="ttdeci">void AddMessageTask(Task task)</div><div class="ttdoc">Adds a given task  to messageSendTask.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l01068">ChatManager.cs:1068</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_chat_manager_8cs_source.html#l00058">Tgstation.Server.Host.Components.Chat.ChatManager.logger</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00078">Tgstation.Server.Host.Components.Chat.ChatManager.mappedChannels</a>.</p>

</div>
</div>
<a id="a6df490e4067fe694af10379fb56a7a25" name="a6df490e4067fe694af10379fb56a7a25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6df490e4067fe694af10379fb56a7a25">&#9670;&#160;</a></span>QueueMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Tgstation.Server.Host.Components.Chat.ChatManager.QueueMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a>&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IEnumerable&lt; ulong &gt;&#160;</td>
          <td class="paramname"><em>channelIds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue a chat <em>message</em>  to a given set of <em>channelIds</em> .<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>The MessageContent being sent.</td></tr>
    <tr><td class="paramname">channelIds</td><td>The <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_channel.html#a0dd252ba836263c5a825862bcda215f7" title="The row Id.">Models.ChatChannel.Id</a>s of the <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_channel.html">Models.ChatChannel</a>s to send to.</td></tr>
  </table>
  </dd>
</dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#af9226f864c0c82403eab7ac5f8e43002">Tgstation.Server.Host.Components.Chat.IChatManager</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00344">344</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  345</span>        {</div>
<div class="line"><span class="lineno">  346</span>            ArgumentNullException.ThrowIfNull(message);</div>
<div class="line"><span class="lineno">  347</span>            ArgumentNullException.ThrowIfNull(channelIds);</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>            <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a340b673aa6460c8570dc501b18fe0f5e">QueueMessageInternal</a>(message, () =&gt; channelIds, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  350</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a340b673aa6460c8570dc501b18fe0f5e"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a340b673aa6460c8570dc501b18fe0f5e">Tgstation.Server.Host.Components.Chat.ChatManager.QueueMessageInternal</a></div><div class="ttdeci">void QueueMessageInternal(MessageContent message, Func&lt; IEnumerable&lt; ulong &gt; &gt; channelIdsFactory, bool waitForConnections)</div><div class="ttdoc">Adds a given message  to the send queue.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l01097">ChatManager.cs:1097</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_chat_manager_8cs_source.html#l01097">Tgstation.Server.Host.Components.Chat.ChatManager.QueueMessageInternal()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a6df490e4067fe694af10379fb56a7a25_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a6df490e4067fe694af10379fb56a7a25_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a6df490e4067fe694af10379fb56a7a25_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a6df490e4067fe694af10379fb56a7a25_cgraph">
<area shape="rect" title="Queue a chat message &#160;to a given set of channelIds ." alt="" coords="5,5,232,46"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a340b673aa6460c8570dc501b18fe0f5e" title="Adds a given message &#160;to the send queue." alt="" coords="280,5,545,46"/>
<area shape="poly" title=" " alt="" coords="232,23,264,23,264,28,232,28"/>
</map>
</div>

</div>
</div>
<a id="a340b673aa6460c8570dc501b18fe0f5e" name="a340b673aa6460c8570dc501b18fe0f5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a340b673aa6460c8570dc501b18fe0f5e">&#9670;&#160;</a></span>QueueMessageInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Tgstation.Server.Host.Components.Chat.ChatManager.QueueMessageInternal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a>&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Func&lt; IEnumerable&lt; ulong &gt; &gt;&#160;</td>
          <td class="paramname"><em>channelIdsFactory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>waitForConnections</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds a given <em>message</em>  to the send queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>The MessageContent being sent.</td></tr>
    <tr><td class="paramname">channelIdsFactory</td><td>A Func&lt;TResult&gt; to retrieve he Models.ChatChannel.Ids of the Models.ChatChannels to send to.</td></tr>
    <tr><td class="paramname">waitForConnections</td><td>If <code>true</code>, the message send will wait for initialProviderConnectionsTask to complete before running.</td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l01097">1097</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1098</span>        {</div>
<div class="line"><span class="lineno"> 1099</span>            async Task SendMessageTask()</div>
<div class="line"><span class="lineno"> 1100</span>            {</div>
<div class="line"><span class="lineno"> 1101</span>                var cancellationToken = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#adc4749cb2a207e472c9fac07cf56e981">handlerCts</a>.Token;</div>
<div class="line"><span class="lineno"> 1102</span>                <span class="keywordflow">if</span> (waitForConnections)</div>
<div class="line"><span class="lineno"> 1103</span>                    await <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a2cd00fcaf7dd3fe543c97bb315bd1837">initialProviderConnectionsTask</a>!.WaitAsync(cancellationToken);</div>
<div class="line"><span class="lineno"> 1104</span> </div>
<div class="line"><span class="lineno"> 1105</span>                await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a14df10dd6677ff9fbf9d9d3bdc05c99f">SendMessage</a>(</div>
<div class="line"><span class="lineno"> 1106</span>                    channelIdsFactory(),</div>
<div class="line"><span class="lineno"> 1107</span>                    <span class="keyword">null</span>,</div>
<div class="line"><span class="lineno"> 1108</span>                    message,</div>
<div class="line"><span class="lineno"> 1109</span>                    cancellationToken);</div>
<div class="line"><span class="lineno"> 1110</span>            }</div>
<div class="line"><span class="lineno"> 1111</span> </div>
<div class="line"><span class="lineno"> 1112</span>            <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ab21f39aa8eb74bc4269aa37b378cf85c">AddMessageTask</a>(SendMessageTask());</div>
<div class="line"><span class="lineno"> 1113</span>        }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00344">Tgstation.Server.Host.Components.Chat.ChatManager.QueueMessage()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00353">Tgstation.Server.Host.Components.Chat.ChatManager.QueueWatchdogMessage()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a340b673aa6460c8570dc501b18fe0f5e_icgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a340b673aa6460c8570dc501b18fe0f5e_icgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a340b673aa6460c8570dc501b18fe0f5e_icgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a340b673aa6460c8570dc501b18fe0f5e_icgraph">
<area shape="rect" title="Adds a given message &#160;to the send queue." alt="" coords="334,39,599,79"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a6df490e4067fe694af10379fb56a7a25" title="Queue a chat message &#160;to a given set of channelIds ." alt="" coords="32,5,259,46"/>
<area shape="poly" title=" " alt="" coords="318,46,259,40,259,35,318,41"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#acd8b6d211bb278105cc10f3a483362f6" title="Queue a chat message &#160;to configured watchdog channels." alt="" coords="5,71,286,111"/>
<area shape="poly" title=" " alt="" coords="319,76,286,80,286,74,318,71"/>
</map>
</div>

</div>
</div>
<a id="acd8b6d211bb278105cc10f3a483362f6" name="acd8b6d211bb278105cc10f3a483362f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd8b6d211bb278105cc10f3a483362f6">&#9670;&#160;</a></span>QueueWatchdogMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Tgstation.Server.Host.Components.Chat.ChatManager.QueueWatchdogMessage </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue a chat <em>message</em>  to configured watchdog channels.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>The message being sent.</td></tr>
  </table>
  </dd>
</dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#a103e061814fc6760410734c7a83f9a83">Tgstation.Server.Host.Components.Chat.IChatManager</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00353">353</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  354</span>        {</div>
<div class="line"><span class="lineno">  355</span>            ArgumentNullException.ThrowIfNull(message);</div>
<div class="line"><span class="lineno">  356</span> </div>
<div class="line"><span class="lineno">  357</span>            message = String.Format(CultureInfo.InvariantCulture, <span class="stringliteral">&quot;WD: {0}&quot;</span>, message);</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a2cd00fcaf7dd3fe543c97bb315bd1837">initialProviderConnectionsTask</a>!.IsCompleted)</div>
<div class="line"><span class="lineno">  360</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Waiting for initial provider connections before sending watchdog message...&quot;</span>);</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>            <span class="comment">// Reimplementing QueueMessage</span></div>
<div class="line"><span class="lineno">  363</span>            <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a340b673aa6460c8570dc501b18fe0f5e">QueueMessageInternal</a>(</div>
<div class="line"><span class="lineno">  364</span>                <span class="keyword">new</span> <a class="code hl_class" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a></div>
<div class="line"><span class="lineno">  365</span>                {</div>
<div class="line"><span class="lineno">  366</span>                    Text = message,</div>
<div class="line"><span class="lineno">  367</span>                },</div>
<div class="line"><span class="lineno">  368</span>                () =&gt;</div>
<div class="line"><span class="lineno">  369</span>                {</div>
<div class="line"><span class="lineno">  370</span>                    <span class="comment">// so it doesn&#39;t change while we&#39;re using it</span></div>
<div class="line"><span class="lineno">  371</span>                    lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>)</div>
<div class="line"><span class="lineno">  372</span>                        <span class="keywordflow">return</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Where(x =&gt; x.Value.IsWatchdogChannel).Select(x =&gt; x.Key).ToList();</div>
<div class="line"><span class="lineno">  373</span>                },</div>
<div class="line"><span class="lineno">  374</span>                <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  375</span>        }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_chat_manager_8cs_source.html#l00113">Tgstation.Server.Host.Components.Chat.ChatManager.initialProviderConnectionsTask</a>, <a class="el" href="_chat_manager_8cs_source.html#l00058">Tgstation.Server.Host.Components.Chat.ChatManager.logger</a>, <a class="el" href="_chat_manager_8cs_source.html#l00078">Tgstation.Server.Host.Components.Chat.ChatManager.mappedChannels</a>, and <a class="el" href="_chat_manager_8cs_source.html#l01097">Tgstation.Server.Host.Components.Chat.ChatManager.QueueMessageInternal()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_acd8b6d211bb278105cc10f3a483362f6_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_acd8b6d211bb278105cc10f3a483362f6_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_acd8b6d211bb278105cc10f3a483362f6_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_acd8b6d211bb278105cc10f3a483362f6_cgraph">
<area shape="rect" title="Queue a chat message &#160;to configured watchdog channels." alt="" coords="5,5,286,46"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a340b673aa6460c8570dc501b18fe0f5e" title="Adds a given message &#160;to the send queue." alt="" coords="334,5,599,46"/>
<area shape="poly" title=" " alt="" coords="286,23,318,23,318,28,286,28"/>
</map>
</div>

</div>
</div>
<a id="ae1b556bac2bf1a08d0eef0fd76297dc4" name="ae1b556bac2bf1a08d0eef0fd76297dc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1b556bac2bf1a08d0eef0fd76297dc4">&#9670;&#160;</a></span>RegisterCommandHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Tgstation.Server.Host.Components.Chat.ChatManager.RegisterCommandHandler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_custom_command_handler.html">ICustomCommandHandler</a>&#160;</td>
          <td class="paramname"><em>customCommandHandler</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers a <em>customCommandHandler</em>  to use.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">customCommandHandler</td><td>A <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_custom_command_handler.html" title="Handles Commands.ICommands that map to those defined in a IChatTrackingContext.">ICustomCommandHandler</a>.</td></tr>
  </table>
  </dd>
</dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#a1e1ce49aa3e843a1e037060a544e125e">Tgstation.Server.Host.Components.Chat.IChatManager</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00550">550</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  551</span>        {</div>
<div class="line"><span class="lineno">  552</span>            <span class="keywordflow">if</span> (this.<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a537b7a1db9aa8fab1de0dfb4587b2b3b">customCommandHandler</a> != <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  553</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="stringliteral">&quot;RegisterCommandHandler() already called!&quot;</span>);</div>
<div class="line"><span class="lineno">  554</span>            this.customCommandHandler = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a537b7a1db9aa8fab1de0dfb4587b2b3b">customCommandHandler</a> ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a537b7a1db9aa8fab1de0dfb4587b2b3b">customCommandHandler</a>));</div>
<div class="line"><span class="lineno">  555</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4487a7f0841824a78272233a9f30262c" name="a4487a7f0841824a78272233a9f30262c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4487a7f0841824a78272233a9f30262c">&#9670;&#160;</a></span>RemapProvider()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async ValueTask Tgstation.Server.Host.Components.Chat.ChatManager.RemapProvider </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a>&#160;</td>
          <td class="paramname"><em>provider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remap the channels for a given <em>provider</em> . </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">provider</td><td>The IProvider to remap channels for.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask representing the running operation.</dd></dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00664">664</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  665</span>        {</div>
<div class="line"><span class="lineno">  666</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Remapping channels for provider reconnection...&quot;</span>);</div>
<div class="line"><span class="lineno">  667</span>            IEnumerable&lt;Models.ChatChannel&gt;? channelsToMap;</div>
<div class="line"><span class="lineno">  668</span>            <span class="keywordtype">long</span> providerId;</div>
<div class="line"><span class="lineno">  669</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>)</div>
<div class="line"><span class="lineno">  670</span>                providerId = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>.Where(x =&gt; x.Value == provider).Select(x =&gt; x.Key).First();</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>)</div>
<div class="line"><span class="lineno">  673</span>                channelsToMap = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>.FirstOrDefault(x =&gt; x.Id == providerId)?.Channels;</div>
<div class="line"><span class="lineno">  674</span> </div>
<div class="line"><span class="lineno">  675</span>            <span class="keywordflow">if</span> (channelsToMap?.Any() ?? <span class="keyword">false</span>)</div>
<div class="line"><span class="lineno">  676</span>                await <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a627c57e5a0a6cc6f52a9f7f09cfa5694">ChangeChannels</a>(providerId, channelsToMap, cancellationToken);</div>
<div class="line"><span class="lineno">  677</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a627c57e5a0a6cc6f52a9f7f09cfa5694"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a627c57e5a0a6cc6f52a9f7f09cfa5694">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels</a></div><div class="ttdeci">async ValueTask ChangeChannels(long connectionId, IEnumerable&lt; Models.ChatChannel &gt; newChannels, CancellationToken cancellationToken)</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00191">ChatManager.cs:191</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af46a3f4845f2190ea2c22af33e233c31" name="af46a3f4845f2190ea2c22af33e233c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af46a3f4845f2190ea2c22af33e233c31">&#9670;&#160;</a></span>RemoveProviderChannels()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async ValueTask&lt; <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a>?&gt; Tgstation.Server.Host.Components.Chat.ChatManager.RemoveProviderChannels </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>connectionId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>removeProvider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove a IProvider from mappedChannels optionally removing the provider itself from providers and updating the trackingContexts as well. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connectionId</td><td>The <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">EntityId.Id</a> of the IProvider to delete.</td></tr>
    <tr><td class="paramname">removeProvider</td><td>If the provider should be removed from providers and trackingContexts should be update.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask&lt;TResult&gt; resulting in the IProvider being removed if it exists, <code>null</code> otherwise.</dd></dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00622">622</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  623</span>        {</div>
<div class="line"><span class="lineno">  624</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;RemoveProviderChannels {connectionId}...&quot;</span>, connectionId);</div>
<div class="line"><span class="lineno">  625</span>            <a class="code hl_interface" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a>? provider;</div>
<div class="line"><span class="lineno">  626</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>)</div>
<div class="line"><span class="lineno">  627</span>            {</div>
<div class="line"><span class="lineno">  628</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>.TryGetValue(connectionId, out provider))</div>
<div class="line"><span class="lineno">  629</span>                {</div>
<div class="line"><span class="lineno">  630</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Aborted, no such provider!&quot;</span>);</div>
<div class="line"><span class="lineno">  631</span>                    <span class="keywordflow">return</span> <span class="keyword">null</span>;</div>
<div class="line"><span class="lineno">  632</span>                }</div>
<div class="line"><span class="lineno">  633</span> </div>
<div class="line"><span class="lineno">  634</span>                <span class="keywordflow">if</span> (removeProvider)</div>
<div class="line"><span class="lineno">  635</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>.Remove(connectionId);</div>
<div class="line"><span class="lineno">  636</span>            }</div>
<div class="line"><span class="lineno">  637</span> </div>
<div class="line"><span class="lineno">  638</span>            ValueTask trackingContextsUpdateTask;</div>
<div class="line"><span class="lineno">  639</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>)</div>
<div class="line"><span class="lineno">  640</span>            {</div>
<div class="line"><span class="lineno">  641</span>                <span class="keywordflow">foreach</span> (var mappedConnectionChannel <span class="keywordflow">in</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Where(x =&gt; x.Value.ProviderId == connectionId).Select(x =&gt; x.Key).ToList())</div>
<div class="line"><span class="lineno">  642</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Remove(mappedConnectionChannel);</div>
<div class="line"><span class="lineno">  643</span> </div>
<div class="line"><span class="lineno">  644</span>                var newMappedChannels = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Select(y =&gt; y.Value.Channel).ToList();</div>
<div class="line"><span class="lineno">  645</span> </div>
<div class="line"><span class="lineno">  646</span>                <span class="keywordflow">if</span> (removeProvider)</div>
<div class="line"><span class="lineno">  647</span>                    lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a>)</div>
<div class="line"><span class="lineno">  648</span>                        trackingContextsUpdateTask = <a class="code hl_class" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html">ValueTaskExtensions</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3">WhenAll</a>(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a>.Select(x =&gt; x.UpdateChannels(newMappedChannels, cancellationToken)));</div>
<div class="line"><span class="lineno">  649</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  650</span>                    trackingContextsUpdateTask = ValueTask.CompletedTask;</div>
<div class="line"><span class="lineno">  651</span>            }</div>
<div class="line"><span class="lineno">  652</span> </div>
<div class="line"><span class="lineno">  653</span>            await trackingContextsUpdateTask;</div>
<div class="line"><span class="lineno">  654</span> </div>
<div class="line"><span class="lineno">  655</span>            <span class="keywordflow">return</span> provider;</div>
<div class="line"><span class="lineno">  656</span>        }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_value_task_extensions_8cs_source.html#l00099">Tgstation.Server.Common.Extensions.ValueTaskExtensions.WhenAll()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_af46a3f4845f2190ea2c22af33e233c31_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_af46a3f4845f2190ea2c22af33e233c31_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_af46a3f4845f2190ea2c22af33e233c31_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_af46a3f4845f2190ea2c22af33e233c31_cgraph">
<area shape="rect" title="Remove a IProvider from mappedChannels optionally removing the provider itself from providers and upd..." alt="" coords="5,13,287,54"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3" title="Fully await a given list of tasks ." alt="" coords="335,5,550,61"/>
<area shape="poly" title=" " alt="" coords="287,31,319,31,319,36,287,36"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_af46a3f4845f2190ea2c22af33e233c31_icgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_af46a3f4845f2190ea2c22af33e233c31_icgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_af46a3f4845f2190ea2c22af33e233c31_icgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_af46a3f4845f2190ea2c22af33e233c31_icgraph">
<area shape="rect" title="Remove a IProvider from mappedChannels optionally removing the provider itself from providers and upd..." alt="" coords="283,5,564,46"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a627c57e5a0a6cc6f52a9f7f09cfa5694" title=" " alt="" coords="5,5,235,46"/>
<area shape="poly" title=" " alt="" coords="267,28,235,28,235,23,267,23"/>
</map>
</div>

</div>
</div>
<a id="a14df10dd6677ff9fbf9d9d3bdc05c99f" name="a14df10dd6677ff9fbf9d9d3bdc05c99f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14df10dd6677ff9fbf9d9d3bdc05c99f">&#9670;&#160;</a></span>SendMessage()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ValueTask Tgstation.Server.Host.Components.Chat.ChatManager.SendMessage </td>
          <td>(</td>
          <td class="paramtype">IEnumerable&lt; ulong &gt;&#160;</td>
          <td class="paramname"><em>channelIds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_message.html">Message</a>?&#160;</td>
          <td class="paramname"><em>replyTo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html">MessageContent</a>&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Asynchronously send a given <em>message</em>  to a set of <em>channelIds</em> . </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channelIds</td><td>The Models.ChatChannel.Ids of the Models.ChatChannels to send to.</td></tr>
    <tr><td class="paramname">replyTo</td><td>The Message to reply to.</td></tr>
    <tr><td class="paramname">message</td><td>The MessageContent to send.</td></tr>
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task representing the running operation.</dd></dl>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l01026">1026</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1027</span>        {</div>
<div class="line"><span class="lineno"> 1028</span>            var channelIdsList = channelIds.ToList();</div>
<div class="line"><span class="lineno"> 1029</span> </div>
<div class="line"><span class="lineno"> 1030</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(</div>
<div class="line"><span class="lineno"> 1031</span>                <span class="stringliteral">&quot;Chat send \&quot;{message}\&quot;{embed} to channels: [{channelIdsCommaSeperated}]&quot;</span>,</div>
<div class="line"><span class="lineno"> 1032</span>                message.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html#acc847c3c842120dede3072ddb6e0c0cd">Text</a>,</div>
<div class="line"><span class="lineno"> 1033</span>                message.<a class="code hl_property" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html#a60f2aaeaf7f59e642e62b322bb1bce63">Embed</a> != <span class="keyword">null</span> ? <span class="stringliteral">&quot; (with embed)&quot;</span> : String.Empty,</div>
<div class="line"><span class="lineno"> 1034</span>                String.Join(<span class="stringliteral">&quot;, &quot;</span>, channelIdsList));</div>
<div class="line"><span class="lineno"> 1035</span> </div>
<div class="line"><span class="lineno"> 1036</span>            <span class="keywordflow">if</span> (channelIdsList.Count == 0)</div>
<div class="line"><span class="lineno"> 1037</span>                <span class="keywordflow">return</span> ValueTask.CompletedTask;</div>
<div class="line"><span class="lineno"> 1038</span> </div>
<div class="line"><span class="lineno"> 1039</span>            <span class="keywordflow">return</span> <a class="code hl_class" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html">ValueTaskExtensions</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3">WhenAll</a>(</div>
<div class="line"><span class="lineno"> 1040</span>                channelIdsList.Select(x =&gt;</div>
<div class="line"><span class="lineno"> 1041</span>                {</div>
<div class="line"><span class="lineno"> 1042</span>                    ChannelMapping? channelMapping;</div>
<div class="line"><span class="lineno"> 1043</span>                    lock (mappedChannels)</div>
<div class="line"><span class="lineno"> 1044</span>                        if (!mappedChannels.TryGetValue(x, out channelMapping))</div>
<div class="line"><span class="lineno"> 1045</span>                            return ValueTask.CompletedTask;</div>
<div class="line"><span class="lineno"> 1046</span>                    IProvider? provider;</div>
<div class="line"><span class="lineno"> 1047</span>                    lock (providers)</div>
<div class="line"><span class="lineno"> 1048</span>                        if (!providers.TryGetValue(channelMapping.ProviderId, out provider))</div>
<div class="line"><span class="lineno"> 1049</span>                            return ValueTask.CompletedTask;</div>
<div class="line"><span class="lineno"> 1050</span>                    return provider.SendMessage(replyTo, message, channelMapping.ProviderChannelId, cancellationToken);</div>
<div class="line"><span class="lineno"> 1051</span>                }));</div>
<div class="line"><span class="lineno"> 1052</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content_html_a60f2aaeaf7f59e642e62b322bb1bce63"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html#a60f2aaeaf7f59e642e62b322bb1bce63">Tgstation.Server.Host.Components.Interop.MessageContent.Embed</a></div><div class="ttdeci">ChatEmbed? Embed</div><div class="ttdoc">The ChatEmbed.</div><div class="ttdef"><b>Definition</b> <a href="_message_content_8cs_source.html#l00016">MessageContent.cs:16</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content_html_acc847c3c842120dede3072ddb6e0c0cd"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_interop_1_1_message_content.html#acc847c3c842120dede3072ddb6e0c0cd">Tgstation.Server.Host.Components.Interop.MessageContent.Text</a></div><div class="ttdeci">string? Text</div><div class="ttdoc">The message string.</div><div class="ttdef"><b>Definition</b> <a href="_message_content_8cs_source.html#l00011">MessageContent.cs:11</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_message_content_8cs_source.html#l00016">Tgstation.Server.Host.Components.Interop.MessageContent.Embed</a>, <a class="el" href="_message_content_8cs_source.html#l00011">Tgstation.Server.Host.Components.Interop.MessageContent.Text</a>, and <a class="el" href="_value_task_extensions_8cs_source.html#l00099">Tgstation.Server.Common.Extensions.ValueTaskExtensions.WhenAll()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a14df10dd6677ff9fbf9d9d3bdc05c99f_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a14df10dd6677ff9fbf9d9d3bdc05c99f_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a14df10dd6677ff9fbf9d9d3bdc05c99f_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_a14df10dd6677ff9fbf9d9d3bdc05c99f_cgraph">
<area shape="rect" title="Asynchronously send a given message &#160;to a set of channelIds ." alt="" coords="5,13,232,54"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3" title="Fully await a given list of tasks ." alt="" coords="280,5,495,61"/>
<area shape="poly" title=" " alt="" coords="232,31,264,31,264,36,232,36"/>
</map>
</div>

</div>
</div>
<a id="ae189d33da50a0791f4caf35fa3eb2567" name="ae189d33da50a0791f4caf35fa3eb2567"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae189d33da50a0791f4caf35fa3eb2567">&#9670;&#160;</a></span>StartAsync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async Task Tgstation.Server.Host.Components.Chat.ChatManager.StartAsync </td>
          <td>(</td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p></p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00473">473</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  474</span>        {</div>
<div class="line"><span class="lineno">  475</span>            <span class="keywordflow">foreach</span> (var tgsCommand <span class="keywordflow">in</span> <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#aa6a9c74750f2d7681b3e2f2a2913d0b3">commandFactory</a>.<a class="code hl_function" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_factory.html#aeb2c367e49d99ddde4c96c516cba6633">GenerateCommands</a>())</div>
<div class="line"><span class="lineno">  476</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a69d25612b62368e0fb9ac204987ed7b6">builtinCommands</a>.Add(tgsCommand.Name.ToUpperInvariant(), tgsCommand);</div>
<div class="line"><span class="lineno">  477</span>            var initialChatBots = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a3ca52a2da0df3c6f05614dc8e87a4ec0">activeChatBots</a>.ToList();</div>
<div class="line"><span class="lineno">  478</span>            await <a class="code hl_class" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html">ValueTaskExtensions</a>.<a class="code hl_function" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3">WhenAll</a>(initialChatBots.Select(x =&gt; <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8d3eb0ce3398090f2f26241f515845fb">ChangeSettings</a>(x, cancellationToken)));</div>
<div class="line"><span class="lineno">  479</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a2cd00fcaf7dd3fe543c97bb315bd1837">initialProviderConnectionsTask</a> = <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a422e8e55e6988c994b23eaaf16cf0498">InitialConnection</a>();</div>
<div class="line"><span class="lineno">  480</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a87f1fd43fb31e2681bd1852ae7bf7ae8">chatHandler</a> = <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a530e8ef5a58711a9c6744021df74afb2">MonitorMessages</a>(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#adc4749cb2a207e472c9fac07cf56e981">handlerCts</a>.Token);</div>
<div class="line"><span class="lineno">  481</span>        }</div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a422e8e55e6988c994b23eaaf16cf0498"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a422e8e55e6988c994b23eaaf16cf0498">Tgstation.Server.Host.Components.Chat.ChatManager.InitialConnection</a></div><div class="ttdeci">async Task InitialConnection()</div><div class="ttdoc">Aggregate all IProvider.InitialConnectionJobs into one &lt;sse cref=&quot;Task&quot;&gt;.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l01058">ChatManager.cs:1058</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a530e8ef5a58711a9c6744021df74afb2"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a530e8ef5a58711a9c6744021df74afb2">Tgstation.Server.Host.Components.Chat.ChatManager.MonitorMessages</a></div><div class="ttdeci">async Task MonitorMessages(CancellationToken cancellationToken)</div><div class="ttdoc">Monitors active providers for new Messages.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00933">ChatManager.cs:933</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a87f1fd43fb31e2681bd1852ae7bf7ae8"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a87f1fd43fb31e2681bd1852ae7bf7ae8">Tgstation.Server.Host.Components.Chat.ChatManager.chatHandler</a></div><div class="ttdeci">Task? chatHandler</div><div class="ttdoc">The Task that monitors incoming chat messages.</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00108">ChatManager.cs:108</a></div></div>
<div class="ttc" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_html_a8d3eb0ce3398090f2f26241f515845fb"><div class="ttname"><a href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8d3eb0ce3398090f2f26241f515845fb">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings</a></div><div class="ttdeci">async ValueTask ChangeSettings(Models.ChatBot newSettings, CancellationToken cancellationToken)</div><div class="ttdoc">Change chat settings. If the Api.Models.EntityId.Id is not currently in use, a new connection will be...</div><div class="ttdef"><b>Definition</b> <a href="_chat_manager_8cs_source.html#l00281">ChatManager.cs:281</a></div></div>
<div class="ttc" id="ainterface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_factory_html_aeb2c367e49d99ddde4c96c516cba6633"><div class="ttname"><a href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_factory.html#aeb2c367e49d99ddde4c96c516cba6633">Tgstation.Server.Host.Components.Chat.Commands.ICommandFactory.GenerateCommands</a></div><div class="ttdeci">IReadOnlyList&lt; ICommand &gt; GenerateCommands()</div><div class="ttdoc">Generate builtin ICommands.</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="_value_task_extensions_8cs_source.html#l00099">Tgstation.Server.Common.Extensions.ValueTaskExtensions.WhenAll()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae189d33da50a0791f4caf35fa3eb2567_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae189d33da50a0791f4caf35fa3eb2567_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae189d33da50a0791f4caf35fa3eb2567_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae189d33da50a0791f4caf35fa3eb2567_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,232,54"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_common_1_1_extensions_1_1_value_task_extensions.html#a58adbd94d764754bd3e6c566a5fe7fe3" title="Fully await a given list of tasks ." alt="" coords="280,5,495,61"/>
<area shape="poly" title=" " alt="" coords="232,31,264,31,264,36,232,36"/>
</map>
</div>

</div>
</div>
<a id="af798c33e00b6fbbf046c8459cfd06eab" name="af798c33e00b6fbbf046c8459cfd06eab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af798c33e00b6fbbf046c8459cfd06eab">&#9670;&#160;</a></span>StopAsync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async Task Tgstation.Server.Host.Components.Chat.ChatManager.StopAsync </td>
          <td>(</td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p></p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00484">484</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  485</span>        {</div>
<div class="line"><span class="lineno">  486</span>            <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#adc4749cb2a207e472c9fac07cf56e981">handlerCts</a>.Cancel();</div>
<div class="line"><span class="lineno">  487</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a87f1fd43fb31e2681bd1852ae7bf7ae8">chatHandler</a> != <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  488</span>                await <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a87f1fd43fb31e2681bd1852ae7bf7ae8">chatHandler</a>;</div>
<div class="line"><span class="lineno">  489</span>            await Task.WhenAll(<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a4cad1103e8e6752fa1772016effff937">providers</a>.Select(x =&gt; x.Key).Select(x =&gt; <a class="code hl_function" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#ae8f42e9fc59f0aa9d70de26a4b6600b7">DeleteConnection</a>(x, cancellationToken)));</div>
<div class="line"><span class="lineno">  490</span>            await <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a8537715fb809f78e49b1497bcd82849e">messageSendTask</a>;</div>
<div class="line"><span class="lineno">  491</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae2f686caab499a7d4ff36174d99a81e7" name="ae2f686caab499a7d4ff36174d99a81e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2f686caab499a7d4ff36174d99a81e7">&#9670;&#160;</a></span>UpdateTrackingContexts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async ValueTask Tgstation.Server.Host.Components.Chat.ChatManager.UpdateTrackingContexts </td>
          <td>(</td>
          <td class="paramtype">CancellationToken&#160;</td>
          <td class="paramname"><em>cancellationToken</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Force an update with the active channels on all active <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_tracking_context.html" title="Represents a tracking of dynamic chat json files.">IChatTrackingContext</a>s.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cancellationToken</td><td>The CancellationToken for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A ValueTask representing the running operation.</dd></dl>
 </p>

<p>Implements <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_manager.html#a9db61524573df9c1993f87862c29aae2">Tgstation.Server.Host.Components.Chat.IChatManager</a>.</p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00518">518</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  519</span>        {</div>
<div class="line"><span class="lineno">  520</span>            var logMessageSent = 0;</div>
<div class="line"><span class="lineno">  521</span>            async Task UpdateTrackingContext(IChatTrackingContext channelSink, IEnumerable&lt;ChannelRepresentation&gt; channels)</div>
<div class="line"><span class="lineno">  522</span>            {</div>
<div class="line"><span class="lineno">  523</span>                <span class="keywordflow">if</span> (Interlocked.Exchange(ref logMessageSent, 1) == 0)</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>                await channelSink.UpdateChannels(channels, cancellationToken);</div>
<div class="line"><span class="lineno">  526</span>            }</div>
<div class="line"><span class="lineno">  527</span> </div>
<div class="line"><span class="lineno">  528</span>            var waitingForInitialConnection = !<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a2cd00fcaf7dd3fe543c97bb315bd1837">initialProviderConnectionsTask</a>!.IsCompleted;</div>
<div class="line"><span class="lineno">  529</span>            <span class="keywordflow">if</span> (waitingForInitialConnection)</div>
<div class="line"><span class="lineno">  530</span>            {</div>
<div class="line"><span class="lineno">  531</span>                <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Waiting for initial chat bot connections before updating tracking contexts...&quot;</span>);</div>
<div class="line"><span class="lineno">  532</span>                await <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a2cd00fcaf7dd3fe543c97bb315bd1837">initialProviderConnectionsTask</a>.WaitAsync(cancellationToken);</div>
<div class="line"><span class="lineno">  533</span>            }</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>            List&lt;Task&gt; tasks;</div>
<div class="line"><span class="lineno">  536</span>            lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>)</div>
<div class="line"><span class="lineno">  537</span>                lock (<a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a>)</div>
<div class="line"><span class="lineno">  538</span>                    tasks = <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#af98ea12e0c98e5cc3815d59cace7567a">trackingContexts</a>.Select(x =&gt; UpdateTrackingContext(x, <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#affabd2c8c6dccbfc92ab509c9405b88b">mappedChannels</a>.Select(y =&gt; y.Value.Channel))).ToList();</div>
<div class="line"><span class="lineno">  539</span> </div>
<div class="line"><span class="lineno">  540</span>            <span class="keywordflow">if</span> (waitingForInitialConnection)</div>
<div class="line"><span class="lineno">  541</span>                <span class="keywordflow">if</span> (tasks.Count &gt; 0)</div>
<div class="line"><span class="lineno">  542</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;Updating chat tracking contexts...&quot;</span>);</div>
<div class="line"><span class="lineno">  543</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  544</span>                    <a class="code hl_variable" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#abc0dda9d12fd94b299931aaa8d4aa8bd">logger</a>.LogTrace(<span class="stringliteral">&quot;No chat tracking contexts to update&quot;</span>);</div>
<div class="line"><span class="lineno">  545</span> </div>
<div class="line"><span class="lineno">  546</span>            await Task.WhenAll(tasks);</div>
<div class="line"><span class="lineno">  547</span>        }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_channel_sink.html#a0a3e498cc9efaf16adabea814bdae5b7">Tgstation.Server.Host.Components.Chat.IChannelSink.UpdateChannels()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae2f686caab499a7d4ff36174d99a81e7_cgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae2f686caab499a7d4ff36174d99a81e7_cgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae2f686caab499a7d4ff36174d99a81e7_cgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae2f686caab499a7d4ff36174d99a81e7_cgraph">
<area shape="rect" title="Force an update with the active channels on all active IChatTrackingContexts.A ValueTask representing..." alt="" coords="5,5,280,46"/>
<area shape="rect" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_channel_sink.html#a0a3e498cc9efaf16adabea814bdae5b7" title="Called when newChannels &#160;are set." alt="" coords="328,5,555,46"/>
<area shape="poly" title=" " alt="" coords="280,23,312,23,312,28,280,28"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae2f686caab499a7d4ff36174d99a81e7_icgraph.png" border="0" usemap="#aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae2f686caab499a7d4ff36174d99a81e7_icgraph" alt=""/></div>
<map name="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae2f686caab499a7d4ff36174d99a81e7_icgraph" id="aclass_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager_ae2f686caab499a7d4ff36174d99a81e7_icgraph">
<area shape="rect" title="Force an update with the active channels on all active IChatTrackingContexts.A ValueTask representing..." alt="" coords="283,5,557,46"/>
<area shape="rect" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html#a627c57e5a0a6cc6f52a9f7f09cfa5694" title=" " alt="" coords="5,5,235,46"/>
<area shape="poly" title=" " alt="" coords="267,28,235,28,235,23,267,23"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a3ca52a2da0df3c6f05614dc8e87a4ec0" name="a3ca52a2da0df3c6f05614dc8e87a4ec0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ca52a2da0df3c6f05614dc8e87a4ec0">&#9670;&#160;</a></span>activeChatBots</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly List&lt;<a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_models_1_1_chat_bot.html">Models.ChatBot</a>&gt; Tgstation.Server.Host.Components.Chat.ChatManager.activeChatBots</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The active Models.ChatBot for the ChatManager. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00088">88</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00281">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<a id="a69d25612b62368e0fb9ac204987ed7b6" name="a69d25612b62368e0fb9ac204987ed7b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69d25612b62368e0fb9ac204987ed7b6">&#9670;&#160;</a></span>builtinCommands</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly Dictionary&lt;string, <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command.html">ICommand</a>&gt; Tgstation.Server.Host.Components.Chat.ChatManager.builtinCommands</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unchanging ICommands in the ChatManager mapped by <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command.html#aa9cbbf23975efc1dde048ee43a6e1d4b" title="The text to invoke the command. May not be &quot;?&quot; or &quot;help&quot; (case-insensitive).">ICommand.Name</a>. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00063">63</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<a id="abef5c8cc20c6ed55f7393272cc5e5cbe" name="abef5c8cc20c6ed55f7393272cc5e5cbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abef5c8cc20c6ed55f7393272cc5e5cbe">&#9670;&#160;</a></span>changeChannelSemaphores</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly ConcurrentDictionary&lt;long, SemaphoreSlim&gt; Tgstation.Server.Host.Components.Chat.ChatManager.changeChannelSemaphores</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Map of SemaphoreSlims used to guard concurrent access to ChangeChannels(long, IEnumerable&lt;Models.ChatChannel&gt;, CancellationToken), keyed by ChatBotSettings <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">EntityId.Id</a>. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00073">73</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00176">Tgstation.Server.Host.Components.Chat.ChatManager.DisposeAsync()</a>.</p>

</div>
</div>
<a id="a9f8c4d78e74aa61eb4aaa13cc1a88bbf" name="a9f8c4d78e74aa61eb4aaa13cc1a88bbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f8c4d78e74aa61eb4aaa13cc1a88bbf">&#9670;&#160;</a></span>channelIdCounter</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ulong Tgstation.Server.Host.Components.Chat.ChatManager.channelIdCounter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used for remapping ChannelRepresentation.RealIds. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00128">128</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<a id="a87f1fd43fb31e2681bd1852ae7bf7ae8" name="a87f1fd43fb31e2681bd1852ae7bf7ae8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87f1fd43fb31e2681bd1852ae7bf7ae8">&#9670;&#160;</a></span>chatHandler</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Task? Tgstation.Server.Host.Components.Chat.ChatManager.chatHandler</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The Task that monitors incoming chat messages. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00108">108</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

</div>
</div>
<a id="aa6a9c74750f2d7681b3e2f2a2913d0b3" name="aa6a9c74750f2d7681b3e2f2a2913d0b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6a9c74750f2d7681b3e2f2a2913d0b3">&#9670;&#160;</a></span>commandFactory</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_commands_1_1_i_command_factory.html">ICommandFactory</a> Tgstation.Server.Host.Components.Chat.ChatManager.commandFactory</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The ICommandFactory for the ChatManager. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00043">43</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<a id="a0b5b0d03d129b21de29dc2c2bbf17edf" name="a0b5b0d03d129b21de29dc2c2bbf17edf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b5b0d03d129b21de29dc2c2bbf17edf">&#9670;&#160;</a></span>CommonMention</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const string Tgstation.Server.Host.Components.Chat.ChatManager.CommonMention = &quot;!tgs&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The common bot mention. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00033">33</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_discord_provider_8cs_source.html#l00482">Tgstation.Server.Host.Components.Chat.Providers.DiscordProvider.RespondAsync()</a>.</p>

</div>
</div>
<a id="ae24bfda149bf5a3080399529e7ef299c" name="ae24bfda149bf5a3080399529e7ef299c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae24bfda149bf5a3080399529e7ef299c">&#9670;&#160;</a></span>connectionsUpdated</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TaskCompletionSource Tgstation.Server.Host.Components.Chat.ChatManager.connectionsUpdated</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The TaskCompletionSource that completes when ChatBotSettingss change. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00123">123</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00281">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<a id="a537b7a1db9aa8fab1de0dfb4587b2b3b" name="a537b7a1db9aa8fab1de0dfb4587b2b3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a537b7a1db9aa8fab1de0dfb4587b2b3b">&#9670;&#160;</a></span>customCommandHandler</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_custom_command_handler.html">ICustomCommandHandler</a>? Tgstation.Server.Host.Components.Chat.ChatManager.customCommandHandler</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The ICustomCommandHandler for the ChangeChannels(long, IEnumerable&lt;Models.ChatChannel&gt;, CancellationToken). </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00103">103</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

</div>
</div>
<a id="adc4749cb2a207e472c9fac07cf56e981" name="adc4749cb2a207e472c9fac07cf56e981"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc4749cb2a207e472c9fac07cf56e981">&#9670;&#160;</a></span>handlerCts</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly CancellationTokenSource Tgstation.Server.Host.Components.Chat.ChatManager.handlerCts</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The CancellationTokenSource for chatHandler. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00093">93</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00176">Tgstation.Server.Host.Components.Chat.ChatManager.DisposeAsync()</a>.</p>

</div>
</div>
<a id="a2cd00fcaf7dd3fe543c97bb315bd1837" name="a2cd00fcaf7dd3fe543c97bb315bd1837"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2cd00fcaf7dd3fe543c97bb315bd1837">&#9670;&#160;</a></span>initialProviderConnectionsTask</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Task? Tgstation.Server.Host.Components.Chat.ChatManager.initialProviderConnectionsTask</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A Task that represents the IProviders initial connection. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00113">113</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00353">Tgstation.Server.Host.Components.Chat.ChatManager.QueueWatchdogMessage()</a>.</p>

</div>
</div>
<a id="abc0dda9d12fd94b299931aaa8d4aa8bd" name="abc0dda9d12fd94b299931aaa8d4aa8bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc0dda9d12fd94b299931aaa8d4aa8bd">&#9670;&#160;</a></span>logger</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly ILogger&lt;<a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_chat_manager.html">ChatManager</a>&gt; Tgstation.Server.Host.Components.Chat.ChatManager.logger</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The ILogger for the ChatManager. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00058">58</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00281">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00176">Tgstation.Server.Host.Components.Chat.ChatManager.DisposeAsync()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00378">Tgstation.Server.Host.Components.Chat.ChatManager.QueueDeploymentMessage()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00353">Tgstation.Server.Host.Components.Chat.ChatManager.QueueWatchdogMessage()</a>.</p>

</div>
</div>
<a id="a76009f2ea5bcdd632cd599fc3857ac96" name="a76009f2ea5bcdd632cd599fc3857ac96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76009f2ea5bcdd632cd599fc3857ac96">&#9670;&#160;</a></span>loggerFactory</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly ILoggerFactory Tgstation.Server.Host.Components.Chat.ChatManager.loggerFactory</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The ILoggerFactory for the ChatManager. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00053">53</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<a id="affabd2c8c6dccbfc92ab509c9405b88b" name="affabd2c8c6dccbfc92ab509c9405b88b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affabd2c8c6dccbfc92ab509c9405b88b">&#9670;&#160;</a></span>mappedChannels</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly Dictionary&lt;ulong, <a class="el" href="class_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_channel_mapping.html">ChannelMapping</a>&gt; Tgstation.Server.Host.Components.Chat.ChatManager.mappedChannels</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Map of ChannelRepresentation.RealIds to ChannelMappings. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00078">78</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00281">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00378">Tgstation.Server.Host.Components.Chat.ChatManager.QueueDeploymentMessage()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00353">Tgstation.Server.Host.Components.Chat.ChatManager.QueueWatchdogMessage()</a>.</p>

</div>
</div>
<a id="a8537715fb809f78e49b1497bcd82849e" name="a8537715fb809f78e49b1497bcd82849e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8537715fb809f78e49b1497bcd82849e">&#9670;&#160;</a></span>messageSendTask</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Task Tgstation.Server.Host.Components.Chat.ChatManager.messageSendTask</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A Task that represents all sent messages. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00118">118</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00176">Tgstation.Server.Host.Components.Chat.ChatManager.DisposeAsync()</a>.</p>

</div>
</div>
<a id="a0f90df8e6ed21489cc4b57f690f41c7e" name="a0f90df8e6ed21489cc4b57f690f41c7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f90df8e6ed21489cc4b57f690f41c7e">&#9670;&#160;</a></span>messagesProcessed</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">long Tgstation.Server.Host.Components.Chat.ChatManager.messagesProcessed</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The number of Messages processed. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00133">133</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

</div>
</div>
<a id="a13f4e387e7b5419193b74e1ae3cd0fb5" name="a13f4e387e7b5419193b74e1ae3cd0fb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13f4e387e7b5419193b74e1ae3cd0fb5">&#9670;&#160;</a></span>providerFactory</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider_factory.html">IProviderFactory</a> Tgstation.Server.Host.Components.Chat.ChatManager.providerFactory</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The IProviderFactory for the ChatManager. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00038">38</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00281">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<a id="a4cad1103e8e6752fa1772016effff937" name="a4cad1103e8e6752fa1772016effff937"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cad1103e8e6752fa1772016effff937">&#9670;&#160;</a></span>providers</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly Dictionary&lt;long, <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_providers_1_1_i_provider.html">IProvider</a>&gt; Tgstation.Server.Host.Components.Chat.ChatManager.providers</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Map of IProviders in use, keyed by ChatBotSettings <a class="el" href="class_tgstation_1_1_server_1_1_api_1_1_models_1_1_entity_id.html#ae31e478e1d338b37a14565df6fd58570" title="The ID of the entity.">EntityId.Id</a>. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00068">68</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00281">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00176">Tgstation.Server.Host.Components.Chat.ChatManager.DisposeAsync()</a>.</p>

</div>
</div>
<a id="ac3dec357800cfc9a526c82d61fe99803" name="ac3dec357800cfc9a526c82d61fe99803"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3dec357800cfc9a526c82d61fe99803">&#9670;&#160;</a></span>restartRegistration</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly <a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_core_1_1_i_restart_registration.html">IRestartRegistration</a> Tgstation.Server.Host.Components.Chat.ChatManager.restartRegistration</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The IRestartRegistration for the ChatManager. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00048">48</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00176">Tgstation.Server.Host.Components.Chat.ChatManager.DisposeAsync()</a>.</p>

</div>
</div>
<a id="a1ac2daf67a09f128290588a5181c88ba" name="a1ac2daf67a09f128290588a5181c88ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ac2daf67a09f128290588a5181c88ba">&#9670;&#160;</a></span>synchronizationLock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly object Tgstation.Server.Host.Components.Chat.ChatManager.synchronizationLock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used for various lock statements throughout this <code>class</code>. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00098">98</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00191">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeChannels()</a>, <a class="el" href="_chat_manager_8cs_source.html#l00281">Tgstation.Server.Host.Components.Chat.ChatManager.ChangeSettings()</a>, and <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<a id="af98ea12e0c98e5cc3815d59cace7567a" name="af98ea12e0c98e5cc3815d59cace7567a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af98ea12e0c98e5cc3815d59cace7567a">&#9670;&#160;</a></span>trackingContexts</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly List&lt;<a class="el" href="interface_tgstation_1_1_server_1_1_host_1_1_components_1_1_chat_1_1_i_chat_tracking_context.html">IChatTrackingContext</a>&gt; Tgstation.Server.Host.Components.Chat.ChatManager.trackingContexts</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The active IChatTrackingContexts for the ChatManager. </p>

<p class="definition">Definition at line <a class="el" href="_chat_manager_8cs_source.html#l00083">83</a> of file <a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a>.</p>

<p class="reference">Referenced by <a class="el" href="_chat_manager_8cs_source.html#l00144">Tgstation.Server.Host.Components.Chat.ChatManager.ChatManager()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/Tgstation.Server.Host/Components/Chat/<a class="el" href="_chat_manager_8cs_source.html">ChatManager.cs</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
