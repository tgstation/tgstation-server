<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tgstation-server: TGServerService/ServerInstance/Byond.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tgs.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tgstation-server
   </div>
   <div id="projectbrief">The /tg/station 13 server suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f220d0611c2e3262469750905b70ffc9.html">TGServerService</a></li><li class="navelem"><a class="el" href="dir_7e4cc728347459cda364f4bf32c2446b.html">ServerInstance</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Byond.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_t_g_server_service_2_server_instance_2_byond_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.IO;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.IO.Compression;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Net;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Text.RegularExpressions;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Threading;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_t_g_service_interface.html">TGServiceInterface</a>.<a class="code" href="namespace_t_g_service_interface_1_1_components.html">Components</a>;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_t_g_server_service.html">TGServerService</a></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;{</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    sealed <span class="keyword">partial class </span>ServerInstance : <a class="code" href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_byond.html">ITGByond</a></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    {</div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a63d04056dea64487e7eaed6b26b57e3a">   18</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a63d04056dea64487e7eaed6b26b57e3a">ByondDirectory</a> = <span class="stringliteral">&quot;BYOND&quot;</span>;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#aaf67da3d367607fac5b98d52feed5efe">   22</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aaf67da3d367607fac5b98d52feed5efe">StagingDirectory</a> = <span class="stringliteral">&quot;BYOND_staged&quot;</span>;</div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a74331465cc7db01bbb583a5430e6d506">   26</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a74331465cc7db01bbb583a5430e6d506">StagingDirectoryInner</a> = StagingDirectory + <span class="stringliteral">&quot;/byond&quot;</span>;</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#aae957ffd2966d65e145b02b490d3710e">   30</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#aae957ffd2966d65e145b02b490d3710e">RevisionDownloadPath</a> = <span class="stringliteral">&quot;BYONDRevision.zip&quot;</span>;</div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a012f09818116b92edf15f9d4aff96dff">   34</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a012f09818116b92edf15f9d4aff96dff">VersionFile</a> = <span class="stringliteral">&quot;/byond_version.dat&quot;</span>;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a8602c86bbeaa9a0efaf0dec7f54a5ecb">   38</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8602c86bbeaa9a0efaf0dec7f54a5ecb">ByondRevisionsURL</a> = <span class="stringliteral">&quot;https://secure.byond.com/download/build/{0}/{0}.{1}_byond.zip&quot;</span>;</div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a19bd19fedfdb8cd0e5701215b483ce3f">   42</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a19bd19fedfdb8cd0e5701215b483ce3f">ByondLatestURL</a> = <span class="stringliteral">&quot;https://secure.byond.com/download/build/LATEST/&quot;</span>;</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a8534ec556abce2125376c3df9fd644c1">   46</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a8534ec556abce2125376c3df9fd644c1">ByondConfigDir</a> = StagingDirectory + <span class="stringliteral">&quot;/BYOND/cfg&quot;</span>;</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ae375b158f3e4eb869a967674ed9f3b74">   50</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae375b158f3e4eb869a967674ed9f3b74">ByondDDConfig</a> = ByondConfigDir + <span class="stringliteral">&quot;/daemon.txt&quot;</span>;</div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#afb3e8619b26aae0b35238283f6377c76">   54</a></span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#afb3e8619b26aae0b35238283f6377c76">ByondNoPromptTrustedMode</a> = <span class="stringliteral">&quot;trusted-check 0&quot;</span>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a773bda7930c58a1def918b077efcf2a1">   59</a></span>&#160;        <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a773bda7930c58a1def918b077efcf2a1">updateStat</a> = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Idle;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a0c663631406c567c006171c5b6bf361f">   64</a></span>&#160;        <span class="keywordtype">object</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a0c663631406c567c006171c5b6bf361f">ByondLock</a> = <span class="keyword">new</span> object();</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#adcc40d967672331fc5578d052f20743a">   68</a></span>&#160;        <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#adcc40d967672331fc5578d052f20743a">lastError</a>;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#afcb683e8f7cd91c6e64ce98e007899f4">   72</a></span>&#160;        Thread <a class="code" href="class_t_g_server_service_1_1_server_instance.html#afcb683e8f7cd91c6e64ce98e007899f4">RevisionStaging</a>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a1f51512799decc40e41edde3d1917d0e">   77</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1f51512799decc40e41edde3d1917d0e">InitByond</a>()</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1540f43c11b3123d35007af7d56567b6">CleanByondStaging</a>();</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a1540f43c11b3123d35007af7d56567b6">   85</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1540f43c11b3123d35007af7d56567b6">CleanByondStaging</a>()</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            var rrdp = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(RevisionDownloadPath);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="comment">//linger not</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">if</span> (File.Exists(rrdp))</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                File.Delete(rrdp);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <a class="code" href="class_t_g_server_service_1_1_program.html">Program</a>.<a class="code" href="class_t_g_server_service_1_1_program.html#af23c01e40193036d8b54ca95efb5b229">DeleteDirectory</a>(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(StagingDirectory));</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a0ae469ca70e8869f5f5ed794d7fe4ce5">   97</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a0ae469ca70e8869f5f5ed794d7fe4ce5">DisposeByond</a>()</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            lock (ByondLock)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="keywordflow">if</span> (RevisionStaging != null)</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                    RevisionStaging.Abort();</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1540f43c11b3123d35007af7d56567b6">CleanByondStaging</a>();</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a05bc0ce5b4867dfd63385a30bf713f9e">  111</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a05bc0ce5b4867dfd63385a30bf713f9e">BusyCheck</a>()</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            lock (ByondLock)</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <span class="keywordflow">switch</span> (updateStat)</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Starting:</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Downloading:</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Staging:</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Updating:</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Idle:</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Staged:</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a31b1bd6a8c38575bffb5442fbd75a677">  129</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a31b1bd6a8c38575bffb5442fbd75a677">CurrentStatus</a>()</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            lock (ByondLock)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a773bda7930c58a1def918b077efcf2a1">updateStat</a>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ac0e13a664468683095e10e352eec8cbf">  138</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ac0e13a664468683095e10e352eec8cbf">GetError</a>()</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            lock (ByondLock)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                var error = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#adcc40d967672331fc5578d052f20743a">lastError</a>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                lastError = null;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="keywordflow">return</span> error;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#ae64d03735cb348d0d162e493bf9b3f68">  149</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae64d03735cb348d0d162e493bf9b3f68">GetVersion</a>(<a class="code" href="namespace_t_g_service_interface.html#a7610968e566eeb321fee2adba3fbf107">ByondVersion</a> type)</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                lock (ByondLock)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                    <span class="keywordflow">if</span> (type == <a class="code" href="namespace_t_g_service_interface.html#a7610968e566eeb321fee2adba3fbf107">ByondVersion</a>.Latest)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                        <span class="comment">//get the latest version from the website</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(ByondLatestURL);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                        var results = <span class="keyword">new</span> List&lt;string&gt;();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                        <span class="keyword">using</span> (HttpWebResponse response = (HttpWebResponse)request.GetResponse())</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                        {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                            <span class="keyword">using</span> (StreamReader reader = <span class="keyword">new</span> StreamReader(response.GetResponseStream()))</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                            {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                                <span class="keywordtype">string</span> html = reader.ReadToEnd();</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                Regex regex = <span class="keyword">new</span> Regex(<span class="stringliteral">&quot;\\\&quot;([^\&quot;]*)\\\&quot;&quot;</span>);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                                MatchCollection matches = regex.Matches(html);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                <span class="keywordflow">foreach</span> (Match match <span class="keywordflow">in</span> matches)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                                    <span class="keywordflow">if</span> (match.Success &amp;&amp; match.Value.Contains(<span class="stringliteral">&quot;_byond.exe&quot;</span>))</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                                        results.Add(match.Value.Replace(<span class="stringliteral">&quot;\&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).Replace(<span class="stringliteral">&quot;_byond.exe&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                            }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                        }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                        results.Sort();</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                        results.Reverse();</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        <span class="keywordflow">return</span> results.Count &gt; 0 ? results[0] : null;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                    {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                        <span class="keywordtype">string</span> DirToUse = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(type == <a class="code" href="namespace_t_g_service_interface.html#a7610968e566eeb321fee2adba3fbf107">ByondVersion</a>.Staged ? StagingDirectoryInner : ByondDirectory);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                        <span class="keywordflow">if</span> (Directory.Exists(DirToUse))</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                        {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                            <span class="keywordtype">string</span> file = DirToUse + <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a012f09818116b92edf15f9d4aff96dff">VersionFile</a>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                            <span class="keywordflow">if</span> (File.Exists(file))</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                <span class="keywordflow">return</span> File.ReadAllText(file);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                        }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                    <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                <span class="keywordflow">return</span> <span class="stringliteral">&quot;Error: &quot;</span> + e.ToString();</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        </div><div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a4a2dc7c3b649bf0e7f81362c851a2c8f">  200</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a4a2dc7c3b649bf0e7f81362c851a2c8f">UpdateToVersionImpl</a>(<span class="keywordtype">object</span> param)</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            lock (ByondLock) { </div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                <span class="keywordflow">if</span> (updateStat != <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Starting)</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                updateStat = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Downloading;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a1540f43c11b3123d35007af7d56567b6">CleanByondStaging</a>();</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                var vi = ((string)param).Split(<span class="charliteral">&#39;.&#39;</span>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                var major = Convert.ToInt32(vi[0]);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                var minor = Convert.ToInt32(vi[1]);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                var rrdp = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(RevisionDownloadPath);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <span class="keyword">using</span> (var client = <span class="keyword">new</span> WebClient())</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                {</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(String.Format(<span class="stringliteral">&quot;BYOND: Updating to version {0}.{1}...&quot;</span>, major, minor), <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.DeveloperInfo);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                    <span class="comment">//DOWNLOADING</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    <span class="keywordflow">try</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                    {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                        client.DownloadFile(String.Format(ByondRevisionsURL, major, minor), rrdp);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                    <span class="keywordflow">catch</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                    {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;BYOND: Update download failed. Does the specified version exist?&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.DeveloperInfo);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                        lastError = String.Format(<span class="stringliteral">&quot;Download of BYOND version {0}.{1} failed! Does it exist?&quot;</span>, major, minor);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a9f6e141cd76aa497dcf72f14c1219017">WriteWarning</a>(String.Format(<span class="stringliteral">&quot;Failed to update BYOND to version {0}.{1}!&quot;</span>, major, minor), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.BYONDUpdateFail);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                        lock (ByondLock)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                        {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                            updateStat = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Idle;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                lock (ByondLock)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    updateStat = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Staging;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                <span class="comment">//STAGING</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                </div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                ZipFile.ExtractToDirectory(rrdp, <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(StagingDirectory));</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                lock (ByondLock)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    File.WriteAllText(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(StagingDirectoryInner + VersionFile), String.Format(<span class="stringliteral">&quot;{0}.{1}&quot;</span>, major, minor));</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    <span class="comment">//IMPORTANT: SET THE BYOND CONFIG TO NOT PROMPT FOR TRUSTED MODE REEE</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    Directory.CreateDirectory(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(ByondConfigDir));</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                    File.WriteAllText(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(ByondDDConfig), ByondNoPromptTrustedMode);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                File.Delete(RevisionDownloadPath);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                lock (ByondLock)</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    updateStat = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Staged;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                <span class="keywordflow">switch</span> (<a class="code" href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">DaemonStatus</a>())</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">DreamDaemonStatus</a>.Offline:</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a28e22392a22a56807a3c3a6a3a366860">ApplyStagedUpdate</a>())</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                            lastError = null;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                            lastError = <span class="stringliteral">&quot;Failed to apply update!&quot;</span>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a2e6fa52a6bc2f17eedd4c5d62f13063f">RequestRestart</a>();</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        lastError = <span class="stringliteral">&quot;Update staged. Awaiting server restart...&quot;</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(String.Format(<span class="stringliteral">&quot;BYOND: Staging complete. Awaiting server restart...&quot;</span>, major, minor), <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.DeveloperInfo);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a33c09fd7ed6d0907549e1cc08ad74562">WriteInfo</a>(String.Format(<span class="stringliteral">&quot;BYOND update {0}.{1} staged&quot;</span>, major, minor), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.BYONDUpdateStaged);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">catch</span> (ThreadAbortException)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            }</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <a class="code" href="class_t_g_server_service_1_1_server_instance.html#abc4aea21aa8dfb0039d9e384458b037e">WriteError</a>(<span class="stringliteral">&quot;Revision staging errror: &quot;</span> + e.ToString(), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.BYONDUpdateFail);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                lock (ByondLock)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    updateStat = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Idle;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    lastError = e.ToString();</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    RevisionStaging = null;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        }</div><div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a6136aa0574aa874d5532cb528e764d78">  292</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a6136aa0574aa874d5532cb528e764d78">UpdateToVersion</a>(<span class="keywordtype">int</span> major, <span class="keywordtype">int</span> minor)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            lock (ByondLock)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a05bc0ce5b4867dfd63385a30bf713f9e">BusyCheck</a>())</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    updateStat = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Starting;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    RevisionStaging = <span class="keyword">new</span> Thread(<span class="keyword">new</span> ParameterizedThreadStart(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a4a2dc7c3b649bf0e7f81362c851a2c8f">UpdateToVersionImpl</a>))</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                        IsBackground = <span class="keyword">true</span> <span class="comment">//don&#39;t slow me down</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                    };</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    RevisionStaging.Start(String.Format(<span class="stringliteral">&quot;{0}.{1}&quot;</span>, major, minor));</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>; </div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="class_t_g_server_service_1_1_server_instance.html#a28e22392a22a56807a3c3a6a3a366860">  314</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a28e22392a22a56807a3c3a6a3a366860">ApplyStagedUpdate</a>()</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            lock (<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a43598a044d75089e4c3a0b433bca455b">CompilerLock</a>)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a9adc6c97daa5981c9b4c6128c4df1f11">compilerCurrentStatus</a> == <a class="code" href="namespace_t_g_service_interface.html#af50082a408f9ae6f37a053a7a2464ef3">CompilerStatus</a>.Compiling)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                lock (ByondLock)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                    <span class="keywordflow">if</span> (updateStat != <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Staged)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                    updateStat = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Updating;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    var rbd = <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(ByondDirectory);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_program.html">Program</a>.<a class="code" href="class_t_g_server_service_1_1_program.html#af23c01e40193036d8b54ca95efb5b229">DeleteDirectory</a>(rbd);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    Directory.Move(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(StagingDirectoryInner), rbd);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_program.html">Program</a>.<a class="code" href="class_t_g_server_service_1_1_program.html#af23c01e40193036d8b54ca95efb5b229">DeleteDirectory</a>(<a class="code" href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">RelativePath</a>(StagingDirectory));</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                    lastError = null;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;BYOND: Update completed!&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.DeveloperInfo);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#a33c09fd7ed6d0907549e1cc08ad74562">WriteInfo</a>(String.Format(<span class="stringliteral">&quot;BYOND update {0} completed!&quot;</span>, <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae64d03735cb348d0d162e493bf9b3f68">GetVersion</a>(<a class="code" href="namespace_t_g_service_interface.html#a7610968e566eeb321fee2adba3fbf107">ByondVersion</a>.Installed)), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.BYONDUpdateComplete);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    lastError = e.ToString();</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">SendMessage</a>(<span class="stringliteral">&quot;BYOND: Update failed!&quot;</span>, <a class="code" href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">MessageType</a>.DeveloperInfo);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    <a class="code" href="class_t_g_server_service_1_1_server_instance.html#abc4aea21aa8dfb0039d9e384458b037e">WriteError</a>(<span class="stringliteral">&quot;BYOND update failed! Error: &quot;</span> + e.ToString(), <a class="code" href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">EventID</a>.BYONDUpdateFail);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <span class="keywordflow">finally</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                    lock(ByondLock) {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                        updateStat = <a class="code" href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">ByondStatus</a>.Idle;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                    }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div><div class="ttc" id="namespace_t_g_service_interface_1_1_components_html"><div class="ttname"><a href="namespace_t_g_service_interface_1_1_components.html">TGServiceInterface.Components</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_service_interface_2_components_2_administration_8cs_source.html#l00003">Administration.cs:3</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html_a77ffb8da5e77d0173c9a1a3b8ba0b110"><div class="ttname"><a href="namespace_t_g_server_service.html#a77ffb8da5e77d0173c9a1a3b8ba0b110">TGServerService.MessageType</a></div><div class="ttdeci">MessageType</div><div class="ttdoc">Type of chat message, these may be OR&amp;#39;d together </div><div class="ttdef"><b>Definition:</b> <a href="_message_type_8cs_source.html#l00008">MessageType.cs:8</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ab39a3abd504c56e0d217a7ad475506e4"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ab39a3abd504c56e0d217a7ad475506e4">TGServerService.ServerInstance.DaemonStatus</a></div><div class="ttdeci">DreamDaemonStatus DaemonStatus()</div><div class="ttdoc">Gets the status of DreamDaemon  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00193">DreamDaemon.cs:193</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a19bd19fedfdb8cd0e5701215b483ce3f"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a19bd19fedfdb8cd0e5701215b483ce3f">TGServerService.ServerInstance.ByondLatestURL</a></div><div class="ttdeci">const string ByondLatestURL</div><div class="ttdoc">The URL for getting the latest BYOND version zipfile </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00042">Byond.cs:42</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a1540f43c11b3123d35007af7d56567b6"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a1540f43c11b3123d35007af7d56567b6">TGServerService.ServerInstance.CleanByondStaging</a></div><div class="ttdeci">void CleanByondStaging()</div><div class="ttdoc">Cleans the BYOND staging directory </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00085">Byond.cs:85</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a05bc0ce5b4867dfd63385a30bf713f9e"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a05bc0ce5b4867dfd63385a30bf713f9e">TGServerService.ServerInstance.BusyCheck</a></div><div class="ttdeci">bool BusyCheck()</div><div class="ttdoc">Checks if the updater is considered busy </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00111">Byond.cs:111</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a0ae469ca70e8869f5f5ed794d7fe4ce5"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a0ae469ca70e8869f5f5ed794d7fe4ce5">TGServerService.ServerInstance.DisposeByond</a></div><div class="ttdeci">void DisposeByond()</div><div class="ttdoc">Called when the ServerInstance is shutdown </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00097">Byond.cs:97</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a63d04056dea64487e7eaed6b26b57e3a"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a63d04056dea64487e7eaed6b26b57e3a">TGServerService.ServerInstance.ByondDirectory</a></div><div class="ttdeci">const string ByondDirectory</div><div class="ttdoc">The instance directory to store the BYOND installation </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00018">Byond.cs:18</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a012f09818116b92edf15f9d4aff96dff"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a012f09818116b92edf15f9d4aff96dff">TGServerService.ServerInstance.VersionFile</a></div><div class="ttdeci">const string VersionFile</div><div class="ttdoc">The location of the BYOND version data of an installation </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00034">Byond.cs:34</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html_a98d8f6303b894422167c743e15185398"><div class="ttname"><a href="namespace_t_g_server_service.html#a98d8f6303b894422167c743e15185398">TGServerService.EventID</a></div><div class="ttdeci">EventID</div><div class="ttdoc">Various events and their IDs in no particular order. Found in the Windows event log. These key incremented by 100 and are guaranteed to never be reused in the future. In the windows event viewer, these IDs will be offset by the ServerInstance.LoggingID to distinguish events between instances. Each event ID may be information, a warning, or error and will be documented accordingly. Warnings will occur due to user, data, or network errors. Errors will occur due to filesystem errors or hard faults </div><div class="ttdef"><b>Definition:</b> <a href="_event_i_d_8cs_source.html#l00008">EventID.cs:8</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ae375b158f3e4eb869a967674ed9f3b74"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ae375b158f3e4eb869a967674ed9f3b74">TGServerService.ServerInstance.ByondDDConfig</a></div><div class="ttdeci">const string ByondDDConfig</div><div class="ttdoc">BYOND&amp;#39;s DreamDaemon config file in the cfg modification directory </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00050">Byond.cs:50</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html_a7610968e566eeb321fee2adba3fbf107"><div class="ttname"><a href="namespace_t_g_service_interface.html#a7610968e566eeb321fee2adba3fbf107">TGServiceInterface.ByondVersion</a></div><div class="ttdeci">ByondVersion</div><div class="ttdoc">Type of byond version </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00062">Enumerations.cs:62</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a28e22392a22a56807a3c3a6a3a366860"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a28e22392a22a56807a3c3a6a3a366860">TGServerService.ServerInstance.ApplyStagedUpdate</a></div><div class="ttdeci">bool ApplyStagedUpdate()</div><div class="ttdoc">Attempts to move the staged update from StagingDirectory to ByondDirectory. Sets lastError on failure...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00314">Byond.cs:314</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a2e6fa52a6bc2f17eedd4c5d62f13063f"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a2e6fa52a6bc2f17eedd4c5d62f13063f">TGServerService.ServerInstance.RequestRestart</a></div><div class="ttdeci">void RequestRestart()</div><div class="ttdoc">Restart the server after the currently running world reboots. Has no effect if the server isn&amp;#39;t runni...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_dream_daemon_8cs_source.html#l00202">DreamDaemon.cs:202</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a9adc6c97daa5981c9b4c6128c4df1f11"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a9adc6c97daa5981c9b4c6128c4df1f11">TGServerService.ServerInstance.compilerCurrentStatus</a></div><div class="ttdeci">CompilerStatus compilerCurrentStatus</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_compiler_8cs_source.html#l00039">Compiler.cs:39</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a31b1bd6a8c38575bffb5442fbd75a677"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a31b1bd6a8c38575bffb5442fbd75a677">TGServerService.ServerInstance.CurrentStatus</a></div><div class="ttdeci">ByondStatus CurrentStatus()</div><div class="ttdoc">Gets the current status of any BYOND updates  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00129">Byond.cs:129</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_adcc40d967672331fc5578d052f20743a"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#adcc40d967672331fc5578d052f20743a">TGServerService.ServerInstance.lastError</a></div><div class="ttdeci">string lastError</div><div class="ttdoc">The last error the BYOND updater encountered </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00068">Byond.cs:68</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_afb3e8619b26aae0b35238283f6377c76"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#afb3e8619b26aae0b35238283f6377c76">TGServerService.ServerInstance.ByondNoPromptTrustedMode</a></div><div class="ttdeci">const string ByondNoPromptTrustedMode</div><div class="ttdoc">Setting to add to ByondDDConfig to suppress an invisible user prompt for running a trusted mode ...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00054">Byond.cs:54</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_afcb683e8f7cd91c6e64ce98e007899f4"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#afcb683e8f7cd91c6e64ce98e007899f4">TGServerService.ServerInstance.RevisionStaging</a></div><div class="ttdeci">Thread RevisionStaging</div><div class="ttdoc">Thread used for staging BYOND revisions </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00072">Byond.cs:72</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_aaf67da3d367607fac5b98d52feed5efe"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#aaf67da3d367607fac5b98d52feed5efe">TGServerService.ServerInstance.StagingDirectory</a></div><div class="ttdeci">const string StagingDirectory</div><div class="ttdoc">The instance directory to use when updating the BYOND installation </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00022">Byond.cs:22</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html_af50082a408f9ae6f37a053a7a2464ef3"><div class="ttname"><a href="namespace_t_g_service_interface.html#af50082a408f9ae6f37a053a7a2464ef3">TGServiceInterface.CompilerStatus</a></div><div class="ttdeci">CompilerStatus</div><div class="ttdoc">The status of the compiler </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00117">Enumerations.cs:117</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html_af1c6e932aa16d25cbe05b86e896f3935"><div class="ttname"><a href="namespace_t_g_service_interface.html#af1c6e932aa16d25cbe05b86e896f3935">TGServiceInterface.ByondStatus</a></div><div class="ttdeci">ByondStatus</div><div class="ttdoc">The status of a BYOND update job </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00032">Enumerations.cs:32</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_aae957ffd2966d65e145b02b490d3710e"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#aae957ffd2966d65e145b02b490d3710e">TGServerService.ServerInstance.RevisionDownloadPath</a></div><div class="ttdeci">const string RevisionDownloadPath</div><div class="ttdoc">The path in the instance directory to store the downloaded BYOND revision </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00030">Byond.cs:30</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ae64d03735cb348d0d162e493bf9b3f68"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ae64d03735cb348d0d162e493bf9b3f68">TGServerService.ServerInstance.GetVersion</a></div><div class="ttdeci">string GetVersion(ByondVersion type)</div><div class="ttdoc">Get the currently installed version as a string formatted as Major.Minor  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00149">Byond.cs:149</a></div></div>
<div class="ttc" id="_t_g_command_line_2_program_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_t_g_command_line_2_program_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">using System</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_command_line_2_program_8cs_source.html#l00001">Program.cs:1</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a33c09fd7ed6d0907549e1cc08ad74562"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a33c09fd7ed6d0907549e1cc08ad74562">TGServerService.ServerInstance.WriteInfo</a></div><div class="ttdeci">void WriteInfo(string message, EventID id)</div><div class="ttdoc">Writes information to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_server_instance_8cs_source.html#l00063">ServerInstance.cs:63</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html"><div class="ttname"><a href="namespace_t_g_service_interface.html">TGServiceInterface</a></div><div class="ttdef"><b>Definition:</b> <a href="_chat_setup_info_8cs_source.html#l00006">ChatSetupInfo.cs:6</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a4a2dc7c3b649bf0e7f81362c851a2c8f"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a4a2dc7c3b649bf0e7f81362c851a2c8f">TGServerService.ServerInstance.UpdateToVersionImpl</a></div><div class="ttdeci">void UpdateToVersionImpl(object param)</div><div class="ttdoc">Downloads and unzips a BYOND revision. Calls ApplyStagedUpdate afterwards if the ServerInstance isn&amp;#39;t...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00200">Byond.cs:200</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a43598a044d75089e4c3a0b433bca455b"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a43598a044d75089e4c3a0b433bca455b">TGServerService.ServerInstance.CompilerLock</a></div><div class="ttdeci">object CompilerLock</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_compiler_8cs_source.html#l00038">Compiler.cs:38</a></div></div>
<div class="ttc" id="interface_t_g_service_interface_1_1_components_1_1_i_t_g_byond_html"><div class="ttname"><a href="interface_t_g_service_interface_1_1_components_1_1_i_t_g_byond.html">TGServiceInterface.Components.ITGByond</a></div><div class="ttdoc">For managing the BYOND installation the server runs </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_service_interface_2_components_2_byond_8cs_source.html#l00010">Byond.cs:10</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ae6ea9140e5cf33703628ac25700bc556"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ae6ea9140e5cf33703628ac25700bc556">TGServerService.ServerInstance.SendMessage</a></div><div class="ttdeci">void SendMessage(string msg, MessageType mt)</div><div class="ttdoc">Broadcast a message to appropriate channels based on the message type </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_chat_8cs_source.html#l00232">Chat.cs:232</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a6136aa0574aa874d5532cb528e764d78"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a6136aa0574aa874d5532cb528e764d78">TGServerService.ServerInstance.UpdateToVersion</a></div><div class="ttdeci">bool UpdateToVersion(int major, int minor)</div><div class="ttdoc">updates the used byond version to that of version major .minor . The change won&amp;#39;t take place until DD...</div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00292">Byond.cs:292</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a1f51512799decc40e41edde3d1917d0e"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a1f51512799decc40e41edde3d1917d0e">TGServerService.ServerInstance.InitByond</a></div><div class="ttdeci">void InitByond()</div><div class="ttdoc">Called when the ServerInstance is setup. Prepares the BYOND updater </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00077">Byond.cs:77</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a9f6e141cd76aa497dcf72f14c1219017"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a9f6e141cd76aa497dcf72f14c1219017">TGServerService.ServerInstance.WriteWarning</a></div><div class="ttdeci">void WriteWarning(string message, EventID id)</div><div class="ttdoc">Writes a warning to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_server_instance_8cs_source.html#l00083">ServerInstance.cs:83</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a7d6b306dbbaec279da07bdffc641cd17"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a7d6b306dbbaec279da07bdffc641cd17">TGServerService.ServerInstance.RelativePath</a></div><div class="ttdeci">string RelativePath(string path)</div><div class="ttdoc">Converts relative paths to full ServerInstance directory paths </div><div class="ttdef"><b>Definition:</b> <a href="_server_instance_8cs_source.html#l00102">ServerInstance.cs:102</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a773bda7930c58a1def918b077efcf2a1"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a773bda7930c58a1def918b077efcf2a1">TGServerService.ServerInstance.updateStat</a></div><div class="ttdeci">ByondStatus updateStat</div><div class="ttdoc">The status of the BYOND updater </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00059">Byond.cs:59</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a0c663631406c567c006171c5b6bf361f"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a0c663631406c567c006171c5b6bf361f">TGServerService.ServerInstance.ByondLock</a></div><div class="ttdeci">object ByondLock</div><div class="ttdoc">Used for multithreading safety </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00064">Byond.cs:64</a></div></div>
<div class="ttc" id="namespace_t_g_server_service_html"><div class="ttname"><a href="namespace_t_g_server_service.html">TGServerService</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_abc4aea21aa8dfb0039d9e384458b037e"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#abc4aea21aa8dfb0039d9e384458b037e">TGServerService.ServerInstance.WriteError</a></div><div class="ttdeci">void WriteError(string message, EventID id)</div><div class="ttdoc">Writes an error to the Windows event log </div><div class="ttdef"><b>Definition:</b> <a href="_server_instance_8cs_source.html#l00073">ServerInstance.cs:73</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_program_html_af23c01e40193036d8b54ca95efb5b229"><div class="ttname"><a href="class_t_g_server_service_1_1_program.html#af23c01e40193036d8b54ca95efb5b229">TGServerService.Program.DeleteDirectory</a></div><div class="ttdeci">static void DeleteDirectory(string path, bool ContentsOnly=false, IList&lt; string &gt; excludeRoot=null)</div><div class="ttdoc">Recursive directory deleter </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_program_8cs_source.html#l00041">Program.cs:41</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a74331465cc7db01bbb583a5430e6d506"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a74331465cc7db01bbb583a5430e6d506">TGServerService.ServerInstance.StagingDirectoryInner</a></div><div class="ttdeci">const string StagingDirectoryInner</div><div class="ttdoc">Path to the actual BYOND installation within the StagingDirectory </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00026">Byond.cs:26</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8534ec556abce2125376c3df9fd644c1"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8534ec556abce2125376c3df9fd644c1">TGServerService.ServerInstance.ByondConfigDir</a></div><div class="ttdeci">const string ByondConfigDir</div><div class="ttdoc">The instance directory to modify the BYOND cfg before installation </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00046">Byond.cs:46</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_ac0e13a664468683095e10e352eec8cbf"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#ac0e13a664468683095e10e352eec8cbf">TGServerService.ServerInstance.GetError</a></div><div class="ttdeci">string GetError()</div><div class="ttdoc">Check the last update error. Checking this will clear the value  </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00138">Byond.cs:138</a></div></div>
<div class="ttc" id="namespace_t_g_service_interface_html_a8d0a8727304bcbf3c0b9967701e533e9"><div class="ttname"><a href="namespace_t_g_service_interface.html#a8d0a8727304bcbf3c0b9967701e533e9">TGServiceInterface.DreamDaemonStatus</a></div><div class="ttdeci">DreamDaemonStatus</div><div class="ttdoc">The status of the DD instance </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00140">Enumerations.cs:140</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_server_instance_html_a8602c86bbeaa9a0efaf0dec7f54a5ecb"><div class="ttname"><a href="class_t_g_server_service_1_1_server_instance.html#a8602c86bbeaa9a0efaf0dec7f54a5ecb">TGServerService.ServerInstance.ByondRevisionsURL</a></div><div class="ttdeci">const string ByondRevisionsURL</div><div class="ttdoc">The URL format string for getting BYOND version {0}.{1} zipfile </div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_server_instance_2_byond_8cs_source.html#l00038">Byond.cs:38</a></div></div>
<div class="ttc" id="class_t_g_server_service_1_1_program_html"><div class="ttname"><a href="class_t_g_server_service_1_1_program.html">TGServerService.Program</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_g_server_service_2_program_8cs_source.html#l00008">Program.cs:8</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
